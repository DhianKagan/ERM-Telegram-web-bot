{"version":3,"file":"CodeLogin-BDyjYYX3.js","sources":["../../../web/src/pages/CodeLogin.tsx"],"sourcesContent":["// Страница входа через код подтверждения\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { useSearchParams } from \"react-router-dom\";\r\nimport { useToast } from \"../context/useToast\";\r\nimport authFetch from \"../utils/authFetch\";\r\n\r\nexport default function CodeLogin() {\r\n  const [telegramId, setTelegramId] = useState(\"\");\r\n  const [code, setCode] = useState(\"\");\r\n  const [sent, setSent] = useState(false);\r\n  const { addToast } = useToast();\r\n  const [params] = useSearchParams();\r\n  const expired = params.get(\"expired\");\r\n\r\n  useEffect(() => {\r\n    if (expired) {\r\n      addToast(\"Сессия истекла, войдите снова\", \"error\");\r\n    }\r\n  }, [expired, addToast]);\r\n\r\n  async function send(e?: React.FormEvent) {\r\n    e?.preventDefault();\r\n    const r = await authFetch(\"/api/v1/auth/send_code\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ telegramId: Number(telegramId) }),\r\n    });\r\n    if (r.ok) {\r\n      setSent(true);\r\n      addToast(\"Код отправлен\");\r\n    } else {\r\n      addToast(\"Не удалось отправить код\", \"error\");\r\n    }\r\n  }\r\n\r\n  async function verify(e?: React.FormEvent) {\r\n    e?.preventDefault();\r\n    const res = await authFetch(\"/api/v1/auth/verify_code\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ telegramId: Number(telegramId), code }),\r\n    });\r\n    if (res.ok) {\r\n      window.location.href = \"/\";\r\n    } else {\r\n      addToast(\"Неверный код\", \"error\");\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form className=\"flex flex-col gap-2 p-4\" onSubmit={sent ? verify : send}>\r\n      <input\r\n        id=\"code-login-telegram-id\"\r\n        name=\"telegramId\"\r\n        className=\"border p-2\"\r\n        placeholder=\"Telegram ID\"\r\n        value={telegramId}\r\n        onChange={(e) => setTelegramId(e.target.value)}\r\n      />\r\n      <a\r\n        className=\"text-primary underline\"\r\n        href=\"https://telegram.me/userinfobot\"\r\n        target=\"_blank\"\r\n        rel=\"noopener\"\r\n      >\r\n        Узнать свой ID через @userinfobot\r\n      </a>\r\n      {sent && (\r\n        <input\r\n          id=\"code-login-code\"\r\n          name=\"verificationCode\"\r\n          className=\"border p-2\"\r\n          placeholder=\"Код\"\r\n          value={code}\r\n          onChange={(e) => setCode(e.target.value)}\r\n        />\r\n      )}\r\n      <button type=\"submit\" className=\"bg-primary p-2 text-white\">\r\n        {sent ? \"Войти по коду\" : \"Отправить код\"}\r\n      </button>\r\n    </form>\r\n  );\r\n}\r\n"],"names":["CodeLogin","telegramId","setTelegramId","useState","code","setCode","sent","setSent","addToast","useToast","params","useSearchParams","expired","useEffect","send","authFetch","verify","jsx"],"mappings":"yKAMA,SAAwBA,GAAY,CAClC,KAAM,CAACC,EAAYC,CAAa,EAAIC,EAAAA,SAAS,EAAE,EACzC,CAACC,EAAMC,CAAO,EAAIF,EAAAA,SAAS,EAAE,EAC7B,CAACG,EAAMC,CAAO,EAAIJ,EAAAA,SAAS,EAAK,EAChC,CAAE,SAAAK,CAAA,EAAaC,EAAA,EACf,CAACC,CAAM,EAAIC,EAAA,EACXC,EAAUF,EAAO,IAAI,SAAS,EAEpCG,EAAAA,UAAU,IAAM,CACVD,GACFJ,EAAS,gCAAiC,OAAO,CAErD,EAAG,CAACI,EAASJ,CAAQ,CAAC,EAEtB,eAAeM,EAAK,EAAqB,CACvC,WAAG,kBACO,MAAMC,EAAU,yBAA0B,CAClD,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,WAAY,OAAOd,CAAU,EAAG,CAAA,CACxD,GACK,IACJM,EAAQ,EAAI,EACZC,EAAS,eAAe,GAExBA,EAAS,2BAA4B,OAAO,CAEhD,CAEA,eAAeQ,EAAO,EAAqB,CACzC,WAAG,kBACS,MAAMD,EAAU,2BAA4B,CACtD,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,WAAY,OAAOd,CAAU,EAAG,KAAAG,CAAA,CAAM,CAAA,CAC9D,GACO,GACN,OAAO,SAAS,KAAO,IAEvBI,EAAS,eAAgB,OAAO,CAEpC,CAEA,cACG,OAAA,CAAK,UAAU,0BAA0B,SAAUF,EAAOU,EAASF,EAClE,SAAA,CAAAG,EAAAA,IAAC,QAAA,CACC,GAAG,yBACH,KAAK,aACL,UAAU,aACV,YAAY,cACZ,MAAOhB,EACP,SAAW,GAAMC,EAAc,EAAE,OAAO,KAAK,CAAA,CAAA,EAE/Ce,EAAAA,IAAC,IAAA,CACC,UAAU,yBACV,KAAK,kCACL,OAAO,SACP,IAAI,WACL,SAAA,mCAAA,CAAA,EAGAX,GACCW,EAAAA,IAAC,QAAA,CACC,GAAG,kBACH,KAAK,mBACL,UAAU,aACV,YAAY,MACZ,MAAOb,EACP,SAAW,GAAMC,EAAQ,EAAE,OAAO,KAAK,CAAA,CAAA,EAG3CY,EAAAA,IAAC,UAAO,KAAK,SAAS,UAAU,4BAC7B,SAAAX,EAAO,gBAAkB,eAAA,CAC5B,CAAA,EACF,CAEJ"}