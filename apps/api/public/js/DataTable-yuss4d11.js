import{j as e}from"./index-CiBvN1ph.js";import{b as M,R as y,q as le,t as P,v as ae}from"./vendor-DBLHOZWC.js";import{I as ie}from"./input-DPyG2bFz.js";import{u as q}from"./AuthenticatedApp-BGiyXYX-.js";import{b as H,F as ce,T as de,K as ue,L as me}from"./App-CBKZhWa-.js";function xe({title:o,titleId:a,...i},u){return M.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":a},i),o?M.createElement("title",{id:a},o):null,M.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const fe=M.forwardRef(xe);function ge(){const{query:o,setQuery:a}=q(),{t:i}=H(),u=y.useRef(null),[s,m]=y.useState(o),d=()=>{var b;m(""),a(""),(b=u.current)==null||b.focus()},x=()=>{a(s)},g=b=>{var n;b.key==="Escape"&&(b.stopPropagation(),d(),(n=u.current)==null||n.blur()),b.key==="Enter"&&(b.preventDefault(),x())};return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"pointer-events-none absolute top-1/2 left-2 size-4 -translate-y-1/2 text-gray-400"}),e.jsx(ie,{ref:u,value:s,onChange:b=>m(b.target.value),onKeyDown:g,placeholder:i("search"),"aria-label":i("search"),className:"h-8 w-48 pr-8 pl-8"}),s&&e.jsx("button",{onClick:d,"aria-label":"Очистить",className:"absolute top-1/2 right-2 -translate-y-1/2 text-gray-400 hover:text-black",children:e.jsx(ce,{className:"size-4"})})]}),e.jsx("button",{onClick:x,className:"rounded border px-1.5 py-1",children:i("find")})]})}function be({inline:o=!1}){const{filters:a,setFilters:i,filterUsers:u}=q(),[s,m]=y.useState(a);y.useEffect(()=>{m(a)},[a]);const d=y.useCallback((t,r)=>"".concat(t,"-").concat(r).toLowerCase().replace(/[^a-z0-9а-яё]+/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),[]),x=(t,r)=>{m(p=>{const l=p[t],j=l.includes(r)?l.filter(C=>C!==r):[...l,r];return{...p,[t]:j}})},g=t=>{m(r=>{const l=r.assignees.includes(t)?r.assignees.filter(c=>c!==t):[...r.assignees,t];return{...r,assignees:l}})},b=t=>t.username?"".concat(t.name," (@").concat(t.username,")"):t.name,n=e.jsxs("div",{className:"flex w-52 flex-col gap-1.5 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-semibold uppercase tracking-wide text-gray-600",children:"Статус"}),de.map(t=>{const r=d("status",t);return e.jsxs("label",{className:"flex items-center gap-1 text-[13px]",htmlFor:r,children:[e.jsx("input",{id:r,name:"status[]",type:"checkbox",checked:s.status.includes(t),onChange:()=>x("status",t)}),t]},t)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-semibold uppercase tracking-wide text-gray-600",children:"Приоритет"}),ue.map(t=>{const r=d("priority",t);return e.jsxs("label",{className:"flex items-center gap-1 text-[13px]",htmlFor:r,children:[e.jsx("input",{id:r,name:"priority[]",type:"checkbox",checked:s.priority.includes(t),onChange:()=>x("priority",t)}),t]},t)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-semibold uppercase tracking-wide text-gray-600",children:"Тип задачи"}),me.map(t=>{const r=d("task-type",t);return e.jsxs("label",{className:"flex items-center gap-1 text-[13px]",htmlFor:r,children:[e.jsx("input",{id:r,name:"taskTypes[]",type:"checkbox",checked:s.taskTypes.includes(t),onChange:()=>x("taskTypes",t)}),t]},t)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-semibold uppercase tracking-wide text-gray-600",children:"Исполнители"}),e.jsxs("div",{className:"max-h-28 overflow-y-auto pr-1",children:[u.map(t=>{const r=d("assignee",String(t.id));return e.jsxs("label",{className:"flex items-center gap-1 text-[13px]",htmlFor:r,children:[e.jsx("input",{id:r,name:"assignees[]",type:"checkbox",checked:s.assignees.includes(t.id),onChange:()=>g(t.id)}),b(t)]},t.id)}),u.length===0?e.jsx("span",{className:"block text-[13px] text-muted-foreground",children:"Нет доступных исполнителей"}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{type:"date",className:"rounded border px-1.5 py-1 text-[13px]",name:"from",value:s.from,onChange:t=>m({...s,from:t.target.value})}),e.jsx("input",{type:"date",className:"rounded border px-1.5 py-1 text-[13px]",name:"to",value:s.to,onChange:t=>m({...s,to:t.target.value})})]}),e.jsx("button",{onClick:()=>i(s),className:"mt-1.5 rounded border px-1.5 py-1 text-[13px]",children:"Искать"})]});return o?n:e.jsxs("details",{className:"relative",children:[e.jsx("summary",{className:"cursor-pointer rounded border px-1.5 py-0.5 select-none text-sm",children:"Фильтры"}),e.jsx("div",{className:"absolute z-10 mt-1 rounded border bg-white p-1.5 shadow",children:n})]})}function pe({table:o,children:a,showGlobalSearch:i=!0,showFilters:u=!0}){const s=o.getAllLeafColumns(),{t:m}=H(),d=()=>{const n=s.filter(c=>c.getIsVisible()).map(c=>c.columnDef.header),t=o.getRowModel().rows.map(c=>c.getVisibleCells().map(j=>{var C;return String((C=j.getValue())!=null?C:"")})),r=[n.join(","),...t.map(c=>c.join(","))].join("\n"),p=new Blob([r],{type:"text/csv"}),l=document.createElement("a");l.href=URL.createObjectURL(p),l.download="table.csv",l.click()},x=async()=>{const n="jspdf",t="jspdf-autotable",{default:r}=await import(n);await import(t);const p=s.filter(j=>j.getIsVisible()).map(j=>j.columnDef.header),l=o.getRowModel().rows.map(j=>j.getVisibleCells().map(C=>{var k;return String((k=C.getValue())!=null?k:"")})),c=new r;c.autoTable({head:[p],body:l}),c.save("table.pdf")},g=n=>{const t=o.getColumn(n);t&&t.toggleVisibility()},b=(n,t)=>{const r=o.getState().columnOrder,p=r.indexOf(n);if(p===-1)return;const l=p+t;if(l<0||l>=r.length)return;const c=[...r];[c[p],c[l]]=[c[l],c[p]],o.setColumnOrder(c)};return e.jsxs("div",{className:"flex w-full flex-wrap items-center gap-1 text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex flex-1 flex-wrap items-center gap-1",children:[i?e.jsx(ge,{}):null,a]}),e.jsxs("div",{className:"ml-auto flex w-full flex-wrap items-center justify-end gap-1 sm:w-auto",children:[e.jsxs("details",{className:"group relative flex-shrink-0",children:[e.jsx("summary",{className:"cursor-pointer rounded-t-md rounded-b-none border border-b-0 border-gray-200 bg-white px-2 py-1 text-xs font-semibold leading-tight text-gray-700 shadow-sm transition-colors select-none hover:bg-gray-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-1 group-open:border-gray-200 sm:text-sm",children:m("export")}),e.jsxs("div",{className:"absolute left-0 top-full z-10 w-32 min-w-full rounded-b-md border border-t border-gray-200 bg-white p-1 shadow-sm",children:[e.jsx("button",{onClick:d,className:"block w-full rounded px-1.5 py-1 text-left text-xs font-medium transition-colors hover:bg-gray-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-1 sm:text-sm",children:"CSV"}),e.jsx("button",{onClick:()=>void x(),className:"mt-1 block w-full rounded px-1.5 py-1 text-left text-xs font-medium transition-colors hover:bg-gray-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-1 sm:text-sm",children:"PDF"})]})]}),e.jsxs("details",{className:"group relative flex-shrink-0",children:[e.jsx("summary",{className:"cursor-pointer rounded-t-md rounded-b-none border border-b-0 border-gray-200 bg-white px-2 py-1 text-xs font-semibold leading-tight text-gray-700 shadow-sm transition-colors select-none hover:bg-gray-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-1 group-open:border-gray-200 sm:text-sm",children:m("settings")}),e.jsxs("div",{className:"absolute left-0 top-full z-10 w-64 min-w-full space-y-1 rounded-b-md border border-t border-gray-200 bg-white p-1.5 shadow-sm",children:[u?e.jsx(be,{inline:!0}):null,e.jsx("div",{className:"border-t pt-1",children:s.map(n=>e.jsxs("div",{className:"flex items-center justify-between gap-1",children:[e.jsxs("label",{className:"flex items-center gap-1 text-xs font-medium sm:text-sm",htmlFor:"table-column-".concat(n.id),children:[e.jsx("input",{id:"table-column-".concat(n.id),name:"column-".concat(n.id),type:"checkbox",checked:n.getIsVisible(),onChange:()=>g(n.id)}),n.columnDef.header]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>b(n.id,-1),className:"rounded border border-gray-200 px-1 text-xs font-medium leading-none text-gray-700 transition-colors hover:bg-gray-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-1",children:"←"}),e.jsx("button",{onClick:()=>b(n.id,1),className:"rounded border border-gray-200 px-1 text-xs font-medium leading-none text-gray-700 transition-colors hover:bg-gray-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-1",children:"→"})]})]},n.id))})]})]})]})]})}const he=["inline-flex min-h-[1.65rem] max-w-full items-center justify-start gap-1","rounded-full px-2.5 py-0.5 text-[0.72rem] font-semibold leading-tight text-slate-900","ring-1 ring-slate-300/80 bg-slate-100/90 shadow-xs","dark:text-slate-100 dark:ring-slate-600/60 dark:bg-slate-800/80","truncate"].join(" "),ve="flex flex-wrap items-center gap-1.5",Q=o=>o.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),U=o=>o==null?"":typeof o=="string"?Q(o):typeof o=="number"||typeof o=="boolean"?String(o).trim():"",ye=o=>{const a=[],i=s=>{s&&(a.includes(s)||a.push(s))},u=s=>{if(s==null||s===!1)return;if(typeof s=="string"||typeof s=="number"){const d=String(s).trim();if(!d)return;const x=d.split(/[,\n;]/).map(g=>g.trim()).filter(Boolean);x.length?a.push(...x):a.push(d);return}if(Array.isArray(s)){s.forEach(u);return}if(y.isValidElement(s)){const d=s,x=a.length;if(u(d.props.children),a.length===x){const g=d.props||{};[g["data-badge-label"],g["data-label"],g["aria-label"],g.title].forEach(l=>{if(l==null)return;const c=String(l).trim();i(c)});const n=g.dangerouslySetInnerHTML,t=n&&typeof n.__html=="string"?Q(n.__html):"";t&&i(t);const r=g.renderValue;if(typeof r=="function"){const l=U(r());i(l)}const p=g.getValue;if(typeof p=="function"){const l=U(p());i(l)}}return}const m=String(s).trim();i(m)};return u(o),a},je=(o,a,i,u)=>{const s=ye(o);return s.length?s.length===1?e.jsx("span",{className:a,title:s[0],children:s[0]}):e.jsx("div",{className:i,children:s.map((m,d)=>e.jsx("span",{className:a,title:m,children:m},"".concat(m,"-").concat(d)))}):e.jsx("span",{className:a,title:u,children:u})},we=["relative w-full overflow-auto rounded-xl border border-border/70","bg-background shadow-sm dark:border-border/60"].join(" "),ke=["min-w-full table-auto caption-bottom font-ui text-[12px] leading-tight","text-foreground dark:text-foreground sm:text-[13px]"].join(" "),Ne=["border-b border-border/70 px-1.5 py-1.5 text-left align-middle font-semibold","text-[11px] leading-snug text-foreground sm:px-2 sm:text-[13px]","whitespace-normal"].join(" "),Ce=["relative z-[1] px-1.5 py-1.5 align-top text-[12px] leading-snug","text-foreground sm:px-2 sm:text-sm","whitespace-normal"].join(" "),G=["group relative isolate min-h-[2.5rem] cursor-pointer select-none","odd:bg-sky-50/70 even:bg-emerald-50/70 odd:text-slate-900 even:text-slate-900","hover:odd:bg-sky-100/80 hover:even:bg-emerald-100/80","dark:odd:bg-slate-800/70 dark:even:bg-slate-700/70 dark:text-slate-100","dark:hover:odd:bg-slate-700 dark:hover:even:bg-slate-600"].join(" "),Se=["bg-muted/20 text-foreground"].join(" ");function Me({columns:o,data:a,pageIndex:i,pageSize:u,pageCount:s,onPageChange:m,onPageSizeChange:d,onRowClick:x,toolbarChildren:g,showGlobalSearch:b=!0,showFilters:n=!0,wrapCellsAsBadges:t=!1,badgeClassName:r=he,badgeWrapperClassName:p=ve,badgeEmptyPlaceholder:l="—",enableVirtualization:c=!0,virtualizationOverscan:j=6,virtualizationThreshold:C=40,rowHeight:k=52,maxBodyHeight:V=520}){const[Y,Z]=y.useState({}),[J,X]=y.useState([]),R=le({data:a,columns:o,state:{columnVisibility:Y,columnOrder:J,pagination:{pageIndex:i,pageSize:u}},onColumnVisibilityChange:Z,onColumnOrderChange:X,getCoreRowModel:ae(),manualPagination:!0,pageCount:s}),N=R.getRowModel().rows,E=y.useRef(null),[z,D]=y.useState(0),[ee,te]=y.useState(V),w=c&&N.length>C;y.useLayoutEffect(()=>{if(!w)return;const f=E.current;if(!f)return;const h=()=>{te(f.clientHeight||V)};if(h(),typeof ResizeObserver<"u"){const v=new ResizeObserver(h);return v.observe(f),()=>v.disconnect()}},[w,V]),y.useEffect(()=>{E.current&&(E.current.scrollTop=0,D(0))},[N.length,w]);const se=y.useCallback(f=>{w&&D(f.currentTarget.scrollTop)},[w]),re=N.length*k,oe=w?ee:N.length*k,I=w?Math.max(0,Math.floor(z/k)-j):0,A=w?Math.min(N.length,Math.ceil((z+oe)/k)+j):N.length,ne=w?N.slice(I,A):N,O=w?I*k:0,B=w?Math.max(re-A*k,0):0,W=Math.max(R.getVisibleLeafColumns().length,1);return e.jsxs("div",{className:"w-full space-y-3 px-0 font-ui text-[13px] sm:px-1.5 sm:text-sm",children:[e.jsx(pe,{table:R,showGlobalSearch:b,showFilters:n,children:g}),e.jsx("div",{ref:E,className:we,style:{maxHeight:w?V:void 0},onScroll:se,children:e.jsxs("table",{className:ke,children:[e.jsx("thead",{children:R.getHeaderGroups().map(f=>e.jsx("tr",{className:Se,children:f.headers.map(h=>{var T,F;const v=h.column.columnDef.meta||{},S=h.getSize(),$=typeof v.width=="string"?v.width:Number.isFinite(S)?"".concat(S,"px"):void 0,L=[Ne,v.headerClassName].filter(Boolean).join(" ");return e.jsx("th",{style:{width:$,minWidth:(T=v.minWidth)!=null?T:"4rem",maxWidth:(F=v.maxWidth)!=null?F:"24rem"},className:L,children:h.isPlaceholder?null:P(h.column.columnDef.header,h.getContext())},h.id)})},f.id))}),e.jsxs("tbody",{children:[O>0?e.jsx("tr",{"aria-hidden":!0,style:{height:O},children:e.jsx("td",{colSpan:W})}):null,ne.map(f=>e.jsx("tr",{onClick:()=>x==null?void 0:x(f.original),className:x?G:G.replace("cursor-pointer","cursor-default"),children:f.getVisibleCells().map(h=>{var _,K;const v=h.column.columnDef.meta||{},S=h.column.getSize(),$=typeof v.width=="string"?v.width:Number.isFinite(S)?"".concat(S,"px"):void 0,L=[Ce,v.cellClassName].filter(Boolean).join(" "),T=P(h.column.columnDef.cell,h.getContext()),F=t&&v.renderAsBadges!==!1;return e.jsx("td",{style:{width:$,minWidth:(_=v.minWidth)!=null?_:"4rem",maxWidth:(K=v.maxWidth)!=null?K:"24rem"},className:L,children:F?je(T,r,p,l):T},h.id)})},f.id)),B>0?e.jsx("tr",{"aria-hidden":!0,style:{height:B},children:e.jsx("td",{colSpan:W})}):null,N.length?null:e.jsx("tr",{children:e.jsx("td",{colSpan:W,className:"px-4 py-6 text-center text-sm text-muted-foreground",children:"Нет данных для отображения"})})]})]})}),e.jsxs("div",{className:"flex flex-col gap-2 text-xs sm:flex-row sm:items-center sm:justify-between sm:text-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[e.jsx("button",{onClick:()=>m(Math.max(0,i-1)),disabled:i===0,className:"rounded border border-[color:var(--color-gray-300)] px-2 py-1 font-medium text-[color:var(--color-gray-700)] transition hover:bg-[color:var(--color-gray-50)] disabled:cursor-not-allowed disabled:opacity-50 dark:border-[color:var(--color-gray-700)] dark:text-[color:var(--color-gray-200)] dark:hover:bg-[color:var(--color-gray-800)]",children:"Назад"}),e.jsxs("span",{className:"px-1 text-[color:var(--color-gray-600)] dark:text-[color:var(--color-gray-300)]",children:["Стр. ",i+1,s?" / ".concat(s):""]}),e.jsx("button",{onClick:()=>m(s?Math.min(s-1,i+1):i+1),disabled:s?i+1>=s:!1,className:"rounded border border-[color:var(--color-gray-300)] px-2 py-1 font-medium text-[color:var(--color-gray-700)] transition hover:bg-[color:var(--color-gray-50)] disabled:cursor-not-allowed disabled:opacity-50 dark:border-[color:var(--color-gray-700)] dark:text-[color:var(--color-gray-200)] dark:hover:bg-[color:var(--color-gray-800)]",children:"Вперёд"})]}),d?e.jsx("select",{value:u,onChange:f=>d(Number(f.target.value)),className:"h-8 min-w-[4rem] rounded border border-[color:var(--color-gray-300)] bg-white px-1.5 text-xs text-[color:var(--color-gray-700)] shadow-sm transition focus:border-[color:var(--color-brand-400)] focus:outline-none focus:ring-2 focus:ring-[color:var(--color-brand-200)] dark:border-[color:var(--color-gray-700)] dark:bg-[color:var(--color-gray-dark)] dark:text-[color:var(--color-gray-100)]",children:[10,25,50].map(f=>e.jsx("option",{value:f,children:f},f))}):null]})]})}export{Me as default,he as defaultBadgeClassName,ve as defaultBadgeWrapperClassName};
//# sourceMappingURL=DataTable-yuss4d11.js.map
