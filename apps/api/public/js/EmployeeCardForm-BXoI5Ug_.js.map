{"version":3,"file":"EmployeeCardForm-BXoI5Ug_.js","sources":["../../../web/src/services/roles.ts","../../../web/src/utils/roleDisplay.ts","../../../web/src/components/EmployeeCardForm.tsx"],"sourcesContent":["// Назначение: запросы к API ролей\n// Основные модули: authFetch\nimport authFetch from '../utils/authFetch';\n\nexport interface Role {\n  _id: string;\n  name: string;\n  access: number;\n}\n\nexport const fetchRoles = (): Promise<Role[]> =>\n  authFetch('/api/v1/roles').then((r) => (r.ok ? r.json() : []));\n\nexport const updateRole = (id: string, permissions: number) =>\n  authFetch(`/api/v1/roles/${id}`, {\n    method: 'PATCH',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ permissions }),\n  }).then((r) => r.json());\n","// Назначение файла: функции и константы для отображения названий ролей\n// Основные модули: словарь соответствий ролей и экспортируемые утилиты\n\nexport const ROLE_LABELS: Record<string, string> = {\n  admin: 'Администратор',\n  manager: 'Менеджер',\n  user: 'Сотрудник',\n};\n\nexport interface RoleOption {\n  value: string;\n  label: string;\n}\n\nexport const ROLE_OPTIONS: RoleOption[] = [\n  { value: 'admin', label: ROLE_LABELS.admin },\n  { value: 'manager', label: ROLE_LABELS.manager },\n  { value: 'user', label: ROLE_LABELS.user },\n];\n\nexport const formatRoleName = (role?: string | null): string => {\n  if (!role) return '—';\n  return ROLE_LABELS[role] ?? role;\n};\n","// Назначение: форма карточки сотрудника для создания и редактирования пользователей.\n// Основные модули: React, services/users, services/collections, services/roles.\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n  type FormEvent,\n} from 'react';\nimport clsx from 'clsx';\nimport { Button } from '@/components/ui/button';\nimport ConfirmDialog from './ConfirmDialog';\nimport {\n  fetchCollectionItems,\n  type CollectionItem,\n} from '../services/collections';\nimport { fetchRoles, type Role } from '../services/roles';\nimport { ROLE_OPTIONS } from '../utils/roleDisplay';\nimport {\n  createUser,\n  fetchUser,\n  previewUserCredentials,\n  updateUser,\n  type GeneratedUserCredentials,\n  type UserDetails,\n} from '../services/users';\nimport { useAuth } from '../context/useAuth';\nimport { showToast } from '../utils/toast';\nimport { hasAccess, ACCESS_ADMIN } from '../utils/access';\nimport type { UserFormData } from '../pages/Settings/UserForm';\n\ninterface EmployeeCardFormProps {\n  telegramId?: string;\n  className?: string;\n  mode?: 'create' | 'update';\n  onSaved?: (user: UserDetails) => void;\n}\n\nconst emptyForm: UserFormData = {\n  telegram_id: undefined,\n  username: '',\n  name: '',\n  phone: '',\n  mobNumber: '',\n  email: '',\n  role: 'user',\n  access: 1,\n  roleId: '',\n  departmentId: '',\n  divisionId: '',\n  positionId: '',\n};\n\nfunction mapUserToForm(user: UserDetails): UserFormData {\n  return {\n    telegram_id: user.telegram_id,\n    username: user.telegram_username || user.username || '',\n    name: user.name || '',\n    phone: user.phone || '',\n    mobNumber: user.mobNumber || '',\n    email: user.email || '',\n    role: user.role || 'user',\n    access: user.access,\n    roleId: user.roleId || '',\n    departmentId: user.departmentId || '',\n    divisionId: user.divisionId || '',\n    positionId: user.positionId || '',\n  };\n}\n\nconst normalize = (value: unknown): string => {\n  if (value === undefined || value === null) return '';\n  if (typeof value === 'number') return String(value);\n  return String(value);\n};\n\nexport default function EmployeeCardForm({\n  telegramId,\n  className,\n  mode,\n  onSaved,\n}: EmployeeCardFormProps) {\n  const { user } = useAuth();\n  const [form, setForm] = useState<UserFormData>({ ...emptyForm });\n  const [initialForm, setInitialForm] = useState<UserFormData>({\n    ...emptyForm,\n  });\n  const [departments, setDepartments] = useState<CollectionItem[]>([]);\n  const [divisions, setDivisions] = useState<CollectionItem[]>([]);\n  const [positions, setPositions] = useState<CollectionItem[]>([]);\n  const [roles, setRoles] = useState<Role[]>([]);\n  const resolvedMode = mode ?? (telegramId ? 'update' : 'create');\n  const [loading, setLoading] = useState<boolean>(\n    resolvedMode === 'update' && !!telegramId,\n  );\n  const [error, setError] = useState<string | null>(null);\n  const [saving, setSaving] = useState(false);\n  const [confirmSave, setConfirmSave] = useState(false);\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\n  const [prefillError, setPrefillError] = useState<string | null>(null);\n\n  const isCreateMode = resolvedMode === 'create';\n  const canEdit = hasAccess(user?.access, ACCESS_ADMIN);\n\n  useEffect(() => {\n    fetchCollectionItems('departments', '', 1, 100)\n      .then((d) => setDepartments(d.items))\n      .catch(() => setDepartments([]));\n    fetchCollectionItems('divisions', '', 1, 100)\n      .then((d) => setDivisions(d.items))\n      .catch(() => setDivisions([]));\n    fetchCollectionItems('positions', '', 1, 100)\n      .then((d) => setPositions(d.items))\n      .catch(() => setPositions([]));\n    fetchRoles().then((list) => setRoles(list));\n  }, []);\n\n  const applyGeneratedCredentials = useCallback(\n    (credentials: GeneratedUserCredentials) => {\n      setForm((prev) => ({\n        ...prev,\n        telegram_id: credentials.telegram_id,\n        username: credentials.username,\n      }));\n      setInitialForm((prev) => ({\n        ...prev,\n        telegram_id: credentials.telegram_id,\n        username: credentials.username,\n      }));\n    },\n    [],\n  );\n\n  const requestGeneratedCredentials = useCallback(\n    () => previewUserCredentials(),\n    [],\n  );\n\n  useEffect(() => {\n    setSuccessMessage(null);\n    if (isCreateMode) {\n      setLoading(false);\n      setError(null);\n      setForm({ ...emptyForm });\n      setInitialForm({ ...emptyForm });\n      let active = true;\n      requestGeneratedCredentials()\n        .then((generated) => {\n          if (!active) return;\n          applyGeneratedCredentials(generated);\n          setPrefillError(null);\n        })\n        .catch((error) => {\n          if (!active) return;\n          const message =\n            error instanceof Error\n              ? error.message\n              : 'Не удалось подготовить данные';\n          setPrefillError(message);\n          showToast(message, 'error');\n        });\n      return () => {\n        active = false;\n      };\n    }\n    setPrefillError(null);\n    if (!telegramId) {\n      setLoading(false);\n      setError(null);\n      setForm({ ...emptyForm });\n      setInitialForm({ ...emptyForm });\n      return;\n    }\n    setLoading(true);\n    setError(null);\n    fetchUser(telegramId)\n      .then((data) => {\n        if (!data) {\n          setError('Пользователь не найден');\n          setForm({ ...emptyForm });\n          setInitialForm({ ...emptyForm });\n          return;\n        }\n        const mapped = mapUserToForm(data);\n        setForm(mapped);\n        setInitialForm({ ...mapped });\n      })\n      .catch((e) => {\n        const message = e instanceof Error ? e.message : 'Ошибка загрузки';\n        setError(message || 'Ошибка загрузки');\n        setForm({ ...emptyForm });\n        setInitialForm({ ...emptyForm });\n      })\n      .finally(() => setLoading(false));\n  }, [\n    telegramId,\n    isCreateMode,\n    applyGeneratedCredentials,\n    requestGeneratedCredentials,\n  ]);\n\n  const isDirty = useMemo(() => {\n    if (!canEdit) return false;\n    if (isCreateMode) {\n      return Boolean(form.telegram_id && form.username);\n    }\n    const keys = Object.keys(initialForm) as (keyof UserFormData)[];\n    return keys.some(\n      (key) => normalize(form[key]) !== normalize(initialForm[key]),\n    );\n  }, [canEdit, form, initialForm, isCreateMode]);\n\n  const updateField = <K extends keyof UserFormData>(\n    key: K,\n    value: UserFormData[K],\n  ) => {\n    setSuccessMessage(null);\n    setForm((prev) => ({ ...prev, [key]: value }));\n  };\n\n  const handleRoleChange = (value: string) => {\n    const role = roles.find((r) => r.name === value);\n    setSuccessMessage(null);\n    setForm((prev) => ({\n      ...prev,\n      role: value,\n      roleId: role?._id || prev.roleId,\n      access: role?.access ?? prev.access,\n    }));\n  };\n\n  const resetChanges = () => {\n    if (isCreateMode) {\n      setSuccessMessage(null);\n      setForm({ ...emptyForm });\n      setInitialForm({ ...emptyForm });\n      requestGeneratedCredentials()\n        .then((generated) => {\n          applyGeneratedCredentials(generated);\n          setPrefillError(null);\n        })\n        .catch((error) => {\n          const message =\n            error instanceof Error\n              ? error.message\n              : 'Не удалось подготовить данные';\n          setPrefillError(message);\n          showToast(message, 'error');\n        });\n      return;\n    }\n    setSuccessMessage(null);\n    setForm({ ...initialForm });\n  };\n\n  const handleSubmit = (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (!canEdit) return;\n    if (!isDirty) return;\n    setConfirmSave(true);\n  };\n\n  const persistChanges = async () => {\n    if (!canEdit) {\n      setConfirmSave(false);\n      return;\n    }\n    if (isCreateMode) {\n      if (!form.telegram_id || !form.username) {\n        showToast('Укажите ID и username сотрудника', 'error');\n        setConfirmSave(false);\n        return;\n      }\n      setSaving(true);\n      try {\n        const telegramIdValue = Number(form.telegram_id);\n        if (!Number.isFinite(telegramIdValue)) {\n          throw new Error('ID должен быть числом');\n        }\n        await createUser(telegramIdValue, form.username, form.roleId);\n        const { telegram_id: _, ...payload } = form;\n        const updated = await updateUser(telegramIdValue, payload);\n        if (!updated) throw new Error('Не удалось сохранить изменения');\n        const mapped = mapUserToForm(updated);\n        setForm(mapped);\n        setInitialForm({ ...mapped });\n        onSaved?.(updated);\n        setSuccessMessage('Сотрудник создан');\n      } catch (error) {\n        const message =\n          error instanceof Error ? error.message : 'Не удалось сохранить';\n        showToast(message, 'error');\n      } finally {\n        setSaving(false);\n        setConfirmSave(false);\n      }\n      return;\n    }\n    if (!form.telegram_id) {\n      setConfirmSave(false);\n      return;\n    }\n    setSaving(true);\n    try {\n      const { telegram_id: telegramIdValue, ...payload } = form;\n      const updated = await updateUser(telegramIdValue, payload);\n      if (!updated) throw new Error('Не удалось сохранить изменения');\n      const mapped = mapUserToForm(updated);\n      setForm(mapped);\n      setInitialForm({ ...mapped });\n      onSaved?.(updated);\n      setSuccessMessage('Данные сотрудника сохранены');\n    } catch (error) {\n      const message =\n        error instanceof Error ? error.message : 'Не удалось сохранить';\n      showToast(message, 'error');\n    } finally {\n      setSaving(false);\n      setConfirmSave(false);\n    }\n  };\n\n  if (!telegramId && !isCreateMode) {\n    return (\n      <div className=\"text-sm text-gray-500\">Выберите сотрудника слева</div>\n    );\n  }\n\n  return (\n    <div className={clsx('space-y-4', className)}>\n      <div className=\"space-y-1\">\n        <h2 className=\"text-xl font-semibold\">\n          {isCreateMode ? 'Новый сотрудник' : 'Карточка сотрудника'}\n        </h2>\n        <p className=\"text-sm text-gray-500\">\n          {isCreateMode\n            ? 'Заполните данные и сохраните, чтобы создать запись.'\n            : 'Измените данные и подтвердите сохранение.'}\n        </p>\n      </div>\n      {loading && <div>Загрузка...</div>}\n      {!loading && isCreateMode && prefillError && (\n        <div className=\"rounded border border-rose-200 bg-rose-50 p-3 text-sm text-rose-900\">\n          {prefillError}\n        </div>\n      )}\n      {!loading && error && <div className=\"text-red-600\">{error}</div>}\n      {!loading && !error && (\n        <form\n          onSubmit={handleSubmit}\n          className=\"space-y-4 rounded bg-white p-6 shadow\"\n        >\n          {successMessage && (\n            <div className=\"rounded border border-green-200 bg-green-50 p-3 text-sm text-green-800\">\n              {successMessage}\n            </div>\n          )}\n          {!canEdit && (\n            <div className=\"rounded border border-amber-200 bg-amber-50 p-3 text-sm text-amber-900\">\n              У вас нет прав на редактирование, данные доступны только для\n              чтения.\n            </div>\n          )}\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">ID</span>\n              <input\n                name=\"telegramId\"\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.telegram_id ?? ''}\n                onChange={(e) =>\n                  updateField(\n                    'telegram_id',\n                    e.target.value ? Number(e.target.value) : undefined,\n                  )\n                }\n                readOnly={!isCreateMode}\n                required\n              />\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Username</span>\n              <input\n                name=\"username\"\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.username || ''}\n                onChange={(e) => updateField('username', e.target.value)}\n                readOnly={!isCreateMode}\n                required\n              />\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Имя</span>\n              <input\n                name=\"name\"\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.name || ''}\n                onChange={(e) => updateField('name', e.target.value)}\n                disabled={!canEdit}\n              />\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Телефон</span>\n              <input\n                name=\"phone\"\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.phone || ''}\n                onChange={(e) => updateField('phone', e.target.value)}\n                disabled={!canEdit}\n              />\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Доп. телефон</span>\n              <input\n                name=\"mobNumber\"\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.mobNumber || ''}\n                onChange={(e) => updateField('mobNumber', e.target.value)}\n                disabled={!canEdit}\n              />\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Email</span>\n              <input\n                name=\"email\"\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.email || ''}\n                onChange={(e) => updateField('email', e.target.value)}\n                disabled={!canEdit}\n              />\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Роль</span>\n              <select\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.role || 'user'}\n                onChange={(e) => handleRoleChange(e.target.value)}\n                disabled={!canEdit}\n              >\n                {ROLE_OPTIONS.map((option) => (\n                  <option key={option.value} value={option.value}>\n                    {option.label}\n                  </option>\n                ))}\n              </select>\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Департамент</span>\n              <select\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.departmentId || ''}\n                onChange={(e) => updateField('departmentId', e.target.value)}\n                disabled={!canEdit}\n              >\n                <option value=\"\"></option>\n                {departments.map((d) => (\n                  <option key={d._id} value={d._id}>\n                    {d.name}\n                  </option>\n                ))}\n              </select>\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Отдел</span>\n              <select\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.divisionId || ''}\n                onChange={(e) => updateField('divisionId', e.target.value)}\n                disabled={!canEdit}\n              >\n                <option value=\"\"></option>\n                {divisions.map((d) => (\n                  <option key={d._id} value={d._id}>\n                    {d.name}\n                  </option>\n                ))}\n              </select>\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Должность</span>\n              <select\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.positionId || ''}\n                onChange={(e) => updateField('positionId', e.target.value)}\n                disabled={!canEdit}\n              >\n                <option value=\"\"></option>\n                {positions.map((p) => (\n                  <option key={p._id} value={p._id}>\n                    {p.name}\n                  </option>\n                ))}\n              </select>\n            </label>\n          </div>\n          {canEdit && (\n            <div className=\"flex gap-3\">\n              <Button type=\"submit\" disabled={!isDirty || saving}>\n                {saving ? 'Сохранение...' : 'Сохранить'}\n              </Button>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={resetChanges}\n                disabled={!isDirty || saving}\n              >\n                Очистить\n              </Button>\n            </div>\n          )}\n        </form>\n      )}\n      <ConfirmDialog\n        open={confirmSave}\n        message={\n          isCreateMode\n            ? 'Создать сотрудника?'\n            : 'Сохранить изменения сотрудника?'\n        }\n        onConfirm={persistChanges}\n        onCancel={() => setConfirmSave(false)}\n        confirmText=\"Сохранить\"\n      />\n    </div>\n  );\n}\n"],"names":["fetchRoles","authFetch","r","ROLE_LABELS","ROLE_OPTIONS","formatRoleName","role","_a","emptyForm","mapUserToForm","user","normalize","value","EmployeeCardForm","telegramId","className","mode","onSaved","useAuth","form","setForm","useState","initialForm","setInitialForm","departments","setDepartments","divisions","setDivisions","positions","setPositions","roles","setRoles","resolvedMode","loading","setLoading","error","setError","saving","setSaving","confirmSave","setConfirmSave","successMessage","setSuccessMessage","prefillError","setPrefillError","isCreateMode","canEdit","hasAccess","ACCESS_ADMIN","useEffect","fetchCollectionItems","d","list","applyGeneratedCredentials","useCallback","credentials","prev","requestGeneratedCredentials","previewUserCredentials","active","generated","message","showToast","fetchUser","data","mapped","isDirty","useMemo","key","updateField","handleRoleChange","resetChanges","handleSubmit","event","persistChanges","telegramIdValue","createUser","_","payload","updated","updateUser","jsx","clsx","jsxs","option","p","Button","ConfirmDialog"],"mappings":"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"}