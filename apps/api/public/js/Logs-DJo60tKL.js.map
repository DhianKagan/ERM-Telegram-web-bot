{"version":3,"mappings":"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","names":["ESC","ansiRegex","parseAnsiLogEntry","line","clean","match","res","msg","m","useLogsQuery","filters","page","logs","setLogs","useState","useEffect","params","authFetch","r","data","parsed","l","FiltersPanel","onChange","noCsrfId","React","jsxs","e","jsx","logColumns","DataTable","lazy","__vitePreload","LogViewer","setFilters","live","setLive","setPage","id","current","Suspense","Logs"],"ignoreList":[],"sources":["../../../web/src/utils/parseAnsiLogEntry.ts","../../../web/src/hooks/useLogsQuery.ts","../../../web/src/components/FiltersPanel.tsx","../../../web/src/columns/logColumns.ts","../../../web/src/components/LogViewer.tsx","../../../web/src/pages/Logs.tsx"],"sourcesContent":["// Назначение файла: разбор ANSI-строк логов WG Log Engine\r\n// Модули: регулярные выражения\r\n\r\nexport interface ParsedLog {\r\n  level: string;\r\n  time?: string;\r\n  method?: string;\r\n  status?: number;\r\n  endpoint?: string;\r\n  csrf?: boolean;\r\n  message: string;\r\n}\r\n\r\nconst ESC = \"\\u001b\";\r\nconst ansiRegex = new RegExp(`${ESC}\\\\[[0-9;]*m`, \"g\");\r\n\r\nexport default function parseAnsiLogEntry(line: string): ParsedLog {\r\n  const clean = line.replace(ansiRegex, \"\");\r\n  const match = clean.match(/^(\\w+)\\s+\\[(.+?)\\]\\s+(.*)$/);\r\n  const res: ParsedLog = {\r\n    level: match ? match[1].toLowerCase() : \"info\",\r\n    time: match ? match[2] : undefined,\r\n    message: match ? match[3] : clean,\r\n  };\r\n  const msg = res.message;\r\n  let m;\r\n  if ((m = msg.match(/API запрос (\\w+) (\\S+) token:([^ ]+) csrf:([^ ]+)/))) {\r\n    res.method = m[1];\r\n    res.endpoint = m[2];\r\n    res.csrf = m[4] !== \"no-csrf\";\r\n  } else if ((m = msg.match(/API запрос (\\w+) (\\S+) (\\w+) (\\w+)/))) {\r\n    res.method = m[1];\r\n    res.endpoint = m[2];\r\n    res.csrf = m[4] !== \"no-csrf\";\r\n  } else if ((m = msg.match(/API ответ (\\w+) (\\S+) (\\d+)/))) {\r\n    res.method = m[1];\r\n    res.endpoint = m[2];\r\n    res.status = Number(m[3]);\r\n  }\r\n  return res;\r\n}\r\n","// Назначение файла: загрузка и фильтрация логов\r\n// Модули: React, authFetch, parseAnsiLogEntry\r\nimport { useEffect, useState } from \"react\";\r\nimport authFetch from \"../utils/authFetch\";\r\nimport parseAnsiLogEntry, { ParsedLog } from \"../utils/parseAnsiLogEntry\";\r\n\r\nexport interface LogFilters {\r\n  level?: string;\r\n  message?: string;\r\n  from?: string;\r\n  to?: string;\r\n  method?: string;\r\n  status?: number;\r\n  endpoint?: string;\r\n  noCsrf?: boolean;\r\n}\r\n\r\nexport default function useLogsQuery(filters: LogFilters, page: number) {\r\n  const [logs, setLogs] = useState<ParsedLog[]>([]);\r\n\r\n  useEffect(() => {\r\n    const params = new URLSearchParams();\r\n    if (filters.level) params.set(\"level\", filters.level);\r\n    if (filters.message) params.set(\"message\", filters.message);\r\n    if (filters.from) params.set(\"from\", filters.from);\r\n    if (filters.to) params.set(\"to\", filters.to);\r\n    params.set(\"page\", String(page));\r\n    params.set(\"limit\", \"50\");\r\n    authFetch(`/api/v1/logs?${params.toString()}`)\r\n      .then((r) => (r.ok ? r.json() : []))\r\n      .then((data: { message: string; level: string }[]) => {\r\n        const parsed = data.map((l) =>\r\n          parseAnsiLogEntry(`${l.level} [${l.createdAt}] ${l.message}`),\r\n        );\r\n        setLogs(parsed);\r\n      });\r\n  }, [filters, page]);\r\n\r\n  return logs.filter((l) => {\r\n    if (filters.method && l.method !== filters.method) return false;\r\n    if (filters.status && l.status !== filters.status) return false;\r\n    if (filters.endpoint && !(l.endpoint || \"\").includes(filters.endpoint))\r\n      return false;\r\n    if (filters.noCsrf && l.csrf !== false) return false;\r\n    return true;\r\n  });\r\n}\r\n","// Панель фильтров логов\r\n// Модули: React\r\nimport React from \"react\";\r\nimport { LogFilters } from \"../hooks/useLogsQuery\";\r\n\r\ninterface Props {\r\n  filters: LogFilters;\r\n  onChange: (f: LogFilters) => void;\r\n}\r\n\r\nexport default function FiltersPanel({ filters, onChange }: Props) {\r\n  const noCsrfId = React.useId();\r\n  return (\r\n    <div className=\"flex flex-wrap gap-2\">\r\n      <select\r\n        className=\"rounded border p-1\"\r\n        aria-label=\"Уровень\"\r\n        name=\"level\"\r\n        value={filters.level || \"\"}\r\n        onChange={(e) => onChange({ ...filters, level: e.target.value })}\r\n      >\r\n        <option value=\"\">Все уровни</option>\r\n        <option value=\"debug\">debug</option>\r\n        <option value=\"info\">info</option>\r\n        <option value=\"warn\">warn</option>\r\n        <option value=\"error\">error</option>\r\n        <option value=\"log\">log</option>\r\n      </select>\r\n      <input\r\n        className=\"rounded border p-1\"\r\n        placeholder=\"Метод\"\r\n        aria-label=\"Метод\"\r\n        name=\"method\"\r\n        value={filters.method || \"\"}\r\n        onChange={(e) => onChange({ ...filters, method: e.target.value })}\r\n      />\r\n      <input\r\n        className=\"rounded border p-1\"\r\n        placeholder=\"Endpoint\"\r\n        aria-label=\"Endpoint\"\r\n        name=\"endpoint\"\r\n        value={filters.endpoint || \"\"}\r\n        onChange={(e) => onChange({ ...filters, endpoint: e.target.value })}\r\n      />\r\n      <input\r\n        className=\"rounded border p-1\"\r\n        placeholder=\"Статус\"\r\n        aria-label=\"Статус\"\r\n        name=\"status\"\r\n        value={filters.status || \"\"}\r\n        onChange={(e) =>\r\n          onChange({ ...filters, status: Number(e.target.value) || undefined })\r\n        }\r\n      />\r\n      <input\r\n        className=\"rounded border p-1\"\r\n        placeholder=\"Содержит текст\"\r\n        aria-label=\"Содержит текст\"\r\n        name=\"message\"\r\n        value={filters.message || \"\"}\r\n        onChange={(e) => onChange({ ...filters, message: e.target.value })}\r\n      />\r\n      <input\r\n        type=\"date\"\r\n        className=\"rounded border p-1\"\r\n        aria-label=\"От\"\r\n        name=\"from\"\r\n        value={filters.from || \"\"}\r\n        onChange={(e) => onChange({ ...filters, from: e.target.value })}\r\n      />\r\n      <input\r\n        type=\"date\"\r\n        className=\"rounded border p-1\"\r\n        aria-label=\"До\"\r\n        name=\"to\"\r\n        value={filters.to || \"\"}\r\n        onChange={(e) => onChange({ ...filters, to: e.target.value })}\r\n      />\r\n      <div className=\"flex items-center gap-1 text-sm\">\r\n        <input\r\n          id={noCsrfId}\r\n          name=\"noCsrf\"\r\n          type=\"checkbox\"\r\n          checked={filters.noCsrf || false}\r\n          onChange={(e) => onChange({ ...filters, noCsrf: e.target.checked })}\r\n        />\r\n        <label htmlFor={noCsrfId}>no-csrf</label>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// Конфигурация колонок логов для React Table\r\n// Модули: @tanstack/react-table\r\nimport type { ColumnDef } from \"@tanstack/react-table\";\r\n\r\nexport interface LogRow {\r\n  level: string;\r\n  time: string;\r\n  method: string;\r\n  status: number;\r\n  endpoint: string;\r\n  message: string;\r\n}\r\n\r\nconst logColumns: ColumnDef<LogRow>[] = [\r\n  { header: \"Уровень\", accessorKey: \"level\" },\r\n  { header: \"Время\", accessorKey: \"time\" },\r\n  { header: \"Метод\", accessorKey: \"method\" },\r\n  { header: \"Статус\", accessorKey: \"status\" },\r\n  { header: \"Endpoint\", accessorKey: \"endpoint\" },\r\n  { header: \"Сообщение\", accessorKey: \"message\" },\r\n];\r\n\r\nexport default logColumns;\r\n","// Компонент просмотра логов на React Table\r\n// Модули: React, useLogsQuery, FiltersPanel, DataTable (лениво), logColumns\r\nimport React, { lazy, Suspense } from \"react\";\r\nimport useLogsQuery, { LogFilters } from \"../hooks/useLogsQuery\";\r\nimport FiltersPanel from \"./FiltersPanel\";\r\nconst DataTable = lazy(() => import(\"./DataTable\"));\r\nimport logColumns from \"../columns/logColumns\";\r\n\r\nexport default function LogViewer() {\r\n  const [filters, setFilters] = React.useState<LogFilters>({});\r\n  const [live, setLive] = React.useState(true);\r\n  const [page, setPage] = React.useState(0);\r\n  const logs = useLogsQuery(filters, page + 1);\r\n\r\n  React.useEffect(() => {\r\n    setPage(0);\r\n  }, [filters]);\r\n\r\n  React.useEffect(() => {\r\n    if (!live) return;\r\n    const id = setInterval(\r\n      () => setFilters((current) => ({ ...current })),\r\n      5000,\r\n    );\r\n    return () => clearInterval(id);\r\n  }, [live]);\r\n\r\n  return (\r\n    <div className=\"space-y-4 rounded-lg bg-white p-4 shadow-sm\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h2 className=\"text-xl font-semibold\">Логи</h2>\r\n        <label\r\n          className=\"flex items-center gap-1 text-sm\"\r\n          htmlFor=\"log-live-toggle\"\r\n        >\r\n          <input\r\n            id=\"log-live-toggle\"\r\n            name=\"liveUpdates\"\r\n            type=\"checkbox\"\r\n            checked={live}\r\n            onChange={(e) => setLive(e.target.checked)}\r\n          />\r\n          Live\r\n        </label>\r\n      </div>\r\n      <FiltersPanel filters={filters} onChange={setFilters} />\r\n      <Suspense fallback={<div>Загрузка таблицы...</div>}>\r\n        <DataTable\r\n          columns={logColumns}\r\n          data={logs}\r\n          pageIndex={page}\r\n          pageSize={50}\r\n          onPageChange={setPage}\r\n        />\r\n      </Suspense>\r\n    </div>\r\n  );\r\n}\r\n","// Страница просмотра логов\r\nimport React from \"react\";\r\nimport LogViewer from \"../components/LogViewer\";\r\n\r\nexport default function Logs() {\r\n  return (\r\n    <div className=\"space-y-6 p-4\">\r\n      <LogViewer />\r\n    </div>\r\n  );\r\n}\r\n"],"file":"js/Logs-DJo60tKL.js"}