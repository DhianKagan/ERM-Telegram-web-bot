import{j as a}from"./index-DAGCYRZX.js";import{b as t}from"./vendor-DBLHOZWC.js";import{a as H,B as F,l as J,s as P}from"./App-DjzPhsfn.js";import{f as b}from"./collections-B_MhW3hf.js";const K={admin:"Администратор",manager:"Менеджер",user:"Пользователь"},_={name:"",phone:"",email:""},g=e=>{const m=new Map;return e.forEach(d=>{m.set(d._id,d.name)}),m};function Y(){const{user:e,setUser:m,loading:d}=H(),[l,c]=t.useState({..._}),[i,N]=t.useState({..._}),[y,j]=t.useState([]),[v,w]=t.useState([]),[k,I]=t.useState([]),[p,M]=t.useState(!1),[S,u]=t.useState(null);t.useEffect(()=>{b("departments","",1,200).then(s=>j(s.items)).catch(()=>j([])),b("divisions","",1,200).then(s=>w(s.items)).catch(()=>w([])),b("positions","",1,200).then(s=>I(s.items)).catch(()=>I([]))},[]),t.useEffect(()=>{if(!e)return;const s={name:e.name||e.telegram_username||"",phone:e.phone||"",email:e.email||""};c(s),N(s),u(null)},[e]);const E=t.useMemo(()=>g(y),[y]),O=t.useMemo(()=>g(v),[v]),C=t.useMemo(()=>g(k),[k]),D=t.useMemo(()=>{const s=typeof(e==null?void 0:e.departmentName)=="string"?e.departmentName.trim():"";if(s)return s;const n=typeof(e==null?void 0:e.departmentId)=="string"?e.departmentId.trim():"";return n?E.get(n)||n:""},[E,e==null?void 0:e.departmentId,e==null?void 0:e.departmentName]),U=t.useMemo(()=>{const s=typeof(e==null?void 0:e.divisionName)=="string"?e.divisionName.trim():"";if(s)return s;const n=typeof(e==null?void 0:e.divisionId)=="string"?e.divisionId.trim():"";return n?O.get(n)||n:""},[O,e==null?void 0:e.divisionId,e==null?void 0:e.divisionName]),T=t.useMemo(()=>{const s=typeof(e==null?void 0:e.positionName)=="string"?e.positionName.trim():"";if(s)return s;const n=typeof(e==null?void 0:e.positionId)=="string"?e.positionId.trim():"";return n?C.get(n)||n:""},[C,e==null?void 0:e.positionId,e==null?void 0:e.positionName]),x=(s,n)=>{c(f=>({...f,[s]:n}))},h=t.useMemo(()=>l.name!==i.name||l.phone!==i.phone||l.email!==i.email,[l,i]),q=async s=>{if(s.preventDefault(),!e||!h||p)return;const n=l.name.trim(),f=l.phone.trim(),G=l.email.trim();M(!0),u(null);try{const r=await J({name:n,phone:f||void 0,email:G});m(r);const o={name:r.name||r.telegram_username||"",phone:r.phone||"",email:r.email||""};c(o),N(o),P("Профиль обновлён","success")}catch(r){const o=r instanceof Error?r.message:"Не удалось обновить профиль";u(o),P(o,"error")}finally{M(!1)}},B=()=>{c(i),u(null)};if(d)return a.jsx("div",{children:"Загрузка..."});if(!e)return a.jsx("div",{children:"Профиль недоступен"});const A=e.role?K[e.role]||e.role:"—",L=e.telegram_id?String(e.telegram_id):e.id||"",R=e.telegram_username||"—",z=e.mobNumber||"—";return a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"mx-auto max-w-4xl space-y-4",children:[S&&a.jsx("div",{className:"rounded border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:S}),a.jsxs("form",{onSubmit:q,className:"space-y-4 rounded bg-white p-8 shadow",children:[a.jsx("h2",{className:"text-2xl",children:"Личный кабинет"}),a.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[a.jsxs("label",{className:"space-y-1 md:col-span-2",children:[a.jsx("span",{className:"block text-sm font-medium",children:"ФИО"}),a.jsx("input",{name:"fullName",className:"h-10 w-full rounded border px-3",value:l.name,onChange:s=>x("name",s.target.value),required:!0})]}),a.jsxs("label",{className:"space-y-1",children:[a.jsx("span",{className:"block text-sm font-medium",children:"Телефон"}),a.jsx("input",{name:"phone",className:"h-10 w-full rounded border px-3",value:l.phone,onChange:s=>x("phone",s.target.value),type:"tel",placeholder:""})]}),a.jsxs("label",{className:"space-y-1",children:[a.jsx("span",{className:"block text-sm font-medium",children:"Email"}),a.jsx("input",{name:"email",className:"h-10 w-full rounded border px-3",value:l.email,onChange:s=>x("email",s.target.value),type:"email",required:!0})]}),a.jsxs("label",{className:"space-y-1",children:[a.jsx("span",{className:"block text-sm font-medium",children:"Доп. телефон"}),a.jsx("input",{name:"additionalPhone",className:"h-10 w-full rounded border bg-gray-100 px-3 text-gray-600",value:z,readOnly:!0,disabled:!0})]}),a.jsxs("label",{className:"space-y-1",children:[a.jsx("span",{className:"block text-sm font-medium",children:"Telegram ID"}),a.jsx("input",{name:"telegramId",className:"h-10 w-full rounded border bg-gray-100 px-3 text-gray-600",value:L,readOnly:!0,disabled:!0})]}),a.jsxs("label",{className:"space-y-1",children:[a.jsx("span",{className:"block text-sm font-medium",children:"Username"}),a.jsx("input",{name:"telegramUsername",className:"h-10 w-full rounded border bg-gray-100 px-3 text-gray-600",value:R,readOnly:!0,disabled:!0})]}),a.jsxs("label",{className:"space-y-1",children:[a.jsx("span",{className:"block text-sm font-medium",children:"Роль"}),a.jsx("input",{name:"role",className:"h-10 w-full rounded border bg-gray-100 px-3 text-gray-600",value:A,readOnly:!0,disabled:!0})]}),a.jsxs("label",{className:"space-y-1",children:[a.jsx("span",{className:"block text-sm font-medium",children:"Департамент"}),a.jsx("input",{name:"department",className:"h-10 w-full rounded border bg-gray-100 px-3 text-gray-600",value:D||"—",readOnly:!0,disabled:!0})]}),a.jsxs("label",{className:"space-y-1",children:[a.jsx("span",{className:"block text-sm font-medium",children:"Отдел"}),a.jsx("input",{name:"division",className:"h-10 w-full rounded border bg-gray-100 px-3 text-gray-600",value:U||"—",readOnly:!0,disabled:!0})]}),a.jsxs("label",{className:"space-y-1",children:[a.jsx("span",{className:"block text-sm font-medium",children:"Должность"}),a.jsx("input",{name:"position",className:"h-10 w-full rounded border bg-gray-100 px-3 text-gray-600",value:T||"—",readOnly:!0,disabled:!0})]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(F,{type:"submit",disabled:!h||p,children:p?"Сохранение...":"Сохранить"}),a.jsx(F,{type:"button",variant:"outline",onClick:B,disabled:!h||p,children:"Отменить"})]})]})]})})}export{Y as default};
//# sourceMappingURL=Profile-Bvp2nsrw.js.map
