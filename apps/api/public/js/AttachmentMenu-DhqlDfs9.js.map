{"version":3,"file":"AttachmentMenu-DhqlDfs9.js","sources":["../../../web/src/pages/AttachmentMenu.tsx"],"sourcesContent":["// Страница выбора задачи для Attachment Menu\r\n// Модули: React, useToast, authFetch, shared\r\nimport React, { useEffect, useState } from \"react\";\r\nimport type { Task } from \"shared\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { useToast } from \"../context/useToast\";\r\nimport authFetch from \"../utils/authFetch\";\r\n\r\ntype MenuTask = Task & { task_number: string; createdAt: string };\r\n\r\nexport default function AttachmentMenu() {\r\n  const [tasks, setTasks] = useState<MenuTask[]>([]);\r\n  const { addToast } = useToast();\r\n\r\n  useEffect(() => {\r\n    authFetch(\"/api/v1/tasks?limit=10\", { noRedirect: true })\r\n      .then((r) => {\r\n        if (r.status === 401) {\r\n          addToast(\"Сессия истекла, войдите снова\", \"error\");\r\n          return [];\r\n        }\r\n        return r.ok ? r.json() : [];\r\n      })\r\n      .then((data) =>\r\n        setTasks((Array.isArray(data) ? data : data.tasks || []) as MenuTask[]),\r\n      );\r\n  }, [addToast]);\r\n\r\n  function select(id: string) {\r\n    type TelegramApi = {\r\n      WebApp?: {\r\n        sendData?: (data: string) => void;\r\n      };\r\n    };\r\n    const telegram = (globalThis as typeof globalThis & { Telegram?: TelegramApi }).Telegram;\r\n    telegram?.WebApp?.sendData?.(`task_selected:${id}`);\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4\">\r\n      <h1 className=\"mb-4 text-lg\">Выберите задачу</h1>\r\n      <ul>\r\n        {tasks.map((t) => (\r\n          <li key={t._id} className=\"mb-2\">\r\n            <Button\r\n              onClick={() => select(t._id)}\r\n              variant=\"link\"\r\n              size=\"sm\"\r\n              className=\"px-0\"\r\n            >\r\n              {`${t.task_number} ${t.createdAt.slice(0, 10)} ${t.title}`}\r\n            </Button>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["AttachmentMenu","tasks","setTasks","useState","addToast","useToast","useEffect","authFetch","r","data","select","id","telegram","_b","_a","jsxs","jsx","t","Button"],"mappings":"yKAWA,SAAwBA,GAAiB,CACvC,KAAM,CAACC,EAAOC,CAAQ,EAAIC,EAAAA,SAAqB,CAAA,CAAE,EAC3C,CAAE,SAAAC,CAAA,EAAaC,EAAA,EAErBC,EAAAA,UAAU,IAAM,CACdC,EAAU,yBAA0B,CAAE,WAAY,EAAA,CAAM,EACrD,KAAMC,GACDA,EAAE,SAAW,KACfJ,EAAS,gCAAiC,OAAO,EAC1C,CAAA,GAEFI,EAAE,GAAKA,EAAE,KAAA,EAAS,CAAA,CAC1B,EACA,KAAMC,GACLP,EAAU,MAAM,QAAQO,CAAI,EAAIA,EAAOA,EAAK,OAAS,CAAA,CAAiB,CAAA,CAE5E,EAAG,CAACL,CAAQ,CAAC,EAEb,SAASM,EAAOC,EAAY,SAM1B,MAAMC,EAAY,WAA8D,UAChFC,GAAAC,EAAAF,GAAA,YAAAA,EAAU,SAAV,YAAAE,EAAkB,WAAlB,MAAAD,EAAA,KAAAC,EAA6B,iBAAiB,OAAAH,GAChD,CAEA,OACEI,EAAAA,KAAC,MAAA,CAAI,UAAU,MACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,eAAe,SAAA,kBAAe,EAC5CA,EAAAA,IAAC,MACE,SAAAf,EAAM,IAAKgB,GACVD,EAAAA,IAAC,KAAA,CAAe,UAAU,OACxB,SAAAA,EAAAA,IAACE,EAAA,CACC,QAAS,IAAMR,EAAOO,EAAE,GAAG,EAC3B,QAAQ,OACR,KAAK,KACL,UAAU,OAET,SAAA,GAAG,OAAAA,EAAE,YAAW,KAAI,OAAAA,EAAE,UAAU,MAAM,EAAG,EAAE,EAAC,KAAI,OAAAA,EAAE,MAAK,CAAA,GAPnDA,EAAE,GASX,CACD,CAAA,CACH,CAAA,EACF,CAEJ"}