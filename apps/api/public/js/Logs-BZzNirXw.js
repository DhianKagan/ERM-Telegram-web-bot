const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/DataTable-yuss4d11.js","js/index-CiBvN1ph.js","js/vendor-DBLHOZWC.js","js/index-C9GJ36QG.css","js/input-DPyG2bFz.js","js/App-CBKZhWa-.js","js/AuthenticatedApp-BGiyXYX-.js"])))=>i.map(i=>d[i]);
import{j as s,_ as m}from"./index-CiBvN1ph.js";import{b as d,R as c}from"./vendor-DBLHOZWC.js";import{h as p}from"./App-CBKZhWa-.js";const h="\x1B",g=new RegExp("".concat(h,"\\[[0-9;]*m"),"g");function v(e){const o=e.replace(g,""),r=o.match(/^(\w+)\s+\[(.+?)\]\s+(.*)$/),a={level:r?r[1].toLowerCase():"info",time:r?r[2]:void 0,message:r?r[3]:o},n=a.message;let t;return(t=n.match(/API запрос (\w+) (\S+) token:([^ ]+) csrf:([^ ]+)/))||(t=n.match(/API запрос (\w+) (\S+) (\w+) (\w+)/))?(a.method=t[1],a.endpoint=t[2],a.csrf=t[4]!=="no-csrf"):(t=n.match(/API ответ (\w+) (\S+) (\d+)/))&&(a.method=t[1],a.endpoint=t[2],a.status=Number(t[3])),a}function x(e,o){const[r,a]=d.useState([]);return d.useEffect(()=>{const n=new URLSearchParams;e.level&&n.set("level",e.level),e.message&&n.set("message",e.message),e.from&&n.set("from",e.from),e.to&&n.set("to",e.to),n.set("page",String(o)),n.set("limit","50"),p("/api/v1/logs?".concat(n.toString())).then(t=>t.ok?t.json():[]).then(t=>{const i=t.map(l=>v("".concat(l.level," [").concat(l.createdAt,"] ").concat(l.message)));a(i)})},[e,o]),r.filter(n=>!(e.method&&n.method!==e.method||e.status&&n.status!==e.status||e.endpoint&&!(n.endpoint||"").includes(e.endpoint)||e.noCsrf&&n.csrf!==!1))}function f({filters:e,onChange:o}){const r=c.useId();return s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs("select",{className:"rounded border p-1","aria-label":"Уровень",name:"level",value:e.level||"",onChange:a=>o({...e,level:a.target.value}),children:[s.jsx("option",{value:"",children:"Все уровни"}),s.jsx("option",{value:"debug",children:"debug"}),s.jsx("option",{value:"info",children:"info"}),s.jsx("option",{value:"warn",children:"warn"}),s.jsx("option",{value:"error",children:"error"}),s.jsx("option",{value:"log",children:"log"})]}),s.jsx("input",{className:"rounded border p-1",placeholder:"Метод","aria-label":"Метод",name:"method",value:e.method||"",onChange:a=>o({...e,method:a.target.value})}),s.jsx("input",{className:"rounded border p-1",placeholder:"Endpoint","aria-label":"Endpoint",name:"endpoint",value:e.endpoint||"",onChange:a=>o({...e,endpoint:a.target.value})}),s.jsx("input",{className:"rounded border p-1",placeholder:"Статус","aria-label":"Статус",name:"status",value:e.status||"",onChange:a=>o({...e,status:Number(a.target.value)||void 0})}),s.jsx("input",{className:"rounded border p-1",placeholder:"Содержит текст","aria-label":"Содержит текст",name:"message",value:e.message||"",onChange:a=>o({...e,message:a.target.value})}),s.jsx("input",{type:"date",className:"rounded border p-1","aria-label":"От",name:"from",value:e.from||"",onChange:a=>o({...e,from:a.target.value})}),s.jsx("input",{type:"date",className:"rounded border p-1","aria-label":"До",name:"to",value:e.to||"",onChange:a=>o({...e,to:a.target.value})}),s.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[s.jsx("input",{id:r,name:"noCsrf",type:"checkbox",checked:e.noCsrf||!1,onChange:a=>o({...e,noCsrf:a.target.checked})}),s.jsx("label",{htmlFor:r,children:"no-csrf"})]})]})}const j=[{header:"Уровень",accessorKey:"level"},{header:"Время",accessorKey:"time"},{header:"Метод",accessorKey:"method"},{header:"Статус",accessorKey:"status"},{header:"Endpoint",accessorKey:"endpoint"},{header:"Сообщение",accessorKey:"message"}],b=d.lazy(()=>m(()=>import("./DataTable-yuss4d11.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function w(){const[e,o]=c.useState({}),[r,a]=c.useState(!0),[n,t]=c.useState(0),i=x(e,n+1);return c.useEffect(()=>{t(0)},[e]),c.useEffect(()=>{if(!r)return;const l=setInterval(()=>o(u=>({...u})),5e3);return()=>clearInterval(l)},[r]),s.jsxs("div",{className:"space-y-4 rounded-lg bg-white p-4 shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-xl font-semibold",children:"Логи"}),s.jsxs("label",{className:"flex items-center gap-1 text-sm",htmlFor:"log-live-toggle",children:[s.jsx("input",{id:"log-live-toggle",name:"liveUpdates",type:"checkbox",checked:r,onChange:l=>a(l.target.checked)}),"Live"]})]}),s.jsx(f,{filters:e,onChange:o}),s.jsx(d.Suspense,{fallback:s.jsx("div",{children:"Загрузка таблицы..."}),children:s.jsx(b,{columns:j,data:i,pageIndex:n,pageSize:50,onPageChange:t})})]})}function S(){return s.jsx("div",{className:"space-y-6 p-4",children:s.jsx(w,{})})}export{S as default};
//# sourceMappingURL=Logs-BZzNirXw.js.map
