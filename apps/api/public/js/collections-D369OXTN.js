import{i as f}from"./index-DgL4A3Hy.js";import{h as m}from"./App-C5qf9m0C.js";const j={"Некорректный тип коллекции":"collections.errors.invalidType","Тип коллекции обязателен":"collections.errors.typeRequired","Некорректное название элемента":"collections.errors.invalidName","Название элемента обязательно":"collections.errors.nameRequired","Некорректное значение элемента":"collections.errors.invalidValue","Значение элемента обязательно":"collections.errors.valueRequired","Значение элемента не может быть пустым":"collections.errors.valueRequired","Ошибка валидации":"collections.errors.generalValidation","Ссылка на тему Telegram должна иметь формат https://t.me/c/<id>/<topic>":"collections.errors.invalidTelegramTopicUrl"},k={departments:{"Значение элемента обязательно":"collections.errors.departmentsMustHaveDivisions"}},b=t=>{try{return JSON.parse(t)}catch(e){return}},d=(t,e)=>{var i;if(!t)return"";const s=t.trim();if(!s)return"";const o=e==null?void 0:e.collectionType,n=o&&((i=k[o])==null?void 0:i[s]),r=n!=null?n:j[s];return r?f.t(r):s},w=(t,e)=>{if(!(t!=null&&t.length))return[];const s=t.map(o=>{const n=typeof(o==null?void 0:o.msg)=="string"?o.msg:typeof(o==null?void 0:o.message)=="string"?o.message:"";return d(n,e)}).filter(Boolean);return s.length?s:[f.t("collections.errors.generalValidation")]},v=(t,e)=>{if(!t)return[];if(Array.isArray(t)){const s=t.filter(n=>!!(n&&typeof n=="object"&&"msg"in n));if(s.length)return w(s,e);const o=t.map(n=>typeof n=="string"?d(n,e):"").filter(Boolean);if(o.length)return o}if(typeof t=="string"){const s=b(t);if(s!==void 0){const n=v(s,e);if(n.length)return n}const o=d(t,e);return o?[o]:[]}return[]},u=(t,e,s)=>{const o=t===429?f.t("collections.fallback.rateLimited"):t===403?f.t("collections.fallback.forbidden"):f.t("collections.fallback.loadFailed");if(e){const n=b(e);if(n){const r=w(n.errors,s);if(r.length)return Array.from(new Set(r)).join(". ");const i=v(n.detail,s);if(i.length)return Array.from(new Set(i)).join(". ");const c=d(n.error,s)||d(n.message,s);if(c)return c}else{const r=d(e,s);if(r)return r}}return o},y=t=>{const e=typeof t=="string"?Number.parseFloat(t):typeof t=="number"?t:Number.NaN;return Number.isFinite(e)?e:void 0},C=t=>{var r,i,c,a,l,g,h;const e=(r=t.meta)!=null?r:{},s=typeof e.address=="string"&&e.address.trim().length?e.address.trim():t.value.trim(),o=(a=y((c=e.latitude)!=null?c:(i=e.location)==null?void 0:i.lat))!=null?a:void 0,n=(h=y((g=e.longitude)!=null?g:(l=e.location)==null?void 0:l.lng))!=null?h:void 0;return{...t,address:s,latitude:o,longitude:n,meta:e}},T=async(t,e="",s=1,o=10)=>{const n=await m("/api/v1/collections?type=".concat(t,"&page=").concat(s,"&limit=").concat(o).concat(e?"&search=".concat(encodeURIComponent(e)):""));if(!n.ok){const r=await n.text().catch(()=>"");throw new Error(u(n.status,r,{collectionType:t}))}return n.json()},p=t=>typeof t=="number"&&Number.isFinite(t),x=async(t,e="",s=200)=>{const o=s>0?s:200,n=[];let r=1,i=0;const c=100;for(;r<=c;){const a=await T(t,e,r,o),l=Array.isArray(a.items)?a.items:[];if(!l.length&&n.length===0&&!p(a.total))return[];if(n.push(...l),p(a.total)&&(i=Math.max(i,a.total)),l.length<o||i&&n.length>=i)break;r+=1}return i&&n.length>i?n.slice(0,i):n},A=async(t="",e=1,s=10)=>{var r;const o=await T("objects",t,e,s),n=Array.isArray(o.items)?o.items.map(C):[];return{items:n,total:(r=o.total)!=null?r:n.length}},M=(t,e)=>m("/api/v1/collections",{method:"POST",confirmed:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify({type:t,...e})}).then(async s=>{if(!s.ok){const o=await s.text().catch(()=>"");throw new Error(u(s.status,o,{collectionType:t}))}return s.json()}),S=(t,e,s)=>m("/api/v1/collections/".concat(t),{method:"PUT",confirmed:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(async o=>{if(!o.ok){const n=await o.text().catch(()=>"");throw new Error(u(o.status,n,s))}return o.json()}),F=async t=>{const e=await m("/api/v1/collections/".concat(t),{method:"DELETE",confirmed:!0});if(!e.ok){const s=await e.text().catch(()=>"");throw new Error(u(e.status,s))}return e.json()};export{x as a,A as b,M as c,T as f,F as r,C as t,S as u};
//# sourceMappingURL=collections-D369OXTN.js.map
