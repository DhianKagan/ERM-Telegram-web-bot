{"version":3,"file":"Archive-legacy-CIdXW_3z.js","sources":["../../../web/src/pages/Archive.tsx","../../../web/src/columns/archiveColumns.tsx","../../../web/src/services/archives.ts"],"sourcesContent":["// Страница архива задач\n// Основные модули: React, DataTable, сервисы архива\nimport React from 'react';\nimport DataTable from '../components/DataTable';\nimport archiveColumns from '../columns/archiveColumns';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { useToast } from '../context/useToast';\nimport { useAuth } from '../context/useAuth';\nimport { fetchArchive, purgeArchive } from '../services/archives';\nimport type { ArchiveTask } from '../types/archive';\nimport { ARCHIVE_ACCESS, ACCESS_TASK_DELETE, hasAccess } from '../utils/access';\n\nconst PAGE_SIZE = 25;\n\nconst toId = (value: unknown): string => {\n  if (!value) return '';\n  if (typeof value === 'string') return value;\n  if (typeof value === 'number') return String(value);\n  if (typeof value === 'object' && value !== null && 'toString' in value) {\n    try {\n      return (value as { toString(): string }).toString();\n    } catch {\n      return '';\n    }\n  }\n  return '';\n};\n\nconst normalizeDate = (value: unknown): string | undefined => {\n  if (typeof value === 'string') return value;\n  if (value instanceof Date) return value.toISOString();\n  return undefined;\n};\n\nexport default function ArchivePage() {\n  const { addToast } = useToast();\n  const { user } = useAuth();\n  const [rows, setRows] = React.useState<ArchiveTask[]>([]);\n  const [page, setPage] = React.useState(0);\n  const [pageCount, setPageCount] = React.useState(0);\n  const [total, setTotal] = React.useState(0);\n  const [loading, setLoading] = React.useState(false);\n  const [purging, setPurging] = React.useState(false);\n  const [search, setSearch] = React.useState('');\n  const [appliedSearch, setAppliedSearch] = React.useState('');\n  const [refreshKey, setRefreshKey] = React.useState(0);\n  const [selectedIds, setSelectedIds] = React.useState<Set<string>>(new Set());\n\n  const access = typeof user?.access === 'number' ? user.access : 0;\n  const canViewArchive = hasAccess(access, ARCHIVE_ACCESS);\n  const canPurge = hasAccess(access, ACCESS_TASK_DELETE);\n\n  const visibleCount = React.useMemo(\n    () => rows.filter((row) => row.id).length,\n    [rows],\n  );\n\n  React.useEffect(() => {\n    let cancelled = false;\n    const load = async () => {\n      setLoading(true);\n      try {\n        const data = await fetchArchive({\n          page: page + 1,\n          limit: PAGE_SIZE,\n          search: appliedSearch || undefined,\n        });\n        if (cancelled) return;\n        const mapped = data.items.map((item) => {\n          const record = item as Record<string, unknown>;\n          const id = toId(record._id ?? record.id ?? record.task_number ?? '');\n          return {\n            id,\n            task_number:\n              typeof record.task_number === 'string'\n                ? record.task_number\n                : undefined,\n            title: typeof record.title === 'string' ? record.title : undefined,\n            status:\n              typeof record.status === 'string' ? record.status : undefined,\n            archived_at: normalizeDate(record.archived_at),\n            createdAt: normalizeDate(record.createdAt),\n            archived_by:\n              typeof record.archived_by === 'number' &&\n              Number.isFinite(record.archived_by)\n                ? (record.archived_by as number)\n                : undefined,\n          } satisfies ArchiveTask;\n        });\n        setRows(mapped);\n        setTotal(data.total);\n        setPageCount(data.pages);\n        setSelectedIds((prev) => {\n          const next = new Set<string>();\n          mapped.forEach((row) => {\n            if (row.id && prev.has(row.id)) {\n              next.add(row.id);\n            }\n          });\n          return next;\n        });\n        const maxPageIndex = Math.max((data.pages || 1) - 1, 0);\n        if (page > maxPageIndex) {\n          setPage(maxPageIndex);\n        }\n      } catch (error) {\n        if (!cancelled) {\n          const message =\n            error instanceof Error\n              ? error.message\n              : 'Не удалось загрузить архив задач';\n          addToast(message, 'error');\n        }\n      } finally {\n        if (!cancelled) {\n          setLoading(false);\n        }\n      }\n    };\n    if (canViewArchive) {\n      void load();\n    }\n    return () => {\n      cancelled = true;\n    };\n  }, [page, appliedSearch, refreshKey, canViewArchive, addToast]);\n\n  const handleSearchSubmit = React.useCallback(\n    (event: React.FormEvent<HTMLFormElement>) => {\n      event.preventDefault();\n      setAppliedSearch(search.trim());\n      setPage(0);\n    },\n    [search],\n  );\n\n  const handleSearchReset = React.useCallback(() => {\n    setSearch('');\n    setAppliedSearch('');\n    setPage(0);\n  }, []);\n\n  const handleToggleRow = React.useCallback((id: string, checked: boolean) => {\n    setSelectedIds((prev) => {\n      const next = new Set(prev);\n      if (checked) {\n        next.add(id);\n      } else {\n        next.delete(id);\n      }\n      return next;\n    });\n  }, []);\n\n  const handleToggleAll = React.useCallback(\n    (checked: boolean) => {\n      if (checked) {\n        const next = new Set<string>();\n        rows.forEach((row) => {\n          if (row.id) {\n            next.add(row.id);\n          }\n        });\n        setSelectedIds(next);\n      } else {\n        setSelectedIds(new Set());\n      }\n    },\n    [rows],\n  );\n\n  const handlePurge = React.useCallback(async () => {\n    if (!selectedIds.size) return;\n    setPurging(true);\n    try {\n      const removed = await purgeArchive(Array.from(selectedIds));\n      if (removed > 0) {\n        addToast(`Удалено ${removed} задач`, 'success');\n      } else {\n        addToast('Задачи не были удалены', 'error');\n      }\n      setSelectedIds(new Set());\n      setRefreshKey((prev) => prev + 1);\n    } catch (error) {\n      const message =\n        error instanceof Error\n          ? error.message\n          : 'Не удалось выполнить полное удаление';\n      addToast(message, 'error');\n    } finally {\n      setPurging(false);\n    }\n  }, [selectedIds, addToast]);\n\n  const columns = React.useMemo(\n    () =>\n      archiveColumns({\n        enableSelection: canPurge,\n        selectedIds,\n        onToggleRow: handleToggleRow,\n        onToggleAll: handleToggleAll,\n        visibleCount,\n      }),\n    [canPurge, selectedIds, handleToggleRow, handleToggleAll, visibleCount],\n  );\n\n  if (!canViewArchive) {\n    return (\n      <div className=\"space-y-4\">\n        <h1 className=\"text-2xl font-semibold\">Архив задач</h1>\n        <p className=\"text-sm text-muted-foreground\">\n          Недостаточно прав для просмотра архива.\n        </p>\n      </div>\n    );\n  }\n\n  const totalLabel = (() => {\n    const remainder10 = total % 10;\n    const remainder100 = total % 100;\n    if (remainder10 === 1 && remainder100 !== 11) return 'задача';\n    if ([2, 3, 4].includes(remainder10) && ![12, 13, 14].includes(remainder100))\n      return 'задачи';\n    return 'задач';\n  })();\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Архив задач</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Здесь отображаются удалённые задачи только для чтения.\n          </p>\n        </div>\n        {canPurge ? (\n          <Button\n            type=\"button\"\n            variant=\"destructive\"\n            disabled={!selectedIds.size || purging || loading}\n            onClick={handlePurge}\n          >\n            Полное удаление\n          </Button>\n        ) : null}\n      </div>\n      <form\n        onSubmit={handleSearchSubmit}\n        className=\"flex flex-col gap-2 sm:flex-row sm:items-center\"\n      >\n        <Input\n          value={search}\n          onChange={(event) => setSearch(event.target.value)}\n          placeholder=\"Поиск по номеру или названию\"\n          aria-label=\"Поиск по архиву\"\n        />\n        <div className=\"flex gap-2\">\n          <Button type=\"submit\" variant=\"secondary\" disabled={loading}>\n            Искать\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            disabled={loading || (!appliedSearch && !search)}\n            onClick={handleSearchReset}\n          >\n            Сбросить\n          </Button>\n        </div>\n      </form>\n      {loading ? (\n        <div className=\"text-sm text-muted-foreground\">Загрузка архива...</div>\n      ) : null}\n      <DataTable<ArchiveTask>\n        columns={columns}\n        data={rows}\n        pageIndex={page}\n        pageSize={PAGE_SIZE}\n        pageCount={pageCount}\n        onPageChange={setPage}\n        showGlobalSearch={false}\n        showFilters={false}\n      />\n      <div className=\"text-sm text-muted-foreground\">\n        Найдено {total} {totalLabel}\n      </div>\n    </div>\n  );\n}\n","// Конфигурация колонок архива задач\n// Основные модули: React, @tanstack/react-table\nimport React from 'react';\nimport type { ColumnDef } from '@tanstack/react-table';\nimport type { ArchiveTask } from '../types/archive';\n\nconst dateTimeFormatter = new Intl.DateTimeFormat('ru-RU', {\n  dateStyle: 'short',\n  timeStyle: 'short',\n});\n\nfunction formatDate(value?: string) {\n  if (!value) return '—';\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) return value;\n  return dateTimeFormatter.format(date);\n}\n\nexport default function archiveColumns({\n  enableSelection,\n  selectedIds,\n  onToggleRow,\n  onToggleAll,\n  visibleCount,\n}: {\n  enableSelection: boolean;\n  selectedIds: Set<string>;\n  onToggleRow: (id: string, checked: boolean) => void;\n  onToggleAll: (checked: boolean) => void;\n  visibleCount: number;\n}): ColumnDef<ArchiveTask>[] {\n  const columns: ColumnDef<ArchiveTask>[] = [];\n  if (enableSelection) {\n    columns.push({\n      id: 'select',\n      header: () => {\n        const allSelected =\n          visibleCount > 0 && selectedIds.size >= visibleCount;\n        const indeterminate =\n          selectedIds.size > 0 && selectedIds.size < visibleCount;\n        return (\n          <input\n            type=\"checkbox\"\n            aria-label=\"Выбрать все\"\n            checked={allSelected}\n            ref={(el) => {\n              if (el) el.indeterminate = indeterminate && !allSelected;\n            }}\n            onChange={(event) => onToggleAll(event.target.checked)}\n          />\n        );\n      },\n      cell: ({ row }) => {\n        const id = row.original.id;\n        if (!id) {\n          return <span className=\"text-muted-foreground\">—</span>;\n        }\n        return (\n          <input\n            type=\"checkbox\"\n            aria-label={`Выбрать задачу ${row.original.task_number || id}`}\n            checked={selectedIds.has(id)}\n            onChange={(event) => onToggleRow(id, event.target.checked)}\n          />\n        );\n      },\n      meta: { width: '3rem', minWidth: '3rem', maxWidth: '3rem' },\n    });\n  }\n  columns.push(\n    {\n      header: 'Номер',\n      accessorKey: 'task_number',\n      meta: {\n        width: '8rem',\n        minWidth: '6rem',\n        maxWidth: '8rem',\n        cellClassName: 'font-mono text-xs sm:text-sm',\n      },\n      cell: ({ row }) => row.original.task_number || row.original.id || '—',\n    },\n    {\n      header: 'Название',\n      accessorKey: 'title',\n      meta: {\n        width: '16rem',\n        minWidth: '10rem',\n        maxWidth: '22rem',\n        cellClassName: 'whitespace-normal',\n      },\n      cell: ({ row }) => {\n        const title = row.original.title || '—';\n        return (\n          <span className=\"line-clamp-2 break-words text-sm\">{title}</span>\n        );\n      },\n    },\n    {\n      header: 'Статус',\n      accessorKey: 'status',\n      meta: {\n        width: '8rem',\n        minWidth: '6rem',\n        maxWidth: '10rem',\n      },\n      cell: ({ row }) => row.original.status || '—',\n    },\n    {\n      header: 'Удалена',\n      accessorKey: 'archived_at',\n      meta: {\n        width: '10rem',\n        minWidth: '8rem',\n        maxWidth: '12rem',\n      },\n      cell: ({ row }) => formatDate(row.original.archived_at),\n    },\n  );\n  return columns;\n}\n","// Назначение: запросы к API архива задач\n// Основные модули: authFetch\nimport authFetch from '../utils/authFetch';\n\nexport interface ArchiveListResult {\n  items: Array<Record<string, unknown>>;\n  total: number;\n  page: number;\n  pages: number;\n}\n\nexport async function fetchArchive(\n  params: { page?: number; limit?: number; search?: string } = {},\n): Promise<ArchiveListResult> {\n  const query = new URLSearchParams();\n  if (params.page) query.set('page', String(params.page));\n  if (params.limit) query.set('limit', String(params.limit));\n  if (params.search) query.set('search', params.search.trim());\n  const suffix = query.toString();\n  const url = suffix ? `/api/v1/archives?${suffix}` : '/api/v1/archives';\n  const response = await authFetch(url);\n  if (!response.ok) {\n    const text = await response.text().catch(() => '');\n    throw new Error(text || 'Не удалось загрузить архив задач');\n  }\n  const data = await response.json();\n  return {\n    items: Array.isArray(data.items) ? data.items : [],\n    total: Number(data.total) || 0,\n    page: Number(data.page) || 1,\n    pages: Number(data.pages) || 0,\n  };\n}\n\nexport async function purgeArchive(ids: string[]): Promise<number> {\n  if (!Array.isArray(ids) || ids.length === 0) {\n    return 0;\n  }\n  const response = await authFetch('/api/v1/archives/purge', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({ ids }),\n  });\n  if (!response.ok) {\n    const text = await response.text().catch(() => '');\n    throw new Error(text || 'Не удалось выполнить полное удаление');\n  }\n  const payload = await response.json();\n  return Number(payload.removed) || 0;\n}\n"],"names":["addToast","useToast","user","useAuth","_React$useState2","_slicedToArray","React","useState","rows","setRows","_React$useState4","page","setPage","_React$useState6","pageCount","setPageCount","_React$useState8","total","setTotal","_React$useState0","loading","setLoading","_React$useState10","purging","setPurging","_React$useState12","search","setSearch","_React$useState14","appliedSearch","setAppliedSearch","_React$useState16","refreshKey","setRefreshKey","_React$useState18","Set","selectedIds","setSelectedIds","access","canViewArchive","hasAccess","ARCHIVE_ACCESS","canPurge","ACCESS_TASK_DELETE","visibleCount","useMemo","filter","row","id","length","useEffect","cancelled","load","_callee","data","mapped","maxPageIndex","message","_t","_regenerator","w","_context","p","n","fetchArchive","limit","PAGE_SIZE","v","a","items","map","item","_ref8","_ref9","_record$_id","record","toId","_id","task_number","title","status","archived_at","normalizeDate","createdAt","archived_by","Number","isFinite","pages","prev","next","forEach","has","add","Math","max","Error","f","handleSearchSubmit","useCallback","event","preventDefault","trim","handleSearchReset","handleToggleRow","checked","delete","handleToggleAll","handlePurge","_asyncToGenerator","m","_callee2","removed","_t2","_context2","size","purgeArchive","Array","from","concat","columns","_ref","enableSelection","onToggleRow","onToggleAll","push","header","allSelected","indeterminate","jsx","type","ref","el","onChange","target","cell","_ref2","original","className","children","meta","width","minWidth","maxWidth","accessorKey","cellClassName","_ref3","_ref4","_ref6","value","date","Date","isNaN","getTime","dateTimeFormatter","format","formatDate","archiveColumns","jsxs","totalLabel","remainder10","remainder100","includes","Button","variant","disabled","onClick","onSubmit","Input","placeholder","DataTable","pageIndex","pageSize","onPageChange","showGlobalSearch","showFilters","Intl","DateTimeFormat","dateStyle","timeStyle","_fetchArchive","apply","this","arguments","_callee3","params","query","suffix","url","response","text","_args3","_context3","undefined","URLSearchParams","set","String","toString","authFetch","ok","catch","json","isArray","_callee4","ids","payload","_context4","method","headers","body","JSON","stringify","_typeof","_unused","toISOString"],"mappings":"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"}