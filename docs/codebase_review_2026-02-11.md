# Codebase review backlog (2026-02-11)

## 1) Опечатка (typo)

**Где:** `apps/api/src/system/stackHealth.service.ts`.

**Наблюдение:** в диагностическом сообщении для HTTP 5xx есть опечатка `upsteam`.

**Задача:** заменить `upsteam` на `upstream` в строке подсказки, чтобы избежать путаницы в продакшн-логах.

## 2) Исправление ошибки (bugfix)

**Где:** `apps/api/src/tasks/taskComments.ts` + `apps/api/src/controllers/taskSync.controller.ts`.

**Наблюдение:** функция `hasRenderableComment()` без проверки вызывает `convertHtmlToMarkdown(value)`. При несовместимом импорте/моке возникает `TypeError`, который уже всплывал во время тест-прогона и приводил к fallback-поведению с ошибкой в логах.

**Задача:** сделать безопасную деградацию в `hasRenderableComment()` (проверка типа экспортируемой функции и/или безопасный fallback), чтобы синхронизация комментариев не зависела от формы экспорта в тестовой/рантайм-среде.

## 3) Исправление комментария/документации (несоответствие)

**Где:** `docs/technical_manual.md`.

**Наблюдение:** в руководстве перечислены тесты с расширением `.js` (`routeCsrf.test.js`, `taskFields.test.js`, `loginFlow.test.js`, `loginRouteFlow.test.js`, `authService.test.js`, `tasksService.test.js`), тогда как в репозитории используются TypeScript-файлы `.ts`.

**Задача:** обновить документацию до актуальных имён тестов и команд запуска, чтобы инструкция соответствовала реальному состоянию проекта.

## 4) Улучшение теста

**Где:** `tests/playwright/task-done.flow.spec.ts`.

**Наблюдение:** в e2e-проверке используются только `expect(response.ok()).toBeTruthy()` для двух запросов. Это не диагностирует статус-коды и не помогает быстро понять причину регрессии.

**Задача:** усилить тест: проверять конкретный `status() === 200`, добавить минимальную валидацию контрактов ответа (наличие `inline_keyboard`, структура callback_data) и осмысленные сообщения ошибок.
