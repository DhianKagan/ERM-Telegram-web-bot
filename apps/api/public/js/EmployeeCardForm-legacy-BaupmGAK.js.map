{"version":3,"file":"EmployeeCardForm-legacy-BaupmGAK.js","sources":["../../../web/src/services/roles.ts","../../../web/src/utils/roleDisplay.ts","../../../web/src/components/EmployeeCardForm.tsx"],"sourcesContent":["// Назначение: запросы к API ролей\n// Основные модули: authFetch\nimport authFetch from '../utils/authFetch';\n\nexport interface Role {\n  _id: string;\n  name: string;\n  access: number;\n}\n\nexport const fetchRoles = (): Promise<Role[]> =>\n  authFetch('/api/v1/roles').then((r) => (r.ok ? r.json() : []));\n\nexport const updateRole = (id: string, permissions: number) =>\n  authFetch(`/api/v1/roles/${id}`, {\n    method: 'PATCH',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ permissions }),\n  }).then((r) => r.json());\n","// Назначение файла: функции и константы для отображения названий ролей\n// Основные модули: словарь соответствий ролей и экспортируемые утилиты\n\nexport const ROLE_LABELS: Record<string, string> = {\n  admin: 'Администратор',\n  manager: 'Менеджер',\n  user: 'Сотрудник',\n};\n\nexport interface RoleOption {\n  value: string;\n  label: string;\n}\n\nexport const ROLE_OPTIONS: RoleOption[] = [\n  { value: 'admin', label: ROLE_LABELS.admin },\n  { value: 'manager', label: ROLE_LABELS.manager },\n  { value: 'user', label: ROLE_LABELS.user },\n];\n\nexport const formatRoleName = (role?: string | null): string => {\n  if (!role) return '—';\n  return ROLE_LABELS[role] ?? role;\n};\n","// Назначение: форма карточки сотрудника для создания и редактирования пользователей.\n// Основные модули: React, services/users, services/collections, services/roles.\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n  type FormEvent,\n} from 'react';\nimport clsx from 'clsx';\nimport { Button } from '@/components/ui/button';\nimport ConfirmDialog from './ConfirmDialog';\nimport {\n  fetchCollectionItems,\n  type CollectionItem,\n} from '../services/collections';\nimport { fetchRoles, type Role } from '../services/roles';\nimport { ROLE_OPTIONS } from '../utils/roleDisplay';\nimport {\n  createUser,\n  fetchUser,\n  previewUserCredentials,\n  updateUser,\n  type GeneratedUserCredentials,\n  type UserDetails,\n} from '../services/users';\nimport { useAuth } from '../context/useAuth';\nimport { showToast } from '../utils/toast';\nimport { hasAccess, ACCESS_ADMIN } from '../utils/access';\nimport type { UserFormData } from '../pages/Settings/UserForm';\n\ninterface EmployeeCardFormProps {\n  telegramId?: string;\n  className?: string;\n  mode?: 'create' | 'update';\n  onSaved?: (user: UserDetails) => void;\n}\n\nconst emptyForm: UserFormData = {\n  telegram_id: undefined,\n  username: '',\n  name: '',\n  phone: '',\n  mobNumber: '',\n  email: '',\n  role: 'user',\n  access: 1,\n  roleId: '',\n  departmentId: '',\n  divisionId: '',\n  positionId: '',\n};\n\nfunction mapUserToForm(user: UserDetails): UserFormData {\n  return {\n    telegram_id: user.telegram_id,\n    username: user.telegram_username || user.username || '',\n    name: user.name || '',\n    phone: user.phone || '',\n    mobNumber: user.mobNumber || '',\n    email: user.email || '',\n    role: user.role || 'user',\n    access: user.access,\n    roleId: user.roleId || '',\n    departmentId: user.departmentId || '',\n    divisionId: user.divisionId || '',\n    positionId: user.positionId || '',\n  };\n}\n\nconst normalize = (value: unknown): string => {\n  if (value === undefined || value === null) return '';\n  if (typeof value === 'number') return String(value);\n  return String(value);\n};\n\nexport default function EmployeeCardForm({\n  telegramId,\n  className,\n  mode,\n  onSaved,\n}: EmployeeCardFormProps) {\n  const { user } = useAuth();\n  const [form, setForm] = useState<UserFormData>({ ...emptyForm });\n  const [initialForm, setInitialForm] = useState<UserFormData>({\n    ...emptyForm,\n  });\n  const [departments, setDepartments] = useState<CollectionItem[]>([]);\n  const [divisions, setDivisions] = useState<CollectionItem[]>([]);\n  const [positions, setPositions] = useState<CollectionItem[]>([]);\n  const [roles, setRoles] = useState<Role[]>([]);\n  const resolvedMode = mode ?? (telegramId ? 'update' : 'create');\n  const [loading, setLoading] = useState<boolean>(\n    resolvedMode === 'update' && !!telegramId,\n  );\n  const [error, setError] = useState<string | null>(null);\n  const [saving, setSaving] = useState(false);\n  const [confirmSave, setConfirmSave] = useState(false);\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\n  const [prefillError, setPrefillError] = useState<string | null>(null);\n\n  const isCreateMode = resolvedMode === 'create';\n  const canEdit = hasAccess(user?.access, ACCESS_ADMIN);\n\n  useEffect(() => {\n    fetchCollectionItems('departments', '', 1, 100)\n      .then((d) => setDepartments(d.items))\n      .catch(() => setDepartments([]));\n    fetchCollectionItems('divisions', '', 1, 100)\n      .then((d) => setDivisions(d.items))\n      .catch(() => setDivisions([]));\n    fetchCollectionItems('positions', '', 1, 100)\n      .then((d) => setPositions(d.items))\n      .catch(() => setPositions([]));\n    fetchRoles().then((list) => setRoles(list));\n  }, []);\n\n  const applyGeneratedCredentials = useCallback(\n    (credentials: GeneratedUserCredentials) => {\n      setForm((prev) => ({\n        ...prev,\n        telegram_id: credentials.telegram_id,\n        username: credentials.username,\n      }));\n      setInitialForm((prev) => ({\n        ...prev,\n        telegram_id: credentials.telegram_id,\n        username: credentials.username,\n      }));\n    },\n    [],\n  );\n\n  const requestGeneratedCredentials = useCallback(\n    () => previewUserCredentials(),\n    [],\n  );\n\n  useEffect(() => {\n    setSuccessMessage(null);\n    if (isCreateMode) {\n      setLoading(false);\n      setError(null);\n      setForm({ ...emptyForm });\n      setInitialForm({ ...emptyForm });\n      let active = true;\n      requestGeneratedCredentials()\n        .then((generated) => {\n          if (!active) return;\n          applyGeneratedCredentials(generated);\n          setPrefillError(null);\n        })\n        .catch((error) => {\n          if (!active) return;\n          const message =\n            error instanceof Error\n              ? error.message\n              : 'Не удалось подготовить данные';\n          setPrefillError(message);\n          showToast(message, 'error');\n        });\n      return () => {\n        active = false;\n      };\n    }\n    setPrefillError(null);\n    if (!telegramId) {\n      setLoading(false);\n      setError(null);\n      setForm({ ...emptyForm });\n      setInitialForm({ ...emptyForm });\n      return;\n    }\n    setLoading(true);\n    setError(null);\n    fetchUser(telegramId)\n      .then((data) => {\n        if (!data) {\n          setError('Пользователь не найден');\n          setForm({ ...emptyForm });\n          setInitialForm({ ...emptyForm });\n          return;\n        }\n        const mapped = mapUserToForm(data);\n        setForm(mapped);\n        setInitialForm({ ...mapped });\n      })\n      .catch((e) => {\n        const message = e instanceof Error ? e.message : 'Ошибка загрузки';\n        setError(message || 'Ошибка загрузки');\n        setForm({ ...emptyForm });\n        setInitialForm({ ...emptyForm });\n      })\n      .finally(() => setLoading(false));\n  }, [\n    telegramId,\n    isCreateMode,\n    applyGeneratedCredentials,\n    requestGeneratedCredentials,\n  ]);\n\n  const isDirty = useMemo(() => {\n    if (!canEdit) return false;\n    if (isCreateMode) {\n      return Boolean(form.telegram_id && form.username);\n    }\n    const keys = Object.keys(initialForm) as (keyof UserFormData)[];\n    return keys.some(\n      (key) => normalize(form[key]) !== normalize(initialForm[key]),\n    );\n  }, [canEdit, form, initialForm, isCreateMode]);\n\n  const updateField = <K extends keyof UserFormData>(\n    key: K,\n    value: UserFormData[K],\n  ) => {\n    setSuccessMessage(null);\n    setForm((prev) => ({ ...prev, [key]: value }));\n  };\n\n  const handleRoleChange = (value: string) => {\n    const role = roles.find((r) => r.name === value);\n    setSuccessMessage(null);\n    setForm((prev) => ({\n      ...prev,\n      role: value,\n      roleId: role?._id || prev.roleId,\n      access: role?.access ?? prev.access,\n    }));\n  };\n\n  const resetChanges = () => {\n    if (isCreateMode) {\n      setSuccessMessage(null);\n      setForm({ ...emptyForm });\n      setInitialForm({ ...emptyForm });\n      requestGeneratedCredentials()\n        .then((generated) => {\n          applyGeneratedCredentials(generated);\n          setPrefillError(null);\n        })\n        .catch((error) => {\n          const message =\n            error instanceof Error\n              ? error.message\n              : 'Не удалось подготовить данные';\n          setPrefillError(message);\n          showToast(message, 'error');\n        });\n      return;\n    }\n    setSuccessMessage(null);\n    setForm({ ...initialForm });\n  };\n\n  const handleSubmit = (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (!canEdit) return;\n    if (!isDirty) return;\n    setConfirmSave(true);\n  };\n\n  const persistChanges = async () => {\n    if (!canEdit) {\n      setConfirmSave(false);\n      return;\n    }\n    if (isCreateMode) {\n      if (!form.telegram_id || !form.username) {\n        showToast('Укажите ID и username сотрудника', 'error');\n        setConfirmSave(false);\n        return;\n      }\n      setSaving(true);\n      try {\n        const telegramIdValue = Number(form.telegram_id);\n        if (!Number.isFinite(telegramIdValue)) {\n          throw new Error('ID должен быть числом');\n        }\n        await createUser(telegramIdValue, form.username, form.roleId);\n        const { telegram_id: _, ...payload } = form;\n        const updated = await updateUser(telegramIdValue, payload);\n        if (!updated) throw new Error('Не удалось сохранить изменения');\n        const mapped = mapUserToForm(updated);\n        setForm(mapped);\n        setInitialForm({ ...mapped });\n        onSaved?.(updated);\n        setSuccessMessage('Сотрудник создан');\n      } catch (error) {\n        const message =\n          error instanceof Error ? error.message : 'Не удалось сохранить';\n        showToast(message, 'error');\n      } finally {\n        setSaving(false);\n        setConfirmSave(false);\n      }\n      return;\n    }\n    if (!form.telegram_id) {\n      setConfirmSave(false);\n      return;\n    }\n    setSaving(true);\n    try {\n      const { telegram_id: telegramIdValue, ...payload } = form;\n      const updated = await updateUser(telegramIdValue, payload);\n      if (!updated) throw new Error('Не удалось сохранить изменения');\n      const mapped = mapUserToForm(updated);\n      setForm(mapped);\n      setInitialForm({ ...mapped });\n      onSaved?.(updated);\n      setSuccessMessage('Данные сотрудника сохранены');\n    } catch (error) {\n      const message =\n        error instanceof Error ? error.message : 'Не удалось сохранить';\n      showToast(message, 'error');\n    } finally {\n      setSaving(false);\n      setConfirmSave(false);\n    }\n  };\n\n  if (!telegramId && !isCreateMode) {\n    return (\n      <div className=\"text-sm text-gray-500\">Выберите сотрудника слева</div>\n    );\n  }\n\n  return (\n    <div className={clsx('space-y-4', className)}>\n      <div className=\"space-y-1\">\n        <h2 className=\"text-xl font-semibold\">\n          {isCreateMode ? 'Новый сотрудник' : 'Карточка сотрудника'}\n        </h2>\n        <p className=\"text-sm text-gray-500\">\n          {isCreateMode\n            ? 'Заполните данные и сохраните, чтобы создать запись.'\n            : 'Измените данные и подтвердите сохранение.'}\n        </p>\n      </div>\n      {loading && <div>Загрузка...</div>}\n      {!loading && isCreateMode && prefillError && (\n        <div className=\"rounded border border-rose-200 bg-rose-50 p-3 text-sm text-rose-900\">\n          {prefillError}\n        </div>\n      )}\n      {!loading && error && <div className=\"text-red-600\">{error}</div>}\n      {!loading && !error && (\n        <form\n          onSubmit={handleSubmit}\n          className=\"space-y-4 rounded bg-white p-6 shadow\"\n        >\n          {successMessage && (\n            <div className=\"rounded border border-green-200 bg-green-50 p-3 text-sm text-green-800\">\n              {successMessage}\n            </div>\n          )}\n          {!canEdit && (\n            <div className=\"rounded border border-amber-200 bg-amber-50 p-3 text-sm text-amber-900\">\n              У вас нет прав на редактирование, данные доступны только для\n              чтения.\n            </div>\n          )}\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">ID</span>\n              <input\n                name=\"telegramId\"\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.telegram_id ?? ''}\n                onChange={(e) =>\n                  updateField(\n                    'telegram_id',\n                    e.target.value ? Number(e.target.value) : undefined,\n                  )\n                }\n                readOnly={!isCreateMode}\n                required\n              />\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Username</span>\n              <input\n                name=\"username\"\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.username || ''}\n                onChange={(e) => updateField('username', e.target.value)}\n                readOnly={!isCreateMode}\n                required\n              />\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Имя</span>\n              <input\n                name=\"name\"\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.name || ''}\n                onChange={(e) => updateField('name', e.target.value)}\n                disabled={!canEdit}\n              />\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Телефон</span>\n              <input\n                name=\"phone\"\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.phone || ''}\n                onChange={(e) => updateField('phone', e.target.value)}\n                disabled={!canEdit}\n              />\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Доп. телефон</span>\n              <input\n                name=\"mobNumber\"\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.mobNumber || ''}\n                onChange={(e) => updateField('mobNumber', e.target.value)}\n                disabled={!canEdit}\n              />\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Email</span>\n              <input\n                name=\"email\"\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.email || ''}\n                onChange={(e) => updateField('email', e.target.value)}\n                disabled={!canEdit}\n              />\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Роль</span>\n              <select\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.role || 'user'}\n                onChange={(e) => handleRoleChange(e.target.value)}\n                disabled={!canEdit}\n              >\n                {ROLE_OPTIONS.map((option) => (\n                  <option key={option.value} value={option.value}>\n                    {option.label}\n                  </option>\n                ))}\n              </select>\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Департамент</span>\n              <select\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.departmentId || ''}\n                onChange={(e) => updateField('departmentId', e.target.value)}\n                disabled={!canEdit}\n              >\n                <option value=\"\"></option>\n                {departments.map((d) => (\n                  <option key={d._id} value={d._id}>\n                    {d.name}\n                  </option>\n                ))}\n              </select>\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Отдел</span>\n              <select\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.divisionId || ''}\n                onChange={(e) => updateField('divisionId', e.target.value)}\n                disabled={!canEdit}\n              >\n                <option value=\"\"></option>\n                {divisions.map((d) => (\n                  <option key={d._id} value={d._id}>\n                    {d.name}\n                  </option>\n                ))}\n              </select>\n            </label>\n            <label className=\"space-y-1\">\n              <span className=\"block text-sm font-medium\">Должность</span>\n              <select\n                className=\"h-10 w-full rounded border px-3\"\n                value={form.positionId || ''}\n                onChange={(e) => updateField('positionId', e.target.value)}\n                disabled={!canEdit}\n              >\n                <option value=\"\"></option>\n                {positions.map((p) => (\n                  <option key={p._id} value={p._id}>\n                    {p.name}\n                  </option>\n                ))}\n              </select>\n            </label>\n          </div>\n          {canEdit && (\n            <div className=\"flex gap-3\">\n              <Button type=\"submit\" disabled={!isDirty || saving}>\n                {saving ? 'Сохранение...' : 'Сохранить'}\n              </Button>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={resetChanges}\n                disabled={!isDirty || saving}\n              >\n                Очистить\n              </Button>\n            </div>\n          )}\n        </form>\n      )}\n      <ConfirmDialog\n        open={confirmSave}\n        message={\n          isCreateMode\n            ? 'Создать сотрудника?'\n            : 'Сохранить изменения сотрудника?'\n        }\n        onConfirm={persistChanges}\n        onCancel={() => setConfirmSave(false)}\n        confirmText=\"Сохранить\"\n      />\n    </div>\n  );\n}\n"],"names":["fetchRoles","authFetch","then","r","ok","json","ROLE_LABELS","admin","manager","user","ROLE_OPTIONS","exports","value","label","emptyForm","role","_ROLE_LABELS$role","telegram_id","username","name","phone","mobNumber","email","access","roleId","departmentId","divisionId","positionId","mapUserToForm","telegram_username","normalize","String","EmployeeCardForm","_ref","_form$telegram_id","telegramId","className","mode","onSaved","useAuth","_reactExports$useStat2","_slicedToArray","useState","form","setForm","_reactExports$useStat4","_objectSpread","initialForm","setInitialForm","_reactExports$useStat6","departments","setDepartments","_reactExports$useStat8","divisions","setDivisions","_reactExports$useStat0","positions","setPositions","_reactExports$useStat10","roles","setRoles","resolvedMode","_reactExports$useStat12","loading","setLoading","_reactExports$useStat14","error","setError","_reactExports$useStat16","saving","setSaving","_reactExports$useStat18","confirmSave","setConfirmSave","_reactExports$useStat20","successMessage","setSuccessMessage","_reactExports$useStat22","prefillError","setPrefillError","isCreateMode","canEdit","hasAccess","ACCESS_ADMIN","useEffect","fetchCollectionItems","d","items","catch","list","applyGeneratedCredentials","useCallback","credentials","prev","requestGeneratedCredentials","previewUserCredentials","active","generated","message","Error","showToast","fetchUser","data","mapped","e","finally","isDirty","useMemo","Boolean","Object","keys","some","key","updateField","persistChanges","_callee","telegramIdValue","payload","updated","_telegramIdValue","_payload","_updated","_mapped","_message","_t","_t2","_regenerator","w","_context","p","n","a","Number","isFinite","createUser","_excluded","updateUser","v","f","_excluded2","clsx","children","jsxs","jsx","onSubmit","event","preventDefault","onChange","target","readOnly","required","disabled","find","_role$access","_id","map","option","Button","type","variant","onClick","ConfirmDialog","open","onConfirm","onCancel","confirmText"],"mappings":"o6KAUO,IAAMA,QAAa,kBACxBC,EAAU,iBAAiBC,KAAK,SAACC,GAAA,OAAOA,EAAEC,GAAKD,EAAEE,OAAS,EAAG,EAAA,GCRlDC,EAAsC,CACjDC,MAAO,gBACPC,QAAS,WACTC,KAAM,aAQKC,EAAAC,EAAA,IAA6B,CACxC,CAAEC,MAAO,QAASC,MAAOP,EAAYC,OACrC,CAAEK,MAAO,UAAWC,MAAOP,EAAYE,SACvC,CAAEI,MAAO,OAAQC,MAAOP,EAAYG,QCqBhCK,GDlBOH,EAAA,IAAiB,SAACI,OAAiCC,EAC9D,OAAKD,EACkB,QAAvBC,EAAOV,EAAYS,UAAI,IAAAC,EAAAA,EAAKD,EADV,GAEpB,GCegC,CAC9BE,iBAAa,EACbC,SAAU,GACVC,KAAM,GACNC,MAAO,GACPC,UAAW,GACXC,MAAO,GACPP,KAAM,OACNQ,OAAQ,EACRC,OAAQ,GACRC,aAAc,GACdC,WAAY,GACZC,WAAY,KAGd,SAASC,EAAcnB,GACrB,MAAO,CACLQ,YAAaR,EAAKQ,YAClBC,SAAUT,EAAKoB,mBAAqBpB,EAAKS,UAAY,GACrDC,KAAMV,EAAKU,MAAQ,GACnBC,MAAOX,EAAKW,OAAS,GACrBC,UAAWZ,EAAKY,WAAa,GAC7BC,MAAOb,EAAKa,OAAS,GACrBP,KAAMN,EAAKM,MAAQ,OACnBQ,OAAQd,EAAKc,OACbC,OAAQf,EAAKe,QAAU,GACvBC,aAAchB,EAAKgB,cAAgB,GACnCC,WAAYjB,EAAKiB,YAAc,GAC/BC,WAAYlB,EAAKkB,YAAc,GAEnC,CAEA,IAAMG,EAAY,SAAClB,GACjB,OAAIA,QAA8C,GACZmB,OAAOnB,EAE/C,EAEA,SAAwBoB,EAAAC,GAKE,IAAAC,EAJxBC,EAAAF,EAAAE,WACAC,EAAAH,EAAAG,UACAC,EAAAJ,EAAAI,KACAC,EAAAL,EAAAK,QAEQ7B,EAAS8B,IAAT9B,KACuD+B,EAAAC,EAAvCC,EAAAA,cAA4B5B,IAAW,GAAxD6B,OAAMC,EAAOJ,EAAA,GAGnBK,EAAAJ,EAFqCC,WAAAI,KACjChC,IACJ,GAFMiC,EAAAF,EAAA,GAAaG,EAAcH,EAAA,GAGiCI,EAAAR,EAA7BC,EAAAA,SAA2B,IAAE,GAA5DQ,EAAAD,EAAA,GAAaE,EAAcF,EAAA,GAC6BG,EAAAX,EAA7BC,EAAAA,SAA2B,IAAE,GAAxDW,EAAAD,KAAWE,EAAYF,EAAA,GACiCG,EAAAd,EAA7BC,EAAAA,SAA2B,OAAtDc,EAAAD,EAAA,GAAWE,EAAYF,KACeG,EAAAjB,EAAnBC,EAAAA,SAAiB,IAAE,GAAtCiB,EAAAD,EAAA,GAAOE,EAAQF,EAAA,GAChBG,EAAexB,QAAAA,EAASF,EAAa,SAAW,SAGtD2B,EAAArB,EAF8BC,EAAAA,SACX,WAAjBmB,KAA+B1B,GACjC,GAFO4B,GAAAD,EAAA,GAASE,GAAUF,EAAA,GAG4BG,GAAAxB,EAA5BC,EAAAA,SAAwB,MAAI,GAA/CwB,GAAAD,MAAOE,GAAQF,GAAA,GACoBG,GAAA3B,EAAdC,EAAAA,UAAS,GAAK,GAAnC2B,GAAAD,GAAA,GAAQE,GAASF,GAAA,GAC4BG,GAAA9B,EAAdC,EAAAA,UAAS,GAAK,GAA7C8B,GAAAD,GAAA,GAAaE,GAAcF,MACsCG,GAAAjC,EAA5BC,EAAAA,SAAwB,MAAI,GAAjEiC,GAAAD,MAAgBE,GAAiBF,GAAA,GAC4BG,GAAApC,EAA5BC,EAAAA,SAAwB,MAAI,GAA7DoC,GAAAD,GAAA,GAAcE,GAAeF,GAAA,GAE9BG,GAAgC,WAAjBnB,EACfoB,GAAUC,EAAUzE,aAAA,EAAAA,EAAMc,OAAQ4D,GAExCC,EAAAA,UAAU,WACRC,EAAqB,cAAe,GAAI,EAAG,KACxCnF,KAAK,SAACoF,GAAA,OAAMnC,EAAemC,EAAEC,MAAM,GACnCC,MAAM,WAAA,OAAMrC,EAAe,MAC9BkC,EAAqB,YAAa,GAAI,EAAG,KACtCnF,KAAK,SAACoF,GAAA,OAAMhC,EAAagC,EAAEC,SAC3BC,MAAM,WAAA,OAAMlC,EAAa,GAAG,GAC/B+B,EAAqB,YAAa,GAAI,EAAG,KACtCnF,KAAK,SAACoF,GAAA,OAAM7B,EAAa6B,EAAEC,MAAM,GACjCC,MAAM,WAAA,OAAM/B,EAAa,GAAG,GAC/BzD,IAAaE,KAAK,SAACuF,GAAA,OAAS7B,EAAS6B,EAAK,EAC5C,EAAG,IAEH,IAAMC,GAA4BC,EAAAA,YAChC,SAACC,GACChD,EAAQ,SAACiD,GAAA,OAAA/C,EAAAA,EAAA,CAAA,EACJ+C,OACH5E,YAAa2E,EAAY3E,YACzBC,SAAU0E,EAAY1E,UAAA,GAExB8B,EAAe,SAAC6C,GAAA,OAAA/C,EAAAA,KACX+C,GAAA,CAAA,EAAA,CACH5E,YAAa2E,EAAY3E,YACzBC,SAAU0E,EAAY1E,UAAA,EAE1B,EACA,IAGI4E,GAA8BH,EAAAA,YAClC,WAAA,OAAMI,GAAuB,EAC7B,IAGFX,EAAAA,UAAU,WAER,GADAR,GAAkB,MACdI,GAAc,CAChBhB,IAAW,GACXG,GAAS,MACTvB,EAAAE,EAAA,CAAA,EAAahC,IACbkC,EAAAF,EAAA,CAAA,EAAoBhC,IACpB,IAAIkF,GAAS,EAgBb,OAfAF,KACG5F,KAAK,SAAC+F,GACAD,IACLN,GAA0BO,GAC1BlB,GAAgB,MAClB,GACCS,MAAM,SAACtB,GACN,GAAK8B,EAAL,CACA,IAAME,EACJhC,aAAiBiC,MACbjC,EAAMgC,QACN,gCACNnB,GAAgBmB,GAChBE,EAAUF,EAAS,SACrB,GACK,WACLF,GAAS,CACX,CACF,CAEA,GADAjB,GAAgB,OACX5C,EAKH,OAJA6B,IAAW,GACXG,GAAS,MACTvB,EAAAE,EAAA,CAAA,EAAahC,SACbkC,EAAAF,KAAoBhC,IAGtBkD,IAAW,GACXG,GAAS,MACTkC,EAAUlE,GACPjC,KAAK,SAACoG,GACL,IAAKA,EAIH,OAHAnC,GAAS,0BACTvB,EAAAE,KAAahC,SACbkC,EAAAF,EAAA,CAAA,EAAoBhC,IAGtB,IAAMyF,EAAS3E,EAAc0E,GAC7B1D,EAAQ2D,GACRvD,EAAAF,EAAA,CAAA,EAAoByD,GACtB,GACCf,MAAM,SAACgB,GACN,IAAMN,EAAUM,aAAaL,MAAQK,EAAEN,QAAU,kBACjD/B,GAAS+B,GAAW,mBACpBtD,EAAAE,EAAA,CAAA,EAAahC,IACbkC,EAAAF,EAAA,CAAA,EAAoBhC,GACtB,GACC2F,QAAQ,WAAA,OAAMzC,IAAW,EAAM,EACpC,EAAG,CACD7B,EACA6C,GACAU,GACAI,KAGF,IAAMY,GAAUC,EAAAA,QAAQ,WACtB,QAAK1B,KACDD,GACK4B,QAAQjE,EAAK1B,aAAe0B,EAAKzB,UAE7B2F,OAAOC,KAAK/D,GACbgE,KACV,SAACC,UAAQlF,EAAUa,EAAKqE,MAAUlF,EAAUiB,EAAYiE,GAAI,GAEhE,EAAG,CAAC/B,GAAStC,EAAMI,EAAaiC,KAE1BiC,GAAc,SAClBD,EACApG,GAEAgE,GAAkB,MAClBhC,EAAQ,SAACiD,iBAAeA,WAAOmB,EAAMpG,GAAA,EACvC,EA4CMsG,+BAAiB,SAAAC,IAAA,IAAAC,EAAAC,EAAAC,EAAAf,EAAAL,EAAAqB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAC,IAAAC,EAAA,SAAAC,iBAAAA,EAAAC,EAAAD,EAAAE,GAAA,KAAA,EAAA,GAChBjD,GAAA,CAAA+C,EAAAE,EAAA,EAAA,KAAA,CACiB,OAApBzD,IAAe,GAAKuD,EAAAG,EAAA,GAAA,KAAA,EAAA,IAGlBnD,IAAAgD,EAAAE,EAAA,GAAA,KAAA,CAAA,GACGvF,EAAK1B,aAAgB0B,EAAKzB,SAAA,CAAA8G,EAAAE,UAET,OADpB9B,EAAU,mCAAoC,SAC9C3B,IAAe,GAAKuD,EAAAG,EAAA,GAAA,KAAA,EAK2B,GAFjD7D,IAAU,GAAI0D,EAAAC,EAAA,EAENb,EAAkBgB,OAAOzF,EAAK1B,aAC/BmH,OAAOC,SAASjB,GAAe,CAAAY,EAAAE,EAAA,EAAA,KAAA,CAAA,MAC5B,IAAI/B,MAAM,yBAAuB,KAAA,EAAA,OAAA6B,EAAAE,EAAA,EAEnCI,EAAWlB,EAAiBzE,EAAKzB,SAAUyB,EAAKnB,QAAM,KAAA,EACrB,OAAAmB,EAA/B1B,YAAmBoG,IAAY1E,EAAA4F,GAAAP,EAAAE,EAAA,EACjBM,EAAWpB,EAAiBC,GAAO,KAAA,EAAnD,GAAAC,EAAAU,EAAAS,GACDT,EAAAE,EAAA,EAAA,KAAA,CAAA,UAAmB/B,MAAM,kCAAgC,KAAA,EACxDI,EAAS3E,EAAc0F,GAC7B1E,EAAQ2D,GACRvD,EAAAF,EAAA,CAAA,EAAoByD,IACpBjE,SAAAA,EAAUgF,GACV1C,GAAkB,oBAAkBoD,EAAAE,EAAA,EAAA,MAAA,KAAA,EAAAF,EAAAC,EAAA,EAAAL,EAAAI,EAAAS,EAE9BvC,EACJhC,aAAiBiC,MAAQjC,EAAMgC,QAAU,uBAC3CE,EAAUF,EAAS,SAAO,KAAA,EAGN,OAHM8B,EAAAC,EAAA,EAE1B3D,IAAU,GACVG,IAAe,GAAKuD,EAAAU,EAAA,GAAA,KAAA,GAAA,OAAAV,EAAAG,gBAInBxF,EAAK1B,YAAA,CAAA+G,EAAAE,EAAA,GAAA,KAAA,CACY,OAApBzD,IAAe,GAAKuD,EAAAG,aAKiC,OAFvD7D,IAAU,GAAI0D,EAAAC,EAAA,GAESb,EAAgCzE,EAA7C1B,YAAiCoG,IAAY1E,EAAAgG,GAAAX,EAAAE,EAAA,GAC/BM,EAAWpB,EAAiBC,GAAO,KAAA,GAAnD,GAAAC,EAAAU,EAAAS,EACD,CAAAT,EAAAE,EAAA,GAAA,KAAA,CAAA,MAAe,IAAI/B,MAAM,0CACxBI,EAAS3E,EAAc0F,GAC7B1E,EAAQ2D,GACRvD,EAAAF,KAAoByD,IACpBjE,SAAAA,EAAUgF,GACV1C,GAAkB,+BAA6BoD,EAAAE,EAAA,GAAA,MAAA,KAAA,GAAAF,EAAAC,EAAA,GAAAJ,EAAAG,EAAAS,EAEzCvC,EACJhC,aAAiBiC,MAAQjC,EAAMgC,QAAU,uBAC3CE,EAAUF,EAAS,SAAO,KAAA,GAGN,OAHM8B,EAAAC,EAAA,GAE1B3D,IAAU,GACVG,IAAe,GAAKuD,EAAAU,EAAA,IAAA,KAAA,GAAA,OAAAV,EAAAG,EAAA,GAAA,EAAAhB,EAAA,KAAA,CAAA,CAAA,GAAA,GAAA,GAAA,IAAA,CAAA,EAAA,EAAA,EAAA,KAAA,gLAExB,OAAA,8CAEA,OAAKhF,GAAe6C,UAOjB,MAAA,CAAI5C,UAAWwG,EAAK,YAAaxG,GAChCyG,SAAA,CAAAC,EAAAA,KAAC,MAAA,CAAI1G,UAAU,YACbyG,SAAA,CAAAE,MAAC,KAAA,CAAG3G,UAAU,wBACXyG,SAAA7D,GAAe,kBAAoB,8BAErC,IAAA,CAAE5C,UAAU,wBACVyG,SAAA7D,GACG,sDACA,iDAGPjB,IAAWgF,EAAAA,IAAC,MAAA,CAAIF,SAAA,iBACf9E,IAAWiB,IAAgBF,UAC1B,MAAA,CAAI1C,UAAU,sEACZyG,SAAA/D,MAGHf,IAAWG,UAAU,MAAA,CAAI9B,UAAU,eAAgByG,SAAA3E,MACnDH,KAAYG,IACZ4E,EAAAA,KAAC,OAAA,CACCE,SA9Fa,SAACC,GACpBA,EAAMC,iBACDjE,IACAyB,IACLjC,IAAe,EACjB,EA0FQrC,UAAU,wCAETyG,SAAA,CAAAlE,IACCoE,EAAAA,IAAC,MAAA,CAAI3G,UAAU,yEACZyG,SAAAlE,MAGHM,IACA8D,EAAAA,IAAC,MAAA,CAAI3G,UAAU,yEAAyEyG,SAAA,yEAK1FC,EAAAA,KAAC,MAAA,CAAI1G,UAAU,4BACbyG,SAAA,CAAAC,EAAAA,KAAC,QAAA,CAAM1G,UAAU,YACfyG,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAK3G,UAAU,4BAA4ByG,SAAA,OAC5CE,EAAAA,IAAC,QAAA,CACC5H,KAAK,aACLiB,UAAU,kCACVxB,cAAAsB,EAAOS,EAAK1B,mBAAA,IAAAiB,EAAAA,EAAe,GAC3BiH,SAAU,SAAC3C,GAAA,OACTS,GACE,cACAT,EAAE4C,OAAOxI,MAAQwH,OAAO5B,EAAE4C,OAAOxI,YAAS,IAG9CyI,UAAWrE,GACXsE,UAAQ,OAGZR,EAAAA,KAAC,QAAA,CAAM1G,UAAU,YACfyG,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAK3G,UAAU,4BAA4ByG,SAAA,aAC5CE,EAAAA,IAAC,QAAA,CACC5H,KAAK,WACLiB,UAAU,kCACVxB,MAAO+B,EAAKzB,UAAY,GACxBiI,SAAU,SAAC3C,GAAA,OAAMS,GAAY,WAAYT,EAAE4C,OAAOxI,MAAK,EACvDyI,UAAWrE,GACXsE,UAAQ,OAGZR,EAAAA,KAAC,QAAA,CAAM1G,UAAU,YACfyG,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAK3G,UAAU,4BAA4ByG,SAAA,QAC5CE,EAAAA,IAAC,QAAA,CACC5H,KAAK,OACLiB,UAAU,kCACVxB,MAAO+B,EAAKxB,MAAQ,GACpBgI,SAAU,SAAC3C,GAAA,OAAMS,GAAY,OAAQT,EAAE4C,OAAOxI,MAAK,EACnD2I,UAAWtE,QAGf6D,EAAAA,KAAC,QAAA,CAAM1G,UAAU,YACfyG,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAK3G,UAAU,4BAA4ByG,SAAA,YAC5CE,EAAAA,IAAC,QAAA,CACC5H,KAAK,QACLiB,UAAU,kCACVxB,MAAO+B,EAAKvB,OAAS,GACrB+H,SAAU,SAAC3C,GAAA,OAAMS,GAAY,QAAST,EAAE4C,OAAOxI,MAAK,EACpD2I,UAAWtE,QAGf6D,EAAAA,KAAC,QAAA,CAAM1G,UAAU,YACfyG,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAK3G,UAAU,4BAA4ByG,SAAA,iBAC5CE,EAAAA,IAAC,QAAA,CACC5H,KAAK,YACLiB,UAAU,kCACVxB,MAAO+B,EAAKtB,WAAa,GACzB8H,SAAU,SAAC3C,GAAA,OAAMS,GAAY,YAAaT,EAAE4C,OAAOxI,MAAK,EACxD2I,UAAWtE,QAGf6D,EAAAA,KAAC,QAAA,CAAM1G,UAAU,YACfyG,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAK3G,UAAU,4BAA4ByG,SAAA,UAC5CE,EAAAA,IAAC,QAAA,CACC5H,KAAK,QACLiB,UAAU,kCACVxB,MAAO+B,EAAKrB,OAAS,GACrB6H,SAAU,SAAC3C,GAAA,OAAMS,GAAY,QAAST,EAAE4C,OAAOxI,MAAK,EACpD2I,UAAWtE,QAGf6D,EAAAA,KAAC,QAAA,CAAM1G,UAAU,YACfyG,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAK3G,UAAU,4BAA4ByG,SAAA,SAC5CE,EAAAA,IAAC,SAAA,CACC3G,UAAU,kCACVxB,MAAO+B,EAAK5B,MAAQ,OACpBoI,SAAU,SAAC3C,GAAA,OAxNC5F,EAwNsB4F,EAAE4C,OAAOxI,MAvNjDG,EAAO4C,EAAM6F,KAAK,SAACrJ,GAAA,OAAMA,EAAEgB,OAASP,CAAK,GAC/CgE,GAAkB,WAClBhC,EAAQ,SAACiD,GAAA,IAAA4D,SAAA3G,EAAAA,EAAA,CAAA,EACJ+C,GAAA,CAAA,EAAA,CACH9E,KAAMH,EACNY,QAAQT,aAAA,EAAAA,EAAM2I,MAAO7D,EAAKrE,OAC1BD,OAAc,QAAdkI,EAAQ1I,aAAA,EAAAA,EAAMQ,cAAA,IAAAkI,EAAAA,EAAU5D,EAAKtE,QAAA,GAPR,IAACX,EAClBG,CAuNsD,EAChDwI,UAAWtE,GAEV4D,SAAAnI,EAAaiJ,IAAI,SAACC,UACjBb,EAAAA,IAAC,SAAA,CAA0BnI,MAAOgJ,EAAOhJ,MACtCiI,SAAAe,EAAO/I,OADG+I,EAAOhJ,MAGrB,QAGLkI,EAAAA,KAAC,QAAA,CAAM1G,UAAU,YACfyG,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAK3G,UAAU,4BAA4ByG,SAAA,gBAC5CC,EAAAA,KAAC,SAAA,CACC1G,UAAU,kCACVxB,MAAO+B,EAAKlB,cAAgB,GAC5B0H,SAAU,SAAC3C,GAAA,OAAMS,GAAY,eAAgBT,EAAE4C,OAAOxI,QACtD2I,UAAWtE,GAEX4D,SAAA,CAAAE,EAAAA,IAAC,SAAA,CAAOnI,MAAM,KACbsC,EAAYyG,IAAI,SAACrE,GAAA,OAChByD,EAAAA,IAAC,SAAA,CAAmBnI,MAAO0E,EAAEoE,IAC1Bb,SAAAvD,EAAEnE,MADQmE,EAAEoE,IAGhB,SAGLZ,EAAAA,KAAC,QAAA,CAAM1G,UAAU,YACfyG,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAK3G,UAAU,4BAA4ByG,SAAA,UAC5CC,EAAAA,KAAC,SAAA,CACC1G,UAAU,kCACVxB,MAAO+B,EAAKjB,YAAc,GAC1ByH,SAAU,SAAC3C,UAAMS,GAAY,aAAcT,EAAE4C,OAAOxI,MAAK,EACzD2I,UAAWtE,GAEX4D,SAAA,CAAAE,EAAAA,IAAC,SAAA,CAAOnI,MAAM,KACbyC,EAAUsG,IAAI,SAACrE,GAAA,OACdyD,EAAAA,IAAC,SAAA,CAAmBnI,MAAO0E,EAAEoE,IAC1Bb,SAAAvD,EAAEnE,MADQmE,EAAEoE,IAGhB,SAGLZ,EAAAA,KAAC,QAAA,CAAM1G,UAAU,YACfyG,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAK3G,UAAU,4BAA4ByG,SAAA,cAC5CC,EAAAA,KAAC,SAAA,CACC1G,UAAU,kCACVxB,MAAO+B,EAAKhB,YAAc,GAC1BwH,SAAU,SAAC3C,GAAA,OAAMS,GAAY,aAAcT,EAAE4C,OAAOxI,MAAK,EACzD2I,UAAWtE,GAEX4D,SAAA,CAAAE,EAAAA,IAAC,SAAA,CAAOnI,MAAM,KACb4C,EAAUmG,IAAI,SAAC1B,GAAA,OACdc,EAAAA,IAAC,SAAA,CAAmBnI,MAAOqH,EAAEyB,IAC1Bb,SAAAZ,EAAE9G,MADQ8G,EAAEyB,IAGhB,YAINzE,IACC6D,EAAAA,KAAC,MAAA,CAAI1G,UAAU,aACbyG,SAAA,CAAAE,EAAAA,IAACc,EAAA,CAAOC,KAAK,SAASP,UAAW7C,IAAWrC,GACzCwE,SAAAxE,GAAS,gBAAkB,cAE9B0E,EAAAA,IAACc,EAAA,CACCC,KAAK,SACLC,QAAQ,UACRC,QAhRO,WACnB,GAAIhF,GAiBF,OAhBAJ,GAAkB,MAClBhC,EAAAE,EAAA,CAAA,EAAahC,IACbkC,EAAAF,EAAA,CAAA,EAAoBhC,SACpBgF,KACG5F,KAAK,SAAC+F,GACLP,GAA0BO,GAC1BlB,GAAgB,KAClB,GACCS,MAAM,SAACtB,GACN,IAAMgC,EACJhC,aAAiBiC,MACbjC,EAAMgC,QACN,gCACNnB,GAAgBmB,GAChBE,EAAUF,EAAS,QACrB,GAGJtB,GAAkB,MAClBhC,EAAAE,EAAA,CAAA,EAAaC,GACf,EA2PcwG,UAAW7C,IAAWrC,GACvBwE,SAAA,mBAOTE,EAAAA,IAACkB,EAAA,CACCC,KAAM1F,GACN0B,QACElB,GACI,sBACA,kCAENmF,UAAWjD,GACXkD,SAAU,WAAV,OAAgB3F,IAAe,IAC/B4F,YAAY,iBArMdtB,EAAAA,IAAC,MAAA,CAAI3G,UAAU,wBAAwByG,SAAA,6BAyM7C"}