{"version":3,"file":"Archive-legacy-BYWpIOSk.js","sources":["../../../web/src/pages/Archive.tsx","../../../web/src/columns/archiveColumns.tsx","../../../web/src/services/archives.ts"],"sourcesContent":["// Страница архива задач\r\n// Основные модули: React, DataTable, сервисы архива\r\nimport React from \"react\";\r\nimport DataTable from \"../components/DataTable\";\r\nimport archiveColumns from \"../columns/archiveColumns\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { useToast } from \"../context/useToast\";\r\nimport { useAuth } from \"../context/useAuth\";\r\nimport { fetchArchive, purgeArchive } from \"../services/archives\";\r\nimport type { ArchiveTask } from \"../types/archive\";\r\nimport {\r\n  ARCHIVE_ACCESS,\r\n  ACCESS_TASK_DELETE,\r\n  hasAccess,\r\n} from \"../utils/access\";\r\n\r\nconst PAGE_SIZE = 25;\r\n\r\nconst toId = (value: unknown): string => {\r\n  if (!value) return \"\";\r\n  if (typeof value === \"string\") return value;\r\n  if (typeof value === \"number\") return String(value);\r\n  if (typeof value === \"object\" && value !== null && \"toString\" in value) {\r\n    try {\r\n      return (value as { toString(): string }).toString();\r\n    } catch {\r\n      return \"\";\r\n    }\r\n  }\r\n  return \"\";\r\n};\r\n\r\nconst normalizeDate = (value: unknown): string | undefined => {\r\n  if (typeof value === \"string\") return value;\r\n  if (value instanceof Date) return value.toISOString();\r\n  return undefined;\r\n};\r\n\r\nexport default function ArchivePage() {\r\n  const { addToast } = useToast();\r\n  const { user } = useAuth();\r\n  const [rows, setRows] = React.useState<ArchiveTask[]>([]);\r\n  const [page, setPage] = React.useState(0);\r\n  const [pageCount, setPageCount] = React.useState(0);\r\n  const [total, setTotal] = React.useState(0);\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [purging, setPurging] = React.useState(false);\r\n  const [search, setSearch] = React.useState(\"\");\r\n  const [appliedSearch, setAppliedSearch] = React.useState(\"\");\r\n  const [refreshKey, setRefreshKey] = React.useState(0);\r\n  const [selectedIds, setSelectedIds] = React.useState<Set<string>>(new Set());\r\n\r\n  const access = typeof user?.access === \"number\" ? user.access : 0;\r\n  const canViewArchive = hasAccess(access, ARCHIVE_ACCESS);\r\n  const canPurge = hasAccess(access, ACCESS_TASK_DELETE);\r\n\r\n  const visibleCount = React.useMemo(\r\n    () => rows.filter((row) => row.id).length,\r\n    [rows],\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    let cancelled = false;\r\n    const load = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const data = await fetchArchive({\r\n          page: page + 1,\r\n          limit: PAGE_SIZE,\r\n          search: appliedSearch || undefined,\r\n        });\r\n        if (cancelled) return;\r\n        const mapped = data.items.map((item) => {\r\n          const record = item as Record<string, unknown>;\r\n          const id = toId(record._id ?? record.id ?? record.task_number ?? \"\");\r\n          return {\r\n            id,\r\n            task_number:\r\n              typeof record.task_number === \"string\"\r\n                ? record.task_number\r\n                : undefined,\r\n            title:\r\n              typeof record.title === \"string\" ? record.title : undefined,\r\n            status:\r\n              typeof record.status === \"string\" ? record.status : undefined,\r\n            archived_at: normalizeDate(record.archived_at),\r\n            createdAt: normalizeDate(record.createdAt),\r\n            archived_by:\r\n              typeof record.archived_by === \"number\" &&\r\n              Number.isFinite(record.archived_by)\r\n                ? (record.archived_by as number)\r\n                : undefined,\r\n          } satisfies ArchiveTask;\r\n        });\r\n        setRows(mapped);\r\n        setTotal(data.total);\r\n        setPageCount(data.pages);\r\n        setSelectedIds((prev) => {\r\n          const next = new Set<string>();\r\n          mapped.forEach((row) => {\r\n            if (row.id && prev.has(row.id)) {\r\n              next.add(row.id);\r\n            }\r\n          });\r\n          return next;\r\n        });\r\n        const maxPageIndex = Math.max((data.pages || 1) - 1, 0);\r\n        if (page > maxPageIndex) {\r\n          setPage(maxPageIndex);\r\n        }\r\n      } catch (error) {\r\n        if (!cancelled) {\r\n          const message =\r\n            error instanceof Error\r\n              ? error.message\r\n              : \"Не удалось загрузить архив задач\";\r\n          addToast(message, \"error\");\r\n        }\r\n      } finally {\r\n        if (!cancelled) {\r\n          setLoading(false);\r\n        }\r\n      }\r\n    };\r\n    if (canViewArchive) {\r\n      void load();\r\n    }\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [page, appliedSearch, refreshKey, canViewArchive, addToast]);\r\n\r\n  const handleSearchSubmit = React.useCallback(\r\n    (event: React.FormEvent<HTMLFormElement>) => {\r\n      event.preventDefault();\r\n      setAppliedSearch(search.trim());\r\n      setPage(0);\r\n    },\r\n    [search],\r\n  );\r\n\r\n  const handleSearchReset = React.useCallback(() => {\r\n    setSearch(\"\");\r\n    setAppliedSearch(\"\");\r\n    setPage(0);\r\n  }, []);\r\n\r\n  const handleToggleRow = React.useCallback((id: string, checked: boolean) => {\r\n    setSelectedIds((prev) => {\r\n      const next = new Set(prev);\r\n      if (checked) {\r\n        next.add(id);\r\n      } else {\r\n        next.delete(id);\r\n      }\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  const handleToggleAll = React.useCallback(\r\n    (checked: boolean) => {\r\n      if (checked) {\r\n        const next = new Set<string>();\r\n        rows.forEach((row) => {\r\n          if (row.id) {\r\n            next.add(row.id);\r\n          }\r\n        });\r\n        setSelectedIds(next);\r\n      } else {\r\n        setSelectedIds(new Set());\r\n      }\r\n    },\r\n    [rows],\r\n  );\r\n\r\n  const handlePurge = React.useCallback(async () => {\r\n    if (!selectedIds.size) return;\r\n    setPurging(true);\r\n    try {\r\n      const removed = await purgeArchive(Array.from(selectedIds));\r\n      if (removed > 0) {\r\n        addToast(`Удалено ${removed} задач`, \"success\");\r\n      } else {\r\n        addToast(\"Задачи не были удалены\", \"error\");\r\n      }\r\n      setSelectedIds(new Set());\r\n      setRefreshKey((prev) => prev + 1);\r\n    } catch (error) {\r\n      const message =\r\n        error instanceof Error\r\n          ? error.message\r\n          : \"Не удалось выполнить полное удаление\";\r\n      addToast(message, \"error\");\r\n    } finally {\r\n      setPurging(false);\r\n    }\r\n  }, [selectedIds, addToast]);\r\n\r\n  const columns = React.useMemo(\r\n    () =>\r\n      archiveColumns({\r\n        enableSelection: canPurge,\r\n        selectedIds,\r\n        onToggleRow: handleToggleRow,\r\n        onToggleAll: handleToggleAll,\r\n        visibleCount,\r\n      }),\r\n    [canPurge, selectedIds, handleToggleRow, handleToggleAll, visibleCount],\r\n  );\r\n\r\n  if (!canViewArchive) {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        <h1 className=\"text-2xl font-semibold\">Архив задач</h1>\r\n        <p className=\"text-sm text-muted-foreground\">\r\n          Недостаточно прав для просмотра архива.\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const totalLabel = (() => {\r\n    const remainder10 = total % 10;\r\n    const remainder100 = total % 100;\r\n    if (remainder10 === 1 && remainder100 !== 11) return \"задача\";\r\n    if ([2, 3, 4].includes(remainder10) && ![12, 13, 14].includes(remainder100))\r\n      return \"задачи\";\r\n    return \"задач\";\r\n  })();\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-semibold\">Архив задач</h1>\r\n          <p className=\"text-sm text-muted-foreground\">\r\n            Здесь отображаются удалённые задачи только для чтения.\r\n          </p>\r\n        </div>\r\n        {canPurge ? (\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"destructive\"\r\n            disabled={!selectedIds.size || purging || loading}\r\n            onClick={handlePurge}\r\n          >\r\n            Полное удаление\r\n          </Button>\r\n        ) : null}\r\n      </div>\r\n      <form\r\n        onSubmit={handleSearchSubmit}\r\n        className=\"flex flex-col gap-2 sm:flex-row sm:items-center\"\r\n      >\r\n        <Input\r\n          value={search}\r\n          onChange={(event) => setSearch(event.target.value)}\r\n          placeholder=\"Поиск по номеру или названию\"\r\n          aria-label=\"Поиск по архиву\"\r\n        />\r\n        <div className=\"flex gap-2\">\r\n          <Button type=\"submit\" variant=\"secondary\" disabled={loading}>\r\n            Искать\r\n          </Button>\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"ghost\"\r\n            disabled={loading || (!appliedSearch && !search)}\r\n            onClick={handleSearchReset}\r\n          >\r\n            Сбросить\r\n          </Button>\r\n        </div>\r\n      </form>\r\n      {loading ? (\r\n        <div className=\"text-sm text-muted-foreground\">Загрузка архива...</div>\r\n      ) : null}\r\n      <DataTable<ArchiveTask>\r\n        columns={columns}\r\n        data={rows}\r\n        pageIndex={page}\r\n        pageSize={PAGE_SIZE}\r\n        pageCount={pageCount}\r\n        onPageChange={setPage}\r\n        showGlobalSearch={false}\r\n        showFilters={false}\r\n      />\r\n      <div className=\"text-sm text-muted-foreground\">\r\n        Найдено {total} {totalLabel}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// Конфигурация колонок архива задач\r\n// Основные модули: React, @tanstack/react-table\r\nimport React from \"react\";\r\nimport type { ColumnDef } from \"@tanstack/react-table\";\r\nimport type { ArchiveTask } from \"../types/archive\";\r\n\r\nconst dateTimeFormatter = new Intl.DateTimeFormat(\"ru-RU\", {\r\n  dateStyle: \"short\",\r\n  timeStyle: \"short\",\r\n});\r\n\r\nfunction formatDate(value?: string) {\r\n  if (!value) return \"—\";\r\n  const date = new Date(value);\r\n  if (Number.isNaN(date.getTime())) return value;\r\n  return dateTimeFormatter.format(date);\r\n}\r\n\r\nexport default function archiveColumns({\r\n  enableSelection,\r\n  selectedIds,\r\n  onToggleRow,\r\n  onToggleAll,\r\n  visibleCount,\r\n}: {\r\n  enableSelection: boolean;\r\n  selectedIds: Set<string>;\r\n  onToggleRow: (id: string, checked: boolean) => void;\r\n  onToggleAll: (checked: boolean) => void;\r\n  visibleCount: number;\r\n}): ColumnDef<ArchiveTask>[] {\r\n  const columns: ColumnDef<ArchiveTask>[] = [];\r\n  if (enableSelection) {\r\n    columns.push({\r\n      id: \"select\",\r\n      header: () => {\r\n        const allSelected =\r\n          visibleCount > 0 && selectedIds.size >= visibleCount;\r\n        const indeterminate =\r\n          selectedIds.size > 0 && selectedIds.size < visibleCount;\r\n        return (\r\n          <input\r\n            type=\"checkbox\"\r\n            aria-label=\"Выбрать все\"\r\n            checked={allSelected}\r\n            ref={(el) => {\r\n              if (el) el.indeterminate = indeterminate && !allSelected;\r\n            }}\r\n            onChange={(event) => onToggleAll(event.target.checked)}\r\n          />\r\n        );\r\n      },\r\n      cell: ({ row }) => {\r\n        const id = row.original.id;\r\n        if (!id) {\r\n          return <span className=\"text-muted-foreground\">—</span>;\r\n        }\r\n        return (\r\n          <input\r\n            type=\"checkbox\"\r\n            aria-label={`Выбрать задачу ${row.original.task_number || id}`}\r\n            checked={selectedIds.has(id)}\r\n            onChange={(event) => onToggleRow(id, event.target.checked)}\r\n          />\r\n        );\r\n      },\r\n      meta: { width: \"3rem\", minWidth: \"3rem\", maxWidth: \"3rem\" },\r\n    });\r\n  }\r\n  columns.push(\r\n    {\r\n      header: \"Номер\",\r\n      accessorKey: \"task_number\",\r\n      meta: {\r\n        width: \"8rem\",\r\n        minWidth: \"6rem\",\r\n        maxWidth: \"8rem\",\r\n        cellClassName: \"font-mono text-xs sm:text-sm\",\r\n      },\r\n      cell: ({ row }) => row.original.task_number || row.original.id || \"—\",\r\n    },\r\n    {\r\n      header: \"Название\",\r\n      accessorKey: \"title\",\r\n      meta: {\r\n        width: \"16rem\",\r\n        minWidth: \"10rem\",\r\n        maxWidth: \"22rem\",\r\n        cellClassName: \"whitespace-normal\",\r\n      },\r\n      cell: ({ row }) => {\r\n        const title = row.original.title || \"—\";\r\n        return <span className=\"line-clamp-2 break-words text-sm\">{title}</span>;\r\n      },\r\n    },\r\n    {\r\n      header: \"Статус\",\r\n      accessorKey: \"status\",\r\n      meta: {\r\n        width: \"8rem\",\r\n        minWidth: \"6rem\",\r\n        maxWidth: \"10rem\",\r\n      },\r\n      cell: ({ row }) => row.original.status || \"—\",\r\n    },\r\n    {\r\n      header: \"Удалена\",\r\n      accessorKey: \"archived_at\",\r\n      meta: {\r\n        width: \"10rem\",\r\n        minWidth: \"8rem\",\r\n        maxWidth: \"12rem\",\r\n      },\r\n      cell: ({ row }) => formatDate(row.original.archived_at),\r\n    },\r\n  );\r\n  return columns;\r\n}\r\n","// Назначение: запросы к API архива задач\r\n// Основные модули: authFetch\r\nimport authFetch from \"../utils/authFetch\";\r\n\r\nexport interface ArchiveListResult {\r\n  items: Array<Record<string, unknown>>;\r\n  total: number;\r\n  page: number;\r\n  pages: number;\r\n}\r\n\r\nexport async function fetchArchive(\r\n  params: { page?: number; limit?: number; search?: string } = {},\r\n): Promise<ArchiveListResult> {\r\n  const query = new URLSearchParams();\r\n  if (params.page) query.set(\"page\", String(params.page));\r\n  if (params.limit) query.set(\"limit\", String(params.limit));\r\n  if (params.search) query.set(\"search\", params.search.trim());\r\n  const suffix = query.toString();\r\n  const url = suffix ? `/api/v1/archives?${suffix}` : \"/api/v1/archives\";\r\n  const response = await authFetch(url);\r\n  if (!response.ok) {\r\n    const text = await response.text().catch(() => \"\");\r\n    throw new Error(text || \"Не удалось загрузить архив задач\");\r\n  }\r\n  const data = await response.json();\r\n  return {\r\n    items: Array.isArray(data.items) ? data.items : [],\r\n    total: Number(data.total) || 0,\r\n    page: Number(data.page) || 1,\r\n    pages: Number(data.pages) || 0,\r\n  };\r\n}\r\n\r\nexport async function purgeArchive(ids: string[]): Promise<number> {\r\n  if (!Array.isArray(ids) || ids.length === 0) {\r\n    return 0;\r\n  }\r\n  const response = await authFetch(\"/api/v1/archives/purge\", {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    body: JSON.stringify({ ids }),\r\n  });\r\n  if (!response.ok) {\r\n    const text = await response.text().catch(() => \"\");\r\n    throw new Error(text || \"Не удалось выполнить полное удаление\");\r\n  }\r\n  const payload = await response.json();\r\n  return Number(payload.removed) || 0;\r\n}\r\n"],"names":["addToast","useToast","user","useAuth","_React$useState2","_slicedToArray","React","useState","rows","setRows","_React$useState4","page","setPage","_React$useState6","pageCount","setPageCount","_React$useState8","total","setTotal","_React$useState0","loading","setLoading","_React$useState10","purging","setPurging","_React$useState12","search","setSearch","_React$useState14","appliedSearch","setAppliedSearch","_React$useState16","refreshKey","setRefreshKey","_React$useState18","Set","selectedIds","setSelectedIds","access","canViewArchive","hasAccess","ARCHIVE_ACCESS","canPurge","ACCESS_TASK_DELETE","visibleCount","useMemo","filter","row","id","length","useEffect","cancelled","load","_callee","data","mapped","maxPageIndex","message","_t","_regenerator","w","_context","p","n","fetchArchive","limit","PAGE_SIZE","v","a","items","map","item","_ref8","_ref9","_record$_id","record","toId","_id","task_number","title","status","archived_at","normalizeDate","createdAt","archived_by","Number","isFinite","pages","prev","next","forEach","has","add","Math","max","Error","f","handleSearchSubmit","useCallback","event","preventDefault","trim","handleSearchReset","handleToggleRow","checked","delete","handleToggleAll","handlePurge","_asyncToGenerator","m","_callee2","removed","_t2","_context2","size","purgeArchive","Array","from","concat","columns","_ref","enableSelection","onToggleRow","onToggleAll","push","header","allSelected","indeterminate","jsx","type","ref","el","onChange","target","cell","_ref2","original","className","children","meta","width","minWidth","maxWidth","accessorKey","cellClassName","_ref3","_ref4","_ref6","value","date","Date","isNaN","getTime","dateTimeFormatter","format","formatDate","archiveColumns","jsxs","totalLabel","remainder10","remainder100","includes","Button","variant","disabled","onClick","onSubmit","Input","placeholder","DataTable","pageIndex","pageSize","onPageChange","showGlobalSearch","showFilters","Intl","DateTimeFormat","dateStyle","timeStyle","_fetchArchive","apply","this","arguments","_callee3","params","query","suffix","url","response","text","_args3","_context3","undefined","URLSearchParams","set","String","toString","authFetch","ok","catch","json","isArray","_callee4","ids","payload","_context4","method","headers","body","JSON","stringify","_typeof","_unused","toISOString"],"mappings":"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"}