{"version":3,"file":"collections-legacy-CM8gom_5.js","sources":["../../../web/src/services/collections.ts"],"sourcesContent":["// Назначение: запросы к API универсальных коллекций\n// Основные модули: authFetch, i18n\nimport i18n from '../i18n';\nimport authFetch from '../utils/authFetch';\n\nexport interface CollectionItemMeta {\n  invalid?: boolean;\n  invalidReason?: string;\n  invalidCode?: string;\n  invalidAt?: string;\n  syncPending?: boolean;\n  syncWarning?: string;\n  syncError?: string;\n  syncFailedAt?: string;\n  legacy?: boolean;\n  readonly?: boolean;\n  readonlyReason?: string;\n  source?: string;\n  sourceId?: string;\n  fleetId?: string;\n  departmentId?: string;\n  divisionId?: string;\n  positionId?: string;\n  defaultLabel?: string;\n  fieldType?: string;\n  required?: boolean;\n  order?: number;\n  virtual?: boolean;\n  address?: string;\n  latitude?: number;\n  longitude?: number;\n  location?: { lat?: number; lng?: number };\n  tg_theme_url?: string;\n  tg_chat_id?: string;\n  tg_topic_id?: number;\n  tg_photos_url?: string;\n  tg_photos_chat_id?: string;\n  tg_photos_topic_id?: number;\n  [key: string]: unknown;\n}\n\nexport interface CollectionItem {\n  _id: string;\n  type: string;\n  name: string;\n  value: string;\n  meta?: CollectionItemMeta;\n}\n\nexport interface CollectionObjectMeta extends CollectionItemMeta {\n  address?: string;\n  latitude?: number;\n  longitude?: number;\n  location?: { lat?: number; lng?: number };\n}\n\nexport interface CollectionObject extends CollectionItem {\n  address: string;\n  latitude?: number;\n  longitude?: number;\n  meta?: CollectionObjectMeta;\n}\n\nexport type CollectionObjectPayload = {\n  name: string;\n  address: string;\n  latitude?: number;\n  longitude?: number;\n};\n\ntype ProblemValidationError = {\n  msg?: string;\n  message?: string;\n  [key: string]: unknown;\n};\n\ntype ProblemResponse = {\n  error?: string;\n  detail?: unknown;\n  message?: string;\n  errors?: ProblemValidationError[];\n};\n\ntype ParseErrorOptions = {\n  collectionType?: string;\n};\n\nconst validationMessageKeys: Record<string, string> = {\n  'Некорректный тип коллекции': 'collections.errors.invalidType',\n  'Тип коллекции обязателен': 'collections.errors.typeRequired',\n  'Некорректное название элемента': 'collections.errors.invalidName',\n  'Название элемента обязательно': 'collections.errors.nameRequired',\n  'Некорректное значение элемента': 'collections.errors.invalidValue',\n  'Значение элемента обязательно': 'collections.errors.valueRequired',\n  'Значение элемента не может быть пустым': 'collections.errors.valueRequired',\n  'Ошибка валидации': 'collections.errors.generalValidation',\n  'Ссылка на тему Telegram должна иметь формат https://t.me/c/<id>/<topic>':\n    'collections.errors.invalidTelegramTopicUrl',\n};\n\nconst typeSpecificValidationKeys: Record<string, Record<string, string>> = {\n  departments: {\n    'Значение элемента обязательно':\n      'collections.errors.departmentsMustHaveDivisions',\n  },\n};\n\nconst tryParseJson = (raw: string): unknown => {\n  try {\n    return JSON.parse(raw);\n  } catch {\n    return undefined;\n  }\n};\n\nconst translateValidationMessage = (\n  raw: string | undefined,\n  options?: ParseErrorOptions,\n): string => {\n  if (!raw) return '';\n  const trimmed = raw.trim();\n  if (!trimmed) return '';\n  const collectionType = options?.collectionType;\n  const specificKey =\n    collectionType && typeSpecificValidationKeys[collectionType]?.[trimmed];\n  const key = specificKey ?? validationMessageKeys[trimmed];\n  if (key) return i18n.t(key);\n  return trimmed;\n};\n\nconst translateValidationErrors = (\n  errors: ProblemValidationError[] | undefined,\n  options?: ParseErrorOptions,\n): string[] => {\n  if (!errors?.length) return [];\n  const translated = errors\n    .map((error) => {\n      const base =\n        typeof error?.msg === 'string'\n          ? error.msg\n          : typeof error?.message === 'string'\n            ? error.message\n            : '';\n      return translateValidationMessage(base, options);\n    })\n    .filter(Boolean);\n  if (translated.length) return translated;\n  return [i18n.t('collections.errors.generalValidation')];\n};\n\nconst extractMessagesFromPayload = (\n  payload: unknown,\n  options?: ParseErrorOptions,\n): string[] => {\n  if (!payload) return [];\n  if (Array.isArray(payload)) {\n    const asErrors = payload.filter((item): item is ProblemValidationError =>\n      Boolean(item && typeof item === 'object' && 'msg' in item),\n    );\n    if (asErrors.length) return translateValidationErrors(asErrors, options);\n    const directStrings = payload\n      .map((item) =>\n        typeof item === 'string'\n          ? translateValidationMessage(item, options)\n          : '',\n      )\n      .filter(Boolean);\n    if (directStrings.length) return directStrings;\n  }\n  if (typeof payload === 'string') {\n    const parsed = tryParseJson(payload);\n    if (parsed !== undefined) {\n      const nested = extractMessagesFromPayload(parsed, options);\n      if (nested.length) return nested;\n    }\n    const translated = translateValidationMessage(payload, options);\n    return translated ? [translated] : [];\n  }\n  return [];\n};\n\nexport const parseErrorMessage = (\n  status: number,\n  body: string,\n  options?: ParseErrorOptions,\n): string => {\n  const fallback =\n    status === 429\n      ? i18n.t('collections.fallback.rateLimited')\n      : status === 403\n        ? i18n.t('collections.fallback.forbidden')\n        : i18n.t('collections.fallback.loadFailed');\n\n  if (body) {\n    const parsed = tryParseJson(body) as ProblemResponse | undefined;\n    if (parsed) {\n      const errorMessages = translateValidationErrors(parsed.errors, options);\n      if (errorMessages.length) {\n        return Array.from(new Set(errorMessages)).join('. ');\n      }\n      const detailMessages = extractMessagesFromPayload(parsed.detail, options);\n      if (detailMessages.length) {\n        return Array.from(new Set(detailMessages)).join('. ');\n      }\n      const generalMessage =\n        translateValidationMessage(parsed.error, options) ||\n        translateValidationMessage(parsed.message, options);\n      if (generalMessage) return generalMessage;\n    } else {\n      const translated = translateValidationMessage(body, options);\n      if (translated) return translated;\n    }\n  }\n\n  return fallback;\n};\n\nconst normalizeCoordinate = (value: unknown): number | undefined => {\n  const numeric =\n    typeof value === 'string'\n      ? Number.parseFloat(value)\n      : typeof value === 'number'\n        ? value\n        : Number.NaN;\n  return Number.isFinite(numeric) ? numeric : undefined;\n};\n\nconst buildObjectMeta = (\n  address: string,\n  latitude?: number,\n  longitude?: number,\n): CollectionObjectMeta | undefined => {\n  const meta: CollectionObjectMeta = {};\n  if (address) {\n    meta.address = address;\n  }\n  if (latitude !== undefined || longitude !== undefined) {\n    meta.location = { lat: latitude, lng: longitude };\n  }\n  if (latitude !== undefined) {\n    meta.latitude = latitude;\n  }\n  if (longitude !== undefined) {\n    meta.longitude = longitude;\n  }\n  return Object.keys(meta).length ? meta : undefined;\n};\n\nexport const toCollectionObject = (item: CollectionItem): CollectionObject => {\n  const meta = (item.meta ?? {}) as CollectionObjectMeta;\n  const address =\n    typeof meta.address === 'string' && meta.address.trim().length\n      ? meta.address.trim()\n      : item.value.trim();\n  const latitude =\n    normalizeCoordinate(meta.latitude ?? meta.location?.lat) ?? undefined;\n  const longitude =\n    normalizeCoordinate(meta.longitude ?? meta.location?.lng) ?? undefined;\n  return {\n    ...item,\n    address,\n    latitude,\n    longitude,\n    meta,\n  };\n};\n\nexport const fetchCollectionItems = async (\n  type: string,\n  search = '',\n  page = 1,\n  limit = 10,\n) => {\n  const res = await authFetch(\n    `/api/v1/collections?type=${type}&page=${page}&limit=${limit}${search ? `&search=${encodeURIComponent(search)}` : ''}`,\n  );\n  if (!res.ok) {\n    const body = await res.text().catch(() => '');\n    throw new Error(\n      parseErrorMessage(res.status, body, { collectionType: type }),\n    );\n  }\n  return res.json();\n};\n\nconst isFiniteNumber = (value: unknown): value is number =>\n  typeof value === 'number' && Number.isFinite(value);\n\nexport const fetchAllCollectionItems = async (\n  type: string,\n  search = '',\n  limit = 200,\n): Promise<CollectionItem[]> => {\n  const effectiveLimit = limit > 0 ? limit : 200;\n  const aggregated: CollectionItem[] = [];\n  let page = 1;\n  let expectedTotal = 0;\n  // ограничиваем количество итераций, чтобы избежать бесконечных циклов при ошибках пагинации\n  const maxIterations = 100;\n  while (page <= maxIterations) {\n    const response = (await fetchCollectionItems(\n      type,\n      search,\n      page,\n      effectiveLimit,\n    )) as { items?: CollectionItem[]; total?: number };\n    const items = Array.isArray(response.items) ? response.items : [];\n    if (\n      !items.length &&\n      aggregated.length === 0 &&\n      !isFiniteNumber(response.total)\n    ) {\n      return [];\n    }\n    aggregated.push(...items);\n    if (isFiniteNumber(response.total)) {\n      expectedTotal = Math.max(expectedTotal, response.total);\n    }\n    if (items.length < effectiveLimit) {\n      break;\n    }\n    if (expectedTotal && aggregated.length >= expectedTotal) {\n      break;\n    }\n    page += 1;\n  }\n  if (expectedTotal && aggregated.length > expectedTotal) {\n    return aggregated.slice(0, expectedTotal);\n  }\n  return aggregated;\n};\n\nexport const fetchCollectionObjects = async (\n  search = '',\n  page = 1,\n  limit = 10,\n): Promise<{ items: CollectionObject[]; total: number }> => {\n  const response = (await fetchCollectionItems(\n    'objects',\n    search,\n    page,\n    limit,\n  )) as { items?: CollectionItem[]; total?: number };\n  const items = Array.isArray(response.items)\n    ? response.items.map(toCollectionObject)\n    : [];\n  return { items, total: response.total ?? items.length };\n};\n\nexport const fetchAllCollectionObjects = async (\n  search = '',\n  limit = 200,\n): Promise<CollectionObject[]> => {\n  const items = await fetchAllCollectionItems('objects', search, limit);\n  return items.map(toCollectionObject);\n};\n\nexport const createCollectionItem = (\n  type: string,\n  data: { name: string; value: string; meta?: Record<string, unknown> },\n) =>\n  authFetch('/api/v1/collections', {\n    method: 'POST',\n    confirmed: true,\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ type, ...data }),\n  }).then(async (r) => {\n    if (!r.ok) {\n      const body = await r.text().catch(() => '');\n      throw new Error(\n        parseErrorMessage(r.status, body, { collectionType: type }),\n      );\n    }\n    return r.json();\n  });\n\nexport const updateCollectionItem = (\n  id: string,\n  data: { name?: string; value?: string; meta?: Record<string, unknown> },\n  options?: ParseErrorOptions,\n) =>\n  authFetch(`/api/v1/collections/${id}`, {\n    method: 'PUT',\n    confirmed: true,\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(data),\n  }).then(async (r) => {\n    if (!r.ok) {\n      const body = await r.text().catch(() => '');\n      throw new Error(parseErrorMessage(r.status, body, options));\n    }\n    return r.json();\n  });\n\nexport const removeCollectionItem = async (id: string) => {\n  const r = await authFetch(`/api/v1/collections/${id}`, {\n    method: 'DELETE',\n    confirmed: true,\n  });\n  if (!r.ok) {\n    const body = await r.text().catch(() => '');\n    throw new Error(parseErrorMessage(r.status, body));\n  }\n  return r.json();\n};\n\nconst buildObjectPayload = (\n  data: CollectionObjectPayload,\n): { name: string; value: string; meta?: CollectionObjectMeta } => {\n  const trimmedAddress = data.address.trim();\n  const latitude = normalizeCoordinate(data.latitude);\n  const longitude = normalizeCoordinate(data.longitude);\n  const meta = buildObjectMeta(trimmedAddress, latitude, longitude);\n  return {\n    name: data.name.trim(),\n    value: trimmedAddress,\n    meta,\n  };\n};\n\nexport const createCollectionObject = (payload: CollectionObjectPayload) =>\n  createCollectionItem('objects', buildObjectPayload(payload));\n\nexport const updateCollectionObject = (\n  id: string,\n  payload: CollectionObjectPayload,\n) =>\n  updateCollectionItem(id, buildObjectPayload(payload), {\n    collectionType: 'objects',\n  });\n\nexport const removeCollectionObject = (id: string) => removeCollectionItem(id);\n"],"names":["validationMessageKeys","typeSpecificValidationKeys","departments","tryParseJson","raw","JSON","parse","_unused","translateValidationMessage","options","_typeSpecificValidati","trimmed","trim","collectionType","specificKey","key","i18n","t","translateValidationErrors","errors","length","translated","map","error","base","msg","message","filter","Boolean","extractMessagesFromPayload","payload","Array","isArray","asErrors","item","_typeof","directStrings","parsed","nested","parseErrorMessage","status","body","fallback","errorMessages","from","Set","join","detailMessages","detail","generalMessage","normalizeCoordinate","value","numeric","Number","parseFloat","NaN","isFinite","toCollectionObject","exports","_item$meta","_normalizeCoordinate","_meta$latitude","_meta$location","_normalizeCoordinate2","_meta$longitude","_meta$location2","meta","address","latitude","location","lat","longitude","lng","_objectSpread","fetchCollectionItems","_ref","_asyncToGenerator","_regenerator","m","_callee","type","search","page","limit","res","_args","arguments","w","_context","n","undefined","authFetch","concat","encodeURIComponent","ok","text","catch","Error","a","json","_x","apply","this","isFiniteNumber","_callee2","effectiveLimit","aggregated","expectedTotal","maxIterations","response","items","_args2","_context2","total","push","_toConsumableArray","Math","max","slice","_x2","_ref2","_callee3","_response$total","_args3","_context3","data","method","confirmed","headers","stringify","then","_ref4","_callee4","r","_context4","_x3","id","_ref5","_callee5","_context5","_x4","_ref6","_callee6","_context6","v","_x5"],"mappings":"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"}