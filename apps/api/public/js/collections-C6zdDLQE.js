import{i as l}from"./index-CiBvN1ph.js";import{h as u}from"./App-CBKZhWa-.js";const w={"Некорректный тип коллекции":"collections.errors.invalidType","Тип коллекции обязателен":"collections.errors.typeRequired","Некорректное название элемента":"collections.errors.invalidName","Название элемента обязательно":"collections.errors.nameRequired","Некорректное значение элемента":"collections.errors.invalidValue","Значение элемента обязательно":"collections.errors.valueRequired","Значение элемента не может быть пустым":"collections.errors.valueRequired","Ошибка валидации":"collections.errors.generalValidation","Ссылка на тему Telegram должна иметь формат https://t.me/c/<id>/<topic>":"collections.errors.invalidTelegramTopicUrl"},b={departments:{"Значение элемента обязательно":"collections.errors.departmentsMustHaveDivisions"}},h=t=>{try{return JSON.parse(t)}catch(r){return}},a=(t,r)=>{var i;if(!t)return"";const n=t.trim();if(!n)return"";const s=r==null?void 0:r.collectionType,e=s&&((i=b[s])==null?void 0:i[n]),o=e!=null?e:w[n];return o?l.t(o):n},y=(t,r)=>{if(!(t!=null&&t.length))return[];const n=t.map(s=>{const e=typeof(s==null?void 0:s.msg)=="string"?s.msg:typeof(s==null?void 0:s.message)=="string"?s.message:"";return a(e,r)}).filter(Boolean);return n.length?n:[l.t("collections.errors.generalValidation")]},p=(t,r)=>{if(!t)return[];if(Array.isArray(t)){const n=t.filter(e=>!!(e&&typeof e=="object"&&"msg"in e));if(n.length)return y(n,r);const s=t.map(e=>typeof e=="string"?a(e,r):"").filter(Boolean);if(s.length)return s}if(typeof t=="string"){const n=h(t);if(n!==void 0){const e=p(n,r);if(e.length)return e}const s=a(t,r);return s?[s]:[]}return[]},d=(t,r,n)=>{const s=t===429?l.t("collections.fallback.rateLimited"):t===403?l.t("collections.fallback.forbidden"):l.t("collections.fallback.loadFailed");if(r){const e=h(r);if(e){const o=y(e.errors,n);if(o.length)return Array.from(new Set(o)).join(". ");const i=p(e.detail,n);if(i.length)return Array.from(new Set(i)).join(". ");const f=a(e.error,n)||a(e.message,n);if(f)return f}else{const o=a(r,n);if(o)return o}}return s},v=async(t,r="",n=1,s=10)=>{const e=await u("/api/v1/collections?type=".concat(t,"&page=").concat(n,"&limit=").concat(s).concat(r?"&search=".concat(encodeURIComponent(r)):""));if(!e.ok){const o=await e.text().catch(()=>"");throw new Error(d(e.status,o,{collectionType:t}))}return e.json()},g=t=>typeof t=="number"&&Number.isFinite(t),E=async(t,r="",n=200)=>{const s=n>0?n:200,e=[];let o=1,i=0;const f=100;for(;o<=f;){const c=await v(t,r,o,s),m=Array.isArray(c.items)?c.items:[];if(!m.length&&e.length===0&&!g(c.total))return[];if(e.push(...m),g(c.total)&&(i=Math.max(i,c.total)),m.length<s||i&&e.length>=i)break;o+=1}return i&&e.length>i?e.slice(0,i):e},j=(t,r)=>u("/api/v1/collections",{method:"POST",confirmed:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify({type:t,...r})}).then(async n=>{if(!n.ok){const s=await n.text().catch(()=>"");throw new Error(d(n.status,s,{collectionType:t}))}return n.json()}),x=(t,r,n)=>u("/api/v1/collections/".concat(t),{method:"PUT",confirmed:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(async s=>{if(!s.ok){const e=await s.text().catch(()=>"");throw new Error(d(s.status,e,n))}return s.json()}),M=async t=>{const r=await u("/api/v1/collections/".concat(t),{method:"DELETE",confirmed:!0});if(!r.ok){const n=await r.text().catch(()=>"");throw new Error(d(r.status,n))}return r.json()};export{E as a,j as c,v as f,M as r,x as u};
//# sourceMappingURL=collections-C6zdDLQE.js.map
