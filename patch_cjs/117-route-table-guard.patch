diff --git a/apps/api/src/services/route.ts b/apps/api/src/services/route.ts
index 648e2ed..31b74f6 100644
--- a/apps/api/src/services/route.ts
+++ b/apps/api/src/services/route.ts
@@ -407,8 +407,8 @@ export async function table<T = unknown>(
   params: Record<string, string | number> = {},
 ): Promise<T> {
   if (tableGuard) {
-    const count = points.split(';').length;
-    if (count > tableMaxPoints) throw new Error('Слишком много точек');
+    const normalizedCount = normalizePointsString(points).length;
+    if (normalizedCount > tableMaxPoints) throw new Error('Слишком много точек');
     const now = Date.now();
     const diff = now - tableLastCall;
     if (diff < tableMinInterval)
       await new Promise((r) => setTimeout(r, tableMinInterval - diff));
diff --git a/apps/api/tests/routeValidation.test.ts b/apps/api/tests/routeValidation.test.ts
index a198593..9ad2c54 100644
--- a/apps/api/tests/routeValidation.test.ts
+++ b/apps/api/tests/routeValidation.test.ts
@@ -22,7 +22,7 @@ test('table отклоняет некорректные координаты', async () => {
     osrmRequestDuration: { startTimer: () => () => {} },
     osrmErrorsTotal: { inc: jest.fn() },
   }));
-  const { table } = require('../src/services/route');
+  const { table } = await import('../src/services/route');
   global.fetch = jest.fn();
   await expect(table('1,1;../../../etc', {})).rejects.toThrow(
     'Некорректные координаты после нормализации',
@@ -30,6 +30,19 @@ test('table отклоняет некорректные координаты', async () => {
   expect(fetch).not.toHaveBeenCalled();
 });
 
+test('table учитывает разделитель "|" при ограничении количества точек', async () => {
+  process.env.ROUTE_TABLE_GUARD = '1';
+  process.env.ROUTE_TABLE_MAX_POINTS = '2';
+  jest.doMock('../src/metrics', () => ({
+    osrmRequestDuration: { startTimer: () => () => {} },
+    osrmErrorsTotal: { inc: jest.fn() },
+  }));
+  const { table } = await import('../src/services/route');
+  global.fetch = jest.fn();
+  await expect(table('1,1|2,2|3,3', {})).rejects.toThrow('Слишком много точек');
+  expect(fetch).not.toHaveBeenCalled();
+});
+
 test('использует дефолт ROUTE_TABLE_MAX_POINTS при отрицательном значении', async () => {
   process.env.ROUTE_TABLE_GUARD = '1';
   process.env.ROUTE_TABLE_MAX_POINTS = '-1';
@@ -38,7 +51,7 @@ test('использует дефолт ROUTE_TABLE_MAX_POINTS при отрицательном значении', async () => {
     osrmRequestDuration: { startTimer: () => () => {} },
     osrmErrorsTotal: { inc: jest.fn() },
   }));
-  const { table } = require('../src/services/route');
+  const { table } = await import('../src/services/route');
   global.fetch = jest.fn().mockResolvedValue({
     ok: true,
     text: async () => JSON.stringify({}),
@@ -59,7 +72,7 @@ test('использует дефолт ROUTE_TABLE_MIN_INTERVAL_MS при отрицательном значении', async () => {
     osrmRequestDuration: { startTimer: () => () => {} },
     osrmErrorsTotal: { inc: jest.fn() },
   }));
-  const { table } = require('../src/services/route');
+  const { table } = await import('../src/services/route');
   global.fetch = jest.fn().mockResolvedValue({
     ok: true,
     text: async () => JSON.stringify({}),
@@ -69,7 +82,7 @@ test('использует дефолт ROUTE_TABLE_MIN_INTERVAL_MS при отрицательном значении', async () => {
   const mid = Date.now();
   await table('1,1;2,2', {});
   const diff = Date.now() - mid;
-  // Допускаем 20 мс погрешности таймеров, чтобы избежать флаки
+  // Допускаем 20 мс погрешности таймеров, чтобы избежать флаки
   expect(diff).toBeGreaterThanOrEqual(180);
   expect(warn).toHaveBeenCalledWith(
     'ROUTE_TABLE_MIN_INTERVAL_MS должен быть положительным. Используется значение по умолчанию 200',
