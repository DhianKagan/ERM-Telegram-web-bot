Унификация дизайна фронтенда с Tailwind CSS и DaisyUI
Цель

Привести все элементы пользовательского интерфейса к единому современному стилю с помощью Tailwind CSS и DaisyUI. Реализовать поддержку светлой и тёмной темы; обеспечить консистентность дизайна для всех компонентов (кнопки, формы, таблицы, карточки, навигация, выпадающие списки, фильтры, export-контролы и т.д.); улучшить юзабилити наиболее нагруженных страниц (особенно страницу настроек /cp/settings), не нарушая бизнес-логику приложения.

Ожидаемый результат

По всем страницам элементы интерфейса оформлены в едином стиле на базе Tailwind/DaisyUI и единой палитры токенов (цвета, радиусы, тени, spacing).

Поддержка двух тем: erm-light и erm-dark через data-theme на элементе документа.

Все повторяющиеся элементы вынесены в переиспользуемые UI-примитивы в папке apps/web/src/components/ui/.

/cp/settings переработана: настройки сгруппированы в визуально понятные блоки/карточки/аккордеоны, адаптивна и удобна.

Изменения делаются поэтапно, малые PR, тесты и визуальная приёмка для каждого PR.

Обязательные принципы и соглашения

Tokens как единственный источник правды.
Вся визуальная палитра и размерные параметры (цвета, радиусы, отступы, высоты кнопок, тени и пр.) задаются CSS-переменными в одном файле tokens (например _tokens.css). Во всех стилях и компонентах использовать var(--...). Любой новый токен добавляется только в этот файл с документированным назначением.

DaisyUI + Tailwind.
Использовать DaisyUI для базовых семантических классов (btn, card, input, table и т.д.) и Tailwind утилиты для layout/адаптивности. Конфигурация Tailwind должна содержать описанные темы erm-light/erm-dark и прочие расширения, согласованные с tokens.

Тема управляется data-theme.
Переключатель темы должен устанавливать document.documentElement.dataset.theme = 'erm-light' или 'erm-dark'. Это — контракт между ThemeToggle и Tailwind/DaisyUI: темы в конфиге должны соответствовать этим именам.

Ui-примитивы в src/components/ui/.
Все переиспользуемые компоненты (UiButton, UiCard, UiInput, UiFormGroup, UiTable, UiPagination, UiModal, UiBadge, UiSkeleton, UiFilterRow, ThemeToggle и т.п.) должны жить в этой директории и экспортировать стандартный API: className, variant, size, asChild/slot, ref, и т.п. Компоненты должны быть forwardRef-совместимыми.

Миграция — retrofit, не rewrite.
Новые компоненты создаются/уточняются, затем страницы мигрируются поэтапно. Каждый PR должен менять небольшое число файлов и включать визуальную проверку.

Доступность и UX.
Модальные окна, таблицы и формы обязаны поддерживать aria-атрибуты, keyboard navigation (focus trap/escape close) и достаточную контрастность текста.

Словарь сопоставлений (старое → новое)

Старый кастомный Button / ad-hoc кнопки → UiButton (варианты: primary, secondary, outline, ghost, link, destructive, success, pill, icon; размеры: xs/sm/md/lg).

Локальный Modal → UiModal (dialog с фокус-трапом и aria).

Инлайновые input/textarea/select → UiInput / UiTextarea / UiSelect внутри UiFormGroup (label + helper + error).

Самодельные Pagination → UiPagination.

Самодельные Table → UiTable / UiTableContainer.

Карточки с bg-white p-4 shadow-sm → UiCard (card + card-body).

Статусы/бейджи → UiBadge / ui-status-badge с data-tone.

Фильтровая строка → UiFilterRow (wrapper + inputs area + actions).

Фазовый план работ (пошагово)
Фаза 0 — Подготовка

Создать рабочую ветку feat/ui/unify-all и отдельные ветки для подзадач (feat/ui/buttons, feat/ui/forms, feat/ui/modals и т.д.).

Записать baseline: запустить сборку и тесты на main и сохранить результаты (для регрессионной проверки).

Фаза 1 — Токены и тема

Убедиться, что в проекте есть единый файл токенов с набором переменных: цвета (primary, primary-600, accent, neutral, success, danger, warning), bg-surface, bg-muted, border, radius, touch-target, btn-padding-x/y, btn-height, shadow-sm и т.п.

Уточнить/дополнить токены при необходимости.

Настроить DaisyUI темы erm-light и erm-dark в tailwind.config.ts, сопоставив цвета с токенами. Убедиться, что darkMode — class и переключение темы управляется data-theme.

Критерий сдачи: токены покрывают все базовые параметры; переключение темы меняет вид основных элементов.

Фаза 2 — UiButton и миграция кнопок

Проверить/финализировать компонент Button с использованием cva или эквивалента. Определить mapping variant/size.

Заменить ad-hoc кнопки в шапке, сайдбаре, и ключевых страницах на UiButton. В PR — не более 20 файлов.

Проверить визуально все состояния (hover, active, disabled) и размеры.

Критерий сдачи: все критичные места используют UiButton, визуальное соответствие дизайн-токенам.

Фаза 3 — Формы и фильтры

Реализовать UiFormGroup и UiInput/UiSelect/UiTextarea. UiFormGroup обязан показывать label, helper и error.

Мигрировать фильтровые панели и формы на ключевых страницах (/cp/settings, Tasks, таблицы). Фильтры — grid layout с responsive поведением.

Экспортные контролы (export) стандартизировать: UiButton variant outline size sm + индикатор загрузки.

Критерий сдачи: формы и фильтры единообразны; валидация видна; экспорт работает и отображает spinner.

Фаза 4 — Модалы и диалоги

Создать/проверить UiModal с focus-trap, aria и поддержкой действий в footer.

Заменить модальные окна в AlertDialog/ConfirmDialog/CKEditorPopup и т.д.

Проверить keyboard navigation и возврат фокуса.

Критерий сдачи: модалки доступны, корректно закрываются по Escape, focus возвращается.

Фаза 5 — Таблицы, пагинация, skeletons

Реализовать UiTable + UiTableContainer (sticky header, zebra, responsive).

Реализовать UiPagination и заменить все самодельные пагинации.

Заменить skeletons на UiSkeleton/UiSkeletonCard.

Критерий сдачи: таблицы выглядят консистентно, пагинация работает, skeletons единообразны.

Фаза 6 — Навигация, карточки, статус-бейджи

Унифицировать Header/Nav/Sidebar, использовать UiCard для блоков, UiBadge для статусов.

Обеспечить responsive-поведение для меню (drawer/burger).

Критерий сдачи: навигация адаптивна, карточки и бейджи единообразны.

Фаза 7 — Sweep & polish

Пройти grep/поиск и удалить остатки старых стилей: inline-цвета, устаревшие классы (border-stroke, bg-white p-4 shadow-sm и т.д.), заменить их на вызовы Ui-примитивов или на токены.

Пометить старые компоненты deprecated, не удалять сразу — удалить после нескольких стабильных релизов.

Критерий сдачи: в репозитории не осталось рефакторных участков старого стиля; все новые правки документированы.

Правила для PR-ов и ревью

Каждый PR — маленький и осмысленный: максимум 3–5 файлов для критичных, до 20–30 для массовой замены при уверенной автоматике.

PR-описание должно содержать: что сделано, почему, mapping старого→нового, список страниц, инструкции для ревью, шаги проверки (ручные и автоматические).

Обязательные проверки перед мержем:

Сборка приложения проходит.

TypeScript компиляция проходит.

Unit-тесты/интеграционные тесты зеленые (если есть).

Визуальная проверка (скриншоты desktop + mobile + dark).

Accessibility: модальные окна, таблицы и формы — aria, focus, contrast.

How to discover и автоматизировать поиск мест для замены

Запускать grep по репозиторию для выявления:

Импортов старого Button (например, import { Button } from '@/components/ui/button' или собственные button-компоненты).

Modal (локальных реализаций).

Инлайновых input/select с кастомными классами/переменными.

Классов border-stroke, bg-white p-4 shadow-sm, --color-* и иных признаком кастомных стилей.

Составить таблицу: файл → устаревший элемент → план замены (Ui-компонент и mapping props).

Тесты и приёмка (шаги проверки)

Для каждого PR выполнить:

Локальная сборка: приложение собирается.

TS-проверка: tsc проходит.

Unit tests: проходят.

Smoke тесты вручную: создать сущность, открыть модал, сохранить, фильтровать, экспортировать.

Visual check: скриншоты до/после для desktop/mobile/dark.

Accessibility check: проверить ключевые сценарии (модалки, табы, таблицы) — focus trap, esc close, aria labels и контрастность.

Regression sweep: проверить что старые стили не остались в ключевых файлах (grep).

Acceptance criteria (конкретно)

UI-примитивы реализованы и используются повсеместно: кнопки, формы, карточки, таблицы, пагинация, модалки, фильтры, экспорт.

Тема erm-light / erm-dark корректно применяется через data-theme и изменяет визуал на всех страницах.

/cp/settings полностью переработана и читабельна; элементы группированы и адаптивны.

В репозитории минимально или вовсе отсутствуют старые, разрозненные стили; все основные визуальные параметры берутся из tokens.

PRы маленькие, с тестами и инструкциями, и успешно проходят сборку, типизацию и визуальную проверку.

Рекомендации по приоритету работ

Завершить tokens и DaisyUI темизацию.

Стабилизировать Button и Card, затем мигрировать Header/Sidebar.

Сделать FormGroup + Input, мигрировать критичные формы и фильтры.

Модалки, таблицы и пагинация.

Sweep — удалить старые стили и пометить deprecated.

Примеры коротких задач для Codex (для очереди)

Создать/проверить UiFormGroup + UiInput и заменить форму первой секции на /cp/settings.

Полностью заменить все ad-hoc кнопки в Header и Sidebar на UiButton.

Реализовать UiTableContainer и заменить таблицу на странице логов.

Сделать UiModal и заменить ConfirmDialog/AlertDialog.

Завершающее замечание

Работа должна вестись итеративно, с фокусом на минимальные PR и тщательную визуальную проверку. При каждой итерации фиксировать, какие токены использовались, какие компоненты созданы/модифицированы и какие страницы протестированы. После первой волны миграции выполнить sweep по репо и подготовить список остаточных мест с устаревшими стилями.
