{"version":3,"file":"Storage-29UJ5mL8.js","sources":["../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/ArrowDownTrayIcon.js","../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/DocumentTextIcon.js","../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/DocumentIcon.js","../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/TrashIcon.js","../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/VideoCameraIcon.js","../../../web/src/components/Breadcrumbs.tsx","../../../web/src/columns/storageColumns.tsx","../../../web/src/services/storage.ts","../../../web/src/pages/Storage.tsx"],"sourcesContent":["import * as React from \"react\";\nfunction ArrowDownTrayIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(ArrowDownTrayIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction DocumentTextIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(DocumentTextIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction DocumentIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(DocumentIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction TrashIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(TrashIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction VideoCameraIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(VideoCameraIcon);\nexport default ForwardRef;","// Хлебные крошки навигации\r\nimport React from \"react\";\r\n\r\nexport interface Crumb {\r\n  label: string;\r\n  href?: string;\r\n}\r\n\r\nexport default function Breadcrumbs({ items }: { items: Crumb[] }) {\r\n  return (\r\n    <nav className=\"text-body mb-4 text-sm\">\r\n      <ol className=\"list-reset flex\">\r\n        {items.map((c, idx) => (\r\n          <React.Fragment key={idx}>\r\n            {idx > 0 && (\r\n              <li>\r\n                <span className=\"text-body px-2\">/</span>\r\n              </li>\r\n            )}\r\n            <li>\r\n              {c.href ? (\r\n                <a href={c.href} className=\"text-primary hover:underline\">\r\n                  {c.label}\r\n                </a>\r\n              ) : (\r\n                <span className=\"text-bodydark\">{c.label}</span>\r\n              )}\r\n            </li>\r\n          </React.Fragment>\r\n        ))}\r\n      </ol>\r\n    </nav>\r\n  );\r\n}\r\n","// Конфигурация колонок таблицы файлов хранилища\r\n// Основные модули: React, @tanstack/react-table, heroicons\r\nimport React from \"react\";\r\nimport type { ColumnDef } from \"@tanstack/react-table\";\r\nimport {\r\n  ArrowDownTrayIcon,\r\n  TrashIcon,\r\n} from \"@heroicons/react/24/outline\";\r\nimport EmployeeLink from \"../components/EmployeeLink\";\r\nimport type { StoredFile } from \"../services/storage\";\r\n\r\nexport interface StorageRow extends StoredFile {\r\n  sizeLabel: string;\r\n  uploadedLabel: string;\r\n  userDisplay: string;\r\n  userHint: string;\r\n  taskDisplay: string;\r\n  taskParam?: string;\r\n  taskLink?: string;\r\n  onDownload: () => void;\r\n  onDelete: () => void;\r\n  selectedTaskId: string;\r\n  onTaskSelect: (taskId: string) => void;\r\n  onAttach: () => void;\r\n  attachLoading: boolean;\r\n  attachDisabled: boolean;\r\n}\r\n\r\ninterface Labels {\r\n  name: string;\r\n  user: string;\r\n  type: string;\r\n  size: string;\r\n  task: string;\r\n  uploaded: string;\r\n  download: string;\r\n  delete: string;\r\n  taskTitleHint: (title: string) => string;\r\n  attachTitle: string;\r\n  attachPlaceholder: string;\r\n  attachAction: string;\r\n  attachProcessing: string;\r\n  attachEmpty: string;\r\n  attachLoading: string;\r\n}\r\n\r\ntype TaskOption = { value: string; label: string };\r\n\r\nconst userBadgeClass = [\r\n  \"inline-flex max-w-full items-center gap-1\",\r\n  \"rounded-full border border-blue-200 bg-blue-50 px-2 py-0.5 text-xs font-semibold text-blue-700 shadow-xs\",\r\n  \"transition-colors duration-150 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2\",\r\n  \"dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100\",\r\n].join(\" \");\r\n\r\nexport default function createStorageColumns(\r\n  labels: Labels,\r\n  options: {\r\n    onTaskOpen?: (taskId: string) => void;\r\n    taskOptions?: TaskOption[];\r\n    tasksLoading?: boolean;\r\n  } = {},\r\n): ColumnDef<StorageRow, any>[] {\r\n  const handleTaskOpen = options.onTaskOpen;\r\n  const attachOptions = options.taskOptions ?? [];\r\n  const isTasksLoading = Boolean(options.tasksLoading);\r\n  return [\r\n    {\r\n      header: labels.name,\r\n      accessorKey: \"name\",\r\n      meta: { minWidth: \"12rem\", maxWidth: \"20rem\", renderAsBadges: false },\r\n      cell: ({ row }) => {\r\n        const file = row.original;\r\n        return (\r\n          <div className=\"space-y-3\">\r\n            <div className=\"flex items-center justify-between gap-3\">\r\n              <span className=\"truncate font-medium\" title={file.name}>\r\n                {file.name}\r\n              </span>\r\n              <div className=\"flex flex-shrink-0 items-center gap-1\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={(event) => {\r\n                    event.stopPropagation();\r\n                    file.onDownload();\r\n                  }}\r\n                  className=\"inline-flex items-center rounded border border-blue-200 bg-blue-50 px-2 py-1 text-xs text-blue-700 hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100\"\r\n                  aria-label={labels.download}\r\n                >\r\n                  <ArrowDownTrayIcon className=\"mr-1 size-4\" aria-hidden />\r\n                  {labels.download}\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={(event) => {\r\n                    event.stopPropagation();\r\n                    file.onDelete();\r\n                  }}\r\n                  className=\"inline-flex items-center rounded border border-red-200 bg-red-50 px-2 py-1 text-xs text-red-700 hover:bg-red-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500 dark:border-red-500/30 dark:bg-red-500/10 dark:text-red-100\"\r\n                  aria-label={labels.delete}\r\n                >\r\n                  <TrashIcon className=\"mr-1 size-4\" aria-hidden />\r\n                  {labels.delete}\r\n                </button>\r\n              </div>\r\n            </div>\r\n            <div className=\"space-y-2 rounded-md border border-border/60 bg-muted/40 p-3 text-xs\">\r\n              <span className=\"block font-semibold uppercase tracking-wide text-muted-foreground\">\r\n                {labels.attachTitle}\r\n              </span>\r\n              <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center\">\r\n                <select\r\n                  value={file.selectedTaskId}\r\n                  onChange={(event) => {\r\n                    event.stopPropagation();\r\n                    file.onTaskSelect(event.target.value);\r\n                  }}\r\n                  disabled={file.attachLoading || isTasksLoading}\r\n                  className=\"h-9 min-w-[12rem] rounded-md border border-input bg-background px-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\"\r\n                >\r\n                  <option value=\"\">{labels.attachPlaceholder}</option>\r\n                  {attachOptions.map((option) => (\r\n                    <option key={option.value} value={option.value}>\r\n                      {option.label}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={(event) => {\r\n                    event.stopPropagation();\r\n                    file.onAttach();\r\n                  }}\r\n                  className=\"inline-flex items-center justify-center rounded-md border border-blue-200 bg-blue-600 px-3 py-1.5 text-xs font-semibold text-white transition hover:bg-blue-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:border-border disabled:bg-muted disabled:text-muted-foreground\"\r\n                  disabled={file.attachDisabled}\r\n                >\r\n                  {file.attachLoading ? labels.attachProcessing : labels.attachAction}\r\n                </button>\r\n              </div>\r\n              {isTasksLoading ? (\r\n                <span className=\"block text-muted-foreground\">{labels.attachLoading}</span>\r\n              ) : attachOptions.length === 0 ? (\r\n                <span className=\"block text-muted-foreground\">{labels.attachEmpty}</span>\r\n              ) : null}\r\n            </div>\r\n          </div>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      header: labels.user,\r\n      accessorKey: \"userDisplay\",\r\n      meta: { minWidth: \"8rem\", maxWidth: \"12rem\", renderAsBadges: false },\r\n      cell: ({ row }) => {\r\n        const file = row.original;\r\n        const label = file.userDisplay;\r\n        if (!file.userId) {\r\n          return (\r\n            <span className=\"truncate text-sm\" title={file.userHint}>\r\n              {label}\r\n            </span>\r\n          );\r\n        }\r\n        return (\r\n          <EmployeeLink\r\n            employeeId={file.userId}\r\n            stopPropagation\r\n            className={userBadgeClass}\r\n            title={file.userHint}\r\n          >\r\n            <span className=\"truncate\">{label}</span>\r\n          </EmployeeLink>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      header: labels.type,\r\n      accessorKey: \"type\",\r\n      meta: { minWidth: \"8rem\", maxWidth: \"10rem\" },\r\n      cell: ({ row }) => row.original.type || \"\",\r\n    },\r\n    {\r\n      header: labels.size,\r\n      accessorKey: \"sizeLabel\",\r\n      meta: { minWidth: \"6rem\", maxWidth: \"8rem\" },\r\n      cell: ({ row }) => row.original.sizeLabel,\r\n    },\r\n    {\r\n      header: labels.task,\r\n      accessorKey: \"taskDisplay\",\r\n      meta: { minWidth: \"10rem\", maxWidth: \"16rem\", renderAsBadges: false },\r\n      cell: ({ row }) => {\r\n        const file = row.original;\r\n        const content = (\r\n          <span className=\"block\">\r\n            {file.taskDisplay}\r\n            {file.taskTitle ? (\r\n              <span className=\"block text-xs text-muted-foreground\">\r\n                {file.taskTitle}\r\n              </span>\r\n            ) : null}\r\n          </span>\r\n        );\r\n        if (!file.taskParam) {\r\n          return content;\r\n        }\r\n        if (handleTaskOpen) {\r\n          return (\r\n            <button\r\n              type=\"button\"\r\n              onClick={(event) => {\r\n                event.stopPropagation();\r\n                handleTaskOpen(file.taskParam as string);\r\n              }}\r\n              className=\"inline-flex w-full flex-col items-start gap-0.5 rounded-lg border border-blue-200 bg-blue-50 px-2 py-1 text-left text-xs font-semibold text-blue-700 transition hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100\"\r\n              title={\r\n                file.taskTitle\r\n                  ? labels.taskTitleHint(file.taskTitle)\r\n                  : undefined\r\n              }\r\n            >\r\n              {content}\r\n            </button>\r\n          );\r\n        }\r\n        if (file.taskLink) {\r\n          return (\r\n            <a\r\n              href={file.taskLink}\r\n              className=\"inline-flex w-full flex-col items-start gap-0.5 rounded-lg border border-blue-200 bg-blue-50 px-2 py-1 text-left text-xs font-semibold text-blue-700 no-underline transition hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100\"\r\n              onClick={(event) => event.stopPropagation()}\r\n              title={\r\n                file.taskTitle\r\n                  ? labels.taskTitleHint(file.taskTitle)\r\n                  : undefined\r\n              }\r\n            >\r\n              {content}\r\n            </a>\r\n          );\r\n        }\r\n        return content;\r\n      },\r\n    },\r\n    {\r\n      header: labels.uploaded,\r\n      accessorKey: \"uploadedLabel\",\r\n      meta: { minWidth: \"10rem\", maxWidth: \"12rem\" },\r\n      cell: ({ row }) => row.original.uploadedLabel,\r\n    },\r\n  ];\r\n}\r\n","// Назначение: запросы к API хранения файлов\r\n// Основные модули: authFetch\r\nimport authFetch from \"../utils/authFetch\";\r\n\r\nexport interface StoredFile {\r\n  id: string;\r\n  path: string;\r\n  userId: number;\r\n  name: string;\r\n  type: string;\r\n  url: string;\r\n  thumbnailUrl?: string;\r\n  previewUrl?: string;\r\n  size?: number;\r\n  uploadedAt?: string;\r\n  taskId?: string | number | null;\r\n  taskNumber?: string | null;\r\n  taskTitle?: string | null;\r\n}\r\n\r\nexport interface StorageDiagnosticsReport {\r\n  generatedAt: string;\r\n  snapshot: {\r\n    totalFiles: number;\r\n    linkedFiles: number;\r\n    detachedFiles: number;\r\n  };\r\n  detachedFiles: Array<{\r\n    id: string;\r\n    name: string;\r\n    path: string;\r\n    size: number;\r\n    uploadedAt: string;\r\n    userId: number;\r\n  }>;\r\n}\r\n\r\nexport const fetchFiles = (params?: { userId?: number; type?: string }) => {\r\n  const qs = new URLSearchParams();\r\n  if (params?.userId) qs.set(\"userId\", String(params.userId));\r\n  if (params?.type) qs.set(\"type\", params.type);\r\n  const url = `/api/v1/storage${qs.toString() ? `?${qs}` : \"\"}`;\r\n  return authFetch(url).then((r) => (r.ok ? r.json() : [])) as Promise<\r\n    StoredFile[]\r\n  >;\r\n};\r\n\r\nexport const fetchFile = (id: string) =>\r\n  authFetch(`/api/v1/storage/${encodeURIComponent(id)}`).then((res) =>\r\n    res.ok ? (res.json() as Promise<StoredFile>) : Promise.reject(res),\r\n  );\r\n\r\nexport const removeFile = (id: string) =>\r\n  authFetch(`/api/v1/storage/${encodeURIComponent(id)}`, {\r\n    method: \"DELETE\",\r\n  });\r\n\r\nexport const runDiagnostics = async (): Promise<StorageDiagnosticsReport> => {\r\n  const response = await authFetch(`/api/v1/storage/diagnostics`);\r\n  if (!response.ok) {\r\n    throw new Error(\"diagnostics\");\r\n  }\r\n  return (await response.json()) as StorageDiagnosticsReport;\r\n};\r\n\r\nexport default { fetchFiles, fetchFile, removeFile, runDiagnostics };\r\n\r\n","// Страница управления файлами: таблица, фильтры и карточка файла\r\n// Основные модули: React, DataTable, heroicons, storageService, react-router\r\nimport React from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useSearchParams } from \"react-router-dom\";\r\nimport {\r\n  ArrowDownTrayIcon,\r\n  DocumentIcon,\r\n  DocumentTextIcon,\r\n  PhotoIcon,\r\n  VideoCameraIcon,\r\n  TrashIcon,\r\n} from \"@heroicons/react/24/outline\";\r\n\r\nimport Breadcrumbs from \"../components/Breadcrumbs\";\r\nimport DataTable from \"../components/DataTable\";\r\nimport Modal from \"../components/Modal\";\r\nimport { Button } from \"../components/ui/button\";\r\nimport { Input } from \"../components/ui/input\";\r\nimport createStorageColumns, {\r\n  type StorageRow,\r\n} from \"../columns/storageColumns\";\r\nimport {\r\n  fetchFile,\r\n  fetchFiles,\r\n  removeFile,\r\n\r\n  runDiagnostics,\r\n  type StorageDiagnosticsReport,\r\n\r\n  type StoredFile,\r\n} from \"../services/storage\";\r\nimport { fetchUsers } from \"../services/users\";\r\nimport type { User } from \"../types/user\";\r\nimport authFetch from \"../utils/authFetch\";\r\nimport { showToast } from \"../utils/toast\";\r\nimport { PROJECT_TIMEZONE, PROJECT_TIMEZONE_LABEL } from \"shared\";\r\n\r\nconst PAGE_SIZE = 25;\r\n\r\nconst dateTimeFormatter = new Intl.DateTimeFormat(\"ru-RU\", {\r\n  day: \"2-digit\",\r\n  month: \"2-digit\",\r\n  year: \"numeric\",\r\n  hour: \"2-digit\",\r\n  minute: \"2-digit\",\r\n  hour12: false,\r\n  timeZone: PROJECT_TIMEZONE,\r\n});\r\n\r\ntype SortOption = \"uploaded_desc\" | \"uploaded_asc\" | \"size_desc\" | \"size_asc\";\r\n\r\ntype PreviewMode = \"image\" | \"video\" | \"pdf\" | \"text\";\r\n\r\ntype PreviewState = {\r\n  mode: PreviewMode;\r\n  inlineUrl: string;\r\n  mime: string;\r\n  loading?: boolean;\r\n  error?: string;\r\n  content?: string;\r\n};\r\n\r\ntype TaskOption = {\r\n  id: string;\r\n  label: string;\r\n  title: string;\r\n  number?: string | null;\r\n  changedAt: number;\r\n};\r\n\r\nconst previewIcons: Record<PreviewMode, React.ComponentType<{ className?: string }>> = {\r\n  image: PhotoIcon,\r\n  video: VideoCameraIcon,\r\n  pdf: DocumentIcon,\r\n  text: DocumentTextIcon,\r\n};\r\n\r\nfunction isTextLike(mime: string): boolean {\r\n  return (\r\n    mime.startsWith(\"text/\") ||\r\n    mime.includes(\"json\") ||\r\n    mime.endsWith(\"xml\") ||\r\n    mime === \"application/sql\"\r\n  );\r\n}\r\n\r\nfunction formatSize(bytes: number | undefined): string {\r\n  if (!bytes || Number.isNaN(bytes)) return \"—\";\r\n  if (bytes <= 0) return \"0 Б\";\r\n  const units = [\"Б\", \"КБ\", \"МБ\", \"ГБ\", \"ТБ\"];\r\n  const index = Math.min(Math.floor(Math.log(bytes) / Math.log(1024)), units.length - 1);\r\n  const value = bytes / Math.pow(1024, index);\r\n  return `${value.toFixed(value >= 10 || index === 0 ? 0 : 1)} ${units[index]}`;\r\n}\r\n\r\nfunction formatDate(value?: string): string {\r\n  if (!value) return \"—\";\r\n  const time = Date.parse(value);\r\n  if (Number.isNaN(time)) return \"—\";\r\n  const label = dateTimeFormatter.format(new Date(time)).replace(\", \", \" \");\r\n  return `${label} ${PROJECT_TIMEZONE_LABEL}`;\r\n}\r\n\r\nexport default function StoragePage() {\r\n  const { t } = useTranslation();\r\n  const [searchParams, setSearchParams] = useSearchParams();\r\n  const [files, setFiles] = React.useState<StoredFile[]>([]);\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [usersById, setUsersById] = React.useState<Record<number, User>>({});\r\n  const [search, setSearch] = React.useState(\"\");\r\n  const [sort, setSort] = React.useState<SortOption>(\"uploaded_desc\");\r\n  const [pageIndex, setPageIndex] = React.useState(0);\r\n  const [selectedId, setSelectedId] = React.useState<string | null>(\r\n    searchParams.get(\"file\"),\r\n  );\r\n  const [selectedFile, setSelectedFile] = React.useState<StoredFile | null>(null);\r\n  const [detailsLoading, setDetailsLoading] = React.useState(false);\r\n  const [preview, setPreview] = React.useState<PreviewState | null>(null);\r\n  const [tasksLoading, setTasksLoading] = React.useState(false);\r\n  const [taskOptions, setTaskOptions] = React.useState<TaskOption[]>([]);\r\n  const [taskMetaById, setTaskMetaById] = React.useState<\r\n    Record<string, TaskOption>\r\n  >({});\r\n  const [selectionByFile, setSelectionByFile] = React.useState<\r\n    Record<string, string>\r\n  >({});\r\n  const [attachLoadingId, setAttachLoadingId] = React.useState<string | null>(\r\n    null,\r\n  );\r\n\r\n  const [diagnostics, setDiagnostics] = React.useState<\r\n    StorageDiagnosticsReport | null\r\n  >(null);\r\n  const [diagnosticsLoading, setDiagnosticsLoading] = React.useState(false);\r\n  const [diagnosticsError, setDiagnosticsError] = React.useState<string | null>(\r\n    null,\r\n  );\r\n\r\n  const attachFileToTask = React.useCallback(\r\n    async (fileId: string, taskId: string): Promise<void> => {\r\n      const response = await authFetch(\r\n        `/api/v1/files/${encodeURIComponent(fileId)}/attach`,\r\n        {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({ taskId }),\r\n        },\r\n      );\r\n      if (!response.ok) {\r\n        const error = new Error(\"attach\");\r\n        (error as { status?: number }).status = response.status;\r\n        throw error;\r\n      }\r\n      await response.json().catch(() => ({}));\r\n    },\r\n    [],\r\n  );\r\n\r\n  const loadFiles = React.useCallback(() => {\r\n    setLoading(true);\r\n    return fetchFiles()\r\n      .then((list) => {\r\n        setFiles(Array.isArray(list) ? list : []);\r\n      })\r\n      .catch(() => {\r\n        showToast(t(\"storage.loadError\"), \"error\");\r\n      })\r\n      .finally(() => setLoading(false));\r\n  }, [t]);\r\n\r\n  const detachedCount = React.useMemo(\r\n    () => files.filter((file) => !file.taskId).length,\r\n    [files],\r\n  );\r\n\r\n  const handleDiagnostics = React.useCallback(() => {\r\n    setDiagnosticsLoading(true);\r\n    setDiagnosticsError(null);\r\n    return runDiagnostics()\r\n      .then((report) => {\r\n        setDiagnostics(report);\r\n        showToast(t(\"storage.diagnostics.success\"), \"success\");\r\n        return loadFiles();\r\n      })\r\n      .catch(() => {\r\n        setDiagnosticsError(t(\"storage.diagnostics.error\"));\r\n        showToast(t(\"storage.diagnostics.error\"), \"error\");\r\n      })\r\n      .finally(() => {\r\n        setDiagnosticsLoading(false);\r\n      });\r\n  }, [loadFiles, t]);\r\n\r\n  React.useEffect(() => {\r\n    void loadFiles();\r\n  }, [loadFiles]);\r\n\r\n  React.useEffect(() => {\r\n    let active = true;\r\n    fetchUsers()\r\n      .then((list) => {\r\n        if (!active) return;\r\n        const map: Record<number, User> = {};\r\n        list.forEach((user) => {\r\n          if (typeof user.telegram_id === \"number\") {\r\n            map[user.telegram_id] = user;\r\n          }\r\n        });\r\n        setUsersById(map);\r\n      })\r\n      .catch(() => {\r\n        showToast(t(\"storage.usersLoadError\"), \"error\");\r\n      });\r\n    return () => {\r\n      active = false;\r\n    };\r\n  }, [t]);\r\n\r\n  React.useEffect(() => {\r\n    let cancelled = false;\r\n    setTasksLoading(true);\r\n    authFetch(\"/api/v1/tasks/mentioned\")\r\n      .then((res) => (res.ok ? res.json() : []))\r\n      .then((data) => {\r\n        if (cancelled) return;\r\n        const list = Array.isArray(data) ? (data as Record<string, unknown>[]) : [];\r\n        const normalized = list\r\n          .map((task): TaskOption | null => {\r\n            const rawId =\r\n              typeof (task as { _id?: unknown })._id === \"string\"\r\n                ? ((task as { _id: string })._id ?? \"\").trim()\r\n                : typeof (task as { id?: unknown }).id === \"string\"\r\n                  ? ((task as { id: string }).id ?? \"\").trim()\r\n                  : \"\";\r\n            if (!rawId) {\r\n              return null;\r\n            }\r\n            const rawTitle = (task as { title?: unknown }).title;\r\n            const title =\r\n              typeof rawTitle === \"string\" && rawTitle.trim().length > 0\r\n                ? rawTitle.trim()\r\n                : t(\"storage.attach.untitled\");\r\n            const rawNumber = (task as { task_number?: unknown }).task_number;\r\n            const number =\r\n              typeof rawNumber === \"string\" && rawNumber.trim().length > 0\r\n                ? rawNumber.trim()\r\n                : null;\r\n            const timestamps = [\r\n              (task as { changed_at?: unknown }).changed_at,\r\n              (task as { changedAt?: unknown }).changedAt,\r\n              (task as { updatedAt?: unknown }).updatedAt,\r\n              (task as { createdAt?: unknown }).createdAt,\r\n              (task as { submission_date?: unknown }).submission_date,\r\n            ];\r\n            const changedAt = timestamps\r\n              .map((value) => {\r\n                if (value instanceof Date) {\r\n                  const time = value.getTime();\r\n                  return Number.isNaN(time) ? 0 : time;\r\n                }\r\n                if (typeof value === \"string\") {\r\n                  const time = Date.parse(value);\r\n                  return Number.isNaN(time) ? 0 : time;\r\n                }\r\n                if (typeof value === \"number\" && Number.isFinite(value)) {\r\n                  return value;\r\n                }\r\n                return 0;\r\n              })\r\n              .reduce((max, current) => (current > max ? current : max), 0);\r\n            const shortId = rawId.slice(-6) || rawId;\r\n            const label = number\r\n              ? t(\"storage.attach.optionNumber\", { number, title })\r\n              : t(\"storage.attach.optionId\", { id: shortId, title });\r\n            return { id: rawId, label, title, number, changedAt };\r\n          })\r\n          .filter((item): item is TaskOption => Boolean(item));\r\n        normalized.sort((a, b) => b.changedAt - a.changedAt);\r\n        const limited = normalized.slice(0, 6);\r\n        const meta = limited.reduce<Record<string, TaskOption>>((acc, option) => {\r\n          acc[option.id] = option;\r\n          return acc;\r\n        }, {});\r\n        setTaskOptions(limited);\r\n        setTaskMetaById(meta);\r\n      })\r\n      .catch(() => {\r\n        if (cancelled) return;\r\n        setTaskOptions([]);\r\n        setTaskMetaById({});\r\n        showToast(t(\"storage.attach.tasksLoadError\"), \"error\");\r\n      })\r\n      .finally(() => {\r\n        if (!cancelled) {\r\n          setTasksLoading(false);\r\n        }\r\n      });\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [t]);\r\n\r\n  React.useEffect(() => {\r\n    if (!taskOptions.length) {\r\n      setSelectionByFile((current) =>\r\n        Object.keys(current).length ? ({} as Record<string, string>) : current,\r\n      );\r\n      return;\r\n    }\r\n    const validIds = new Set(taskOptions.map((option) => option.id));\r\n    setSelectionByFile((current) => {\r\n      let changed = false;\r\n      const next: Record<string, string> = {};\r\n      Object.entries(current).forEach(([fileId, value]) => {\r\n        if (value && validIds.has(value)) {\r\n          next[fileId] = value;\r\n        } else if (value) {\r\n          changed = true;\r\n        }\r\n      });\r\n      return changed ? next : current;\r\n    });\r\n  }, [taskOptions]);\r\n\r\n  React.useEffect(() => {\r\n    const queryId = searchParams.get(\"file\");\r\n    setSelectedId(queryId);\r\n  }, [searchParams]);\r\n\r\n  React.useEffect(() => {\r\n    if (!selectedId) {\r\n      setSelectedFile(null);\r\n      setDetailsLoading(false);\r\n      setPreview(null);\r\n      return;\r\n    }\r\n    const existing = files.find((file) => file.id === selectedId);\r\n    if (existing) {\r\n      setSelectedFile(existing);\r\n      return;\r\n    }\r\n    setDetailsLoading(true);\r\n    fetchFile(selectedId)\r\n      .then((file) => {\r\n        setSelectedFile(file);\r\n      })\r\n      .catch(() => {\r\n        showToast(t(\"storage.loadError\"), \"error\");\r\n        setSelectedFile(null);\r\n      })\r\n      .finally(() => setDetailsLoading(false));\r\n  }, [selectedId, files, t]);\r\n\r\n  React.useEffect(() => {\r\n    if (!selectedFile) {\r\n      setPreview(null);\r\n      return;\r\n    }\r\n    const mime = selectedFile.type || \"application/octet-stream\";\r\n    const inlineUrl = selectedFile.previewUrl || `${selectedFile.url}?mode=inline`;\r\n    if (mime.startsWith(\"image/\")) {\r\n      setPreview({ mode: \"image\", inlineUrl, mime });\r\n      return;\r\n    }\r\n    if (mime.startsWith(\"video/\")) {\r\n      setPreview({ mode: \"video\", inlineUrl, mime });\r\n      return;\r\n    }\r\n    if (mime === \"application/pdf\") {\r\n      setPreview({ mode: \"pdf\", inlineUrl, mime });\r\n      return;\r\n    }\r\n    if (isTextLike(mime)) {\r\n      let cancelled = false;\r\n      setPreview({ mode: \"text\", inlineUrl, mime, loading: true });\r\n      authFetch(inlineUrl)\r\n        .then((res) => {\r\n          if (!res.ok) throw new Error(\"preview\");\r\n          return res.text();\r\n        })\r\n        .then((content) => {\r\n          if (cancelled) return;\r\n          setPreview({ mode: \"text\", inlineUrl, mime, content });\r\n        })\r\n        .catch(() => {\r\n          if (cancelled) return;\r\n          setPreview({ mode: \"text\", inlineUrl, mime, error: t(\"storage.previewError\") });\r\n        });\r\n      return () => {\r\n        cancelled = true;\r\n      };\r\n    }\r\n    setPreview(null);\r\n    // неподдерживаемые типы доступны только для скачивания\r\n  }, [selectedFile, t]);\r\n\r\n  const filteredFiles = React.useMemo(() => {\r\n    const query = search.trim().toLowerCase();\r\n    return files.filter((file) =>\r\n      query ? file.name.toLowerCase().includes(query) : true,\r\n    );\r\n  }, [files, search]);\r\n\r\n  const sortedFiles = React.useMemo(() => {\r\n    const list = [...filteredFiles];\r\n    list.sort((a, b) => {\r\n      switch (sort) {\r\n        case \"uploaded_asc\": {\r\n          const left = Date.parse(a.uploadedAt || \"\");\r\n          const right = Date.parse(b.uploadedAt || \"\");\r\n          return (left || 0) - (right || 0);\r\n        }\r\n        case \"uploaded_desc\": {\r\n          const left = Date.parse(a.uploadedAt || \"\");\r\n          const right = Date.parse(b.uploadedAt || \"\");\r\n          return (right || 0) - (left || 0);\r\n        }\r\n        case \"size_asc\":\r\n          return (a.size || 0) - (b.size || 0);\r\n        case \"size_desc\":\r\n          return (b.size || 0) - (a.size || 0);\r\n        default:\r\n          return 0;\r\n      }\r\n    });\r\n    return list;\r\n  }, [filteredFiles, sort]);\r\n\r\n  const pagedFiles = React.useMemo(() => {\r\n    const start = pageIndex * PAGE_SIZE;\r\n    return sortedFiles.slice(start, start + PAGE_SIZE);\r\n  }, [sortedFiles, pageIndex]);\r\n\r\n  const taskOptionsForSelect = React.useMemo(\r\n    () => taskOptions.map((option) => ({ value: option.id, label: option.label })),\r\n    [taskOptions],\r\n  );\r\n\r\n  const handleDownload = React.useCallback(\r\n    (file: StoredFile) => {\r\n      if (!file.url) return;\r\n      window.open(file.url, \"_blank\", \"noopener,noreferrer\");\r\n      showToast(t(\"storage.openedInNewTab\"), \"success\");\r\n    },\r\n    [t],\r\n  );\r\n\r\n  const handleDelete = React.useCallback(\r\n    (file: StoredFile) => {\r\n      const confirmed = window.confirm(\r\n        t(\"storage.deleteConfirm\", { name: file.name }),\r\n      );\r\n      if (!confirmed) return;\r\n      removeFile(file.id)\r\n        .then((res) => {\r\n          if (!res.ok) throw new Error(\"delete\");\r\n          showToast(t(\"storage.deleteSuccess\"), \"success\");\r\n          setFiles((current) => current.filter((candidate) => candidate.id !== file.id));\r\n          if (selectedId === file.id) {\r\n            const next = new URLSearchParams(searchParams.toString());\r\n            next.delete(\"file\");\r\n            setSearchParams(next, { replace: true });\r\n          }\r\n        })\r\n        .catch(() => {\r\n          showToast(t(\"storage.deleteError\"), \"error\");\r\n        });\r\n    },\r\n    [searchParams, selectedId, setSearchParams, t],\r\n  );\r\n\r\n  const handleAttach = React.useCallback(\r\n    (file: StoredFile) => {\r\n      const selectedTaskId = selectionByFile[file.id];\r\n      if (!selectedTaskId) {\r\n        return;\r\n      }\r\n      if (!taskOptions.some((option) => option.id === selectedTaskId)) {\r\n        return;\r\n      }\r\n      setAttachLoadingId(file.id);\r\n      attachFileToTask(file.id, selectedTaskId)\r\n        .then(() => {\r\n          const meta = taskMetaById[selectedTaskId];\r\n          setFiles((current) =>\r\n            current.map((candidate) =>\r\n              candidate.id === file.id\r\n                ? {\r\n                    ...candidate,\r\n                    taskId: selectedTaskId,\r\n                    taskNumber: meta?.number ?? candidate.taskNumber ?? null,\r\n                    taskTitle: meta?.title ?? candidate.taskTitle ?? null,\r\n                  }\r\n                : candidate,\r\n            ),\r\n          );\r\n          if (selectedId === file.id) {\r\n            setSelectedFile((current) =>\r\n              current\r\n                ? {\r\n                    ...current,\r\n                    taskId: selectedTaskId,\r\n                    taskNumber: meta?.number ?? current.taskNumber ?? null,\r\n                    taskTitle: meta?.title ?? current.taskTitle ?? null,\r\n                  }\r\n                : current,\r\n            );\r\n          }\r\n          showToast(t(\"storage.attach.success\"), \"success\");\r\n        })\r\n        .catch((error) => {\r\n          const status = (error as { status?: number }).status;\r\n          if (status === 403) {\r\n            showToast(t(\"storage.attach.forbidden\"), \"error\");\r\n          } else {\r\n            showToast(t(\"storage.attach.error\"), \"error\");\r\n          }\r\n        })\r\n        .finally(() => {\r\n          setAttachLoadingId((current) => (current === file.id ? null : current));\r\n        });\r\n    },\r\n    [\r\n      attachFileToTask,\r\n      selectionByFile,\r\n      taskOptions,\r\n      taskMetaById,\r\n      setFiles,\r\n      selectedId,\r\n      setSelectedFile,\r\n      t,\r\n    ],\r\n  );\r\n\r\n  const toRow = React.useCallback(\r\n    (file: StoredFile): StorageRow => {\r\n      const hasTaskId = file.taskId != null && file.taskId !== \"\";\r\n      const normalizedTaskId = hasTaskId ? String(file.taskId) : undefined;\r\n      const normalizedTitle =\r\n        typeof file.taskTitle === \"string\" && file.taskTitle.trim()\r\n          ? file.taskTitle.trim()\r\n          : undefined;\r\n      const identifier = hasTaskId\r\n        ? file.taskNumber && file.taskNumber !== \"\"\r\n          ? t(\"storage.taskNumberLabel\", { number: file.taskNumber })\r\n          : t(\"storage.taskLabel\", { id: normalizedTaskId })\r\n        : t(\"storage.taskMissing\");\r\n      const user =\r\n        typeof file.userId === \"number\" ? usersById[file.userId] : undefined;\r\n      const displayName =\r\n        (typeof user?.name === \"string\" && user.name.trim()) ||\r\n        (typeof user?.telegram_username === \"string\" &&\r\n          user.telegram_username.trim()) ||\r\n        (typeof user?.username === \"string\" && user.username.trim()) ||\r\n        t(\"storage.userLabel\", { id: file.userId });\r\n      const userHint =\r\n        typeof file.userId === \"number\"\r\n          ? t(\"storage.details.userId\", { id: file.userId })\r\n          : t(\"storage.details.userId\", { id: \"—\" });\r\n      let taskLink: string | undefined;\r\n      if (normalizedTaskId) {\r\n        const paramsWithTask = new URLSearchParams(searchParams.toString());\r\n        paramsWithTask.set(\"task\", normalizedTaskId);\r\n        taskLink = `?${paramsWithTask.toString()}`;\r\n      }\r\n      const selectedCandidate = selectionByFile[file.id] ?? \"\";\r\n      const hasValidSelection = taskOptions.some(\r\n        (option) => option.id === selectedCandidate,\r\n      );\r\n      const selectedTaskId = hasValidSelection ? selectedCandidate : \"\";\r\n      return {\r\n        ...file,\r\n        taskTitle: normalizedTitle,\r\n        sizeLabel: formatSize(file.size),\r\n        uploadedLabel: formatDate(file.uploadedAt),\r\n        userDisplay: displayName,\r\n        userHint,\r\n        taskDisplay: identifier,\r\n        taskParam: normalizedTaskId,\r\n        taskLink,\r\n        onDownload: () => handleDownload(file),\r\n        onDelete: () => handleDelete(file),\r\n        selectedTaskId,\r\n        onTaskSelect: (taskId: string) => {\r\n          setSelectionByFile((current) => ({ ...current, [file.id]: taskId }));\r\n        },\r\n        onAttach: () => handleAttach(file),\r\n        attachLoading: attachLoadingId === file.id,\r\n        attachDisabled:\r\n          attachLoadingId === file.id ||\r\n          tasksLoading ||\r\n          !taskOptions.length ||\r\n          !hasValidSelection,\r\n      };\r\n    },\r\n    [\r\n      attachLoadingId,\r\n      handleAttach,\r\n      handleDelete,\r\n      handleDownload,\r\n      searchParams,\r\n      selectionByFile,\r\n      setSelectionByFile,\r\n      t,\r\n      taskOptions,\r\n      tasksLoading,\r\n      usersById,\r\n    ],\r\n  );\r\n\r\n  const rows = React.useMemo<StorageRow[]>(\r\n    () => pagedFiles.map((file) => toRow(file)),\r\n    [pagedFiles, toRow],\r\n  );\r\n\r\n  const pageCount = React.useMemo(() => {\r\n    if (!sortedFiles.length) return 1;\r\n    return Math.max(1, Math.ceil(sortedFiles.length / PAGE_SIZE));\r\n  }, [sortedFiles.length]);\r\n\r\n  const openTaskDialog = React.useCallback(\r\n    (taskId?: string) => {\r\n      if (!taskId) return;\r\n      const next = new URLSearchParams(searchParams.toString());\r\n      next.set(\"task\", taskId);\r\n      setSearchParams(next, { replace: false });\r\n    },\r\n    [searchParams, setSearchParams],\r\n  );\r\n\r\n  const closeModal = React.useCallback(() => {\r\n    const next = new URLSearchParams(searchParams.toString());\r\n    next.delete(\"file\");\r\n    setSearchParams(next, { replace: true });\r\n  }, [searchParams, setSearchParams]);\r\n\r\n  const selectedRow = React.useMemo(\r\n    () => (selectedFile ? toRow(selectedFile) : null),\r\n    [selectedFile, toRow],\r\n  );\r\n\r\n  const details = React.useMemo(() => {\r\n    if (!selectedRow) return [];\r\n    const empty = t(\"storage.details.empty\");\r\n    return [\r\n      {\r\n        key: \"task\",\r\n        label: t(\"storage.details.task\"),\r\n        value: selectedRow.taskDisplay,\r\n      },\r\n      {\r\n        key: \"taskNumber\",\r\n        label: t(\"storage.details.taskNumber\"),\r\n        value: selectedRow.taskNumber || empty,\r\n      },\r\n      {\r\n        key: \"taskId\",\r\n        label: t(\"storage.details.taskId\"),\r\n        value: selectedRow.taskId || empty,\r\n      },\r\n      {\r\n        key: \"taskTitle\",\r\n        label: t(\"storage.details.taskTitle\"),\r\n        value: selectedRow.taskTitle || empty,\r\n      },\r\n      {\r\n        key: \"user\",\r\n        label: t(\"storage.details.user\"),\r\n        value: (\r\n          <span className=\"flex flex-col\">\r\n            {selectedRow.userDisplay}\r\n            <span className=\"text-xs text-muted-foreground\">\r\n              {selectedRow.userHint}\r\n            </span>\r\n          </span>\r\n        ),\r\n      },\r\n      {\r\n        key: \"uploaded\",\r\n        label: t(\"storage.details.uploaded\"),\r\n        value: selectedRow.uploadedLabel || empty,\r\n      },\r\n      {\r\n        key: \"size\",\r\n        label: t(\"storage.details.size\"),\r\n        value: selectedRow.sizeLabel || empty,\r\n      },\r\n      {\r\n        key: \"type\",\r\n        label: t(\"storage.details.type\"),\r\n        value: selectedRow.type || empty,\r\n      },\r\n      {\r\n        key: \"path\",\r\n        label: t(\"storage.details.path\"),\r\n        value: <code className=\"break-all text-xs\">{selectedRow.path}</code>,\r\n      },\r\n    ];\r\n  }, [selectedRow, t]);\r\n\r\n  const previewIcon = preview ? previewIcons[preview.mode] : null;\r\n  const diagnosticsTimestamp = React.useMemo(\r\n    () => (diagnostics ? formatDate(diagnostics.generatedAt) : null),\r\n    [diagnostics],\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Breadcrumbs items={[{ label: t(\"storage.title\") }]} />\r\n      <section className=\"rounded border border-amber-300 bg-amber-50 p-5 shadow-sm\">\r\n        <div className=\"flex flex-col gap-4 md:flex-row md:items-start md:justify-between\">\r\n          <div className=\"space-y-2\">\r\n            <h2 className=\"text-base font-semibold text-amber-900\">\r\n              {t(\"storage.diagnostics.title\")}\r\n            </h2>\r\n            <p className=\"text-sm text-amber-800\">\r\n              {t(\"storage.diagnostics.description\")}\r\n            </p>\r\n            <p className=\"text-sm text-amber-900\">\r\n              {detachedCount === 0\r\n                ? t(\"storage.sync.ok\", { count: files.length })\r\n                : t(\"storage.sync.warning\", { count: detachedCount })}\r\n            </p>\r\n          </div>\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"outline\"\r\n            className=\"self-start border-amber-400 text-amber-900 hover:bg-amber-100\"\r\n            disabled={diagnosticsLoading}\r\n            onClick={() => {\r\n              void handleDiagnostics();\r\n            }}\r\n          >\r\n            {diagnosticsLoading\r\n              ? t(\"storage.diagnostics.progress\")\r\n              : t(\"storage.diagnostics.cta\")}\r\n          </Button>\r\n        </div>\r\n        {diagnosticsError ? (\r\n          <p className=\"mt-3 text-sm text-red-700\">{diagnosticsError}</p>\r\n        ) : null}\r\n        {diagnostics ? (\r\n          <div className=\"mt-3 space-y-1 text-sm text-amber-900\">\r\n            <p>\r\n              {t(\"storage.diagnostics.lastRun\", {\r\n                date: diagnosticsTimestamp ?? \"—\",\r\n              })}\r\n            </p>\r\n            <p>\r\n              {t(\"storage.diagnostics.snapshot\", {\r\n                total: diagnostics.snapshot.totalFiles,\r\n                linked: diagnostics.snapshot.linkedFiles,\r\n                detached: diagnostics.snapshot.detachedFiles,\r\n              })}\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <p className=\"mt-3 text-sm text-amber-800\">\r\n            {t(\"storage.diagnostics.placeholder\")}\r\n          </p>\r\n        )}\r\n      </section>\r\n      <section className=\"space-y-5 rounded border border-border bg-card p-5 shadow-sm\">\r\n        <header className=\"flex flex-col gap-4 border-b border-border pb-4\">\r\n          <div className=\"flex flex-col gap-1\">\r\n            <h2 className=\"text-lg font-semibold text-foreground\">{t(\"storage.title\")}</h2>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              {t(\"storage.total\", { count: filteredFiles.length })}\r\n            </p>\r\n          </div>\r\n          <div className=\"flex flex-col gap-2 md:flex-row md:items-center md:justify-between\">\r\n            <div className=\"flex flex-wrap items-center gap-2\">\r\n              <Input\r\n                value={search}\r\n                onChange={(event) => {\r\n                  setSearch(event.target.value);\r\n                  setPageIndex(0);\r\n                }}\r\n                placeholder={t(\"storage.searchPlaceholder\") ?? \"\"}\r\n                className=\"max-w-xs\"\r\n              />\r\n              <select\r\n                value={sort}\r\n                onChange={(event) => {\r\n                  setSort(event.target.value as SortOption);\r\n                  setPageIndex(0);\r\n                }}\r\n                className=\"h-9 rounded-md border border-input bg-background px-2 text-sm\"\r\n              >\r\n                <option value=\"uploaded_desc\">{t(\"storage.sort.uploadedDesc\")}</option>\r\n                <option value=\"uploaded_asc\">{t(\"storage.sort.uploadedAsc\")}</option>\r\n                <option value=\"size_desc\">{t(\"storage.sort.sizeDesc\")}</option>\r\n                <option value=\"size_asc\">{t(\"storage.sort.sizeAsc\")}</option>\r\n              </select>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"secondary\"\r\n                onClick={() => void loadFiles()}\r\n                disabled={loading}\r\n              >\r\n                {t(\"storage.refresh\")}\r\n              </Button>\r\n            </div>\r\n            <div className=\"text-xs text-muted-foreground md:text-sm\">\r\n              {loading ? t(\"loading\") : null}\r\n            </div>\r\n          </div>\r\n        </header>\r\n        <DataTable<StorageRow>\r\n          columns={createStorageColumns(\r\n            {\r\n              name: t(\"storage.columns.name\"),\r\n              user: t(\"storage.columns.user\"),\r\n              type: t(\"storage.columns.type\"),\r\n              size: t(\"storage.columns.size\"),\r\n              task: t(\"storage.columns.task\"),\r\n              uploaded: t(\"storage.columns.uploaded\"),\r\n              download: t(\"storage.download\"),\r\n              delete: t(\"storage.delete\"),\r\n              taskTitleHint: (title: string) => t(\"storage.taskTitleHint\", { title }),\r\n              attachTitle: t(\"storage.attach.title\"),\r\n              attachPlaceholder: t(\"storage.attach.placeholder\"),\r\n              attachAction: t(\"storage.attach.button\"),\r\n              attachProcessing: t(\"storage.attach.processing\"),\r\n              attachEmpty: t(\"storage.attach.empty\"),\r\n              attachLoading: t(\"storage.attach.loading\"),\r\n            },\r\n            {\r\n              onTaskOpen: openTaskDialog,\r\n              taskOptions: taskOptionsForSelect,\r\n              tasksLoading,\r\n            },\r\n          )}\r\n          data={rows}\r\n          pageIndex={pageIndex}\r\n          pageSize={PAGE_SIZE}\r\n          pageCount={pageCount}\r\n          onPageChange={setPageIndex}\r\n          showGlobalSearch={false}\r\n          showFilters={false}\r\n          wrapCellsAsBadges\r\n          onRowClick={(row) => {\r\n            const next = new URLSearchParams(searchParams.toString());\r\n            next.set(\"file\", row.id);\r\n            setSearchParams(next, { replace: false });\r\n          }}\r\n        />\r\n      </section>\r\n      <Modal open={Boolean(selectedId)} onClose={closeModal}>\r\n        {detailsLoading ? (\r\n          <div className=\"p-4 text-center text-sm text-muted-foreground\">\r\n            {t(\"loading\")}\r\n          </div>\r\n        ) : selectedRow ? (\r\n          <div className=\"space-y-4\">\r\n            <header className=\"flex items-start justify-between gap-4\">\r\n              <div>\r\n                <h2 className=\"text-lg font-semibold\">{selectedRow.name}</h2>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  {selectedRow.type || t(\"storage.details.type\")}\r\n                </p>\r\n              </div>\r\n              <div className=\"flex flex-wrap items-center gap-2\">\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  onClick={() => handleDownload(selectedRow)}\r\n                >\r\n                  <ArrowDownTrayIcon className=\"mr-2 size-4\" />\r\n                  {t(\"storage.download\")}\r\n                </Button>\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"destructive\"\r\n                  onClick={() => handleDelete(selectedRow)}\r\n                >\r\n                  <TrashIcon className=\"mr-2 size-4\" />\r\n                  {t(\"storage.delete\")}\r\n                </Button>\r\n              </div>\r\n            </header>\r\n            {preview ? (\r\n              <div className=\"space-y-2 rounded-lg border border-dashed border-border p-4\">\r\n                <div className=\"flex items-center gap-2 text-sm font-semibold\">\r\n                  {previewIcon ? <previewIcon className=\"size-5\" /> : null}\r\n                  <span>{t(\"storage.previewTitle\")}</span>\r\n                  <span className=\"text-xs text-muted-foreground\">\r\n                    {t(\"storage.mimeLabel\", { mime: preview.mime })}\r\n                  </span>\r\n                </div>\r\n                {preview.mode === \"image\" ? (\r\n                  <img\r\n                    src={preview.inlineUrl}\r\n                    alt={selectedRow.name}\r\n                    className=\"max-h-[300px] w-full rounded-md object-contain\"\r\n                  />\r\n                ) : preview.mode === \"video\" ? (\r\n                  <video\r\n                    controls\r\n                    src={preview.inlineUrl}\r\n                    className=\"max-h-[320px] w-full rounded-md\"\r\n                  />\r\n                ) : preview.mode === \"pdf\" ? (\r\n                  <iframe\r\n                    title={selectedRow.name}\r\n                    src={preview.inlineUrl}\r\n                    className=\"h-[320px] w-full rounded-md\"\r\n                  />\r\n            ) : preview.mode === \"text\" ? (\r\n              preview.loading ? (\r\n                <div className=\"text-sm text-muted-foreground\">\r\n                  {t(\"storage.previewLoading\")}\r\n                </div>\r\n              ) : preview.error ? (\r\n                <div className=\"text-sm text-red-500\">{preview.error}</div>\r\n              ) : (\r\n                <pre className=\"max-h-[320px] overflow-auto rounded bg-muted p-3 text-xs\">\r\n                  {preview.content}\r\n                </pre>\r\n              )\r\n            ) : null}\r\n          </div>\r\n        ) : null}\r\n        <section className=\"space-y-3\">\r\n          <h3 className=\"text-sm font-semibold\">{t(\"storage.attach.title\")}</h3>\r\n          <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center\">\r\n            <select\r\n              value={selectedRow.selectedTaskId}\r\n              onChange={(event) => selectedRow.onTaskSelect(event.target.value)}\r\n              disabled={selectedRow.attachLoading || tasksLoading}\r\n              className=\"h-9 min-w-[12rem] rounded-md border border-input bg-background px-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\"\r\n            >\r\n              <option value=\"\">{t(\"storage.attach.placeholder\")}</option>\r\n              {taskOptionsForSelect.map((option) => (\r\n                <option key={option.value} value={option.value}>\r\n                  {option.label}\r\n                </option>\r\n              ))}\r\n            </select>\r\n            <Button\r\n              type=\"button\"\r\n              onClick={() => selectedRow.onAttach()}\r\n              disabled={selectedRow.attachDisabled}\r\n            >\r\n              {selectedRow.attachLoading\r\n                ? t(\"storage.attach.processing\")\r\n                : t(\"storage.attach.button\")}\r\n            </Button>\r\n          </div>\r\n          {tasksLoading ? (\r\n            <p className=\"text-xs text-muted-foreground\">{t(\"storage.attach.loading\")}</p>\r\n          ) : taskOptionsForSelect.length === 0 ? (\r\n            <p className=\"text-xs text-muted-foreground\">{t(\"storage.attach.empty\")}</p>\r\n          ) : null}\r\n        </section>\r\n        <section className=\"space-y-2\">\r\n          <h3 className=\"text-sm font-semibold\">{t(\"storage.details.title\")}</h3>\r\n          <dl className=\"grid gap-2 sm:grid-cols-2\">\r\n            {details.map((item) => (\r\n              <div\r\n                    key={item.key}\r\n                    className=\"rounded-md border border-border p-3 text-sm\"\r\n                  >\r\n                    <dt className=\"text-xs font-semibold uppercase text-muted-foreground\">\r\n                      {item.label}\r\n                    </dt>\r\n                    <dd className=\"mt-1 text-sm\">{item.value}</dd>\r\n                  </div>\r\n                ))}\r\n              </dl>\r\n              {selectedRow.taskId ? (\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  onClick={() => openTaskDialog(selectedRow.taskId)}\r\n                >\r\n                  {t(\"storage.details.openTask\")}\r\n                </Button>\r\n              ) : null}\r\n            </section>\r\n          </div>\r\n        ) : (\r\n          <div className=\"p-4 text-sm text-muted-foreground\">\r\n            {t(\"storage.loadError\")}\r\n          </div>\r\n        )}\r\n      </Modal>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["ArrowDownTrayIcon","title","titleId","props","svgRef","React.createElement","ForwardRef","React.forwardRef","DocumentTextIcon","DocumentIcon","TrashIcon","VideoCameraIcon","Breadcrumbs","items","jsx","c","idx","jsxs","React","userBadgeClass","createStorageColumns","labels","options","handleTaskOpen","attachOptions","_a","isTasksLoading","row","file","event","option","label","EmployeeLink","content","fetchFiles","params","qs","url","authFetch","r","fetchFile","id","res","removeFile","runDiagnostics","response","PAGE_SIZE","dateTimeFormatter","PROJECT_TIMEZONE","previewIcons","PhotoIcon","isTextLike","mime","formatSize","bytes","units","index","value","formatDate","time","PROJECT_TIMEZONE_LABEL","StoragePage","t","useTranslation","searchParams","setSearchParams","useSearchParams","files","setFiles","loading","setLoading","usersById","setUsersById","search","setSearch","sort","setSort","pageIndex","setPageIndex","selectedId","setSelectedId","selectedFile","setSelectedFile","detailsLoading","setDetailsLoading","preview","setPreview","tasksLoading","setTasksLoading","taskOptions","setTaskOptions","taskMetaById","setTaskMetaById","selectionByFile","setSelectionByFile","attachLoadingId","setAttachLoadingId","diagnostics","setDiagnostics","diagnosticsLoading","setDiagnosticsLoading","diagnosticsError","setDiagnosticsError","attachFileToTask","fileId","taskId","error","loadFiles","list","showToast","detachedCount","handleDiagnostics","report","active","fetchUsers","map","user","cancelled","data","normalized","task","rawId","_b","rawTitle","rawNumber","number","changedAt","max","current","shortId","item","a","b","limited","meta","acc","validIds","changed","next","queryId","existing","inlineUrl","filteredFiles","query","sortedFiles","left","right","pagedFiles","start","taskOptionsForSelect","handleDownload","handleDelete","candidate","handleAttach","selectedTaskId","_d","_c","toRow","hasTaskId","normalizedTaskId","normalizedTitle","identifier","displayName","userHint","taskLink","paramsWithTask","selectedCandidate","hasValidSelection","rows","pageCount","openTaskDialog","closeModal","selectedRow","details","empty","previewIcon","diagnosticsTimestamp","Button","Input","DataTable","Modal"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4]}