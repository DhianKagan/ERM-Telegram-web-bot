{"version":3,"file":"map-legacy-CIYHAQaS.js","sources":["../../../web/src/utils/haversine.ts","../../../web/src/utils/mapLibrary.ts","../../../web/src/config/map.ts"],"sourcesContent":["// Назначение файла: расчёт геодезического расстояния между двумя координатами\r\n// Основные модули: отсутствуют\r\nimport type { LatLng } from \"./extractCoords\";\r\n\r\nconst EARTH_RADIUS_KM = 6371;\r\n\r\nexport default function haversine(a: LatLng, b: LatLng): number {\r\n  const toRadians = (value: number) => (value * Math.PI) / 180;\r\n  const dLat = toRadians(b.lat - a.lat);\r\n  const dLon = toRadians(b.lng - a.lng);\r\n  const lat1 = toRadians(a.lat);\r\n  const lat2 = toRadians(b.lat);\r\n  const sinLat = Math.sin(dLat / 2);\r\n  const sinLon = Math.sin(dLon / 2);\r\n  const h = sinLat * sinLat + Math.cos(lat1) * Math.cos(lat2) * sinLon * sinLon;\r\n  const c = 2 * Math.atan2(Math.sqrt(h), Math.sqrt(1 - h));\r\n  return EARTH_RADIUS_KM * c;\r\n}\r\n","// Назначение: единая точка подключения MapLibre и поддержки протокола PMTiles\r\n// Основные модули: maplibre-gl, pmtiles\r\n\r\nimport maplibregl, {\r\n  type GeoJSONSource,\r\n  type LngLatBoundsLike,\r\n  type Listener,\r\n  type Map as MapInstance,\r\n  type MapLayerMouseEvent,\r\n  type MapMouseEvent,\r\n  type Marker as MapMarker,\r\n  type ExpressionSpecification,\r\n} from \"maplibre-gl\";\r\nimport { Protocol } from \"pmtiles\";\r\nimport \"maplibre-gl/dist/maplibre-gl.css\";\r\n\r\nlet pmtilesProtocolRegistered = false;\r\n\r\nconst registerPmtilesProtocol = () => {\r\n  if (pmtilesProtocolRegistered) {\r\n    return;\r\n  }\r\n  try {\r\n    const protocol = new Protocol();\r\n    maplibregl.addProtocol(\"pmtiles\", (request) => protocol.tile(request));\r\n    pmtilesProtocolRegistered = true;\r\n  } catch (error) {\r\n    console.error(\"Не удалось зарегистрировать протокол PMTiles\", error);\r\n  }\r\n};\r\n\r\nif (typeof window !== \"undefined\") {\r\n  registerPmtilesProtocol();\r\n}\r\n\r\nexport default maplibregl;\r\nexport { registerPmtilesProtocol };\r\nexport type {\r\n  GeoJSONSource,\r\n  LngLatBoundsLike,\r\n  Listener,\r\n  MapInstance,\r\n  MapLayerMouseEvent,\r\n  MapMouseEvent,\r\n  MapMarker,\r\n  ExpressionSpecification,\r\n};\r\n","// Map config unified for MapLibre + Protomaps CDN\n// URL стиля (light v5) — можно переопределить через VITE_MAP_STYLE_URL\nexport const MAP_STYLE_URL =\n  (import.meta as any)?.env?.VITE_MAP_STYLE_URL ||\n  'https://api.protomaps.com/styles/v5/light/en.json?key=e2ee205f93bfd080';\n\n// Совместимость с существующими импортами:\nexport const MAP_STYLE = MAP_STYLE_URL;                  // ранее могли импортировать как MAP_STYLE\nexport const MAP_STYLE_MODE: 'light' | 'dark' = 'light'; // если в UI есть тумблер темы\n\n// Атрибуция (Protomaps + OpenStreetMap contributors)\nexport const MAP_ATTRIBUTION =\n  '© <a href=\"https://protomaps.com\" target=\"_blank\" rel=\"noopener\">Protomaps</a> © <a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\" rel=\"noopener\">OSM contributors</a>';\n\n// Центр/зум по умолчанию — Киев\nexport const MAP_DEFAULT_CENTER: [number, number] = [30.5234, 50.4501];\nexport const MAP_DEFAULT_ZOOM = 6;\n\n// Глобальные границы мира (чтобы не улетать за пределы проекции)\nexport const MAP_MAX_BOUNDS: [[number, number], [number, number]] = [[-180, -85], [180, 85]];\n\n// Идентификатор векторного источника; для стиля Protomaps v5 чаще 'basemap'\nexport const MAP_VECTOR_SOURCE_ID = 'basemap';\n\n// Скорость анимации (если используется для пробегов транспорта)\nexport const MAP_ANIMATION_SPEED_KMH = 50;\n\n// Ранее использовалось для локальных адресных pmtiles; теперь не требуется.\n// Оставим пустой строкой для совместимости — код выше должен проверять на truthy.\nexport const MAP_ADDRESSES_PMTILES_URL = '';\n\n// Дополнительные алиасы (если где-то использовались короткие имена)\nexport const DEFAULT_CENTER = MAP_DEFAULT_CENTER;\nexport const DEFAULT_ZOOM = MAP_DEFAULT_ZOOM;\n"],"names":["a","b","toRadians","value","Math","PI","dLat","lat","dLon","lng","lat1","lat2","sinLat","sin","sinLon","h","cos","c","atan2","sqrt","EARTH_RADIUS_KM","pmtilesProtocolRegistered","window","protocol","Protocol","maplibregl","addProtocol","request","tile","error","console","registerPmtilesProtocol","exports"],"mappings":"mp9DAMA,SAAkCA,EAAWC,GAC3C,IAAMC,EAAY,SAACC,GAAA,OAAmBA,EAAQC,KAAKC,GAAM,GAAA,EACnDC,EAAOJ,EAAUD,EAAEM,IAAMP,EAAEO,KAC3BC,EAAON,EAAUD,EAAEQ,IAAMT,EAAES,KAC3BC,EAAOR,EAAUF,EAAEO,KACnBI,EAAOT,EAAUD,EAAEM,KACnBK,EAASR,KAAKS,IAAIP,EAAO,GACzBQ,EAASV,KAAKS,IAAIL,EAAO,GACzBO,EAAIH,EAASA,EAASR,KAAKY,IAAIN,GAAQN,KAAKY,IAAIL,GAAQG,EAASA,EACjEG,EAAI,EAAIb,KAAKc,MAAMd,KAAKe,KAAKJ,GAAIX,KAAKe,KAAK,EAAIJ,IACrD,OAAOK,EAAkBH,CAC3B,GAbA,IAAMG,EAAkB,yBCYpBC,GAA4B,EAeV,oBAAXC,QAbqB,WAC9B,IAAID,EAGJ,IACE,IAAME,EAAW,IAAIC,EACrBC,EAAWC,YAAY,UAAW,SAACC,UAAYJ,EAASK,KAAKD,EAAQ,GACrEN,GAA4B,CAC9B,OAASQ,GACPC,QAAQD,MAAM,+CAAgDA,EAChE,CACF,CAGEE,GCzBWC,EAAA,IAJV,0EAKUA,EAAA,IAAmC,SAGnCA,EAAA,IACX,0LAGWA,EAAA,IAAuC,CAAC,QAAS,UACjDA,EAAA,IAAmB,GAGnBA,EAAA,IAAuD,CAAC,EAAC,KAAM,IAAM,CAAC,IAAK,MAG3EA,EAAA,IAAuB,WAGvBA,EAAA,IAA0B"}