{"version":3,"file":"CodeLogin-legacy-BAlyUGxF.js","sources":["../../../web/src/pages/CodeLogin.tsx"],"sourcesContent":["// Страница входа через код подтверждения\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { useSearchParams } from \"react-router-dom\";\r\nimport { useToast } from \"../context/useToast\";\r\nimport authFetch from \"../utils/authFetch\";\r\n\r\nexport default function CodeLogin() {\r\n  const [telegramId, setTelegramId] = useState(\"\");\r\n  const [code, setCode] = useState(\"\");\r\n  const [sent, setSent] = useState(false);\r\n  const { addToast } = useToast();\r\n  const [params] = useSearchParams();\r\n  const expired = params.get(\"expired\");\r\n\r\n  useEffect(() => {\r\n    if (expired) {\r\n      addToast(\"Сессия истекла, войдите снова\", \"error\");\r\n    }\r\n  }, [expired, addToast]);\r\n\r\n  async function send(e?: React.FormEvent) {\r\n    e?.preventDefault();\r\n    const r = await authFetch(\"/api/v1/auth/send_code\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ telegramId: Number(telegramId) }),\r\n    });\r\n    if (r.ok) {\r\n      setSent(true);\r\n      addToast(\"Код отправлен\");\r\n    } else {\r\n      addToast(\"Не удалось отправить код\", \"error\");\r\n    }\r\n  }\r\n\r\n  async function verify(e?: React.FormEvent) {\r\n    e?.preventDefault();\r\n    const res = await authFetch(\"/api/v1/auth/verify_code\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ telegramId: Number(telegramId), code }),\r\n    });\r\n    if (res.ok) {\r\n      window.location.href = \"/\";\r\n    } else {\r\n      addToast(\"Неверный код\", \"error\");\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form className=\"flex flex-col gap-2 p-4\" onSubmit={sent ? verify : send}>\r\n      <input\r\n        id=\"code-login-telegram-id\"\r\n        name=\"telegramId\"\r\n        className=\"border p-2\"\r\n        placeholder=\"Telegram ID\"\r\n        value={telegramId}\r\n        onChange={(e) => setTelegramId(e.target.value)}\r\n      />\r\n      <a\r\n        className=\"text-primary underline\"\r\n        href=\"https://telegram.me/userinfobot\"\r\n        target=\"_blank\"\r\n        rel=\"noopener\"\r\n      >\r\n        Узнать свой ID через @userinfobot\r\n      </a>\r\n      {sent && (\r\n        <input\r\n          id=\"code-login-code\"\r\n          name=\"verificationCode\"\r\n          className=\"border p-2\"\r\n          placeholder=\"Код\"\r\n          value={code}\r\n          onChange={(e) => setCode(e.target.value)}\r\n        />\r\n      )}\r\n      <button type=\"submit\" className=\"bg-primary p-2 text-white\">\r\n        {sent ? \"Войти по коду\" : \"Отправить код\"}\r\n      </button>\r\n    </form>\r\n  );\r\n}\r\n"],"names":["_reactExports$useStat2","_slicedToArray","useState","telegramId","setTelegramId","_reactExports$useStat4","code","setCode","_reactExports$useStat6","sent","setSent","addToast","useToast","expired","useSearchParams","get","_callee","e","_regenerator","w","_context","n","preventDefault","authFetch","method","headers","body","JSON","stringify","Number","v","ok","a","apply","arguments","_callee2","_context2","window","location","href","this","useEffect","className","onSubmit","children","jsx","id","name","placeholder","value","onChange","target","rel","type"],"mappings":"6xHAMA,WACE,IAA+CA,EAAAC,EAAXC,EAAAA,SAAS,IAAE,GAAxCC,EAAAH,KAAYI,EAAaJ,EAAA,GACGK,EAAAJ,EAAXC,EAAAA,SAAS,IAAE,GAA5BI,EAAAD,EAAA,GAAME,EAAOF,KACkBG,EAAAP,EAAdC,EAAAA,UAAS,GAAK,GAA/BO,EAAAD,EAAA,GAAME,EAAOF,EAAA,GACZG,EAAaC,IAAbD,SAEFE,EAD2BZ,EAAhBa,IAAgB,GAApB,GACUC,IAAI,wBAqB3B,iBAbA,SAAAC,EAAoBC,UAAAC,IAAAC,EAAA,SAAAC,GAAA,cAAAA,EAAAC,GAAA,KAAA,EACA,OAAlBJ,SAAAA,EAAGK,iBAAeF,EAAAC,EAAA,EACFE,EAAU,yBAA0B,CAClDC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3BC,KAAMC,KAAKC,UAAU,CAAEzB,WAAY0B,OAAO1B,OAC3C,KAAA,EAJKiB,EAAAU,EAKAC,IACJrB,GAAQ,GACRC,EAAS,kBAETA,EAAS,2BAA4B,SACvC,KAAA,EAAA,OAAAS,EAAAY,OAAAhB,EAAA,KACFiB,WAAAC,UAAA,cAcA,iBAZA,SAAAC,EAAsBlB,GAAA,OAAAC,IAAAC,EAAA,SAAAiB,iBAAAA,EAAAf,GAAA,KAAA,EACF,OAAlBJ,SAAAA,EAAGK,iBAAec,EAAAf,EAAA,EACAE,EAAU,2BAA4B,CACtDC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3BC,KAAMC,KAAKC,UAAU,CAAEzB,WAAY0B,OAAO1B,GAAaG,KAAAA,MACxD,KAAA,EAJK8B,EAAAN,EAKEC,GACNM,OAAOC,SAASC,KAAO,IAEvB5B,EAAS,eAAgB,SAC3B,KAAA,EAAA,OAAAyB,EAAAJ,EAAA,GAAA,EAAAG,EAAA,KACFF,MAAAO,KAAAN,UAAA,CAEA,OAnCAO,EAAAA,UAAU,WACJ5B,GACFF,EAAS,gCAAiC,QAE9C,EAAG,CAACE,EAASF,WAgCV,OAAA,CAAK+B,UAAU,0BAA0BC,SAAUlC,EAjBtD,4CAfsB,4CAiClBmC,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACCC,GAAG,yBACHC,KAAK,aACLL,UAAU,aACVM,YAAY,cACZC,MAAO9C,EACP+C,SAAU,SAACjC,GAAA,OAAMb,EAAca,EAAEkC,OAAOF,MAAK,IAE/CJ,EAAAA,IAAC,IAAA,CACCH,UAAU,yBACVH,KAAK,kCACLY,OAAO,SACPC,IAAI,WACLR,SAAA,sCAGAnC,GACCoC,EAAAA,IAAC,QAAA,CACCC,GAAG,kBACHC,KAAK,mBACLL,UAAU,aACVM,YAAY,MACZC,MAAO3C,EACP4C,SAAU,SAACjC,GAAA,OAAMV,EAAQU,EAAEkC,OAAOF,MAAK,IAG3CJ,EAAAA,IAAC,UAAOQ,KAAK,SAASX,UAAU,4BAC7BE,SAAAnC,EAAO,gBAAkB,oBAIlC"}