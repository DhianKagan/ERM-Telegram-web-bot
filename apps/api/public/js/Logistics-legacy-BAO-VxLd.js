!function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function t(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?e(Object(r),!0).forEach(function(e){n(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function n(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,s,a,o=[],u=!0,l=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=s.call(n)).done)&&(o.push(i.value),o.length!==t);u=!0);}catch(e){l=!0,r=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return o}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=o(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw s}}}}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function a(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return u(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function l(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function s(n,i,r,s){var u=i&&i.prototype instanceof o?i:o,l=Object.create(u.prototype);return c(l,"_invoke",function(n,i,r){var s,o,u,l=0,c=r||[],h=!1,f={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return s=t,o=0,u=e,f.n=n,a}};function d(n,i){for(o=n,u=i,t=0;!h&&l&&!r&&t<c.length;t++){var r,s=c[t],d=f.p,g=s[2];n>3?(r=g===i)&&(u=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=d&&((r=n<2&&d<s[1])?(o=0,f.v=i,f.n=s[1]):d<g&&(r=n<3||s[0]>i||i>g)&&(s[4]=n,s[5]=i,f.n=g,o=0))}if(r||n>1)return a;throw h=!0,i}return function(r,c,g){if(l>1)throw TypeError("Generator is already running");for(h&&1===c&&d(c,g),o=c,u=g;(t=o<2?e:u)||!h;){s||(o?o<3?(o>1&&(f.n=-1),d(o,u)):f.n=u:f.v=u);try{if(l=2,s){if(o||(r="next"),t=s[r]){if(!(t=t.call(s,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(u=TypeError("The iterator does not provide a '"+r+"' method"),o=1);s=e}else if((t=(h=f.n<0)?u:n.call(i,f))!==a)break}catch(t){s=e,o=1,u=t}finally{l=1}}return{value:t,done:h}}}(n,r,s),!0),l}var a={};function o(){}function u(){}function h(){}t=Object.getPrototypeOf;var f=[][i]?t(t([][i]())):(c(t={},i,function(){return this}),t),d=h.prototype=o.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,r,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=h,c(d,"constructor",h),c(h,"constructor",u),u.displayName="GeneratorFunction",c(h,r,"GeneratorFunction"),c(d),c(d,r,"Generator"),c(d,i,function(){return this}),c(d,"toString",function(){return"[object Generator]"}),(l=function(){return{w:s,m:g}})()}function c(e,t,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}c=function(e,t,n,i){function s(t,n){c(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},c(e,t,n,i)}function h(e,t,n,i,r,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(i,r)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var s=e.apply(t,n);function a(e){h(s,i,r,a,o,"next",e)}function o(e){h(s,i,r,a,o,"throw",e)}a(void 0)})}}System.register(["./index-legacy-wk8xCH9w.js","./vendor-legacy-3V6tX1hl.js","./App-legacy-BLQphYZ4.js","./input-legacy-CN97Ilcz.js","./TaskTable-legacy-CVdAADv8.js","./map-legacy-CIYHAQaS.js","./map-legacy-DZQwv05e.js","./AuthenticatedApp-legacy-G7eJFt6z.js","./fleets-legacy-Cv-jsS1p.js","./taskColumns-legacy-Sq45OePX.js","./EmployeeLink-legacy-DKmeq4_P.js"],function(e,n){"use strict";var o,u,c,h,d,g,v,y,p,m,_,x,k,N,E,I,b,w,S,C,T,L,R,O,M,P,A;return{setters:[function(e){o=e.j},function(e){u=e.R,c=e.l,h=e.f,d=e.u,g=e.i},function(e){v=e.h,y=e.b,p=e.a,m=e.T,_=e.k,x=e.B},function(e){k=e.I},function(e){N=e.T},function(e){E=e.M,I=e.m,b=e.a,w=e.b,S=e.c,C=e.d,T=e.e,L=e.h,R=e.f,O=e.g},function(e){M=e.M},function(e){P=e.u},function(e){A=e.l},null,null],execute:function(){var D=document.createElement("style");D.textContent='.mapbox-gl-draw_ctrl-bottom-left,.mapbox-gl-draw_ctrl-top-left{border-radius:0 4px 4px 0;margin-left:0}.mapbox-gl-draw_ctrl-top-right,.mapbox-gl-draw_ctrl-bottom-right{border-radius:4px 0 0 4px;margin-right:0}.mapbox-gl-draw_ctrl-draw-btn{color:rgba(255,255,255,.5);border-color:rgba(0,0,0,.9);width:30px;height:30px}.mapbox-gl-draw_ctrl-draw-btn.active,.mapbox-gl-draw_ctrl-draw-btn.active:hover{background-color:rgba(0,0,0,.05)}.mapbox-gl-draw_ctrl-draw-btn{background-position:50%;background-repeat:no-repeat}.mapbox-gl-draw_point{background-image:url("data:image/svg+xml;utf8,%3Csvg xmlns=\\"http://www.w3.org/2000/svg\\" width=\\"20\\" height=\\"20\\">%3Cpath d=\\"m10 2c-3.3 0-6 2.7-6 6s6 9 6 9 6-5.7 6-9-2.7-6-6-6zm0 2c2.1 0 3.8 1.7 3.8 3.8 0 1.5-1.8 3.9-2.9 5.2h-1.7c-1.1-1.4-2.9-3.8-2.9-5.2-.1-2.1 1.6-3.8 3.7-3.8z\\"/>%3C/svg>")}.mapbox-gl-draw_polygon{background-image:url("data:image/svg+xml;utf8,%3Csvg xmlns=\\"http://www.w3.org/2000/svg\\" width=\\"20\\" height=\\"20\\">%3Cpath d=\\"m15 12.3v-4.6c.6-.3 1-1 1-1.7 0-1.1-.9-2-2-2-.7 0-1.4.4-1.7 1h-4.6c-.3-.6-1-1-1.7-1-1.1 0-2 .9-2 2 0 .7.4 1.4 1 1.7v4.6c-.6.3-1 1-1 1.7 0 1.1.9 2 2 2 .7 0 1.4-.4 1.7-1h4.6c.3.6 1 1 1.7 1 1.1 0 2-.9 2-2 0-.7-.4-1.4-1-1.7zm-8-.3v-4l1-1h4l1 1v4l-1 1h-4z\\"/>%3C/svg>")}.mapbox-gl-draw_line{background-image:url("data:image/svg+xml;utf8,%3Csvg xmlns=\\"http://www.w3.org/2000/svg\\" width=\\"20\\" height=\\"20\\">%3Cpath d=\\"m13.5 3.5c-1.4 0-2.5 1.1-2.5 2.5 0 .3 0 .6.2.9l-3.8 3.8c-.3-.1-.6-.2-.9-.2-1.4 0-2.5 1.1-2.5 2.5s1.1 2.5 2.5 2.5 2.5-1.1 2.5-2.5c0-.3 0-.6-.2-.9l3.8-3.8c.3.1.6.2.9.2 1.4 0 2.5-1.1 2.5-2.5s-1.1-2.5-2.5-2.5z\\"/>%3C/svg>")}.mapbox-gl-draw_trash{background-image:url("data:image/svg+xml;utf8,%3Csvg xmlns=\\"http://www.w3.org/2000/svg\\" width=\\"20\\" height=\\"20\\">%3Cpath d=\\"M10,3.4 c-0.8,0-1.5,0.5-1.8,1.2H5l-1,1v1h12v-1l-1-1h-3.2C11.5,3.9,10.8,3.4,10,3.4z M5,8v7c0,1,1,2,2,2h6c1,0,2-1,2-2V8h-2v5.5h-1.5V8h-3 v5.5H7V8H5z\\"/>%3C/svg>")}.mapbox-gl-draw_uncombine{background-image:url("data:image/svg+xml;utf8,%3Csvg xmlns=\\"http://www.w3.org/2000/svg\\" width=\\"20\\" height=\\"20\\">%3Cpath d=\\"m12 2c-.3 0-.5.1-.7.3l-1 1c-.4.4-.4 1 0 1.4l1 1c.4.4 1 .4 1.4 0l1-1c.4-.4.4-1 0-1.4l-1-1c-.2-.2-.4-.3-.7-.3zm4 4c-.3 0-.5.1-.7.3l-1 1c-.4.4-.4 1 0 1.4l1 1c.4.4 1 .4 1.4 0l1-1c.4-.4.4-1 0-1.4l-1-1c-.2-.2-.4-.3-.7-.3zm-7 1c-1 0-1 1-.5 1.5.3.3 1 1 1 1l-1 1s-.5.5 0 1 1 0 1 0l1-1 1 1c.5.5 1.5.5 1.5-.5v-4zm-5 3c-.3 0-.5.1-.7.3l-1 1c-.4.4-.4 1 0 1.4l4.9 4.9c.4.4 1 .4 1.4 0l1-1c.4-.4.4-1 0-1.4l-4.9-4.9c-.1-.2-.4-.3-.7-.3z\\"/>%3C/svg>")}.mapbox-gl-draw_combine{background-image:url("data:image/svg+xml;utf8,%3Csvg xmlns=\\"http://www.w3.org/2000/svg\\" width=\\"20\\" height=\\"20\\">%3Cpath d=\\"M12.1,2c-0.3,0-0.5,0.1-0.7,0.3l-1,1c-0.4,0.4-0.4,1,0,1.4l4.9,4.9c0.4,0.4,1,0.4,1.4,0l1-1 c0.4-0.4,0.4-1,0-1.4l-4.9-4.9C12.6,2.1,12.3,2,12.1,2z M8,8C7,8,7,9,7.5,9.5c0.3,0.3,1,1,1,1l-1,1c0,0-0.5,0.5,0,1s1,0,1,0l1-1l1,1 C11,13,12,13,12,12V8H8z M4,10c-0.3,0-0.5,0.1-0.7,0.3l-1,1c-0.4,0.4-0.4,1,0,1.4l1,1c0.4,0.4,1,0.4,1.4,0l1-1c0.4-0.4,0.4-1,0-1.4 l-1-1C4.5,10.1,4.3,10,4,10z M8,14c-0.3,0-0.5,0.1-0.7,0.3l-1,1c-0.4,0.4-0.4,1,0,1.4l1,1c0.4,0.4,1,0.4,1.4,0l1-1 c0.4-0.4,0.4-1,0-1.4l-1-1C8.5,14.1,8.3,14,8,14z\\"/>%3C/svg>")}.mapbox-gl-draw_srmode{background-image:url("data:image/svg+xml;utf8,%3Csvg xmlns=\\"http://www.w3.org/2000/svg\\" x=\\"0px\\" y=\\"0px\\" viewBox=\\"0 0 418.54 418.54\\" style=\\"enable-background:new 0 0 418.54 418.54;\\" xml:space=\\"preserve\\" width=\\"20\\" height=\\"20\\">%3Cpath d=\\"M365.566,162.496c0.016-6.432-5.2-11.648-11.648-11.648c-0.912,0-1.792,0.096-2.608,0.304 c-11.952,2.72-22.64,8.752-31.008,17.104c-11.568,11.568-18.72,27.552-18.72,45.2l0.016,16.016l-32.416-32.416 c29.424-49.152,23.136-113.728-19.216-156.08c-49.984-49.984-131.04-49.984-181.024,0V0h-16v68.288h68.192v-16h-40.88 c43.664-43.664,114.72-43.664,158.4,0c35.968,35.968,41.904,90.336,18.624,132.848l-74.416-74.416 c-12.448-12.448-32.816-12.448-45.248,0c-12.448,12.448-12.448,32.816,0,45.248l60.88,60.88c-9.2-0.944-18.72,1.984-25.776,9.024 c-4.864,4.864-7.744,10.928-8.8,17.232c-30.144,1.2-60.688-9.472-83.648-32.432L68.942,222c25.04,25.04,57.856,37.264,90.672,37.2 l-16.272,61.008c-2.816,10.64-0.096,22.432,8.224,30.768l37.216,37.216c40.464,40.464,106.032,40.464,146.496,0 c19.6-19.6,29.6-45.088,30.208-70.752l0.112,0.096v-2.512c0-0.048,0-0.096,0-0.112L365.566,162.496z\\"/>%3C/svg>")}.maplibregl-map.mouse-pointer .maplibregl-canvas-container.maplibregl-interactive{cursor:pointer}.maplibregl-map.mouse-move .maplibregl-canvas-container.maplibregl-interactive{cursor:move}.maplibregl-map.mouse-add .maplibregl-canvas-container.maplibregl-interactive{cursor:crosshair}.maplibregl-map.mouse-move.mode-direct_select .maplibregl-canvas-container.maplibregl-interactive{cursor:grab;cursor:-webkit-grab}.maplibregl-map.mode-direct_select.feature-vertex.mouse-move .maplibregl-canvas-container.maplibregl-interactive{cursor:move}.maplibregl-map.mode-direct_select.feature-midpoint.mouse-pointer .maplibregl-canvas-container.maplibregl-interactive{cursor:cell}.maplibregl-map.mode-direct_select.feature-feature.mouse-move .maplibregl-canvas-container.maplibregl-interactive{cursor:move}.maplibregl-map.mode-static.mouse-pointer .maplibregl-canvas-container.maplibregl-interactive{cursor:grab;cursor:-webkit-grab}.mapbox-gl-draw_boxselect{pointer-events:none;opacity:.5;background:rgba(0,0,0,.1);border:2px dotted #fff;width:0;height:0;position:absolute;top:0;left:0}\n/*$vite$:1*/',document.head.appendChild(D),e("default",function(){var e,n,c,v,E,b,S,L,R,O,D,F,Y=y(),B=Y.t,X=Y.i18n,H=q(B),Z=X.language,W=i(u.useState([]),2),K=W[0],J=W[1],ee=i(u.useState([]),2),ne=ee[0],re=ee[1],se=i(u.useState(1),2),ae=se[0],oe=se[1],ue=i(u.useState("angle"),2),le=ue[0],ce=ue[1],he=i(u.useState([]),2),fe=he[0],de=he[1],ge=i(u.useState(null),2),ve=ge[0],ye=ge[1],pe=i(u.useState(null),2),me=pe[0],_e=pe[1],xe=i(u.useState(""),2),ke=xe[0],Ne=xe[1],Ee=i(u.useState("neutral"),2),Ie=Ee[0],be=Ee[1],we=i(u.useState(!1),2),Se=we[0],Ce=we[1],Te=u.useRef(null),Le=u.useRef(null);u.useEffect(function(){console.warn("Используется временный растровый слой OpenStreetMap. Подключите локальные PMTiles, чтобы вернуть полный стиль.")},[]);var Re=i(u.useState("planar"),2),Oe=Re[0],Me=Re[1],Pe=u.useRef({frameId:null,lastTimestamp:null,routes:[]}),Ae=i(u.useState([]),2),De=Ae[0],Fe=Ae[1],je=i(u.useState(""),2),Ge=je[0],ze=je[1],qe=i(u.useState(""),2),Ye=qe[0],Be=qe[1],Ue=i(u.useState(!1),2),Xe=Ue[0],Ve=Ue[1],He=i(u.useState(function(){if("undefined"==typeof window)return null;try{var e=new URLSearchParams(window.location.search).get("selectedVehicleId");return e&&e.trim()?e.trim():null}catch(t){return null}}),2),Ze=He[0],We=He[1],Ke=i(u.useState(Sn),2),Je=Ke[0],Qe=Ke[1],$e=i(u.useState(!1),2),et=$e[0],tt=$e[1],nt=i(u.useState([]),2),it=nt[0],rt=nt[1],st=i(u.useState([]),2),at=st[0],ot=st[1],ut=i(u.useState([]),2),lt=ut[0],ct=ut[1],ht=i(u.useState(null),2),ft=ht[0],dt=ht[1],gt=i(u.useState([]),2),vt=gt[0],yt=gt[1],pt=i(u.useState([]),2),mt=pt[0],_t=pt[1],xt=i(u.useState(!0),2),kt=xt[0],Nt=xt[1],Et=i(u.useState(!1),2),It=Et[0],bt=Et[1],wt=i(u.useState(ii()),2),St=wt[0],Ct=wt[1],Tt=i(u.useState(0),2),Lt=Tt[0],Rt=Tt[1],Ot=u.useRef(!1),Mt=u.useRef(new Set),Pt=h(),At=d(),Dt=i(g(),1)[0],Ft=u.useMemo(function(){try{var e=new URLSearchParams(At.search).get("withTrack");return"true"===e||"1"===e}catch(t){return!1}},[At.search]),jt=Dt.has("task")||Dt.has("newTask"),Gt=p().user,zt=P().controller,qt=null!==(e=null==Gt?void 0:Gt.role)&&void 0!==e?e:null;u.useEffect(function(){try{var e=new URLSearchParams(At.search).get("selectedVehicleId"),t=e&&e.trim()?e.trim():null;We(function(e){return e===t?e:t})}catch(n){We(function(e){return e})}},[At.search]);var Yt=u.useCallback(function(e){We(function(t){var n,i=e(t),r=i&&i.trim()?i.trim():null;if(t===r)return t;if("undefined"!=typeof window&&"function"==typeof(null===(n=window.history)||void 0===n?void 0:n.replaceState))try{var s=new URL(window.location.href);r?s.searchParams.set("selectedVehicleId",r):s.searchParams.delete("selectedVehicleId"),window.history.replaceState(window.history.state,"","".concat(s.pathname).concat(s.search).concat(s.hash))}catch(a){}return r})},[]),Bt=u.useCallback(function(e){Yt(function(){return e})},[Yt]),Ut=u.useCallback(function(e){Yt(function(t){return t===e?null:e})},[Yt]),Xt=u.useMemo(function(){return De.filter(function(e){return null!==gi(e)})},[De]),Vt=u.useMemo(function(){var e;return null!==(e=De.find(function(e){return e.id===Ze}))&&void 0!==e?e:null},[De,Ze]);u.useEffect(function(){Ze&&(De.some(function(e){return e.id===Ze})||Bt(null))},[De,Ze,Bt]);var Ht=u.useMemo(function(){return new Set(it)},[it]),Zt=u.useMemo(function(){return new Set(at)},[at]),Wt=u.useMemo(function(){return new Set(lt)},[lt]),Kt=u.useMemo(function(){var e;return new Set(null!==(e=null==ft?void 0:ft.ids)&&void 0!==e?e:[])},[ft]),Jt=u.useMemo(function(){return kt?vi(ne,vt,mt):ne},[mt,ne,vt,kt]),Qt=u.useMemo(function(){var e=new Map,t=function(t){var n;if(t){var i=null!==(n=t.status)&&void 0!==n?n:"draft";t.routes.forEach(function(t){t.tasks.forEach(function(t){var n="string"==typeof t.taskId?t.taskId:"string"==typeof t.task_id?t.task_id:null;n&&e.set(n,i)})})}};return t(null!=me?me:null),ve&&t(ve),e},[ve,me]),$t=u.useMemo(function(){return Jt.filter(function(e){var t,n=null!==(t=Qt.get(e._id))&&void 0!==t?t:"unassigned";if(Zt.has(n))return!1;var i=hi(e),r=ri(i);if(Wt.has(r))return!1;var s=fi(e),a=ri(s);return!Ht.has(a)})},[Jt,Zt,Ht,Wt,Qt]),en=u.useMemo(function(){var e={};return $t.forEach(function(t){var n,i="string"==typeof t.status&&t.status.trim()?t.status.trim():"Новая";e[i]=(null!==(n=e[i])&&void 0!==n?n:0)+1}),e},[$t]),tn=u.useMemo(function(){var e=new Map;if(Ln.forEach(function(t){e.set(t,{count:0,color:Mn(t)})}),Jt.forEach(function(t){var n,i=null!==(n=Qt.get(t._id))&&void 0!==n?n:"unassigned",r=e.get(i);r?r.count+=1:e.set(i,{count:1,color:Mn(i)})}),Xt.length){var t=e.get("vehicle");t?t.count+=Xt.length:e.set("vehicle",{count:Xt.length,color:Mn("vehicle")})}return e},[Jt,Qt,Xt]),nn=u.useMemo(function(){var e=new Map;return Jt.forEach(function(t){var n=hi(t),i=si(n),r=ri(i),s=ai(i),a=e.get(r);a?a.count+=1:e.set(r,{label:i,count:1,color:s})}),Xt.forEach(function(t){var n,i=si(null!==(n=t.transportType)&&void 0!==n?n:""),r=ri(i),s=ai(i),a=e.get(r);a?a.count+=1:e.set(r,{label:i,count:1,color:s})}),e},[Jt,Xt]),rn=u.useMemo(function(){var e=new Map;Jt.forEach(function(t){var n=fi(t),i=ri(n),r=e.get(i);r?r.count+=1:e.set(i,{label:n,count:1})}),Xt.length&&e.set(jn,{label:Gn,count:Xt.length});var t=Array.from(e.keys()).sort(),n=new Map;return t.forEach(function(t,i){var r=e.get(t);if(r){var s=Fn[i%Fn.length];n.set(t,{label:r.label,count:r.count,color:s})}}),n},[Jt,Xt]),sn=u.useMemo(function(){return Ln.map(function(e){var t,n;return{key:e,count:null!==(t=null===(n=tn.get(e))||void 0===n?void 0:n.count)&&void 0!==t?t:0,color:Mn(e)}})},[tn]),an=u.useMemo(function(){return Array.from(nn.entries()).sort(function(e,t){return e[1].label.localeCompare(t[1].label)}).map(function(e){var n=i(e,2);return t({key:n[0]},n[1])})},[nn]),on=u.useMemo(function(){return Array.from(rn.entries()).map(function(e){var n=i(e,2);return t({key:n[0]},n[1])})},[rn]),un=u.useMemo(function(){var e=[],t=function(t,n){e.push({type:"Feature",geometry:{type:"Point",coordinates:t},properties:n})};return $t.forEach(function(e){var n,i,r,s,a=null!==(n=Qt.get(e._id))&&void 0!==n?n:"unassigned",o=Mn(a),u=hi(e),l=ri(u),c=ai(u),h=fi(e),f=ri(h),d=null!==(i=null===(r=rn.get(f))||void 0===r?void 0:r.color)&&void 0!==i?i:"#334155",g=di(h),v=oi(c),y=null!==(s=e.title)&&void 0!==s?s:e._id,p=y.length>28?"".concat(y.slice(0,25),"…"):y,m=Kt.has(e._id),_=ci(e.startCoordinates),x=ci(e.finishCoordinates);if(_){var k=ui(f,a,l,"start");t(_,{entity:"task",taskId:e._id,title:y,label:p,routeStatus:a,transportType:u,taskType:h,pointRole:"start",iconId:k,iconFill:c,iconStroke:o,iconText:g,iconTextColor:v,iconAccent:d,selected:m})}if(x){var N=ui(f,a,l,"finish");t(x,{entity:"task",taskId:e._id,title:y,label:p,routeStatus:a,transportType:u,taskType:h,pointRole:"finish",iconId:N,iconFill:c,iconStroke:o,iconText:g,iconTextColor:v,iconAccent:d,selected:m})}}),Xt.forEach(function(e){var n,i,r,s=gi(e);if(s){var a=si(null!==(n=e.transportType)&&void 0!==n?n:""),o=ri(a),u="vehicle";if(!Zt.has(u)&&!Wt.has(o)&&!Ht.has(jn)){var l=ai(a),c=di(Gn),h=oi(l),f=null!==(i=null===(r=rn.get(jn))||void 0===r?void 0:r.color)&&void 0!==i?i:"#0f172a",d=ui(jn,u,o,"vehicle"),g=e.name,v=g.length>28?"".concat(g.slice(0,25),"…"):g;t(s,{entity:"vehicle",vehicleId:e.id,title:g,label:v,routeStatus:u,transportType:a,taskType:Gn,pointRole:"vehicle",iconId:d,iconFill:l,iconStroke:Mn(u),iconText:c,iconTextColor:h,iconAccent:f,selected:Ze===e.id})}}}),{type:"FeatureCollection",features:e}},[$t,Zt,Ht,Wt,Kt,Qt,rn,Xt,Ze]);u.useEffect(function(){if(et){var e=Te.current;if(e){var t=e.getSource(Xn);if(t){un.features.forEach(function(t){var n,i,r,s,a,o,u=null===(n=t.properties)||void 0===n?void 0:n.iconId;if("string"==typeof u&&u){var l="string"==typeof(null===(i=t.properties)||void 0===i?void 0:i.iconFill)?t.properties.iconFill:"#2563eb",c="string"==typeof(null===(r=t.properties)||void 0===r?void 0:r.iconStroke)?t.properties.iconStroke:"#0f172a",h="string"==typeof(null===(s=t.properties)||void 0===s?void 0:s.iconText)?t.properties.iconText:"",f="string"==typeof(null===(a=t.properties)||void 0===a?void 0:a.iconTextColor)?t.properties.iconTextColor:oi(l),d="string"==typeof(null===(o=t.properties)||void 0===o?void 0:o.iconAccent)?t.properties.iconAccent:void 0;li(e,Mt.current,u,l,c,h,f,d)}});var n=Je.tasks?un:ii();t.setData(n)}}}},[Je.tasks,et,un]);var ln=u.useMemo(function(){var e=m.map(function(e){var t,n;return{key:e,label:e,color:null!==(t=wn[e])&&void 0!==t?t:"#2563eb",count:null!==(n=en[e])&&void 0!==n?n:0}}),t=Object.keys(en).filter(function(e){return!m.includes(e)});return t.length&&t.forEach(function(t){var n,i;e.push({key:t,label:t,color:null!==(n=wn[t])&&void 0!==n?n:"#2563eb",count:null!==(i=en[t])&&void 0!==i?i:0})}),e},[en]),cn=u.useMemo(function(){return Kt.size?$t.filter(function(e){return Kt.has(e._id)}):$t},[$t,Kt]),hn=u.useMemo(function(){return JSON.stringify(cn.map(function(e){var t;return[e._id,e.status,null!==(t=e.updatedAt)&&void 0!==t?t:null]}))},[cn]),fn=u.useRef("");u.useEffect(function(){if(ft){var e=new Set(ft.ids);$t.some(function(t){return e.has(t._id)})||dt(null)}},[$t,ft]);var dn=u.useCallback(function(){var e=Pe.current;null!==e.frameId&&(cancelAnimationFrame(e.frameId),e.frameId=null),e.lastTimestamp=null},[]),gn=u.useCallback(function(){if(dn(),et){var e=Pe.current;if(e.routes.length){var t=Te.current;if(t){var n=t.getSource(Wn);if(n){var i=e.routes.map(function(e){var t=mi(e,e.progress),n=t.position,i=t.bearing;return{type:"Feature",geometry:{type:"Point",coordinates:n},properties:{color:e.color,taskId:e.taskId,title:e.title,bearing:i,icon:ti}}});n.setData({type:"FeatureCollection",features:i});var r=function(e){var t=Pe.current,n=Te.current;if(n){var i=n.getSource(Wn);if(i){var s=t.lastTimestamp;t.lastTimestamp=e;var a=null!=s?(e-s)/1e3:0,o=[];t.routes.forEach(function(e){if(!(e.total<=0)){e.progress=(e.progress+a*ni)%e.total;var t=mi(e,e.progress),n=t.position,i=t.bearing;o.push({type:"Feature",geometry:{type:"Point",coordinates:n},properties:{color:e.color,taskId:e.taskId,title:e.title,bearing:i,icon:ti}})}}),i.setData({type:"FeatureCollection",features:o}),t.frameId=requestAnimationFrame(r)}else dn()}else dn()};e.frameId=requestAnimationFrame(r)}}}}},[et,dn]);u.useEffect(function(){if(fn.current!==hn){fn.current=hn,J(cn);var e=null==Gt?void 0:Gt.telegram_id,t=null==e?void 0:Number(e)||void 0;zt.setIndex("logistics:all",cn,{kind:"task",mine:!1,userId:t,pageSize:cn.length,total:cn.length,sort:"desc"})}},[zt,hn,cn,Gt]);var vn=u.useCallback(function(e){return e?JSON.parse(JSON.stringify(e)):null},[]),yn=u.useCallback(function(e){ye(e),_e(vn(e));var t=e?e.routes.map(function(e){return e.routeLink}).filter(function(e){return Boolean(e)}):[];de(t)},[vn]),pn=u.useCallback(f(l().m(function e(){var t,n,i,r;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:return Ce(!0),Ne(""),be("neutral"),e.p=1,e.n=2,$("draft",1,1);case 2:if(!((t=e.v).items.length>0)){e.n=3;break}return yn(t.items[0]),e.a(2);case 3:return e.n=4,$(void 0,1,1);case 4:if(!((n=e.v).items.length>0)){e.n=5;break}return yn(n.items[0]),e.a(2);case 5:yn(null),Ne(H.current("logistics.planEmpty")),e.n=7;break;case 6:e.p=6,r=e.v,i=r instanceof Error?r.message:H.current("logistics.planLoadError"),Ne(i),be("error");case 7:return e.p=7,Ce(!1),e.f(7);case 8:return e.a(2)}},e,null,[[1,6,7,8]])})),[yn]),mn=u.useCallback(function(e){var t;return{title:e.title,notes:null!==(t=e.notes)&&void 0!==t?t:null,routes:e.routes.map(function(e){var t,n,i,r,s;return{id:e.id,order:e.order,vehicleId:null!==(t=e.vehicleId)&&void 0!==t?t:null,vehicleName:null!==(n=e.vehicleName)&&void 0!==n?n:null,driverId:null!==(i=e.driverId)&&void 0!==i?i:null,driverName:null!==(r=e.driverName)&&void 0!==r?r:null,notes:null!==(s=e.notes)&&void 0!==s?s:null,tasks:e.tasks.map(function(e){return e.taskId})}})}},[]),_n=u.useCallback(function(e,n){_e(function(i){if(!i)return i;var r=i.routes.map(function(t,i){return i===e?n(t):t});return t(t({},i),{},{routes:r})})},[]),xn=u.useCallback(function(e){_e(function(n){return n?t(t({},n),{},{title:e}):n})},[]),kn=u.useCallback(function(e){_e(function(n){return n?t(t({},n),{},{notes:e}):n})},[]),En=u.useCallback(function(e,n){_n(e,function(e){return t(t({},e),{},{driverName:n})})},[_n]),In=u.useCallback(function(e,n){_n(e,function(e){return t(t({},e),{},{vehicleName:n})})},[_n]),bn=u.useCallback(function(e,n){_n(e,function(e){return t(t({},e),{},{notes:n||null})})},[_n]),Pn=u.useCallback(function(e,n,r){_e(function(s){if(!s)return s;var o=s.routes.map(function(s,o){if(o!==e)return s;var u=a(s.tasks),l=n+r;if(l<0||l>=u.length)return s;var c=i(u.splice(n,1),1)[0];return u.splice(l,0,c),t(t({},s),{},{tasks:u.map(function(e,n){return t(t({},e),{},{order:n})})})});return t(t({},s),{},{routes:o})})},[]),Dn=u.useCallback(function(){if(kt){var e=Le.current;e&&e.changeMode("draw_polygon")}},[kt]),yi=u.useCallback(function(e,t){_t(function(n){var i=new Set(n);return t?i.add(e):i.delete(e),Array.from(i)})},[]),Ei=u.useCallback(function(e,t){ot(function(n){var i=new Set(n);return t?i.delete(e):i.add(e),Array.from(i)})},[]),Ii=u.useCallback(function(e,t){ct(function(n){var i=new Set(n);return t?i.delete(e):i.add(e),Array.from(i)})},[]),bi=u.useCallback(function(e,t){rt(function(n){var i=new Set(n);return t?i.delete(e):i.add(e),Array.from(i)})},[]),wi=u.useCallback(function(){dt(null)},[]),Si=u.useCallback(function(e){var t=function(){yt(function(t){return t.filter(function(t){return t.id!==e.id})}),_t(function(t){return t.filter(function(t){return t!==e.id})})},n=Le.current;if(n){var i=Boolean(n.get(e.drawId)),r=n.delete(e.drawId);i&&(Array.isArray(r)?0!==r.length:r)||t()}else t()},[]),Ci=u.useCallback(f(l().m(function e(){var t,n,i,r;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:if(me){e.n=1;break}return e.a(2);case 1:return Ce(!0),e.p=2,t=mn(me),e.n=3,te(me.id,t);case 3:n=e.v,yn(n),Ne(H.current("logistics.planSaved")),be("success"),e.n=5;break;case 4:e.p=4,r=e.v,i=r instanceof Error?r.message:H.current("logistics.planSaveError"),Ne(i),be("error");case 5:return e.p=5,Ce(!1),e.f(5);case 6:return e.a(2)}},e,null,[[2,4,5,6]])})),[me,mn,yn]),Ti=u.useCallback(f(l().m(function e(){var t,n,i;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:if(me){e.n=1;break}return e.a(2);case 1:return Ce(!0),e.p=2,e.n=3,ie(me.id,"approved");case 3:t=e.v,yn(t),Ne(H.current("logistics.planPublished")),be("success"),e.n=5;break;case 4:e.p=4,i=e.v,n=i instanceof Error?i.message:H.current("logistics.planStatusError"),Ne(n),be("error");case 5:return e.p=5,Ce(!1),e.f(5);case 6:return e.a(2)}},e,null,[[2,4,5,6]])})),[me,yn]),Li=u.useCallback(f(l().m(function e(){var t,n,i;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:if(me){e.n=1;break}return e.a(2);case 1:return Ce(!0),e.p=2,e.n=3,ie(me.id,"completed");case 3:t=e.v,yn(t),Ne(H.current("logistics.planCompleted")),be("success"),e.n=5;break;case 4:e.p=4,i=e.v,n=i instanceof Error?i.message:H.current("logistics.planStatusError"),Ne(n),be("error");case 5:return e.p=5,Ce(!1),e.f(5);case 6:return e.a(2)}},e,null,[[2,4,5,6]])})),[me,yn]),Ri=u.useCallback(f(l().m(function e(){return l().w(function(e){for(;;)switch(e.n){case 0:return Ne(""),be("neutral"),e.n=1,pn();case 1:return e.a(2)}},e)})),[pn]),Oi=u.useCallback(function(){yn(null),Ne(H.current("logistics.planEmpty")),be("neutral")},[yn]);u.useEffect(function(){pn()},[pn]),u.useEffect(function(){var e=H.current,t=e("logistics.metaTitle"),n=e("logistics.metaDescription");document.title=t;var i=function(e,t,n){var i=document.querySelector("meta[".concat(e,'="').concat(t,'"]'));i||((i=document.createElement("meta")).setAttribute(e,t),document.head.appendChild(i)),i.setAttribute("content",n)};i("name","description",n),i("property","og:title",t),i("property","og:description",n),i("property","og:image","/hero/logistics.png")},[Z]);var Mi=u.useCallback(function(e){var t=new URLSearchParams(At.search);t.set("task",e),Pt({search:t.toString()},{replace:!0})},[At,Pt]),Pi=u.useCallback(function(e){var n=function(e){return"number"==typeof(null==e?void 0:e.lat)&&Number.isFinite(e.lat)&&"number"==typeof(null==e?void 0:e.lng)&&Number.isFinite(e.lng)},i=[];return e.forEach(function(e){var r=hi(e),s=e.logistics_details,a=function(e,t){if("string"==typeof e){var n=e.trim();if(n)return n}if("string"==typeof t){var i=t.trim();if(i)return i}return""},o=a(null==s?void 0:s.start_location,e.start_location),u=a(null==s?void 0:s.end_location,e.end_location),l=n(e.startCoordinates)||n(e.finishCoordinates),c=Boolean(o)||Boolean(u);if(l||c){var h=t({},null!=s?s:{});h.transport_type||(h.transport_type=r),!h.start_location&&o&&(h.start_location=o),!h.end_location&&u&&(h.end_location=u);var f=t(t({},e),{},{logistics_details:h}),d=f;d.transport_type||(d.transport_type=r),o&&!d.start_location&&(d.start_location=o),u&&!d.end_location&&(d.end_location=u),i.push(f)}}),i},[]),Ai=u.useCallback(function(){var e=null==Gt?void 0:Gt.telegram_id,n=null==e?void 0:Number(e)||void 0;_({},n,!0).then(function(e){var n,i,r,a=Array.isArray(e)?e:"object"===s(e)&&null!==e&&null!==(n=null!==(i=null!==(r=e.items)&&void 0!==r?r:e.tasks)&&void 0!==i?i:e.data)&&void 0!==n?n:[],o=(Array.isArray(a)?a:[]).map(function(e){var n,i;if("object"!==s(e)||null===e)return null;var r=e,a=String(null!==(n=null!==(i=r._id)&&void 0!==i?i:r.id)&&void 0!==n?n:"").trim();return a?t(t({},r),{},{id:a,_id:a}):null}).filter(function(e){return Boolean(e)}),u=Pi(o);re(u)})},[zt,Pi,Gt]),Di=u.useCallback(f(l().m(function e(){var t,n,i;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:if("admin"===qt){e.n=1;break}return e.a(2);case 1:return Ve(!0),Be(""),ze(""),e.p=2,e.n=3,A("",1,100);case 3:if(t=e.v,Fe(t.items),t.items.length){e.n=4;break}return Be(H.current("logistics.noVehicles")),e.a(2);case 4:e.n=6;break;case 5:e.p=5,i=e.v,n=i instanceof Error?i.message:H.current("logistics.loadError"),Be(n),Fe([]),ze(n);case 6:return e.p=6,Ve(!1),e.f(6);case 7:return e.a(2)}},e,null,[[2,5,6,7]])})),[qt,H]),Fi=u.useCallback(function(){Ai(),"admin"===qt&&Di()},[Ai,Di,qt]),ji=u.useCallback(function(){"admin"===qt&&Di()},[Di,qt]);z(function(){"admin"===qt&&Di()},Tn,{enabled:"admin"===qt&&Ft,deps:[Di,qt,Ft]}),u.useEffect(function(){var e={tasks:!1,plan:!1,fleet:!1},t=!0,n=null,i=function(){if(n=null,!t)return e.tasks=!1,e.plan=!1,void(e.fleet=!1);var i=e.tasks,r=e.plan,s=e.fleet;e.tasks=!1,e.plan=!1,e.fleet=!1,i&&Ai(),s&&ji(),r&&pn()},r=function(e,t){if(U)return console.warn("Подписка на события логистики отключена переменной окружения VITE_DISABLE_SSE."),function(){};if("undefined"==typeof window||"undefined"==typeof EventSource)return function(){};var n="/api/v1/logistics/events",i=null,r=!1,s=function(e){return"function"==typeof Event?new Event(e):{type:e}},a=function(t){try{var n=JSON.parse(t.data);n&&"string"==typeof n.type&&e(n)}catch(i){console.error("Не удалось распарсить событие логистики",i)}},o=function(e){t&&t(e)},u=function(){r||((i=new EventSource(n,{withCredentials:!0})).addEventListener("message",a),i.addEventListener("error",o))},c=function(){var e=f(l().m(function e(){var i,r,a,o,c,h,f,d;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:if("function"==typeof fetch){e.n=1;break}return u(),e.a(2);case 1:return i=new AbortController,r=!1,a=globalThis.setTimeout?globalThis.setTimeout(function(){i.signal.aborted||i.abort()},4e3):null,e.p=2,e.n=3,fetch(n,{method:"GET",headers:{Accept:"text/event-stream"},credentials:"include",signal:i.signal});case 3:if(c=e.v,h=null!==(o=c.headers.get("content-type"))&&void 0!==o?o:"",f=c.ok&&h.toLowerCase().includes("text/event-stream"),i.signal.aborted||(r=!0,i.abort()),f){e.n=4;break}return console.warn("Сервер логистики не вернул поток событий (text/event-stream), подписка отключена."),t&&t(s("logistics:eventstream-unavailable")),e.a(2);case 4:u(),e.n=6;break;case 5:e.p=5,(d=e.v)instanceof Error&&"AbortError"===d.name&&i.signal.aborted&&!r?console.warn("Проверка доступности событий логистики завершилась по таймауту."):console.warn("Не удалось подключиться к событиям логистики",d),t&&t(s("logistics:eventstream-error")),u();case 6:return e.p=6,null!==a&&clearTimeout(a),e.f(6);case 7:return e.a(2)}},e,null,[[2,5,6,7]])}));return function(){return e.apply(this,arguments)}}();return c(),function(){r=!0,i&&(i.removeEventListener("message",a),i.removeEventListener("error",o),i.close(),i=null)}}(function(t){switch(t.type){case"logistics.init":e.tasks=!0,e.plan=!0,e.fleet=!0;break;case"tasks.changed":e.tasks=!0,e.plan=!0;break;case"route-plan.updated":case"route-plan.removed":e.plan=!0;break;default:return}null===n&&(Cn<=0?i():n=setTimeout(i,Cn))});return function(){t=!1,null!==n&&(clearTimeout(n),n=null),r()}},[Ai,pn,ji]);var Gi=u.useCallback(f(l().m(function e(){var t,n,i,r;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:if((t=K.map(function(e){return e._id})).length){e.n=1;break}return yn(null),Ne(H.current("logistics.planEmpty")),be("neutral"),e.a(2);case 1:return Ce(!0),Ne(""),be("neutral"),e.p=2,e.n=3,G(t,ae,le);case 3:if(n=e.v){e.n=4;break}return yn(null),Ne(H.current("logistics.planEmpty")),e.a(2);case 4:yn(n),Ne(H.current("logistics.planDraftCreated")),be("success"),e.n=6;break;case 5:e.p=5,r=e.v,i=r instanceof Error?r.message:H.current("logistics.planOptimizeError"),Ne(i),be("error");case 6:return e.p=6,Ce(!1),e.f(6);case 7:return e.a(2)}},e,null,[[2,5,6,7]])})),[yn,le,K,ae]),zi=u.useCallback(function(e){return"number"==typeof e&&Number.isFinite(e)?"".concat(e.toFixed(1)," ").concat(H.current("km")):H.current("logistics.planNoDistance")},[]),qi=u.useCallback(function(e){if("number"==typeof e&&Number.isFinite(e)&&e>0){var t=Math.round(e),n=Math.floor(t/60),i=t%60,r=[];return n>0&&r.push(H.current("logistics.etaHours",{count:n})),(i>0||0===n)&&r.push(H.current("logistics.etaMinutes",{count:i})),r.join(" ")}return H.current("logistics.planNoEta")},[]),Yi=u.useCallback(function(e){if("number"!=typeof e||!Number.isFinite(e))return"—";if(e>=1)return"".concat(new Intl.NumberFormat(Z,{maximumFractionDigits:2}).format(e)," км²");var t=100*e;if(t>=1)return"".concat(new Intl.NumberFormat(Z,{maximumFractionDigits:1}).format(t)," га");var n=1e6*e;return"".concat(new Intl.NumberFormat(Z,{maximumFractionDigits:0}).format(n)," м²")},[Z]),Bi=u.useCallback(function(e){if("number"!=typeof e||!Number.isFinite(e))return"—";if(e>=1)return"".concat(new Intl.NumberFormat(Z,{maximumFractionDigits:2}).format(e)," км");var t=1e3*e;return"".concat(new Intl.NumberFormat(Z,{maximumFractionDigits:0}).format(t)," м")},[Z]),Ui=u.useCallback(function(e){return"number"==typeof e&&Number.isFinite(e)?"".concat(new Intl.NumberFormat(Z,{maximumFractionDigits:0}).format(e)," м"):"—"},[Z]),Xi=u.useMemo(function(){return"error"===Ie?"text-sm text-red-600":"success"===Ie?"text-sm text-emerald-600":"text-sm text-muted-foreground"},[Ie]),Vi=null!==(n=null!==(c=null==me?void 0:me.status)&&void 0!==c?c:null==ve?void 0:ve.status)&&void 0!==n?n:"draft",Hi=B("logistics.planStatusValue.".concat(Vi)),Zi="completed"!==Vi,Wi=null!==(v=null==me?void 0:me.routes)&&void 0!==v?v:[],Ki=u.useMemo(function(){var e;return"number"==typeof(null==me||null===(e=me.metrics)||void 0===e?void 0:e.totalStops)?me.metrics.totalStops:me?me.routes.reduce(function(e,t){return e+t.stops.length},0):0},[me]),Ji=null!==(E=null==me||null===(b=me.metrics)||void 0===b?void 0:b.totalRoutes)&&void 0!==E?E:Wi.length,Qi=null!==(S=null!==(L=null==me||null===(R=me.metrics)||void 0===R?void 0:R.totalTasks)&&void 0!==L?L:null==me?void 0:me.tasks.length)&&void 0!==S?S:0,$i=u.useCallback(function(){Ct(ii()),de([])},[]);return u.useEffect(function(){Ai()},[Ai,At.key]),u.useEffect(function(){Rt(0)},[hn]),u.useEffect(function(){var e=H.current;if("admin"!==qt)return Ot.current=!1,Fe([]),ze("manager"===qt?e("logistics.adminOnly"):""),Be(qt?e("logistics.noAccess"):""),void Bt(null);Be(""),ze(""),Ot.current||(Ot.current=!0,Di())},[Di,qt]),u.useEffect(function(){var e=H.current;"admin"===qt&&(De.length||Ge||Xe||Be(e("logistics.noVehicles")))},[De.length,Ge,qt,Xe]),u.useEffect(function(){var e,t;if(!jt&&!Te.current){var n=new I.Map({container:"logistics-map",style:C,center:xi,zoom:w,minZoom:5,maxZoom:22,maxBounds:ki});Te.current=n,"function"==typeof(null===(e=n.dragRotate)||void 0===e?void 0:e.disable)&&n.dragRotate.disable(),"function"==typeof(null===(t=n.touchZoomRotate)||void 0===t?void 0:t.disableRotation)&&n.touchZoomRotate.disableRotation();var i=new I.NavigationControl({showCompass:!1});n.addControl(i,"top-right");var r=new I.AttributionControl({compact:!0,customAttribution:T});n.addControl(r,"bottom-right");var s=new M({displayControlsDefault:!1,controls:{polygon:!0,trash:!0},defaultMode:"simple_select",styles:Q});Le.current=s,n.addControl(s,"top-left");var a=function(){("function"!=typeof n.isStyleLoaded||n.isStyleLoaded())&&V(n)},o=function(){a(),n.addSource(zn,{type:"geojson",data:ii()}),n.addLayer({id:qn,type:"fill",source:zn,paint:{"fill-color":["case",["boolean",["get","active"],!1],"rgba(37, 99, 235, 0.35)","rgba(148, 163, 184, 0.2)"],"fill-opacity":["case",["boolean",["get","active"],!1],.4,.2]}}),n.addLayer({id:Yn,type:"line",source:zn,paint:{"line-color":["case",["boolean",["get","active"],!1],"#2563eb","#94a3b8"],"line-width":["case",["boolean",["get","active"],!1],2.5,1.5]}}),n.addSource(Jn,{type:"geojson",data:ii()});var e={id:Qn,type:"line",source:Jn,layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get","color"],"line-width":4,"line-dasharray":[1.5,1.5],"line-opacity":.8}};n.addLayer(e),n.addSource(Bn,{type:"geojson",data:ii()});var t={id:Un,type:"line",source:Bn,layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get","color"],"line-width":3,"line-opacity":.85}};n.addLayer(t),n.addSource(Xn,{type:"geojson",data:ii(),cluster:!0,clusterRadius:60,clusterMaxZoom:14,clusterProperties:{draft:An.draft,approved:An.approved,completed:An.completed,unassigned:An.unassigned}});var i={id:Vn,type:"circle",source:Xn,filter:["has","point_count"],paint:{"circle-color":["case",["all",[">=",["get","completed"],["get","approved"]],[">=",["get","completed"],["get","draft"]],[">=",["get","completed"],["get","unassigned"]]],Rn.completed,["all",[">=",["get","approved"],["get","draft"]],[">=",["get","approved"],["get","unassigned"]]],Rn.approved,[">=",["get","draft"],["get","unassigned"]],Rn.draft,Rn.unassigned],"circle-radius":["interpolate",["linear"],["zoom"],8,16,12,22,14,30],"circle-opacity":.82,"circle-stroke-width":1.6,"circle-stroke-color":"#f8fafc"}};n.addLayer(i);var r={id:Hn,type:"symbol",source:Xn,filter:["has","point_count"],layout:{"text-field":["get","point_count_abbreviated"],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#0f172a","text-halo-color":"#ffffff","text-halo-width":1.2}};n.addLayer(r);var s={id:Zn,type:"symbol",source:Xn,filter:["!",["has","point_count"]],layout:{"icon-image":["get","iconId"],"icon-size":["case",["boolean",["get","selected"],!1],.8,.65],"icon-allow-overlap":!0,"icon-ignore-placement":!0,"text-field":["coalesce",["get","label"],""],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":10,"text-offset":[0,1.4],"text-anchor":"top","text-optional":!0},paint:{"icon-opacity":.95,"text-color":"#0f172a","text-halo-color":"#ffffff","text-halo-width":.9}};n.addLayer(s),n.addSource(Wn,{type:"geojson",data:ii()});var o={id:Kn,type:"symbol",source:Wn,layout:{"text-field":["get","icon"],"text-size":20,"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-allow-overlap":!0,"text-ignore-placement":!0,"text-rotate":["get","bearing"]},paint:{"text-color":["get","color"],"text-halo-color":"rgba(17, 24, 39, 0.55)","text-halo-width":1.2}};n.addLayer(o),tt(!0)};return n.on("styledata",a),n.on("load",o),function(){"function"==typeof n.off&&(n.off("styledata",a),n.off("load",o)),tt(!1),bt(!1),Le.current=null,dn(),n.remove(),Te.current=null}}},[jt,dn]),u.useEffect(function(){if(et){var e=Te.current;if(e){var t,n,i,r;"perspective"===Oe?("function"==typeof(null===(i=e.dragRotate)||void 0===i?void 0:i.enable)&&e.dragRotate.enable(),"function"==typeof(null===(r=e.touchZoomRotate)||void 0===r?void 0:r.enableRotation)&&e.touchZoomRotate.enableRotation(),"function"==typeof e.easeTo?e.easeTo({pitch:55,bearing:28,duration:600}):(e.setPitch(55),e.setBearing(28))):("function"==typeof e.easeTo?e.easeTo({pitch:0,bearing:0,duration:400}):(e.setPitch(0),e.setBearing(0)),"function"==typeof(null===(t=e.dragRotate)||void 0===t?void 0:t.disable)&&e.dragRotate.disable(),"function"==typeof(null===(n=e.touchZoomRotate)||void 0===n?void 0:n.disableRotation)&&e.touchZoomRotate.disableRotation())}}},[et,Oe]),u.useEffect(function(){if(et){var e=Te.current,n=Le.current;if(e&&n){var i=[],s=new Map,o=function(e){var t=e.features,n=void 0===t?[]:t;i.length=0,yt(function(e){var t,s=a(e),o=e.length,u=(new Date).toISOString(),l=r(n);try{for(l.s();!(t=l.n()).done;){var c,h=t.value;if(h&&Nn(h.geometry)){var f="string"==typeof h.id?h.id:null!=h.id?String(h.id):"draw-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2)),d="undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"zone-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2)),g=H.current("logistics.geozoneDefaultName",{index:o+i.length+1}),v=_i({id:d,drawId:f,name:g,createdAt:u,geometry:h.geometry,properties:null!==(c=h.properties)&&void 0!==c?c:{},active:!0});i.push(v),s.push(v)}}}catch(y){l.e(y)}finally{l.f()}return s}),i.length&&_t(function(e){var t=new Set(e);return i.forEach(function(e){return t.add(e.id)}),Array.from(t)})},u=function(e){var t,n=e.features,i=void 0===n?[]:n,s=new Set,a=r(i);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(o){var u="string"==typeof o.id?o.id:null!=o.id?String(o.id):"";u&&s.add(u)}}}catch(c){a.e(c)}finally{a.f()}if(s.size){var l=[];yt(function(e){return e.filter(function(e){var t=s.has(e.drawId);return t&&l.push(e.id),!t})}),l.length&&_t(function(e){return e.filter(function(e){return!l.includes(e)})})}},l=function(e){var n=e.features,i=void 0===n?[]:n;s.clear();var a,o=r(i);try{for(o.s();!(a=o.n()).done;){var u,l=a.value;if(l&&Nn(l.geometry)){var c="string"==typeof l.id?l.id:null!=l.id?String(l.id):"";c&&s.set(c,{type:"Feature",geometry:l.geometry,properties:t({},null!==(u=l.properties)&&void 0!==u?u:{})})}}}catch(h){o.e(h)}finally{o.f()}s.size&&yt(function(e){return e.map(function(e){var t,n,i=s.get(e.drawId);return i&&Nn(i.geometry)?_i({id:e.id,drawId:e.drawId,name:e.name,createdAt:e.createdAt,geometry:i.geometry,properties:null!==(t=null!==(n=i.properties)&&void 0!==n?n:e.feature.properties)&&void 0!==t?t:{},active:mt.includes(e.id),bufferMeters:e.metrics.bufferMeters}):e})})},c=function(e){var t=e.mode;bt("draw_polygon"===t)};return e.on("draw.create",o),e.on("draw.delete",u),e.on("draw.update",l),e.on("draw.modechange",c),function(){e.off("draw.create",o),e.off("draw.delete",u),e.off("draw.update",l),e.off("draw.modechange",c)}}}},[mt,et]),u.useEffect(function(){if(et){var e=Le.current;e&&(kt||e.changeMode("simple_select"))}},[kt,et]),u.useEffect(function(){if(et){var e=Te.current;if(e){var n=e.getSource(zn);if(n){var i=kt?vt.map(function(e){var n;return t(t({},e.feature),{},{id:e.drawId,properties:t(t({},null!==(n=e.feature.properties)&&void 0!==n?n:{}),{},{zoneId:e.id,name:e.name,active:mt.includes(e.id)})})}):[];n.setData({type:"FeatureCollection",features:i})}}}},[mt,vt,kt,et]),u.useEffect(function(){if(et){var e=Te.current;if(e){var t=e.getSource(Bn),n=e.getSource(Wn);if(t&&n){if(!Je.tasks||!K.length)return t.setData(ii()),n.setData(ii()),Pe.current.routes=[],void dn();var i=!1;return f(l().m(function e(){var s,a,o,u,c,h,f,d,g,v,y,p,m,_,x,k;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:s=[],a=[],o=r(K),e.p=1,o.s();case 2:if((u=o.n()).done){e.n=8;break}if(d=u.value,!i){e.n=3;break}return e.a(3,8);case 3:if(g=ci(d.startCoordinates),v=ci(d.finishCoordinates),g&&v){e.n=4;break}return e.a(3,7);case 4:return e.n=5,j(d.startCoordinates,d.finishCoordinates);case 5:if((y=e.v)&&!i){e.n=6;break}return e.a(3,7);case 6:p="string"==typeof d.status?d.status.trim():"",m=null!==(c=wn[p])&&void 0!==c?c:"#2563eb",_=y,s.push({type:"Feature",geometry:{type:"LineString",coordinates:_},properties:{color:m,taskId:d._id,title:null!==(h=d.title)&&void 0!==h?h:d._id}}),(x=pi(_,m,d._id,null!==(f=d.title)&&void 0!==f?f:d._id))&&a.push(x);case 7:e.n=2;break;case 8:e.n=10;break;case 9:e.p=9,k=e.v,o.e(k);case 10:return e.p=10,o.f(),e.f(10);case 11:if(!i){e.n=12;break}return e.a(2);case 12:t.setData({type:"FeatureCollection",features:s}),Pe.current.routes=a,Pe.current.lastTimestamp=null,a.length?gn():(n.setData(ii()),dn());case 13:return e.a(2)}},e,null,[[1,9,10,11]])}))(),function(){i=!0,dn()}}}}},[Je.tasks,et,gn,K,dn]),u.useEffect(function(){if(Je.optimized&&me){var e=["#ef4444","#22c55e","#f97316"],t=[];me.routes.forEach(function(n,i){var r=[];n.tasks.forEach(function(e){var t=ci(e.start),n=ci(e.finish);t&&r.push(t),n&&r.push(n)}),r.length<2||t.push({type:"Feature",geometry:{type:"LineString",coordinates:r},properties:{color:e[i%e.length],routeId:n.id}})}),Ct({type:"FeatureCollection",features:t})}else Ct(ii())},[Je.optimized,me]),u.useEffect(function(){if(et){var e=Te.current;if(e){var t=e.getSource(Jn);t&&t.setData(St)}}},[et,St]),u.useEffect(function(){if(et){var e=Te.current;if(e){var t=function(t,n){e.getLayer(t)&&e.setLayoutProperty(t,"visibility",n?"visible":"none")};t(Un,Je.tasks),t(Vn,Je.tasks),t(Hn,Je.tasks),t(Zn,Je.tasks),t(Kn,Je.tasks),t(Qn,Je.optimized)}}},[Je.optimized,Je.tasks,et]),u.useEffect(function(){if(et){var e=Te.current;if(e){var t=e.getSource(Xn);if(t){var n=function(e){return function(e){var t,n,i,r=null===(t=e.features)||void 0===t?void 0:t[0];if(r)if("vehicle"!==(null===(n=r.properties)||void 0===n?void 0:n.entity)){var s=null===(i=r.properties)||void 0===i?void 0:i.taskId;"string"==typeof s&&s&&Mi(s)}else{var a,o=null===(a=r.properties)||void 0===a?void 0:a.vehicleId;"string"==typeof o&&o&&Ut(o)}}(e)},i=function(n){return function(n){var i,r,s,a=null===(i=n.features)||void 0===i?void 0:i[0];if(a){var o=null===(r=a.properties)||void 0===r?void 0:r.cluster_id;if("number"==typeof o){var u=a.geometry&&"Point"===a.geometry.type?a.geometry.coordinates:null;t.getClusterExpansionZoom(o,function(t,n){!t&&"number"==typeof n&&u&&e.easeTo({center:u,zoom:n,duration:600})});var l="number"==typeof(null===(s=a.properties)||void 0===s?void 0:s.point_count)?a.properties.point_count:0,c=Math.min(Math.max(l,1),50),h=new Set,f=function(e){t.getClusterLeaves(o,c,e,function(t,n){if(!t&&n)if(n.forEach(function(e){var t;if("task"===(null===(t=e.properties)||void 0===t?void 0:t.entity)){var n,i=null===(n=e.properties)||void 0===n?void 0:n.taskId;"string"==typeof i&&i&&h.add(i)}}),n.length===c&&e+n.length<l)f(e+n.length);else{var i=Array.from(h);dt(i.length?{ids:i,center:null!=u?u:null}:null)}})};f(0)}}}(n)},r=function(t){e.getCanvas().style.cursor=t},s=function(){return r("pointer")},a=function(){return r("")};return e.on("click",Zn,n),e.on("mouseenter",Zn,s),e.on("mouseleave",Zn,a),e.on("click",Vn,i),e.on("mouseenter",Vn,s),e.on("mouseleave",Vn,a),function(){e.off("click",Zn,n),e.off("mouseenter",Zn,s),e.off("mouseleave",Zn,a),e.off("click",Vn,i),e.off("mouseenter",Vn,s),e.off("mouseleave",Vn,a)}}}}},[et,Mi,Ut]),u.useEffect(function(){if(!jt&&et){var e=Te.current;e&&"function"==typeof e.resize&&e.resize()}},[jt,et]),o.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[o.jsxs("header",{className:"flex flex-wrap items-start justify-between gap-3",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx("h2",{className:"text-2xl font-semibold",children:B("logistics.title")}),o.jsx("p",{className:"max-w-3xl text-sm text-muted-foreground",children:B("logistics.pageLead",{defaultValue:"Планируйте маршруты, управляйте автопарком и отслеживайте задачи на одной карте."})})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[o.jsx(x,{type:"button",size:"sm",variant:"outline",onClick:Fi,children:B("refresh")}),o.jsx(x,{type:"button",size:"sm",variant:"outline",onClick:Ri,disabled:Se,children:B(Se?"loading":"logistics.planReload")})]})]}),o.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-3 text-sm text-amber-900",children:B("logistics.mapFallbackWarning",{defaultValue:"Карта использует временные растровые тайлы OpenStreetMap. Подключите локальные PMTiles в public/tiles, чтобы активировать детализированный стиль."})}),o.jsxs("div",{className:"grid gap-4 xl:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("section",{className:"space-y-4 rounded-lg border bg-white/85 p-4 shadow-sm",children:[o.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx("h3",{className:"text-lg font-semibold",children:B("logistics.planSectionTitle")}),o.jsx("p",{className:"text-sm text-muted-foreground",children:B("logistics.planSummary")})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[o.jsx("span",{className:"text-sm font-medium",children:B("logistics.planStatus")}),o.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-700",children:Hi}),Se?o.jsx("span",{className:"text-xs text-muted-foreground",children:B("loading")}):null]})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[o.jsx(x,{type:"button",size:"sm",variant:"outline",onClick:Ri,disabled:Se,children:B(Se?"loading":"logistics.planReload")}),o.jsx(x,{type:"button",size:"sm",variant:"outline",onClick:Oi,disabled:Se,children:B("logistics.planClear")}),o.jsx(x,{type:"button",size:"sm",onClick:Ci,disabled:!me||!Zi||Se,children:B("save")}),"draft"===(null==me?void 0:me.status)?o.jsx(x,{type:"button",size:"sm",variant:"success",onClick:Ti,disabled:Se,children:B("logistics.planApprove")}):null,"approved"===(null==me?void 0:me.status)?o.jsx(x,{type:"button",size:"sm",variant:"success",onClick:Li,disabled:Se,children:B("logistics.planComplete")}):null]}),me?o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[o.jsx("span",{className:"font-medium",children:B("logistics.planTitleLabel")}),o.jsx(k,{value:me.title,onChange:function(e){return xn(e.target.value)},disabled:!Zi||Se})]}),o.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[o.jsx("span",{className:"font-medium",children:B("logistics.planNotesLabel")}),o.jsx("textarea",{value:null!==(O=me.notes)&&void 0!==O?O:"",onChange:function(e){return kn(e.target.value)},className:"min-h-[96px] rounded border px-3 py-2 text-sm",disabled:!Zi||Se})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"text-sm font-semibold uppercase text-muted-foreground",children:B("logistics.planSummary")}),o.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[o.jsxs("div",{className:"rounded border bg-white/70 px-3 py-2 text-sm shadow-sm",children:[o.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:B("logistics.planTotalDistance")}),o.jsx("div",{className:"font-semibold",children:zi(null!==(D=null===(F=me.metrics)||void 0===F?void 0:F.totalDistanceKm)&&void 0!==D?D:null)})]}),o.jsxs("div",{className:"rounded border bg-white/70 px-3 py-2 text-sm shadow-sm",children:[o.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:B("logistics.planTotalRoutes")}),o.jsx("div",{className:"font-semibold",children:Ji})]}),o.jsxs("div",{className:"rounded border bg-white/70 px-3 py-2 text-sm shadow-sm",children:[o.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:B("logistics.planTotalTasks")}),o.jsx("div",{className:"font-semibold",children:Qi})]}),o.jsxs("div",{className:"rounded border bg-white/70 px-3 py-2 text-sm shadow-sm",children:[o.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:B("logistics.planTotalStops")}),o.jsx("div",{className:"font-semibold",children:Ki})]})]})]}),o.jsx("div",{className:"space-y-3",children:Wi.map(function(e,t){var n,i,r,s,a,u,l,c="number"==typeof e.order&&Number.isFinite(e.order)?e.order+1:t+1,h=null!==(n=null===(i=e.metrics)||void 0===i?void 0:i.stops)&&void 0!==n?n:e.stops.length;return o.jsxs("div",{className:"space-y-3 rounded border bg-white/70 px-3 py-3 shadow-sm",children:[o.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-base font-semibold",children:B("logistics.planRouteTitle",{index:c})}),o.jsx("div",{className:"text-xs text-muted-foreground",children:B("logistics.planRouteSummary",{tasks:e.tasks.length,stops:h})})]}),o.jsx("div",{className:"text-xs text-muted-foreground",children:B("logistics.planRouteDistance",{distance:zi(null!==(r=null===(s=e.metrics)||void 0===s?void 0:s.distanceKm)&&void 0!==r?r:null)})})]}),o.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[o.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[o.jsx("span",{className:"font-medium",children:B("logistics.planDriver")}),o.jsx(k,{value:null!==(a=e.driverName)&&void 0!==a?a:"",onChange:function(e){return En(t,e.target.value)},disabled:!Zi||Se})]}),o.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[o.jsx("span",{className:"font-medium",children:B("logistics.planVehicle")}),o.jsx(k,{value:null!==(u=e.vehicleName)&&void 0!==u?u:"",onChange:function(e){return In(t,e.target.value)},disabled:!Zi||Se})]}),o.jsxs("label",{className:"md:col-span-2 flex flex-col gap-1 text-sm",children:[o.jsx("span",{className:"font-medium",children:B("logistics.planRouteNotes")}),o.jsx("textarea",{value:null!==(l=e.notes)&&void 0!==l?l:"",onChange:function(e){return bn(t,e.target.value)},className:"min-h-[80px] rounded border px-3 py-2 text-sm",disabled:!Zi||Se})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h5",{className:"text-sm font-semibold uppercase text-muted-foreground",children:B("logistics.planTasksTitle")}),o.jsx("ul",{className:"space-y-2",children:e.tasks.length?e.tasks.map(function(n,i){var r,s,a=cn.find(function(e){return e._id===n.taskId});return a?o.jsxs("li",{className:"rounded border bg-white/60 px-3 py-2 text-sm shadow-sm",children:[o.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[o.jsxs("div",{children:[o.jsx("button",{type:"button",className:"text-left font-medium text-accentPrimary hover:underline",onClick:function(){return Mi(a)},children:a.title||a._id}),o.jsx("div",{className:"text-xs text-muted-foreground",children:a.address||B("logistics.planRouteNoAddress")})]}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx(x,{type:"button",size:"xs",variant:"outline",onClick:function(){return Pn(t,i,-1)},disabled:0===i,children:B("logistics.planTaskUp")}),o.jsx(x,{type:"button",size:"xs",variant:"outline",onClick:function(){return Pn(t,i,1)},disabled:i===e.tasks.length-1,children:B("logistics.planTaskDown")})]})]}),o.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[o.jsx("span",{children:B("logistics.planRouteDistance",{distance:zi(null!==(r=n.distanceKm)&&void 0!==r?r:null)})}),o.jsx("span",{children:B("logistics.planRouteDuration",{duration:qi(null!==(s=n.durationMinutes)&&void 0!==s?s:null)})})]})]},"".concat(e.id,"-").concat(n.taskId,"-").concat(i)):null}):o.jsx("li",{className:"rounded border border-dashed bg-white/60 px-3 py-2 text-sm text-muted-foreground",children:B("logistics.planRouteEmpty")})})]})]},e.id||"".concat(t))})}),ke?o.jsx("div",{className:Xi,children:ke}):null]}):o.jsx("div",{className:Xi,children:Se?B("loading"):ke||B("logistics.planEmpty")})]}),o.jsxs("section",{className:"space-y-4 rounded-lg border bg-white/85 p-4 shadow-sm",children:[o.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx("h3",{className:"text-lg font-semibold",children:B("logistics.mapPanelTitle",{defaultValue:"Карта маршрутов"})}),o.jsx("p",{className:"text-sm text-muted-foreground",children:B("logistics.mapPanelSummary",{defaultValue:"Включайте нужные слои, выбирайте алгоритм и запускайте оптимизацию прямо на карте."})})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[o.jsxs("label",{className:"inline-flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",className:"size-4",checked:Je.tasks,onChange:function(e){return Qe(function(n){return t(t({},n),{},{tasks:e.target.checked})})}}),o.jsx("span",{children:B("logistics.layerTasks")})]}),o.jsxs("label",{className:"inline-flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",className:"size-4",checked:Je.optimized,onChange:function(e){return Qe(function(n){return t(t({},n),{},{optimized:e.target.checked})})}}),o.jsx("span",{children:B("logistics.layerOptimization")})]})]})]}),o.jsx("div",{id:"logistics-map",className:"h-[320px] w-full rounded border ".concat(jt?"hidden":"")}),o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 text-sm",children:[o.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[o.jsxs("label",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-xs font-medium uppercase text-muted-foreground",children:B("logistics.vehicleCountLabel")}),o.jsxs("select",{value:ae,onChange:function(e){return oe(Number(e.target.value))},className:"h-8 rounded border px-2 text-sm","aria-label":B("logistics.vehicleCountAria"),children:[o.jsx("option",{value:1,children:"1"}),o.jsx("option",{value:2,children:"2"}),o.jsx("option",{value:3,children:"3"})]})]}),o.jsxs("label",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-xs font-medium uppercase text-muted-foreground",children:B("logistics.optimizeMethodLabel")}),o.jsxs("select",{value:le,onChange:function(e){return ce(e.target.value)},className:"h-8 rounded border px-2 text-sm","aria-label":B("logistics.optimizeMethodAria"),children:[o.jsx("option",{value:"angle",children:"angle"}),o.jsx("option",{value:"trip",children:"trip"})]})]})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[o.jsx(x,{type:"button",size:"sm",onClick:Gi,children:B("logistics.optimize")}),o.jsx(x,{type:"button",size:"sm",onClick:$i,children:B("reset")}),o.jsx(x,{type:"button",size:"sm",onClick:Fi,children:B("refresh")})]})]}),null!=ft&&ft.ids.length?o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded border border-dashed border-slate-300 bg-white/70 px-3 py-2 text-xs text-slate-600",children:[o.jsx("span",{children:B("logistics.clusterSelectionSummary",{count:ft.ids.length,defaultValue:"В кластере задач: ".concat(ft.ids.length)})}),o.jsx(x,{type:"button",size:"xs",variant:"outline",onClick:wi,children:B("clear")})]}):null]}),o.jsxs("section",{className:"space-y-3 rounded-lg border bg-white/85 p-4 shadow-sm",children:[o.jsx("h3",{className:"text-lg font-semibold",children:B("logistics.tasksHeading")}),o.jsx(N,{tasks:cn,onDataChange:function(e){return J(e)},onRowClick:Mi,page:Lt,pageCount:Math.max(1,Math.ceil(cn.length/25)),onPageChange:Rt})]})]}),o.jsxs("aside",{className:"space-y-4",children:["admin"===qt?o.jsxs("section",{className:"space-y-3 rounded-lg border bg-white/85 p-4 shadow-sm",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-sm",children:[o.jsx("h3",{className:"font-semibold",children:B("logistics.transport")}),o.jsx(x,{type:"button",size:"sm",variant:"outline",onClick:ji,disabled:Xe,children:Xe?B("loading"):B("logistics.refreshFleet",{defaultValue:"Обновить автопарк"})})]}),Ge?o.jsx("div",{className:"text-sm text-red-600",children:Ge}):null,Ye&&!De.length?o.jsx("div",{className:"text-sm text-muted-foreground",children:Ye}):null,De.length?o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full min-w-[480px] table-fixed border-separate border-spacing-y-1 text-xs sm:text-sm",children:[o.jsx("thead",{children:o.jsxs("tr",{className:"text-left text-muted-foreground",children:[o.jsx("th",{className:"rounded-l-md bg-slate-50 px-3 py-2 font-medium uppercase tracking-wide text-[0.7rem] dark:bg-slate-800/70",children:B("logistics.vehicleColumnName",{defaultValue:"Транспорт"})}),o.jsx("th",{className:"bg-slate-50 px-3 py-2 font-medium uppercase tracking-wide text-[0.7rem] dark:bg-slate-800/70",children:B("logistics.vehicleColumnPlate",{defaultValue:"Госномер"})}),o.jsx("th",{className:"bg-slate-50 px-3 py-2 font-medium uppercase tracking-wide text-[0.7rem] dark:bg-slate-800/70",children:B("logistics.vehicleColumnType",{defaultValue:"Тип"})}),o.jsx("th",{className:"bg-slate-50 px-3 py-2 font-medium uppercase tracking-wide text-[0.7rem] dark:bg-slate-800/70",children:B("logistics.vehicleColumnTasks",{defaultValue:"Задачи"})}),o.jsx("th",{className:"rounded-r-md bg-slate-50 px-3 py-2 font-medium uppercase tracking-wide text-[0.7rem] dark:bg-slate-800/70",children:B("logistics.vehicleColumnMileage",{defaultValue:"Пробег"})})]})}),o.jsx("tbody",{children:De.map(function(e){var t=Ze===e.id,n=Array.isArray(e.currentTasks)?e.currentTasks.length:null,i="number"==typeof e.odometerCurrent&&Number.isFinite(e.odometerCurrent)?e.odometerCurrent:null;return o.jsxs("tr",{onClick:function(){return Ut(e.id)},className:"bg-white/80 text-sm shadow-sm transition dark:bg-slate-900/60 ".concat(t?"cursor-pointer ring-2 ring-sky-500":"cursor-pointer hover:bg-slate-100/80"),"data-state":t?"selected":void 0,"aria-selected":t,children:[o.jsx("td",{className:"rounded-l-md px-3 py-2 font-medium",children:e.name||B("logistics.unselectedVehicle",{defaultValue:"Не выбран"})}),o.jsx("td",{className:"px-3 py-2 text-xs text-muted-foreground",children:e.registrationNumber||B("logistics.assignDialogUnknown",{defaultValue:"нет данных"})}),o.jsx("td",{className:"px-3 py-2 text-xs text-muted-foreground",children:e.transportType||B("logistics.assignDialogUnknown",{defaultValue:"нет данных"})}),o.jsx("td",{className:"px-3 py-2 text-xs text-muted-foreground",children:"number"==typeof n?B("logistics.vehicleTasksShort",{count:n,defaultValue:"".concat(n)}):B("logistics.assignDialogUnknown",{defaultValue:"нет данных"})}),o.jsx("td",{className:"rounded-r-md px-3 py-2 text-xs text-muted-foreground",children:null!==i?B("logistics.vehicleMileageShort",{value:i,defaultValue:"".concat(i," км")}):B("logistics.assignDialogUnknown",{defaultValue:"нет данных"})})]},e.id)})})]})}):null,Vt?o.jsx("div",{className:"rounded border border-sky-200 bg-sky-50 px-3 py-2 text-xs text-sky-700",children:B("logistics.selectedVehicle",{name:Vt.name||B("logistics.unselectedVehicle",{defaultValue:"Не выбран"})})}):null]}):Ge?o.jsx("p",{className:"rounded-lg border border-dashed bg-white/40 p-3 text-xs text-muted-foreground",children:Ge}):null,o.jsxs("section",{className:"space-y-3 rounded-lg border bg-white/85 p-4 shadow-sm",children:[o.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx("h3",{className:"text-sm font-semibold uppercase text-muted-foreground",children:B("logistics.geozonesTitle")}),o.jsx("p",{className:"text-xs text-muted-foreground",children:B("logistics.geozonesDescription",{defaultValue:"Геозоны ограничивают задачи выбранными районами. Отключите, если нужно видеть все адреса."})})]}),o.jsxs("label",{className:"flex items-center gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[o.jsx("input",{type:"checkbox",className:"size-4",checked:kt,onChange:function(e){return Nt(e.target.checked)}}),o.jsx("span",{children:B("logistics.geozonesToggleLabel",{defaultValue:"Геозоны"})})]})]}),o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[o.jsx(x,{type:"button",size:"xs",variant:"outline",onClick:Dn,disabled:!et||!kt,children:B(It?"logistics.geozonesDrawing":"logistics.geozonesDraw")}),kt?null:o.jsx("span",{className:"text-xs text-muted-foreground",children:B("logistics.geozonesDisabled",{defaultValue:"Фильтрация по зонам выключена."})})]}),kt?o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"text-xs text-muted-foreground",children:B("logistics.geozonesHint")}),vt.length?o.jsx("ul",{className:"space-y-2 text-sm",children:vt.map(function(e,t){var n,i,r,s=mt.includes(e.id);return o.jsxs("li",{className:"space-y-2 rounded border bg-white/70 p-3 shadow-sm",children:[o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsxs("label",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",className:"size-4",checked:s,disabled:!kt,onChange:function(t){return yi(e.id,t.target.checked)}}),o.jsx("span",{className:"font-medium",children:e.name||B("logistics.geozoneDefaultName",{index:t+1})})]}),o.jsx(x,{type:"button",size:"xs",variant:"ghost",onClick:function(){return Si(e)},children:B("logistics.geozoneRemove")})]}),o.jsx("div",{className:"text-xs text-muted-foreground",children:B(s?"logistics.geozoneStatusActive":"logistics.geozoneStatusInactive")}),o.jsxs("div",{className:"flex flex-wrap gap-2 text-[0.7rem] text-muted-foreground",children:[o.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-1",children:B("logistics.geozoneArea",{value:Yi(null===(n=e.metrics)||void 0===n?void 0:n.areaKm2)})}),o.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-1",children:B("logistics.geozonePerimeter",{value:Bi(null===(i=e.metrics)||void 0===i?void 0:i.perimeterKm)})}),o.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-1",children:B("logistics.geozoneBuffer",{value:Ui(null===(r=e.metrics)||void 0===r?void 0:r.bufferMeters)})})]})]},e.id)})}):o.jsx("p",{className:"text-sm text-muted-foreground",children:B("logistics.geozonesEmpty")})]}):o.jsx("p",{className:"rounded border border-dashed px-3 py-2 text-xs text-muted-foreground",children:B("logistics.geozonesDisabledHint",{defaultValue:"Включите переключатель выше, чтобы снова показывать зоны."})})]}),o.jsxs("section",{className:"space-y-3 rounded-lg border bg-white/85 p-4 shadow-sm",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx("h3",{className:"text-sm font-semibold uppercase text-muted-foreground",children:B("logistics.layersTitle")}),o.jsx("p",{className:"text-xs text-muted-foreground",children:B("logistics.layersSummary",{defaultValue:"Настройте легенду карты по статусам, транспорту и типам задач."})})]}),o.jsxs("div",{className:"space-y-3 border-t border-dashed border-slate-200 pt-3 text-sm",children:[o.jsxs("fieldset",{className:"space-y-2",children:[o.jsx("legend",{className:"text-xs font-semibold uppercase text-muted-foreground",children:B("logistics.layerRouteStatuses",{defaultValue:"Статусы маршрутов"})}),o.jsx("ul",{className:"space-y-1",children:sn.map(function(e){var t=e.key,n=e.count,i=e.color,r=!Zt.has(t),s=B("logistics.routeStatus.".concat(t),{defaultValue:On[t]});return o.jsxs("li",{className:"flex items-center justify-between gap-2",children:[o.jsxs("label",{className:"flex flex-1 items-center gap-2",children:[o.jsx("input",{type:"checkbox",className:"size-4",checked:r,onChange:function(e){return Ei(t,e.target.checked)}}),o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"inline-block size-3 rounded-full",style:{backgroundColor:i},"aria-hidden":"true"}),o.jsx("span",{children:s})]})]}),o.jsx("span",{className:"text-xs text-muted-foreground",children:B("logistics.legendCount",{count:n,defaultValue:"(".concat(n,")")})})]},t)})})]}),o.jsxs("fieldset",{className:"space-y-2",children:[o.jsx("legend",{className:"text-xs font-semibold uppercase text-muted-foreground",children:B("logistics.layerTransports",{defaultValue:"Типы транспорта"})}),o.jsx("ul",{className:"space-y-1",children:an.map(function(e){var t=e.key,n=e.label,i=e.count,r=e.color,s=!Wt.has(t);return o.jsxs("li",{className:"flex items-center justify-between gap-2",children:[o.jsxs("label",{className:"flex flex-1 items-center gap-2",children:[o.jsx("input",{type:"checkbox",className:"size-4",checked:s,onChange:function(e){return Ii(t,e.target.checked)}}),o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"inline-block size-3 rounded-full",style:{backgroundColor:r},"aria-hidden":"true"}),o.jsx("span",{children:n})]})]}),o.jsx("span",{className:"text-xs text-muted-foreground",children:B("logistics.legendCount",{count:i,defaultValue:"(".concat(i,")")})})]},t)})})]}),o.jsxs("fieldset",{className:"space-y-2",children:[o.jsx("legend",{className:"text-xs font-semibold uppercase text-muted-foreground",children:B("logistics.layerTaskTypes",{defaultValue:"Типы задач"})}),o.jsx("ul",{className:"space-y-1",children:on.map(function(e){var t=e.key,n=e.label,i=e.count,r=e.color,s=!Ht.has(t);return o.jsxs("li",{className:"flex items-center justify-between gap-2",children:[o.jsxs("label",{className:"flex flex-1 items-center gap-2",children:[o.jsx("input",{type:"checkbox",className:"size-4",checked:s,onChange:function(e){return bi(t,e.target.checked)}}),o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"inline-block size-3 rounded-full",style:{backgroundColor:r},"aria-hidden":"true"}),o.jsx("span",{children:n})]})]}),o.jsx("span",{className:"text-xs text-muted-foreground",children:B("logistics.legendCount",{count:i,defaultValue:"(".concat(i,")")})})]},t)})})]})]}),o.jsxs("div",{className:"space-y-1 border-t border-dashed border-slate-200 pt-2",children:[o.jsx("span",{className:"text-xs font-medium uppercase text-muted-foreground",children:B("logistics.viewModeLabel")}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(x,{type:"button",size:"xs",variant:"planar"===Oe?"default":"outline",onClick:function(){return Me("planar")},"aria-pressed":"planar"===Oe,children:B("logistics.viewModePlanar")}),o.jsx(x,{type:"button",size:"xs",variant:"perspective"===Oe?"default":"outline",onClick:function(){return!Ni},"aria-pressed":"perspective"===Oe,disabled:Ni,children:B("logistics.viewModeTilted")})]})]}),!!fe.length&&o.jsx("div",{className:"space-y-1 text-sm",children:fe.map(function(e,t){return o.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-accentPrimary underline",children:B("logistics.linksLabel",{index:t+1})},"".concat(t,"-").concat(e))})})]}),o.jsxs("section",{className:"space-y-3 rounded-lg border bg-white/85 p-4 shadow-sm",children:[o.jsx("h3",{className:"text-sm font-semibold uppercase text-muted-foreground",children:B("logistics.legendTitle")}),o.jsxs("div",{className:"space-y-3 text-sm",children:[o.jsx("p",{className:"text-xs text-muted-foreground",children:B("logistics.legendDescription",{defaultValue:"Заливка маркера соответствует типу транспорта, обводка — статусу маршрута, внутреннее кольцо — типу задачи. Размер и цвет кластера показывают преобладающую категорию."})}),o.jsxs("ul",{className:"flex flex-col gap-2 sm:grid sm:grid-cols-2",children:[o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"legend-symbol legend-symbol--start","aria-hidden":"true",children:$n}),o.jsx("span",{children:B("logistics.legendStart")})]}),o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"legend-symbol legend-symbol--finish","aria-hidden":"true",children:ei}),o.jsx("span",{children:B("logistics.legendFinish")})]}),o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"legend-symbol legend-symbol--movement","aria-hidden":"true",children:ti}),o.jsx("span",{children:B("logistics.legendMovement")})]})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:B("logistics.legendStatusesHeading",{defaultValue:"Статусы задач"})}),o.jsx("ul",{className:"space-y-2",children:ln.map(function(e){return o.jsxs("li",{className:"flex items-center justify-between gap-2",children:[o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"legend-color",style:{backgroundColor:e.color},"aria-hidden":"true"}),o.jsx("span",{children:e.label})]}),e.count?o.jsx("span",{className:"text-xs text-muted-foreground",children:B("logistics.legendCount",{count:e.count,defaultValue:"(".concat(e.count,")")})}):null]},e.key)})})]})]})]})]})]})]})});var F=function(e){if(!e)return!1;var t=e.lng,n=e.lat;return Number.isFinite(t)&&Number.isFinite(n)},j=function(){var e=f(l().m(function e(t,n){var i,r,s,a;return l().w(function(e){for(;;)switch(e.n){case 0:if(F(t)&&F(n)){e.n=1;break}return e.a(2,null);case 1:return r="".concat("https://router.project-osrm.org/route/v1/driving","/").concat(t.lng,",").concat(t.lat,";").concat(n.lng,",").concat(n.lat,"?overview=full&geometries=geojson"),e.n=2,fetch(r);case 2:if((s=e.v).ok){e.n=3;break}return e.a(2,null);case 3:return e.n=4,s.json();case 4:return a=e.v,e.a(2,(null===(i=a.routes)||void 0===i||null===(i=i[0])||void 0===i||null===(i=i.geometry)||void 0===i?void 0:i.coordinates)||null)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),G=function(){var e=f(l().m(function e(t,n,i){var r,s,a;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,v("/api/v1/optimizer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:t,count:n,method:i})});case 1:if((s=e.v).ok){e.n=2;break}return e.a(2,null);case 2:return e.n=3,s.json();case 3:return a=e.v,e.a(2,null!==(r=null==a?void 0:a.plan)&&void 0!==r?r:null)}},e)}));return function(t,n,i){return e.apply(this,arguments)}}(),z=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.enabled,r=void 0===i||i,s=n.immediate,o=void 0!==s&&s,l=n.pauseOnHidden,c=void 0===l||l,h=n.deps,f=void 0===h?[]:h,d=n.document,g=u.useRef(e);u.useEffect(function(){g.current=e},[e]),u.useEffect(function(){if(r){var e=null!=d?d:"undefined"!=typeof document?document:void 0,n=function(){return Boolean(c&&(null==e?void 0:e.hidden))};if(Number.isFinite(t)&&!(t<=0)){var i=!1,s=null,a=function(){null!==s&&(clearInterval(s),s=null)},u=function(){g.current()},l=function(){i||n()||(a(),s=setInterval(function(){n()||u()},t))};!n()&&o&&u(),l();var h=null;return e&&c&&"function"==typeof e.addEventListener&&(h=function(){i||(e.hidden?a():(u(),l()))},e.addEventListener("visibilitychange",h)),function(){i=!0,a(),h&&e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",h)}}!n()&&o&&g.current()}},[d,t,r,o,c].concat(a(f)))},q=function(e){var t=u.useRef(e);return u.useEffect(function(){t.current=e},[e]),t},Y={},B=function(e){if(e){var t=e.trim().toLowerCase();return!!["1","true","yes","on"].includes(t)||!["0","false","no","off"].includes(t)&&void 0}},U=function(){var e="undefined"!=typeof process&&"object"===s(Y)?Y.VITE_DISABLE_SSE:void 0,t=B(e);if(void 0!==t)return t;try{var i,r=n.meta,a=null==r||null===(i=r.env)||void 0===i?void 0:i.VITE_DISABLE_SSE,o=B(a);if(void 0!==o)return o}catch(u){}return!1}();var X="logistics-3d-buildings",V=function(e){var t,n,i=e.getStyle(),r=null==i?void 0:i.sources;if(!(!(!r||"object"!==s(r))&&Object.prototype.hasOwnProperty.call(r,E)))return null;var a=(null!==(t=null==i?void 0:i.layers)&&void 0!==t?t:[]).find(function(e){if(!e||"symbol"!==e.type)return!1;var t=e.layout;if(!t)return!1;var n=t["text-field"];return"string"==typeof n||Array.isArray(n)}),o=X,u=null!==(n=null==a?void 0:a.id)&&void 0!==n?n:null;if(e.getLayer(o))u&&e.moveLayer(o,u);else{var l={id:X,type:"fill-extrusion",source:E,"source-layer":"building",filter:["==",["get","extrude"],"true"],minzoom:15,paint:{"fill-extrusion-color":"#94a3b8","fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["coalesce",["get","height"],0]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],15,0,15.05,["coalesce",["get","min_height"],0]],"fill-extrusion-opacity":.6}};try{e.addLayer(l,null!=u?u:void 0)}catch(c){return u}}return u},H="#3bb2d0",Z="#fbb03b",W="#fff",K=["any",["==","$type","LineString"],["==","$type","Polygon"]],J={"line-cap":"round","line-join":"round"},Q=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],Z,H],"fill-opacity":.1}},{id:"gl-draw-lines-inactive",type:"line",filter:["all",["!=","active","true"],K],layout:J,paint:{"line-color":H,"line-dasharray":[2,0],"line-width":2}},{id:"gl-draw-lines-active",type:"line",filter:["all",["==","active","true"],K],layout:J,paint:{"line-color":Z,"line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":W}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],Z,H]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":W}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":Z}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":Z}}];function $(e,t,n){return ee.apply(this,arguments)}function ee(){return(ee=f(l().m(function e(t,n,i){var r,s;return l().w(function(e){for(;;)switch(e.n){case 0:return r=new URLSearchParams,t&&r.set("status",t),n&&r.set("limit",String(n)),i&&r.set("page",String(i)),e.n=1,v("/api/v1/route-plans?".concat(r.toString()));case 1:if((s=e.v).ok){e.n=2;break}throw new Error("Не удалось загрузить маршрутные планы");case 2:return e.n=3,s.json();case 3:return e.a(2,e.v)}},e)}))).apply(this,arguments)}function te(e,t){return ne.apply(this,arguments)}function ne(){return(ne=f(l().m(function e(t,n){var i,r;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,v("/api/v1/route-plans/".concat(t),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 1:if((i=e.v).ok){e.n=2;break}throw new Error("Не удалось сохранить маршрутный план");case 2:return e.n=3,i.json();case 3:return r=e.v,e.a(2,r.plan)}},e)}))).apply(this,arguments)}function ie(e,t){return re.apply(this,arguments)}function re(){return(re=f(l().m(function e(t,n){var i,r;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,v("/api/v1/route-plans/".concat(t,"/status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:n})});case 1:if((i=e.v).ok){e.n=2;break}throw new Error("Не удалось обновить статус маршрутного плана");case 2:return e.n=3,i.json();case 3:return r=e.v,e.a(2,r.plan)}},e)}))).apply(this,arguments)}var se=6371008.8,ae={centimeters:637100880,centimetres:637100880,degrees:360/(2*Math.PI),feet:20902260.511392,inches:39.37*se,kilometers:6371.0088,kilometres:6371.0088,meters:se,metres:se,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:se/1852,radians:1,yards:6967335.223679999};function oe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function ue(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!de(e[0])||!de(e[1]))throw new Error("coordinates must contain numbers");return oe({type:"Point",coordinates:e},t,n)}function le(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return oe({type:"LineString",coordinates:e},t,n)}function ce(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function he(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"kilometers",n=ae[t];if(!n)throw new Error(t+" units is invalid");return e*n}function fe(e){return e%360*Math.PI/180}function de(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function ge(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return a(e.geometry.coordinates);if("Point"===e.type)return a(e.coordinates)}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return a(e);throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ve(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ye(e){return"Feature"===e.type?e.geometry:e}function pe(e,t,n){if(null!==e)for(var i,r,s,a,o,u,l,c,h=0,f=0,d=e.type,g="FeatureCollection"===d,v="Feature"===d,y=g?e.features.length:1,p=0;p<y;p++){o=(c=!!(l=g?e.features[p].geometry:v?e.geometry:e)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var m=0;m<o;m++){var _=0,x=0;if(null!==(a=c?l.geometries[m]:l)){u=a.coordinates;var k=a.type;switch(h=0,k){case null:break;case"Point":if(!1===t(u,f,p,_,x))return!1;f++,_++;break;case"LineString":case"MultiPoint":for(i=0;i<u.length;i++){if(!1===t(u[i],f,p,_,x))return!1;f++,"MultiPoint"===k&&_++}"LineString"===k&&_++;break;case"Polygon":case"MultiLineString":for(i=0;i<u.length;i++){for(r=0;r<u[i].length-h;r++){if(!1===t(u[i][r],f,p,_,x))return!1;f++}"MultiLineString"===k&&_++,"Polygon"===k&&x++}"Polygon"===k&&_++;break;case"MultiPolygon":for(i=0;i<u.length;i++){for(x=0,r=0;r<u[i].length;r++){for(s=0;s<u[i][r].length-h;s++){if(!1===t(u[i][r][s],f,p,_,x))return!1;f++}x++}_++}break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(!1===pe(a.geometries[i],t))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function me(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length&&!1!==t(e.features[n],n);n++);}function _e(e,t){var n,i,r,s,a,o,u,l,c,h,f=0,d="FeatureCollection"===e.type,g="Feature"===e.type,v=d?e.features.length:1;for(n=0;n<v;n++){for(o=d?e.features[n].geometry:g?e.geometry:e,l=d?e.features[n].properties:g?e.properties:{},c=d?e.features[n].bbox:g?e.bbox:void 0,h=d?e.features[n].id:g?e.id:void 0,a=(u=!!o&&"GeometryCollection"===o.type)?o.geometries.length:1,r=0;r<a;r++)if(null!==(s=u?o.geometries[r]:o))switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(s,f,l,c,h))return!1;break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===t(s.geometries[i],f,l,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,l,c,h))return!1;f++}}function xe(e,t){!function(e,t){_e(e,function(e,n,i,r,s){var a,o=null===e?null:e.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return!1!==t(oe(e,i,{bbox:r,id:s}),n,0)&&void 0}switch(o){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<e.coordinates.length;u++){var l=e.coordinates[u];if(!1===t(oe({type:a,coordinates:l},i),n,u))return!1}})}(e,function(e,n,i){var r=0;if(e.geometry){var s=e.geometry.type;if("Point"!==s&&"MultiPoint"!==s){var a,o=0,u=0,l=0;return!1!==pe(e,function(s,c,h,f,d){if(void 0===a||n>o||f>u||d>l)return a=s,o=n,u=f,l=d,void(r=0);var g=le([a,s],e.properties);if(!1===t(g,n,i,d,r))return!1;r++,a=s})&&void 0}}})}function ke(e){return function(e,t,n){var i=n;return _e(e,function(e,n,r,s,a){i=t(i,e,n,r,s,a)}),i}(e,function(e,t){return e+function(e){var t,n=0;switch(e.type){case"Polygon":return Ne(e.coordinates);case"MultiPolygon":for(t=0;t<e.coordinates.length;t++)n+=Ne(e.coordinates[t]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(t)},0)}function Ne(e){var t=0;if(e&&e.length>0){t+=Math.abs(be(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(be(e[n]))}return t}var Ee=20294876564838.72,Ie=Math.PI/180;function be(e){var t=e.length-1;if(t<=2)return 0;for(var n=0,i=0;i<t;){var r=e[i],s=e[i+1===t?0:i+1],a=e[i+2>=t?(i+2)%t:i+2],o=r[0]*Ie,u=s[1]*Ie;n+=(a[0]*Ie-o)*Math.sin(u),i++}return n*Ee}var we=134217729;function Se(e,t,n,i,r){var s,a,o,u,l=t[0],c=i[0],h=0,f=0;c>l==c>-l?(s=l,l=t[++h]):(s=c,c=i[++f]);var d=0;if(h<e&&f<n)for(c>l==c>-l?(o=s-((a=l+s)-l),l=t[++h]):(o=s-((a=c+s)-c),c=i[++f]),s=a,0!==o&&(r[d++]=o);h<e&&f<n;)c>l==c>-l?(o=s-((a=s+l)-(u=a-s))+(l-u),l=t[++h]):(o=s-((a=s+c)-(u=a-s))+(c-u),c=i[++f]),s=a,0!==o&&(r[d++]=o);for(;h<e;)o=s-((a=s+l)-(u=a-s))+(l-u),l=t[++h],s=a,0!==o&&(r[d++]=o);for(;f<n;)o=s-((a=s+c)-(u=a-s))+(c-u),c=i[++f],s=a,0!==o&&(r[d++]=o);return 0===s&&0!==d||(r[d++]=s),d}function Ce(e){return new Float64Array(e)}var Te=Ce(4),Le=Ce(8),Re=Ce(12),Oe=Ce(16),Me=Ce(4);function Pe(e,t,n,i,r,s){var a=(t-s)*(n-r),o=(e-r)*(i-s),u=a-o,l=Math.abs(a+o);return Math.abs(u)>=33306690738754716e-32*l?u:-function(e,t,n,i,r,s,a){var o,u,l,c,h,f,d,g,v,y,p,m,_,x,k,N,E,I,b=e-r,w=n-r,S=t-s,C=i-s;h=(k=(g=b-(d=(f=we*b)-(f-b)))*(y=C-(v=(f=we*C)-(f-C)))-((x=b*C)-d*v-g*v-d*y))-(p=k-(E=(g=S-(d=(f=we*S)-(f-S)))*(y=w-(v=(f=we*w)-(f-w)))-((N=S*w)-d*v-g*v-d*y))),Te[0]=k-(p+h)+(h-E),h=(_=x-((m=x+p)-(h=m-x))+(p-h))-(p=_-N),Te[1]=_-(p+h)+(h-N),h=(I=m+p)-m,Te[2]=m-(I-h)+(p-h),Te[3]=I;var T=function(e,t){for(var n=t[0],i=1;i<e;i++)n+=t[i];return n}(4,Te),L=22204460492503146e-32*a;if(T>=L||-T>=L)return T;if(o=e-(b+(h=e-b))+(h-r),l=n-(w+(h=n-w))+(h-r),u=t-(S+(h=t-S))+(h-s),c=i-(C+(h=i-C))+(h-s),0===o&&0===u&&0===l&&0===c)return T;if(L=11093356479670487e-47*a+33306690738754706e-32*Math.abs(T),(T+=b*c+C*o-(S*l+w*u))>=L||-T>=L)return T;h=(k=(g=o-(d=(f=we*o)-(f-o)))*(y=C-(v=(f=we*C)-(f-C)))-((x=o*C)-d*v-g*v-d*y))-(p=k-(E=(g=u-(d=(f=we*u)-(f-u)))*(y=w-(v=(f=we*w)-(f-w)))-((N=u*w)-d*v-g*v-d*y))),Me[0]=k-(p+h)+(h-E),h=(_=x-((m=x+p)-(h=m-x))+(p-h))-(p=_-N),Me[1]=_-(p+h)+(h-N),h=(I=m+p)-m,Me[2]=m-(I-h)+(p-h),Me[3]=I;var R=Se(4,Te,4,Me,Le);h=(k=(g=b-(d=(f=we*b)-(f-b)))*(y=c-(v=(f=we*c)-(f-c)))-((x=b*c)-d*v-g*v-d*y))-(p=k-(E=(g=S-(d=(f=we*S)-(f-S)))*(y=l-(v=(f=we*l)-(f-l)))-((N=S*l)-d*v-g*v-d*y))),Me[0]=k-(p+h)+(h-E),h=(_=x-((m=x+p)-(h=m-x))+(p-h))-(p=_-N),Me[1]=_-(p+h)+(h-N),h=(I=m+p)-m,Me[2]=m-(I-h)+(p-h),Me[3]=I;var O=Se(R,Le,4,Me,Re);h=(k=(g=o-(d=(f=we*o)-(f-o)))*(y=c-(v=(f=we*c)-(f-c)))-((x=o*c)-d*v-g*v-d*y))-(p=k-(E=(g=u-(d=(f=we*u)-(f-u)))*(y=l-(v=(f=we*l)-(f-l)))-((N=u*l)-d*v-g*v-d*y))),Me[0]=k-(p+h)+(h-E),h=(_=x-((m=x+p)-(h=m-x))+(p-h))-(p=_-N),Me[1]=_-(p+h)+(h-N),h=(I=m+p)-m,Me[2]=m-(I-h)+(p-h),Me[3]=I;var M=Se(O,Re,4,Me,Oe);return Oe[M-1]}(e,t,n,i,r,s,l)}function Ae(e,t){var n,i,r,s,a,o,u,l,c,h=0,f=e[0],d=e[1],g=t.length;for(n=0;n<g;n++){i=0;var v=t[n],y=v.length-1;if((l=v[0])[0]!==v[y][0]&&l[1]!==v[y][1])throw new Error("First and last coordinates in a ring must be the same");for(s=l[0]-f,a=l[1]-d;i<y;i++){if(o=(c=v[i+1])[0]-f,u=c[1]-d,0===a&&0===u){if(o<=0&&s>=0||s<=0&&o>=0)return 0}else if(u>=0&&a<=0||u<=0&&a>=0){if(0===(r=Pe(s,o,a,u,0,0)))return 0;(r>0&&u>0&&a<=0||r<0&&u<=0&&a>0)&&h++}l=c,a=u,s=o}}return h%2!=0}function De(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ye(e);switch(t.properties||"Feature"!==e.type||(t.properties=e.properties),n.type){case"Polygon":return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ye(e),i=n.coordinates,r=t.properties?t.properties:"Feature"===e.type?e.properties:{};return Fe(i,r)}(n,t);case"MultiPolygon":return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ye(e),i=n.coordinates,r=t.properties?t.properties:"Feature"===e.type?e.properties:{},s=[];return i.forEach(function(e){s.push(Fe(e,r))}),ce(s)}(n,t);default:throw new Error("invalid poly")}}function Fe(e,t){return e.length>1?function(e,t){return oe({type:"MultiLineString",coordinates:e},t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}(e,t):le(e[0],t)}function je(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="object"===s(t)?t.mutate:t;if(!e)throw new Error("geojson is required");var i=function(e){return"FeatureCollection"===e.type?"FeatureCollection":"GeometryCollection"===e.type?"GeometryCollection":"Feature"===e.type&&null!==e.geometry?e.geometry.type:e.type}(e),r=[];switch(i){case"LineString":r=Ge(e,i);break;case"MultiLineString":case"Polygon":ve(e).forEach(function(e){r.push(Ge(e,i))});break;case"MultiPolygon":ve(e).forEach(function(e){var t=[];e.forEach(function(e){t.push(Ge(e,i))}),r.push(t)});break;case"Point":return e;case"MultiPoint":var a={};ve(e).forEach(function(e){var t=e.join("-");Object.prototype.hasOwnProperty.call(a,t)||(r.push(e),a[t]=!0)});break;default:throw new Error(i+" geometry not supported")}return e.coordinates?!0===n?(e.coordinates=r,e):{type:i,coordinates:r}:!0===n?(e.geometry.coordinates=r,e):oe({type:i,coordinates:r},e.properties,{bbox:e.bbox,id:e.id})}function Ge(e,t){var n=ve(e);if(2===n.length&&!ze(n[0],n[1]))return n;var i=[],r=n.length-1,s=i.length;i.push(n[0]);for(var a=1;a<r;a++){var o=i[i.length-1];n[a][0]===o[0]&&n[a][1]===o[1]||(i.push(n[a]),(s=i.length)>2&&qe(i[s-3],i[s-1],i[s-2])&&i.splice(i.length-2,1))}if(i.push(n[n.length-1]),s=i.length,("Polygon"===t||"MultiPolygon"===t)&&ze(n[0],n[n.length-1])&&s<4)throw new Error("invalid polygon");return"LineString"===t&&s<3||qe(i[s-3],i[s-1],i[s-2])&&i.splice(i.length-2,1),i}function ze(e,t){return e[0]===t[0]&&e[1]===t[1]}function qe(e,t,n){var i=n[0],r=n[1],s=e[0],a=e[1],o=t[0],u=t[1],l=o-s,c=u-a;return 0===(i-s)*c-(r-a)*l&&(Math.abs(l)>=Math.abs(c)?l>0?s<=i&&i<=o:o<=i&&i<=s:c>0?a<=r&&r<=u:u<=r&&r<=a)}function Ye(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null!=e.bbox&&!0!==t.recompute)return e.bbox;var n=[1/0,1/0,-1/0,-1/0];return pe(e,function(e){n[0]>e[0]&&(n[0]=e[0]),n[1]>e[1]&&(n[1]=e[1]),n[2]<e[0]&&(n[2]=e[0]),n[3]<e[1]&&(n[3]=e[1])}),n}(e);return ue([(n[0]+n[2])/2,(n[1]+n[3])/2],t.properties,t)}var Be,Ue={exports:{}};var Xe=(Be||(Be=1,function(e){e.exports=function(){function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function t(e,t,n){return t=l(t),function(e,t){if(t&&("object"==s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,h()?Reflect.construct(t,n||[],l(e).constructor):t.apply(e,n))}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){if(h())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,t);var r=new(e.bind.apply(e,i));return n&&f(r,n.prototype),r}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,v(i.key),i)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=y(e))||t){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},u.apply(null,arguments)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}function h(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(h=function(){return!!e})()}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function d(e,t,n,i){var r=u(l(1&i?e.prototype:e),t,n);return 2&i&&"function"==typeof r?function(e){return r.apply(n,e)}:r}function g(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||y(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==s(t)?t:t+""}function y(t,n){if(t){if("string"==typeof t)return e(t,n);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}function p(e){var t="function"==typeof Map?new Map:void 0;return p=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return i(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),f(n,e)},p(e)}var m=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=e.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=e.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==e.JOIN_ROUND&&(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(e){this._joinStyle=e}},{key:"setSimplifyFactor",value:function(e){this._simplifyFactor=e<0?0:e}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(e){this._endCapStyle=e}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(e){this._mitreLimit=e}},{key:"setSingleSided",value:function(e){this._isSingleSided=e}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(i)}else if(4===arguments.length){var r=arguments[0],s=arguments[1],a=arguments[2],o=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(s),this.setJoinStyle(a),this.setMitreLimit(o)}}},{key:"bufferDistanceError",value:function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)}}])}();m.CAP_ROUND=1,m.CAP_FLAT=2,m.CAP_SQUARE=3,m.JOIN_ROUND=1,m.JOIN_MITRE=2,m.JOIN_BEVEL=3,m.DEFAULT_QUADRANT_SEGMENTS=8,m.DEFAULT_MITRE_LIMIT=5,m.DEFAULT_SIMPLIFY_FACTOR=.01;var _=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({Exception:i})[0],r}return c(i,e),a(i,[{key:"toString",value:function(){return this.message}}])}(p(Error)),x=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({IllegalArgumentException:i})[0],r}return c(i,e),a(i)}(_),k=a(function e(){n(this,e)},[{key:"filter",value:function(e){}}]);function N(){}function E(){}function I(){}var b,w,S,C,T,L,R,O,M=a(function e(){n(this,e)},null,[{key:"equalsWithTolerance",value:function(e,t,n){return Math.abs(e-t)<=n}}]),P=a(function e(t,i){n(this,e),this.low=i||0,this.high=t||0},null,[{key:"toBinaryString",value:function(e){var t,n="";for(t=2147483648;t>0;t>>>=1)n+=(e.high&t)===t?"1":"0";for(t=2147483648;t>0;t>>>=1)n+=(e.low&t)===t?"1":"0";return n}}]);function A(){}function D(){}A.NaN=NaN,A.isNaN=function(e){return Number.isNaN(e)},A.isInfinite=function(e){return!Number.isFinite(e)},A.MAX_VALUE=Number.MAX_VALUE,A.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,A.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,"function"==typeof Float64Array&&"function"==typeof Int32Array?(L=2146435072,R=new Float64Array(1),O=new Int32Array(R.buffer),A.doubleToLongBits=function(e){R[0]=e;var t=0|O[0],n=0|O[1];return(n&L)===L&&1048575&n&&0!==t&&(t=0,n=2146959360),new P(n,t)},A.longBitsToDouble=function(e){return O[0]=e.low,O[1]=e.high,R[0]}):(b=1023,w=Math.log2,S=Math.floor,C=Math.pow,T=function(){for(var e=53;e>0;e--){var t=C(2,e)-1;if(S(w(t))+1===e)return t}return 0}(),A.doubleToLongBits=function(e){var t,n,i,r,s,a,o,u,l;if(e<0||1/e===Number.NEGATIVE_INFINITY?(a=1<<31,e=-e):a=0,0===e)return new P(u=a,l=0);if(e===1/0)return new P(u=2146435072|a,l=0);if(e!=e)return new P(u=2146959360,l=0);if(r=0,l=0,(t=S(e))>1)if(t<=T)(r=S(w(t)))<=20?(l=0,u=t<<20-r&1048575):(l=t%(n=C(2,i=r-20))<<32-i,u=t/n&1048575);else for(i=t,l=0;0!==(i=S(n=i/2));)r++,l>>>=1,l|=(1&u)<<31,u>>>=1,n!==i&&(u|=524288);if(o=r+b,s=0===t,t=e-t,r<52&&0!==t)for(i=0;;){if((n=2*t)>=1?(t=n-1,s?(o--,s=!1):(i<<=1,i|=1,r++)):(t=n,s?0==--o&&(r++,s=!1):(i<<=1,r++)),20===r)u|=i,i=0;else if(52===r){l|=i;break}if(1===n){r<20?u|=i<<20-r:r<52&&(l|=i<<52-r);break}}return u|=o<<20,new P(u|=a,l)},A.longBitsToDouble=function(e){var t,n,i,r,s=e.high,a=e.low,o=s&1<<31?-1:1;for(i=((2146435072&s)>>20)-b,r=0,n=1<<19,t=1;t<=20;t++)s&n&&(r+=C(2,-t)),n>>>=1;for(n=1<<31,t=21;t<=52;t++)a&n&&(r+=C(2,-t)),n>>>=1;if(-1023===i){if(0===r)return 0*o;i=-1022}else{if(1024===i)return 0===r?o/0:NaN;r+=1}return o*r*C(2,i)});var F=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({RuntimeException:i})[0],r}return c(i,e),a(i)}(_),j=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,null,[{key:"constructor_",value:function(){if(0===arguments.length)F.constructor_.call(this);else if(1===arguments.length){var e=arguments[0];F.constructor_.call(this,e)}}}])}(F),G=function(){function e(){n(this,e)}return a(e,null,[{key:"shouldNeverReachHere",value:function(){if(0===arguments.length)e.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new j("Should never reach here"+(null!==t?": "+t:""))}}},{key:"isTrue",value:function(){if(1===arguments.length){var t=arguments[0];e.isTrue(t,null)}else if(2===arguments.length){var n=arguments[1];if(!arguments[0])throw null===n?new j:new j(n)}}},{key:"equals",value:function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];e.equals(t,n,null)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];if(!r.equals(i))throw new j("Expected "+i+" but encountered "+r+(null!==s?": "+s:""))}}}])}(),z=new ArrayBuffer(8),q=new Float64Array(z),Y=new Int32Array(z),B=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getM",value:function(){return A.NaN}},{key:"setOrdinate",value:function(t,n){switch(t){case e.X:this.x=n;break;case e.Y:this.y=n;break;case e.Z:this.setZ(n);break;default:throw new x("Invalid ordinate index: "+t)}}},{key:"equals2D",value:function(){if(1===arguments.length){var e=arguments[0];return this.x===e.x&&this.y===e.y}if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!M.equalsWithTolerance(this.x,t.x,n)&&!!M.equalsWithTolerance(this.y,t.y,n)}}},{key:"setM",value:function(t){throw new x("Invalid ordinate index: "+e.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(t){switch(t){case e.X:return this.x;case e.Y:return this.y;case e.Z:return this.getZ()}throw new x("Invalid ordinate index: "+t)}},{key:"equals3D",value:function(e){return this.x===e.x&&this.y===e.y&&(this.getZ()===e.getZ()||A.isNaN(this.getZ())&&A.isNaN(e.getZ()))}},{key:"equals",value:function(t){return t instanceof e&&this.equals2D(t)}},{key:"equalInZ",value:function(e,t){return M.equalsWithTolerance(this.getZ(),e.getZ(),t)}},{key:"setX",value:function(e){this.x=e}},{key:"compareTo",value:function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(e){this.z=e}},{key:"clone",value:function(){try{return null}catch(e){if(e instanceof CloneNotSupportedException)return G.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw e}}},{key:"copy",value:function(){return new e(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.getZ()-e.getZ();return Math.sqrt(t*t+n*n+i*i)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(e){this.y=e}},{key:"distance",value:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)}},{key:"hashCode",value:function(){var t=17;return 37*(t=37*t+e.hashCode(this.x))+e.hashCode(this.y)}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ()}},{key:"interfaces_",get:function(){return[N,E,I]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)e.constructor_.call(this,0,0);else if(1===arguments.length){var t=arguments[0];e.constructor_.call(this,t.x,t.y,t.getZ())}else if(2===arguments.length){var n=arguments[0],i=arguments[1];e.constructor_.call(this,n,i,e.NULL_ORDINATE)}else if(3===arguments.length){var r=arguments[0],s=arguments[1],a=arguments[2];this.x=r,this.y=s,this.z=a}}},{key:"hashCode",value:function(e){return q[0]=e,Y[0]^Y[1]}}])}(),U=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"compare",value:function(t,n){var i=e.compare(t.x,n.x);if(0!==i)return i;var r=e.compare(t.y,n.y);return 0!==r?r:this._dimensionsToTest<=2?0:e.compare(t.getZ(),n.getZ())}},{key:"interfaces_",get:function(){return[D]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,0===arguments.length)e.constructor_.call(this,2);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new x("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}}},{key:"compare",value:function(e,t){return e<t?-1:e>t?1:A.isNaN(e)?A.isNaN(t)?0:-1:A.isNaN(t)?1:0}}])}();B.DimensionalComparator=U,B.NULL_ORDINATE=A.NaN,B.X=0,B.Y=1,B.Z=2,B.M=3;var X=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;return this.isNull()?n.isNull():this._maxx===n.getMaxX()&&this._maxy===n.getMaxY()&&this._minx===n.getMinX()&&this._miny===n.getMinY()}},{key:"intersection",value:function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new e;var n=this._minx>t._minx?this._minx:t._minx,i=this._miny>t._miny?this._miny:t._miny;return new e(n,this._maxx<t._maxx?this._maxx:t._maxx,i,this._maxy<t._maxy?this._maxy:t._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(1===arguments.length){if(arguments[0]instanceof B){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof e){var n=arguments[0];return!this.isNull()&&!n.isNull()&&n.getMinX()>=this._minx&&n.getMaxX()<=this._maxx&&n.getMinY()>=this._miny&&n.getMaxY()<=this._maxy}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return!this.isNull()&&i>=this._minx&&i<=this._maxx&&r>=this._miny&&r<=this._maxy}}},{key:"intersects",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof B){var n=arguments[0];return this.intersects(n.x,n.y)}}else if(2===arguments.length){if(arguments[0]instanceof B&&arguments[1]instanceof B){var i=arguments[0],r=arguments[1];return!(this.isNull()||(i.x<r.x?i.x:r.x)>this._maxx||(i.x>r.x?i.x:r.x)<this._minx||(i.y<r.y?i.y:r.y)>this._maxy||(i.y>r.y?i.y:r.y)<this._miny)}if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var s=arguments[0],a=arguments[1];return!this.isNull()&&!(s>this._maxx||s<this._minx||a>this._maxy||a<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return Math.sqrt(e*e+t*t)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(1===arguments.length){if(arguments[0]instanceof B){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];if(n.isNull())return null;this.isNull()?(this._minx=n.getMinX(),this._maxx=n.getMaxX(),this._miny=n.getMinY(),this._maxy=n.getMaxY()):(n._minx<this._minx&&(this._minx=n._minx),n._maxx>this._maxx&&(this._maxx=n._maxx),n._miny<this._miny&&(this._miny=n._miny),n._maxy>this._maxy&&(this._maxy=n._maxy))}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.isNull()?(this._minx=i,this._maxx=i,this._miny=r,this._maxy=r):(i<this._minx&&(this._minx=i),i>this._maxx&&(this._maxx=i),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0}},{key:"translate",value:function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)}},{key:"copy",value:function(){return new e(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(e){return!(!this.isNull()&&!e.isNull())||e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t}},{key:"expandBy",value:function(){if(1===arguments.length){var e=arguments[0];this.expandBy(e,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof B){var n=arguments[0];return this.covers(n)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return this.covers(i,r)}}},{key:"centre",value:function(){return this.isNull()?null:new B((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof B){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this._minx=n._minx,this._maxx=n._maxx,this._miny=n._miny,this._maxy=n._maxy}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(4===arguments.length){var s=arguments[0],a=arguments[1],o=arguments[2],u=arguments[3];s<a?(this._minx=s,this._maxx=a):(this._minx=a,this._maxx=s),o<u?(this._miny=o,this._maxy=u):(this._miny=u,this._maxy=o)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),0===t?n:0===n?t:Math.sqrt(t*t+n*n)}},{key:"hashCode",value:function(){var e=17;return 37*(e=37*(e=37*(e=37*e+B.hashCode(this._minx))+B.hashCode(this._maxx))+B.hashCode(this._miny))+B.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[N,I]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof B){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(4===arguments.length){var s=arguments[0],a=arguments[1],o=arguments[2],u=arguments[3];this.init(s,a,o,u)}}},{key:"intersects",value:function(){if(3===arguments.length){var e=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(e.x<t.x?e.x:t.x)&&n.x<=(e.x>t.x?e.x:t.x)&&n.y>=(e.y<t.y?e.y:t.y)&&n.y<=(e.y>t.y?e.y:t.y)}if(4===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2],a=arguments[3],o=Math.min(s.x,a.x),u=Math.max(s.x,a.x),l=Math.min(i.x,r.x),c=Math.max(i.x,r.x);return!(l>u||c<o||(o=Math.min(s.y,a.y),u=Math.max(s.y,a.y),l=Math.min(i.y,r.y),c=Math.max(i.y,r.y),l>u||c<o))}}}])}(),V=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===e.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(e){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(e){return this===e||this.equalsExact(e,0)}},{key:"geometryChanged",value:function(){this.apply(e.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(e){return null!==e&&this.norm().equalsExact(e.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var e;if(1===arguments.length){var t=arguments[0];return e=t,this.getTypeCode()!==e.getTypeCode()?this.getTypeCode()-e.getTypeCode():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return e=n,this.getTypeCode()!==e.getTypeCode()?this.getTypeCode()-e.getTypeCode():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(n,i)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(t){if(t.getTypeCode()===e.TYPECODE_GEOMETRYCOLLECTION)throw new x("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(e,t,n){return 0===n?e.equals(t):e.distance(t)<=n}},{key:"norm",value:function(){var e=this.copy();return e.normalize(),e}},{key:"reverse",value:function(){var e=this.reverseInternal();return null!=this.envelope&&(e.envelope=this.envelope.copy()),e.setSRID(this.getSRID()),e}},{key:"copy",value:function(){var e=this.copyInternal();return e.envelope=null==this._envelope?null:this._envelope.copy(),e._SRID=this._SRID,e._userData=this._userData,e}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new X(this._envelope)}},{key:"setSRID",value:function(e){this._SRID=e}},{key:"setUserData",value:function(e){this._userData=e}},{key:"compare",value:function(e,t){for(var n=e.iterator(),i=t.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),s=i.next(),a=r.compareTo(s);if(0!==a)return a}return n.hasNext()?1:i.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(e){return this.getClass()===e.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===e.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===e.TYPECODE_MULTIPOINT||this.getTypeCode()===e.TYPECODE_MULTILINESTRING||this.getTypeCode()===e.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[E,N,I]}},{key:"getClass",value:function(){return e}}],[{key:"hasNonEmptyElements",value:function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(e){for(var t=0;t<e.length;t++)if(null===e[t])return!0;return!1}}])}();V.constructor_=function(e){e&&(this._envelope=null,this._userData=null,this._factory=e,this._SRID=e.getSRID())},V.TYPECODE_POINT=0,V.TYPECODE_MULTIPOINT=1,V.TYPECODE_LINESTRING=2,V.TYPECODE_LINEARRING=3,V.TYPECODE_MULTILINESTRING=4,V.TYPECODE_POLYGON=5,V.TYPECODE_MULTIPOLYGON=6,V.TYPECODE_GEOMETRYCOLLECTION=7,V.TYPENAME_POINT="Point",V.TYPENAME_MULTIPOINT="MultiPoint",V.TYPENAME_LINESTRING="LineString",V.TYPENAME_LINEARRING="LinearRing",V.TYPENAME_MULTILINESTRING="MultiLineString",V.TYPENAME_POLYGON="Polygon",V.TYPENAME_MULTIPOLYGON="MultiPolygon",V.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",V.geometryChangedFilter={get interfaces_(){return[k]},filter:function(e){e.geometryChangedAction()}};var H=function(){function e(){n(this,e)}return a(e,null,[{key:"toLocationSymbol",value:function(t){switch(t){case e.EXTERIOR:return"e";case e.BOUNDARY:return"b";case e.INTERIOR:return"i";case e.NONE:return"-"}throw new x("Unknown location value: "+t)}}])}();H.INTERIOR=0,H.BOUNDARY=1,H.EXTERIOR=2,H.NONE=-1;var Z=a(function e(){n(this,e)},[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}]),W=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({NoSuchElementException:i})[0],r}return c(i,e),a(i)}(_),K=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({UnsupportedOperationException:i})[0],r}return c(i,e),a(i)}(_),J=function(e){function i(){return n(this,i),t(this,i,arguments)}return c(i,e),a(i,[{key:"contains",value:function(){}}])}(Z),Q=function(e){function i(e){var r;return n(this,i),(r=t(this,i)).map=new Map,e instanceof Z&&r.addAll(e),r}return c(i,e),a(i,[{key:"contains",value:function(e){var t=e.hashCode?e.hashCode():e;return!!this.map.has(t)}},{key:"add",value:function(e){var t=e.hashCode?e.hashCode():e;return!this.map.has(t)&&!!this.map.set(t,e)}},{key:"addAll",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.add(i)}}catch(e){n.e(e)}finally{n.f()}return!0}},{key:"remove",value:function(){throw new K}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return 0===this.map.size}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new $(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])}(J),$=a(function e(t){n(this,e),this.iterator=t.values();var i=this.iterator.next(),r=i.done,s=i.value;this.done=r,this.value=s},[{key:"next",value:function(){if(this.done)throw new W;var e=this.value,t=this.iterator.next(),n=t.done,i=t.value;return this.done=n,this.value=i,e}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new K}}]),ee=function(){function e(){n(this,e)}return a(e,null,[{key:"opposite",value:function(t){return t===e.LEFT?e.RIGHT:t===e.RIGHT?e.LEFT:t}}])}();ee.ON=0,ee.LEFT=1,ee.RIGHT=2;var te=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({EmptyStackException:i})[0],r}return c(i,e),a(i)}(_),ne=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({IndexOutOfBoundsException:i})[0],r}return c(i,e),a(i)}(_),ie=function(e){function i(){return n(this,i),t(this,i,arguments)}return c(i,e),a(i,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])}(Z),re=function(e){function i(){var e;return n(this,i),(e=t(this,i)).array=[],e}return c(i,e),a(i,[{key:"add",value:function(e){return this.array.push(e),!0}},{key:"get",value:function(e){if(e<0||e>=this.size())throw new ne;return this.array[e]}},{key:"push",value:function(e){return this.array.push(e),e}},{key:"pop",value:function(){if(0===this.array.length)throw new te;return this.array.pop()}},{key:"peek",value:function(){if(0===this.array.length)throw new te;return this.array[this.array.length-1]}},{key:"empty",value:function(){return 0===this.array.length}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(e){return this.array.indexOf(e)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])}(ie);function se(e,t){return e.interfaces_&&e.interfaces_.indexOf(t)>-1}var ae=a(function e(t){n(this,e),this.str=t},[{key:"append",value:function(e){this.str+=e}},{key:"setCharAt",value:function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)}},{key:"toString",value:function(){return this.str}}]),oe=function(){function e(t){n(this,e),this.value=t}return a(e,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(e){return this.value<e?-1:this.value>e?1:0}}],[{key:"compare",value:function(e,t){return e<t?-1:e>t?1:0}},{key:"isNan",value:function(e){return Number.isNaN(e)}},{key:"valueOf",value:function(t){return new e(t)}}])}(),ue=a(function e(){n(this,e)},null,[{key:"isWhitespace",value:function(e){return e<=32&&e>=0||127===e}},{key:"toUpperCase",value:function(e){return e.toUpperCase()}}]),le=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"le",value:function(e){return this._hi<e._hi||this._hi===e._hi&&this._lo<=e._lo}},{key:"extractSignificantDigits",value:function(t,n){var i=this.abs(),r=e.magnitude(i._hi),s=e.TEN.pow(r);(i=i.divide(s)).gt(e.TEN)?(i=i.divide(e.TEN),r+=1):i.lt(e.ONE)&&(i=i.multiply(e.TEN),r-=1);for(var a=r+1,o=new ae,u=e.MAX_PRINT_DIGITS-1,l=0;l<=u;l++){t&&l===a&&o.append(".");var c=Math.trunc(i._hi);if(c<0)break;var h=!1,f=0;c>9?(h=!0,f="9"):f="0"+c,o.append(f),i=i.subtract(e.valueOf(c)).multiply(e.TEN),h&&i.selfAdd(e.TEN);var d=!0,g=e.magnitude(i._hi);if(g<0&&Math.abs(g)>=u-l&&(d=!1),!d)break}return n[0]=r,o.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var n=arguments[0];return this.add(-n)}}},{key:"equals",value:function(){if(1===arguments.length&&arguments[0]instanceof e){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}}},{key:"isZero",value:function(){return 0===this._hi&&0===this._lo}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(e){return this.le(e)?this:e}},{key:"selfDivide",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var n=arguments[0];return this.selfDivide(n,0)}}else if(2===arguments.length){var i,r,s,a,o=arguments[0],u=arguments[1],l=null,c=null,h=null,f=null;return s=this._hi/o,f=(l=(h=e.SPLIT*s)-(l=h-s))*(c=(f=e.SPLIT*o)-(c=f-o))-(a=s*o)+l*(r=o-c)+(i=s-l)*c+i*r,f=s+(h=(this._hi-a-f+this._lo-s*u)/o),this._hi=f,this._lo=s-f+h,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof e){var t,n,i,r,s=arguments[0],a=null,o=null,u=null,l=null;return t=(i=this._hi/s._hi)-(a=(u=e.SPLIT*i)-(a=u-i)),l=a*(o=(l=e.SPLIT*s._hi)-(o=l-s._hi))-(r=i*s._hi)+a*(n=s._hi-o)+t*o+t*n,new e(l=i+(u=(this._hi-r-l+this._lo-i*s._lo)/s._hi),i-l+u)}if("number"==typeof arguments[0]){var c=arguments[0];return A.isNaN(c)?e.createNaN():e.copy(this).selfDivide(c,0)}}},{key:"ge",value:function(e){return this._hi>e._hi||this._hi===e._hi&&this._lo>=e._lo}},{key:"pow",value:function(t){if(0===t)return e.valueOf(1);var n=new e(this),i=e.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2==1&&i.selfMultiply(n),(r/=2)>0&&(n=n.sqr());else i=n;return t<0?i.reciprocal():i}},{key:"ceil",value:function(){if(this.isNaN())return e.NaN;var t=Math.ceil(this._hi),n=0;return t===this._hi&&(n=Math.ceil(this._lo)),new e(t,n)}},{key:"compareTo",value:function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var n=arguments[0];return this.init(n),this}}},{key:"max",value:function(e){return this.ge(e)?this:e}},{key:"sqrt",value:function(){if(this.isZero())return e.valueOf(0);if(this.isNegative())return e.NaN;var t=1/Math.sqrt(this._hi),n=this._hi*t,i=e.valueOf(n),r=this.subtract(i.sqr())._hi*(.5*t);return i.add(r)}},{key:"selfAdd",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var n,i,r,s,a,o=arguments[0],u=null;return u=(r=this._hi+o)-(s=r-this._hi),i=(a=(u=o-s+(this._hi-u))+this._lo)+(r-(n=r+a)),this._hi=n+i,this._lo=i+(n-this._hi),this}}else if(2===arguments.length){var l,c,h,f,d=arguments[0],g=arguments[1],v=null,y=null,p=null;h=this._hi+d,c=this._lo+g,y=h-(p=h-this._hi),v=c-(f=c-this._lo);var m=(l=h+(p=(y=d-p+(this._hi-y))+c))+(p=(v=g-f+(this._lo-v))+(p+(h-l))),_=p+(l-m);return this._hi=m,this._lo=_,this}}},{key:"selfMultiply",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var n=arguments[0];return this.selfMultiply(n,0)}}else if(2===arguments.length){var i,r,s=arguments[0],a=arguments[1],o=null,u=null,l=null,c=null;o=(l=e.SPLIT*this._hi)-this._hi,c=e.SPLIT*s,o=l-o,i=this._hi-o,u=c-s;var h=(l=this._hi*s)+(c=o*(u=c-u)-l+o*(r=s-u)+i*u+i*r+(this._hi*a+this._lo*s)),f=c+(o=l-h);return this._hi=h,this._lo=f,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return e.NaN;var t=Math.floor(this._hi),n=0;return t===this._hi&&(n=Math.floor(this._lo)),new e(t,n)}},{key:"negate",value:function(){return this.isNaN()?this:new e(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(e){if(e instanceof CloneNotSupportedException)return null;throw e}}},{key:"multiply",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return t.isNaN()?e.createNaN():e.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var n=arguments[0];return A.isNaN(n)?e.createNaN():e.copy(this).selfMultiply(n,0)}}},{key:"isNaN",value:function(){return A.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var t=e.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var t=this.getSpecialNumberString();if(null!==t)return t;var n=new Array(1).fill(null),i=this.extractSignificantDigits(!0,n),r=n[0]+1,s=i;if("."===i.charAt(0))s="0"+i;else if(r<0)s="0."+e.stringOfChar("0",-r)+i;else if(-1===i.indexOf(".")){var a=r-i.length;s=i+e.stringOfChar("0",a)+".0"}return this.isNegative()?"-"+s:s}},{key:"reciprocal",value:function(){var t,n,i,r,s=null,a=null,o=null,u=null;t=(i=1/this._hi)-(s=(o=e.SPLIT*i)-(s=o-i)),a=(u=e.SPLIT*this._hi)-this._hi;var l=i+(o=(1-(r=i*this._hi)-(u=s*(a=u-a)-r+s*(n=this._hi-a)+t*a+t*n)-i*this._lo)/this._hi);return new e(l,i-l+o)}},{key:"toSciNotation",value:function(){if(this.isZero())return e.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var n=new Array(1).fill(null),i=this.extractSignificantDigits(!1,n),r=e.SCI_NOT_EXPONENT_CHAR+n[0];if("0"===i.charAt(0))throw new IllegalStateException("Found leading zero: "+i);var s="";i.length>1&&(s=i.substring(1));var a=i.charAt(0)+"."+s;return this.isNegative()?"-"+a+r:a+r}},{key:"abs",value:function(){return this.isNaN()?e.NaN:this.isNegative()?this.negate():new e(this)}},{key:"isPositive",value:function(){return this._hi>0||0===this._hi&&this._lo>0}},{key:"lt",value:function(e){return this._hi<e._hi||this._hi===e._hi&&this._lo<e._lo}},{key:"add",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return e.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var n=arguments[0];return e.copy(this).selfAdd(n)}}},{key:"init",value:function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof e){var n=arguments[0];this._hi=n._hi,this._lo=n._lo}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this._hi=i,this._lo=r}}},{key:"gt",value:function(e){return this._hi>e._hi||this._hi===e._hi&&this._lo>e._lo}},{key:"isNegative",value:function(){return this._hi<0||0===this._hi&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?e.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[I,N,E]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}else if("string"==typeof arguments[0]){var i=arguments[0];e.constructor_.call(this,e.parse(i))}}else if(2===arguments.length){var r=arguments[0],s=arguments[1];this.init(r,s)}}},{key:"determinant",value:function(){if("number"==typeof arguments[3]&&"number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1],i=arguments[2],r=arguments[3];return e.determinant(e.valueOf(t),e.valueOf(n),e.valueOf(i),e.valueOf(r))}if(arguments[3]instanceof e&&arguments[2]instanceof e&&arguments[0]instanceof e&&arguments[1]instanceof e){var s=arguments[1],a=arguments[2],o=arguments[3];return arguments[0].multiply(o).selfSubtract(s.multiply(a))}}},{key:"sqr",value:function(t){return e.valueOf(t).selfMultiply(t)}},{key:"valueOf",value:function(){if("string"==typeof arguments[0]){var t=arguments[0];return e.parse(t)}if("number"==typeof arguments[0])return new e(arguments[0])}},{key:"sqrt",value:function(t){return e.valueOf(t).sqrt()}},{key:"parse",value:function(t){for(var n=0,i=t.length;ue.isWhitespace(t.charAt(n));)n++;var r=!1;if(n<i){var s=t.charAt(n);"-"!==s&&"+"!==s||(n++,"-"===s&&(r=!0))}for(var a=new e,o=0,u=0,l=0,c=!1;!(n>=i);){var h=t.charAt(n);if(n++,ue.isDigit(h)){var f=h-"0";a.selfMultiply(e.TEN),a.selfAdd(f),o++}else{if("."!==h){if("e"===h||"E"===h){var d=t.substring(n);try{l=oe.parseInt(d)}catch(e){throw e instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+d+" in string "+t):e}break}throw new NumberFormatException("Unexpected character '"+h+"' at position "+n+" in string "+t)}u=o,c=!0}}var g=a;c||(u=o);var v=o-u-l;if(0===v)g=a;else if(v>0){var y=e.TEN.pow(v);g=a.divide(y)}else if(v<0){var p=e.TEN.pow(-v);g=a.multiply(p)}return r?g.negate():g}},{key:"createNaN",value:function(){return new e(A.NaN,A.NaN)}},{key:"copy",value:function(t){return new e(t)}},{key:"magnitude",value:function(e){var t=Math.abs(e),n=Math.log(t)/Math.log(10),i=Math.trunc(Math.floor(n));return 10*Math.pow(10,i)<=t&&(i+=1),i}},{key:"stringOfChar",value:function(e,t){for(var n=new ae,i=0;i<t;i++)n.append(e);return n.toString()}}])}();le.PI=new le(3.141592653589793,12246467991473532e-32),le.TWO_PI=new le(6.283185307179586,24492935982947064e-32),le.PI_2=new le(1.5707963267948966,6123233995736766e-32),le.E=new le(2.718281828459045,14456468917292502e-32),le.NaN=new le(A.NaN,A.NaN),le.EPS=123259516440783e-46,le.SPLIT=134217729,le.MAX_PRINT_DIGITS=32,le.TEN=le.valueOf(10),le.ONE=le.valueOf(1),le.SCI_NOT_EXPONENT_CHAR="E",le.SCI_NOT_ZERO="0.0E0";var ce=function(){function e(){n(this,e)}return a(e,null,[{key:"orientationIndex",value:function(t,n,i){var r=e.orientationIndexFilter(t,n,i);if(r<=1)return r;var s=le.valueOf(n.x).selfAdd(-t.x),a=le.valueOf(n.y).selfAdd(-t.y),o=le.valueOf(i.x).selfAdd(-n.x),u=le.valueOf(i.y).selfAdd(-n.y);return s.selfMultiply(u).selfSubtract(a.selfMultiply(o)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof le&&arguments[2]instanceof le&&arguments[0]instanceof le&&arguments[1]instanceof le){var e=arguments[1],t=arguments[2],n=arguments[3];return arguments[0].multiply(n).selfSubtract(e.multiply(t)).signum()}if("number"==typeof arguments[3]&&"number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1],s=arguments[2],a=arguments[3],o=le.valueOf(i),u=le.valueOf(r),l=le.valueOf(s),c=le.valueOf(a);return o.multiply(c).selfSubtract(u.multiply(l)).signum()}}},{key:"intersection",value:function(e,t,n,i){var r=new le(e.y).selfSubtract(t.y),s=new le(t.x).selfSubtract(e.x),a=new le(e.x).selfMultiply(t.y).selfSubtract(new le(t.x).selfMultiply(e.y)),o=new le(n.y).selfSubtract(i.y),u=new le(i.x).selfSubtract(n.x),l=new le(n.x).selfMultiply(i.y).selfSubtract(new le(i.x).selfMultiply(n.y)),c=s.multiply(l).selfSubtract(u.multiply(a)),h=o.multiply(a).selfSubtract(r.multiply(l)),f=r.multiply(u).selfSubtract(o.multiply(s)),d=c.selfDivide(f).doubleValue(),g=h.selfDivide(f).doubleValue();return A.isNaN(d)||A.isInfinite(d)||A.isNaN(g)||A.isInfinite(g)?null:new B(d,g)}},{key:"orientationIndexFilter",value:function(t,n,i){var r=null,s=(t.x-i.x)*(n.y-i.y),a=(t.y-i.y)*(n.x-i.x),o=s-a;if(s>0){if(a<=0)return e.signum(o);r=s+a}else{if(!(s<0))return e.signum(o);if(a>=0)return e.signum(o);r=-s-a}var u=e.DP_SAFE_EPSILON*r;return o>=u||-o>=u?e.signum(o):2}},{key:"signum",value:function(e){return e>0?1:e<0?-1:0}}])}();ce.DP_SAFE_EPSILON=1e-15;var he=a(function e(){n(this,e)},[{key:"getM",value:function(e){if(this.hasM()){var t=this.getDimension()-this.getMeasures();return this.getOrdinate(e,t)}return A.NaN}},{key:"setOrdinate",value:function(e,t,n){}},{key:"getZ",value:function(e){return this.hasZ()?this.getOrdinate(e,2):A.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(e,t){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(e){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(e){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(e){}},{key:"copy",value:function(){}},{key:"getY",value:function(e){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[E]}}]);he.X=0,he.Y=1,he.Z=2,he.M=3;var fe=function(){function e(){n(this,e)}return a(e,null,[{key:"index",value:function(e,t,n){return ce.orientationIndex(e,t,n)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var t=arguments[0],n=t.length-1;if(n<3)throw new x("Ring has fewer than 4 points, so orientation cannot be determined");for(var i=t[0],r=0,s=1;s<=n;s++){var a=t[s];a.y>i.y&&(i=a,r=s)}var o=r;do{(o-=1)<0&&(o=n)}while(t[o].equals2D(i)&&o!==r);var u=r;do{u=(u+1)%n}while(t[u].equals2D(i)&&u!==r);var l=t[o],c=t[u];if(l.equals2D(i)||c.equals2D(i)||l.equals2D(c))return!1;var h=e.index(l,i,c);return 0===h?l.x>c.x:h>0}if(se(arguments[0],he)){var f=arguments[0],d=f.size()-1;if(d<3)throw new x("Ring has fewer than 4 points, so orientation cannot be determined");for(var g=f.getCoordinate(0),v=0,y=1;y<=d;y++){var p=f.getCoordinate(y);p.y>g.y&&(g=p,v=y)}var m=null,_=v;do{(_-=1)<0&&(_=d),m=f.getCoordinate(_)}while(m.equals2D(g)&&_!==v);var k=null,N=v;do{N=(N+1)%d,k=f.getCoordinate(N)}while(k.equals2D(g)&&N!==v);if(m.equals2D(g)||k.equals2D(g)||m.equals2D(k))return!1;var E=e.index(m,g,k);return 0===E?m.x>k.x:E>0}}}])}();fe.CLOCKWISE=-1,fe.RIGHT=fe.CLOCKWISE,fe.COUNTERCLOCKWISE=1,fe.LEFT=fe.COUNTERCLOCKWISE,fe.COLLINEAR=0,fe.STRAIGHT=fe.COLLINEAR;var de=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(e,t){var n=this.getRightmostSideOfSegment(e,t);return n<0&&(n=this.getRightmostSideOfSegment(e,t-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),n}},{key:"findRightmostEdgeAtVertex",value:function(){var e=this._minDe.getEdge().getCoordinates();G.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],n=e[this._minIndex+1],i=fe.index(this._minCoord,n,t),r=!1;(t.y<this._minCoord.y&&n.y<this._minCoord.y&&i===fe.COUNTERCLOCKWISE||t.y>this._minCoord.y&&n.y>this._minCoord.y&&i===fe.CLOCKWISE)&&(r=!0),r&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(e,t){var n=e.getEdge().getCoordinates();if(t<0||t+1>=n.length)return-1;if(n[t].y===n[t+1].y)return-1;var i=ee.LEFT;return n[t].y<n[t+1].y&&(i=ee.RIGHT),i}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(e){for(var t=e.getEdge().getCoordinates(),n=0;n<t.length-1;n++)(null===this._minCoord||t[n].x>this._minCoord.x)&&(this._minDe=e,this._minIndex=n,this._minCoord=t[n])}},{key:"findRightmostEdgeAtNode",value:function(){var e=this._minDe.getNode().getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();n.isForward()&&this.checkForRightmostCoordinate(n)}G.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===ee.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}]),ge=function(e){function i(e,r){var s;return n(this,i),(s=t(this,i,[r?e+" [ "+r+" ]":e])).pt=r?new B(r):void 0,s.name=Object.keys({TopologyException:i})[0],s}return c(i,e),a(i,[{key:"getCoordinate",value:function(){return this.pt}}])}(F),ve=a(function e(){n(this,e),this.array=[]},[{key:"addLast",value:function(e){this.array.push(e)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return 0===this.array.length}}]),ye=function(e){function i(e){var r;return n(this,i),(r=t(this,i)).array=[],e instanceof Z&&r.addAll(e),r}return c(i,e),a(i,[{key:"interfaces_",get:function(){return[ie,Z]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(e){return 1===arguments.length?this.array.push(e):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.array.push(i)}}catch(e){n.e(e)}finally{n.f()}}},{key:"set",value:function(e,t){var n=this.array[e];return this.array[e]=t,n}},{key:"iterator",value:function(){return new pe(this)}},{key:"get",value:function(e){if(e<0||e>=this.size())throw new ne;return this.array[e]}},{key:"isEmpty",value:function(){return 0===this.array.length}},{key:"sort",value:function(e){e?this.array.sort(function(t,n){return e.compare(t,n)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(e){for(var t=0,n=this.array.length;t<n;t++)if(this.array[t]===e)return!!this.array.splice(t,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])}(ie),pe=a(function e(t){n(this,e),this.arrayList=t,this.position=0},[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new W;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(e){return this.arrayList.set(this.position-1,e)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}]),me=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"clearVisitedEdges",value:function(){for(var e=this._dirEdgeList.iterator();e.hasNext();)e.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(e){for(var t=null,n=e.getEdges().iterator();n.hasNext();){var i=n.next();if(i.isVisited()||i.getSym().isVisited()){t=i;break}}if(null===t)throw new ge("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(t);for(var r=e.getEdges().iterator();r.hasNext();){var s=r.next();s.setVisited(!0),this.copySymDepths(s)}}},{key:"computeDepth",value:function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.getNode(),t.getLabel(),t.setEdgeDepths(ee.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)}},{key:"create",value:function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(ee.RIGHT)>=1&&t.getDepth(ee.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}}},{key:"computeDepths",value:function(e){var t=new Q,n=new ve,i=e.getNode();for(n.addLast(i),t.add(i),e.setVisited(!0);!n.isEmpty();){var r=n.removeFirst();t.add(r),this.computeNodeDepth(r);for(var s=r.getEdges().iterator();s.hasNext();){var a=s.next().getSym();if(!a.isVisited()){var o=a.getNode();t.contains(o)||(n.addLast(o),t.add(o))}}}}},{key:"compareTo",value:function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(null===this._env){for(var e=new X,t=this._dirEdgeList.iterator();t.hasNext();)for(var n=t.next().getEdge().getCoordinates(),i=0;i<n.length-1;i++)e.expandToInclude(n[i]);this._env=e}return this._env}},{key:"addReachable",value:function(e){var t=new re;for(t.add(e);!t.empty();){var n=t.pop();this.add(n,t)}}},{key:"copySymDepths",value:function(e){var t=e.getSym();t.setDepth(ee.LEFT,e.getDepth(ee.RIGHT)),t.setDepth(ee.RIGHT,e.getDepth(ee.LEFT))}},{key:"add",value:function(e,t){e.setVisited(!0),this._nodes.add(e);for(var n=e.getEdges().iterator();n.hasNext();){var i=n.next();this._dirEdgeList.add(i);var r=i.getSym().getNode();r.isVisited()||t.push(r)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[N]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new ye,this._nodes=new ye,this._rightMostCoord=null,this._env=null,this._finder=new de}}]),_e=a(function e(){n(this,e)},null,[{key:"intersection",value:function(e,t,n,i){var r=e.x<t.x?e.x:t.x,s=e.y<t.y?e.y:t.y,a=e.x>t.x?e.x:t.x,o=e.y>t.y?e.y:t.y,u=n.x<i.x?n.x:i.x,l=n.y<i.y?n.y:i.y,c=n.x>i.x?n.x:i.x,h=n.y>i.y?n.y:i.y,f=((r>u?r:u)+(a<c?a:c))/2,d=((s>l?s:l)+(o<h?o:h))/2,g=e.x-f,v=e.y-d,y=t.x-f,p=t.y-d,m=n.x-f,_=n.y-d,x=i.x-f,k=i.y-d,N=v-p,E=y-g,I=g*p-y*v,b=_-k,w=x-m,S=m*k-x*_,C=N*w-b*E,T=(E*S-w*I)/C,L=(b*I-N*S)/C;return A.isNaN(T)||A.isInfinite(T)||A.isNaN(L)||A.isInfinite(L)?null:new B(T+f,L+d)}}]),xe=a(function e(){n(this,e)},null,[{key:"arraycopy",value:function(e,t,n,i,r){for(var s=0,a=t;a<t+r;a++)n[i+s]=e[a],s++}},{key:"getProperty",value:function(e){return{"line.separator":"\n"}[e]}}]),ke=function(){function e(){n(this,e)}return a(e,null,[{key:"log10",value:function(t){var n=Math.log(t);return A.isInfinite(n)||A.isNaN(n)?n:n/e.LOG_10}},{key:"min",value:function(e,t,n,i){var r=e;return t<r&&(r=t),n<r&&(r=n),i<r&&(r=i),r}},{key:"clamp",value:function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],t=arguments[1],n=arguments[2];return e<t?t:e>n?n:e}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],s=arguments[2];return i<r?r:i>s?s:i}}},{key:"wrap",value:function(e,t){return e<0?t- -e%t:e%t}},{key:"max",value:function(){if(3===arguments.length){var e=arguments[1],t=arguments[2],n=arguments[0];return e>n&&(n=e),t>n&&(n=t),n}if(4===arguments.length){var i=arguments[1],r=arguments[2],s=arguments[3],a=arguments[0];return i>a&&(a=i),r>a&&(a=r),s>a&&(a=s),a}}},{key:"average",value:function(e,t){return(e+t)/2}}])}();ke.LOG_10=Math.log(10);var Ne=function(){function e(){n(this,e)}return a(e,null,[{key:"segmentToSegment",value:function(t,n,i,r){if(t.equals(n))return e.pointToSegment(t,i,r);if(i.equals(r))return e.pointToSegment(r,t,n);var s=!1;if(X.intersects(t,n,i,r)){var a=(n.x-t.x)*(r.y-i.y)-(n.y-t.y)*(r.x-i.x);if(0===a)s=!0;else{var o=(t.y-i.y)*(r.x-i.x)-(t.x-i.x)*(r.y-i.y),u=((t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y))/a,l=o/a;(l<0||l>1||u<0||u>1)&&(s=!0)}}else s=!0;return s?ke.min(e.pointToSegment(t,i,r),e.pointToSegment(n,i,r),e.pointToSegment(i,t,n),e.pointToSegment(r,t,n)):0}},{key:"pointToSegment",value:function(e,t,n){if(t.x===n.x&&t.y===n.y)return e.distance(t);var i=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;if(r<=0)return e.distance(t);if(r>=1)return e.distance(n);var s=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/i;return Math.abs(s)*Math.sqrt(i)}},{key:"pointToLinePerpendicular",value:function(e,t,n){var i=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),r=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/i;return Math.abs(r)*Math.sqrt(i)}},{key:"pointToSegmentString",value:function(t,n){if(0===n.length)throw new x("Line array must contain at least one vertex");for(var i=t.distance(n[0]),r=0;r<n.length-1;r++){var s=e.pointToSegment(t,n[r],n[r+1]);s<i&&(i=s)}return i}}])}(),Ee=a(function e(){n(this,e)},[{key:"create",value:function(){if(1===arguments.length)arguments[0]instanceof Array||se(arguments[0],he);else if(2===arguments.length);else if(3===arguments.length){var e=arguments[0],t=arguments[1];return this.create(e,t)}}}]),Ie=a(function e(){n(this,e)},[{key:"filter",value:function(e){}}]),be=a(function e(){n(this,e)},null,[{key:"ofLine",value:function(e){var t=e.size();if(t<=1)return 0;var n=0,i=new B;e.getCoordinate(0,i);for(var r=i.x,s=i.y,a=1;a<t;a++){e.getCoordinate(a,i);var o=i.x,u=i.y,l=o-r,c=u-s;n+=Math.sqrt(l*l+c*c),r=o,s=u}return n}}]),we=a(function e(){n(this,e)}),Se=function(){function e(){n(this,e)}return a(e,null,[{key:"copyCoord",value:function(e,t,n,i){for(var r=Math.min(e.getDimension(),n.getDimension()),s=0;s<r;s++)n.setOrdinate(i,s,e.getOrdinate(t,s))}},{key:"isRing",value:function(e){var t=e.size();return 0===t||!(t<=3)&&e.getOrdinate(0,he.X)===e.getOrdinate(t-1,he.X)&&e.getOrdinate(0,he.Y)===e.getOrdinate(t-1,he.Y)}},{key:"scroll",value:function(){if(2===arguments.length){if(se(arguments[0],he)&&Number.isInteger(arguments[1])){var t=arguments[0],n=arguments[1];e.scroll(t,n,e.isRing(t))}else if(se(arguments[0],he)&&arguments[1]instanceof B){var i=arguments[0],r=arguments[1],s=e.indexOf(r,i);if(s<=0)return null;e.scroll(i,s)}}else if(3===arguments.length){var a=arguments[0],o=arguments[1],u=arguments[2];if(o<=0)return null;for(var l=a.copy(),c=u?a.size()-1:a.size(),h=0;h<c;h++)for(var f=0;f<a.getDimension();f++)a.setOrdinate(h,f,l.getOrdinate((o+h)%c,f));if(u)for(var d=0;d<a.getDimension();d++)a.setOrdinate(c,d,a.getOrdinate(0,d))}}},{key:"isEqual",value:function(e,t){var n=e.size();if(n!==t.size())return!1;for(var i=Math.min(e.getDimension(),t.getDimension()),r=0;r<n;r++)for(var s=0;s<i;s++){var a=e.getOrdinate(r,s),o=t.getOrdinate(r,s);if(!(e.getOrdinate(r,s)===t.getOrdinate(r,s)||A.isNaN(a)&&A.isNaN(o)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(1===arguments.length){var t=arguments[0];return e.minCoordinateIndex(t,0,t.size()-1)}if(3===arguments.length){for(var n=arguments[0],i=arguments[2],r=-1,s=null,a=arguments[1];a<=i;a++){var o=n.getCoordinate(a);(null===s||s.compareTo(o)>0)&&(s=o,r=a)}return r}}},{key:"extend",value:function(t,n,i){var r=t.create(i,n.getDimension()),s=n.size();if(e.copy(n,0,r,0,s),s>0)for(var a=s;a<i;a++)e.copy(n,s-1,r,a,1);return r}},{key:"reverse",value:function(t){for(var n=t.size()-1,i=Math.trunc(n/2),r=0;r<=i;r++)e.swap(t,r,n-r)}},{key:"swap",value:function(e,t,n){if(t===n)return null;for(var i=0;i<e.getDimension();i++){var r=e.getOrdinate(t,i);e.setOrdinate(t,i,e.getOrdinate(n,i)),e.setOrdinate(n,i,r)}}},{key:"copy",value:function(t,n,i,r,s){for(var a=0;a<s;a++)e.copyCoord(t,n+a,i,r+a)}},{key:"ensureValidRing",value:function(t,n){var i=n.size();return 0===i?n:i<=3?e.createClosedRing(t,n,4):n.getOrdinate(0,he.X)===n.getOrdinate(i-1,he.X)&&n.getOrdinate(0,he.Y)===n.getOrdinate(i-1,he.Y)?n:e.createClosedRing(t,n,i+1)}},{key:"indexOf",value:function(e,t){for(var n=0;n<t.size();n++)if(e.x===t.getOrdinate(n,he.X)&&e.y===t.getOrdinate(n,he.Y))return n;return-1}},{key:"createClosedRing",value:function(t,n,i){var r=t.create(i,n.getDimension()),s=n.size();e.copy(n,0,r,0,s);for(var a=s;a<i;a++)e.copy(n,0,r,a,1);return r}},{key:"minCoordinate",value:function(e){for(var t=null,n=0;n<e.size();n++){var i=e.getCoordinate(n);(null===t||t.compareTo(i)>0)&&(t=i)}return t}}])}(),Ce=function(){function e(){n(this,e)}return a(e,null,[{key:"toDimensionSymbol",value:function(t){switch(t){case e.FALSE:return e.SYM_FALSE;case e.TRUE:return e.SYM_TRUE;case e.DONTCARE:return e.SYM_DONTCARE;case e.P:return e.SYM_P;case e.L:return e.SYM_L;case e.A:return e.SYM_A}throw new x("Unknown dimension value: "+t)}},{key:"toDimensionValue",value:function(t){switch(ue.toUpperCase(t)){case e.SYM_FALSE:return e.FALSE;case e.SYM_TRUE:return e.TRUE;case e.SYM_DONTCARE:return e.DONTCARE;case e.SYM_P:return e.P;case e.SYM_L:return e.L;case e.SYM_A:return e.A}throw new x("Unknown dimension symbol: "+t)}}])}();Ce.P=0,Ce.L=1,Ce.A=2,Ce.FALSE=-1,Ce.TRUE=-2,Ce.DONTCARE=-3,Ce.SYM_FALSE="F",Ce.SYM_TRUE="T",Ce.SYM_DONTCARE="*",Ce.SYM_P="0",Ce.SYM_L="1",Ce.SYM_A="2";var Te=a(function e(){n(this,e)},[{key:"filter",value:function(e){}}]),Le=a(function e(){n(this,e)},[{key:"filter",value:function(e,t){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}]),Re=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new X:this._points.expandEnvelope(new X)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new i(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof V){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e;if(this._points.size()!==n._points.size())return!1;for(var r=0;r<this._points.size();r++)if(!this.equal(this._points.getCoordinate(r),n._points.getCoordinate(r),t))return!1;return!0}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var e=0;e<Math.trunc(this._points.size()/2);e++){var t=this._points.size()-1-e;if(!this._points.getCoordinate(e).equals(this._points.getCoordinate(t))){if(this._points.getCoordinate(e).compareTo(this._points.getCoordinate(t))>0){var n=this._points.copy();Se.reverse(n),this._points=n}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Ce.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var e=this._points.copy();return Se.reverse(e),this.getFactory().createLineString(e)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return V.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return be.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(1===arguments.length){for(var e=arguments[0],t=0,n=0;t<this._points.size()&&n<e._points.size();){var i=this._points.getCoordinate(t).compareTo(e._points.getCoordinate(n));if(0!==i)return i;t++,n++}return t<this._points.size()?1:n<e._points.size()?-1:0}if(2===arguments.length){var r=arguments[0];return arguments[1].compare(this._points,r._points)}}},{key:"apply",value:function(){if(se(arguments[0],Ie))for(var e=arguments[0],t=0;t<this._points.size();t++)e.filter(this._points.getCoordinate(t));else if(se(arguments[0],Le)){var n=arguments[0];if(0===this._points.size())return null;for(var i=0;i<this._points.size()&&(n.filter(this._points,i),!n.isDone());i++);n.isGeometryChanged()&&this.geometryChanged()}else(se(arguments[0],Te)||se(arguments[0],k))&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new K}},{key:"isEquivalentClass",value:function(e){return e instanceof i}},{key:"getCoordinateN",value:function(e){return this._points.getCoordinate(e)}},{key:"getGeometryType",value:function(){return V.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return 0===this._points.size()}},{key:"init",value:function(e){if(null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),1===e.size())throw new x("Invalid number of points in LineString (found "+e.size()+" - must be 0 or >= 2)");this._points=e}},{key:"isCoordinate",value:function(e){for(var t=0;t<this._points.size();t++)if(this._points.getCoordinate(t).equals(e))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(e){return this.getFactory().createPoint(this._points.getCoordinate(e))}},{key:"interfaces_",get:function(){return[we]}}],[{key:"constructor_",value:function(){if(this._points=null,0===arguments.length);else if(2===arguments.length){var e=arguments[0],t=arguments[1];V.constructor_.call(this,t),this.init(e)}}}])}(V),Oe=a(function e(){n(this,e)}),Me=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new X;var e=new X;return e.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),e}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new i(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof V){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),t))}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return Ce.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return V.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(null===this.getCoordinate())throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(1===arguments.length){var e=arguments[0];return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var t=arguments[0];return arguments[1].compare(this._coordinates,t._coordinates)}}},{key:"apply",value:function(){if(se(arguments[0],Ie)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this.getCoordinate())}else if(se(arguments[0],Le)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this._coordinates,0),t.isGeometryChanged()&&this.geometryChanged()}else(se(arguments[0],Te)||se(arguments[0],k))&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return V.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(null===this.getCoordinate())throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return 0===this._coordinates.size()}},{key:"init",value:function(e){null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),G.isTrue(e.size()<=1),this._coordinates=e}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Oe]}}],[{key:"constructor_",value:function(){this._coordinates=null;var e=arguments[0],t=arguments[1];V.constructor_.call(this,t),this.init(e)}}])}(V),Pe=function(){function e(){n(this,e)}return a(e,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var t=arguments[0];return Math.abs(e.ofRingSigned(t))}if(se(arguments[0],he)){var n=arguments[0];return Math.abs(e.ofRingSigned(n))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,n=e[0].x,i=1;i<e.length-1;i++){var r=e[i].x-n,s=e[i+1].y;t+=r*(e[i-1].y-s)}return t/2}if(se(arguments[0],he)){var a=arguments[0],o=a.size();if(o<3)return 0;var u=new B,l=new B,c=new B;a.getCoordinate(0,l),a.getCoordinate(1,c);var h=l.x;c.x-=h;for(var f=0,d=1;d<o-1;d++)u.y=l.y,l.x=c.x,l.y=c.y,a.getCoordinate(d+1,c),c.x-=h,f+=l.x*(u.y-c.y);return f/2}}}])}(),Ae=a(function e(){n(this,e)},null,[{key:"sort",value:function(){var e=arguments,t=arguments[0];if(1===arguments.length)t.sort(function(e,t){return e.compareTo(t)});else if(2===arguments.length)t.sort(function(t,n){return e[1].compare(t,n)});else if(3===arguments.length){var n=t.slice(arguments[1],arguments[2]);n.sort();var i=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length));t.splice(0,t.length);var r,s=o(i);try{for(s.s();!(r=s.n()).done;){var a=r.value;t.push(a)}}catch(e){s.e(e)}finally{s.f()}}else if(4===arguments.length){var u=t.slice(arguments[1],arguments[2]);u.sort(function(t,n){return e[3].compare(t,n)});var l=t.slice(0,arguments[1]).concat(u,t.slice(arguments[2],t.length));t.splice(0,t.length);var c,h=o(l);try{for(h.s();!(c=h.n()).done;){var f=c.value;t.push(f)}}catch(e){h.e(e)}finally{h.f()}}}},{key:"asList",value:function(e){var t,n=new ye,i=o(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n.add(r)}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"copyOf",value:function(e,t){return e.slice(0,t)}}]),De=a(function e(){n(this,e)}),Fe=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var e=new Array(this.getNumPoints()).fill(null),t=-1,n=this._shell.getCoordinates(),i=0;i<n.length;i++)e[++t]=n[i];for(var r=0;r<this._holes.length;r++)for(var s=this._holes[r].getCoordinates(),a=0;a<s.length;a++)e[++t]=s[a];return e}},{key:"getArea",value:function(){var e=0;e+=Pe.ofRing(this._shell.getCoordinateSequence());for(var t=0;t<this._holes.length;t++)e-=Pe.ofRing(this._holes[t].getCoordinateSequence());return e}},{key:"copyInternal",value:function(){for(var e=this._shell.copy(),t=new Array(this._holes.length).fill(null),n=0;n<this._holes.length;n++)t[n]=this._holes[n].copy();return new i(e,t,this._factory)}},{key:"isRectangle",value:function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var e=this._shell.getCoordinateSequence(),t=this.getEnvelopeInternal(),n=0;n<5;n++){var i=e.getX(n);if(i!==t.getMinX()&&i!==t.getMaxX())return!1;var r=e.getY(n);if(r!==t.getMinY()&&r!==t.getMaxY())return!1}for(var s=e.getX(0),a=e.getY(0),o=1;o<=4;o++){var u=e.getX(o),l=e.getY(o);if(u!==s==(l!==a))return!1;s=u,a=l}return!0}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof V){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e,r=this._shell,s=n._shell;if(!r.equalsExact(s,t))return!1;if(this._holes.length!==n._holes.length)return!1;for(var a=0;a<this._holes.length;a++)if(!this._holes[a].equalsExact(n._holes[a],t))return!1;return!0}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(0===arguments.length){this._shell=this.normalized(this._shell,!0);for(var e=0;e<this._holes.length;e++)this._holes[e]=this.normalized(this._holes[e],!1);Ae.sort(this._holes)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(t.isEmpty())return null;var i=t.getCoordinateSequence(),r=Se.minCoordinateIndex(i,0,i.size()-2);Se.scroll(i,r,!0),fe.isCCW(i)===n&&Se.reverse(i)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var e=this.getExteriorRing().reverse(),t=new Array(this.getNumInteriorRing()).fill(null),n=0;n<t.length;n++)t[n]=this.getInteriorRingN(n).reverse();return this.getFactory().createPolygon(e,t)}},{key:"getTypeCode",value:function(){return V.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var e=0;e+=this._shell.getLength();for(var t=0;t<this._holes.length;t++)e+=this._holes[t].getLength();return e}},{key:"getNumPoints",value:function(){for(var e=this._shell.getNumPoints(),t=0;t<this._holes.length;t++)e+=this._holes[t].getNumPoints();return e}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(e,t){var n=e.copy();return this.normalize(n,t),n}},{key:"compareToSameClass",value:function(){if(1===arguments.length){var e=arguments[0],t=this._shell,n=e._shell;return t.compareToSameClass(n)}if(2===arguments.length){var i=arguments[1],r=arguments[0],s=this._shell,a=r._shell,o=s.compareToSameClass(a,i);if(0!==o)return o;for(var u=this.getNumInteriorRing(),l=r.getNumInteriorRing(),c=0;c<u&&c<l;){var h=this.getInteriorRingN(c),f=r.getInteriorRingN(c),d=h.compareToSameClass(f,i);if(0!==d)return d;c++}return c<u?1:c<l?-1:0}}},{key:"apply",value:function(){if(se(arguments[0],Ie)){var e=arguments[0];this._shell.apply(e);for(var t=0;t<this._holes.length;t++)this._holes[t].apply(e)}else if(se(arguments[0],Le)){var n=arguments[0];if(this._shell.apply(n),!n.isDone())for(var i=0;i<this._holes.length&&(this._holes[i].apply(n),!n.isDone());i++);n.isGeometryChanged()&&this.geometryChanged()}else if(se(arguments[0],Te))arguments[0].filter(this);else if(se(arguments[0],k)){var r=arguments[0];r.filter(this),this._shell.apply(r);for(var s=0;s<this._holes.length;s++)this._holes[s].apply(r)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var e=new Array(this._holes.length+1).fill(null);e[0]=this._shell;for(var t=0;t<this._holes.length;t++)e[t+1]=this._holes[t];return e.length<=1?this.getFactory().createLinearRing(e[0].getCoordinateSequence()):this.getFactory().createMultiLineString(e)}},{key:"getGeometryType",value:function(){return V.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(e){return this._holes[e]}},{key:"interfaces_",get:function(){return[De]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(V.constructor_.call(this,n),null===e&&(e=this.getFactory().createLinearRing()),null===t&&(t=[]),V.hasNullElements(t))throw new x("holes must not contain null elements");if(e.isEmpty()&&V.hasNonEmptyElements(t))throw new x("shell is empty but holes are not");this._shell=e,this._holes=t}}])}(V),je=function(e){function i(){return n(this,i),t(this,i,arguments)}return c(i,e),a(i)}(J),Ge=function(e){function i(e){var r;return n(this,i),(r=t(this,i)).array=[],e instanceof Z&&r.addAll(e),r}return c(i,e),a(i,[{key:"contains",value:function(e){var t,n=o(this.array);try{for(n.s();!(t=n.n()).done;)if(0===t.value.compareTo(e))return!0}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"add",value:function(e){if(this.contains(e))return!1;for(var t=0,n=this.array.length;t<n;t++)if(1===this.array[t].compareTo(e))return!!this.array.splice(t,0,e);return this.array.push(e),!0}},{key:"addAll",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.add(i)}}catch(e){n.e(e)}finally{n.f()}return!0}},{key:"remove",value:function(){throw new K}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return 0===this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new ze(this.array)}}])}(je),ze=a(function e(t){n(this,e),this.array=t,this.position=0},[{key:"next",value:function(){if(this.position===this.array.length)throw new W;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new K}}]),qe=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"computeEnvelopeInternal",value:function(){for(var e=new X,t=0;t<this._geometries.length;t++)e.expandToInclude(this._geometries[t].getEnvelopeInternal());return e}},{key:"getGeometryN",value:function(e){return this._geometries[e]}},{key:"getCoordinates",value:function(){for(var e=new Array(this.getNumPoints()).fill(null),t=-1,n=0;n<this._geometries.length;n++)for(var i=this._geometries[n].getCoordinates(),r=0;r<i.length;r++)e[++t]=i[r];return e}},{key:"getArea",value:function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getArea();return e}},{key:"copyInternal",value:function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new i(e,this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof V){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e;if(this._geometries.length!==n._geometries.length)return!1;for(var r=0;r<this._geometries.length;r++)if(!this._geometries[r].equalsExact(n._geometries[r],t))return!1;return!0}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var e=0;e<this._geometries.length;e++)this._geometries[e].normalize();Ae.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var e=Ce.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getBoundaryDimension());return e}},{key:"reverseInternal",value:function(){for(var e=this._geometries.length,t=new ye(e),n=0;n<e;n++)t.add(this._geometries[n].reverse());return this.getFactory().buildGeometry(t)}},{key:"getTypeCode",value:function(){return V.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var e=Ce.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getDimension());return e}},{key:"getLength",value:function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getLength();return e}},{key:"getNumPoints",value:function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getNumPoints();return e}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(1===arguments.length){var e=arguments[0],t=new Ge(Ae.asList(this._geometries)),n=new Ge(Ae.asList(e._geometries));return this.compare(t,n)}if(2===arguments.length){for(var i=arguments[1],r=arguments[0],s=this.getNumGeometries(),a=r.getNumGeometries(),o=0;o<s&&o<a;){var u=this.getGeometryN(o),l=r.getGeometryN(o),c=u.compareToSameClass(l,i);if(0!==c)return c;o++}return o<s?1:o<a?-1:0}}},{key:"apply",value:function(){if(se(arguments[0],Ie))for(var e=arguments[0],t=0;t<this._geometries.length;t++)this._geometries[t].apply(e);else if(se(arguments[0],Le)){var n=arguments[0];if(0===this._geometries.length)return null;for(var i=0;i<this._geometries.length&&(this._geometries[i].apply(n),!n.isDone());i++);n.isGeometryChanged()&&this.geometryChanged()}else if(se(arguments[0],Te)){var r=arguments[0];r.filter(this);for(var s=0;s<this._geometries.length;s++)this._geometries[s].apply(r)}else if(se(arguments[0],k)){var a=arguments[0];a.filter(this);for(var o=0;o<this._geometries.length;o++)this._geometries[o].apply(a)}}},{key:"getBoundary",value:function(){return V.checkNotGeometryCollection(this),G.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return V.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,0===arguments.length);else if(2===arguments.length){var e=arguments[0],t=arguments[1];if(V.constructor_.call(this,t),null===e&&(e=[]),V.hasNullElements(e))throw new x("geometries must not contain null elements");this._geometries=e}}}])}(V),Ye=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"copyInternal",value:function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new i(e,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof V){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&d(i,"equalsExact",this,1).call(this,e,t)}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(1===arguments.length&&Number.isInteger(arguments[0])){var e=arguments[0];return this._geometries[e].getCoordinate()}return d(i,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return Ce.FALSE}},{key:"getTypeCode",value:function(){return V.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return V.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Oe]}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];qe.constructor_.call(this,e,t)}}])}(qe),Be=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"copyInternal",value:function(){return new i(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return Ce.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||d(i,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var e=this._points.copy();return Se.reverse(e),this.getFactory().createLinearRing(e)}},{key:"getTypeCode",value:function(){return V.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!d(i,"isClosed",this,1).call(this))throw new x("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<i.MINIMUM_VALID_SIZE)throw new x("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return V.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];Re.constructor_.call(this,e,t),this.validateConstruction()}}])}(Re);Be.MINIMUM_VALID_SIZE=4;var Ue=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"setOrdinate",value:function(e,t){switch(e){case i.X:this.x=t;break;case i.Y:this.y=t;break;default:throw new x("Invalid ordinate index: "+e)}}},{key:"getZ",value:function(){return B.NULL_ORDINATE}},{key:"getOrdinate",value:function(e){switch(e){case i.X:return this.x;case i.Y:return this.y}throw new x("Invalid ordinate index: "+e)}},{key:"setZ",value:function(e){throw new x("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ()}}],[{key:"constructor_",value:function(){if(0===arguments.length)B.constructor_.call(this);else if(1===arguments.length){if(arguments[0]instanceof i){var e=arguments[0];B.constructor_.call(this,e.x,e.y)}else if(arguments[0]instanceof B){var t=arguments[0];B.constructor_.call(this,t.x,t.y)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];B.constructor_.call(this,n,r,B.NULL_ORDINATE)}}}])}(B);Ue.X=0,Ue.Y=1,Ue.Z=-1,Ue.M=-1;var Xe=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(e,t){switch(e){case i.X:this.x=t;break;case i.Y:this.y=t;break;case i.M:this._m=t;break;default:throw new x("Invalid ordinate index: "+e)}}},{key:"setM",value:function(e){this._m=e}},{key:"getZ",value:function(){return B.NULL_ORDINATE}},{key:"getOrdinate",value:function(e){switch(e){case i.X:return this.x;case i.Y:return this.y;case i.M:return this._m}throw new x("Invalid ordinate index: "+e)}},{key:"setZ",value:function(e){throw new x("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ(),this._m=e.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,0===arguments.length)B.constructor_.call(this),this._m=0;else if(1===arguments.length){if(arguments[0]instanceof i){var e=arguments[0];B.constructor_.call(this,e.x,e.y),this._m=e._m}else if(arguments[0]instanceof B){var t=arguments[0];B.constructor_.call(this,t.x,t.y),this._m=this.getM()}}else if(3===arguments.length){var n=arguments[0],r=arguments[1],s=arguments[2];B.constructor_.call(this,n,r,B.NULL_ORDINATE),this._m=s}}}])}(B);Xe.X=0,Xe.Y=1,Xe.Z=-1,Xe.M=2;var Ve=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(e,t){switch(e){case B.X:this.x=t;break;case B.Y:this.y=t;break;case B.Z:this.z=t;break;case B.M:this._m=t;break;default:throw new x("Invalid ordinate index: "+e)}}},{key:"setM",value:function(e){this._m=e}},{key:"getOrdinate",value:function(e){switch(e){case B.X:return this.x;case B.Y:return this.y;case B.Z:return this.getZ();case B.M:return this.getM()}throw new x("Invalid ordinate index: "+e)}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ(),this._m=e.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,0===arguments.length)B.constructor_.call(this),this._m=0;else if(1===arguments.length){if(arguments[0]instanceof i){var e=arguments[0];B.constructor_.call(this,e),this._m=e._m}else if(arguments[0]instanceof B){var t=arguments[0];B.constructor_.call(this,t),this._m=this.getM()}}else if(4===arguments.length){var n=arguments[0],r=arguments[1],s=arguments[2],a=arguments[3];B.constructor_.call(this,n,r,s),this._m=a}}}])}(B),He=function(){function e(){n(this,e)}return a(e,null,[{key:"measures",value:function(e){return e instanceof Ue?0:e instanceof Xe||e instanceof Ve?1:0}},{key:"dimension",value:function(e){return e instanceof Ue?2:e instanceof Xe?3:e instanceof Ve?4:3}},{key:"create",value:function(){if(1===arguments.length){var t=arguments[0];return e.create(t,0)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return 2===n?new Ue:3===n&&0===i?new B:3===n&&1===i?new Xe:4===n&&1===i?new Ve:new B}}}])}(),Ze=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"getCoordinate",value:function(e){return this.get(e)}},{key:"addAll",value:function(){if(2===arguments.length&&"boolean"==typeof arguments[1]&&se(arguments[0],Z)){for(var e=arguments[1],t=!1,n=arguments[0].iterator();n.hasNext();)this.add(n.next(),e),t=!0;return t}return d(i,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var e=d(i,"clone",this,1).call(this),t=0;t<this.size();t++)e.add(t,this.get(t).clone());return e}},{key:"toCoordinateArray",value:function(){if(0===arguments.length)return this.toArray(i.coordArrayType);if(1===arguments.length){if(arguments[0])return this.toArray(i.coordArrayType);for(var e=this.size(),t=new Array(e).fill(null),n=0;n<e;n++)t[n]=this.get(e-n-1);return t}}},{key:"add",value:function(){if(1===arguments.length){var e=arguments[0];return d(i,"add",this,1).call(this,e)}if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var t=arguments[0],n=arguments[1];return this.add(t,n,!0),!0}if(arguments[0]instanceof B&&"boolean"==typeof arguments[1]){var r=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(r))return null;d(i,"add",this,1).call(this,r)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var s=arguments[0],a=arguments[1];return this.add(s,a),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var o=arguments[0],u=arguments[1];if(arguments[2])for(var l=0;l<o.length;l++)this.add(o[l],u);else for(var c=o.length-1;c>=0;c--)this.add(o[c],u);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof B){var h=arguments[0],f=arguments[1];if(!arguments[2]){var g=this.size();if(g>0){if(h>0&&this.get(h-1).equals2D(f))return null;if(h<g&&this.get(h).equals2D(f))return null}}d(i,"add",this,1).call(this,h,f)}}else if(4===arguments.length){var v=arguments[0],y=arguments[1],p=arguments[2],m=arguments[3],_=1;p>m&&(_=-1);for(var x=p;x!==m;x+=_)this.add(v[x],y);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var e=this.get(0).copy();this.add(e,!1)}}}],[{key:"constructor_",value:function(){if(0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.ensureCapacity(t.length),this.add(t,n)}}}])}(ye);Ze.coordArrayType=new Array(0).fill(null);var We=function(){function e(){n(this,e)}return a(e,null,[{key:"isRing",value:function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))}},{key:"ptNotInList",value:function(t,n){for(var i=0;i<t.length;i++){var r=t[i];if(e.indexOf(r,n)<0)return r}return null}},{key:"scroll",value:function(t,n){var i=e.indexOf(n,t);if(i<0)return null;var r=new Array(t.length).fill(null);xe.arraycopy(t,i,r,0,t.length-i),xe.arraycopy(t,0,r,t.length-i,i),xe.arraycopy(r,0,t,0,t.length)}},{key:"equals",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(null===e||null===t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].equals(t[n]))return!1;return!0}if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];if(i===r)return!0;if(null===i||null===r)return!1;if(i.length!==r.length)return!1;for(var a=0;a<i.length;a++)if(0!==s.compare(i[a],r[a]))return!1;return!0}}},{key:"intersection",value:function(e,t){for(var n=new Ze,i=0;i<e.length;i++)t.intersects(e[i])&&n.add(e[i],!0);return n.toCoordinateArray()}},{key:"measures",value:function(e){if(null===e||0===e.length)return 0;var t,n=0,i=o(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n=Math.max(n,He.measures(r))}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"hasRepeatedPoints",value:function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(t){return e.hasRepeatedPoints(t)?new Ze(t,!1).toCoordinateArray():t}},{key:"reverse",value:function(e){for(var t=e.length-1,n=Math.trunc(t/2),i=0;i<=n;i++){var r=e[i];e[i]=e[t-i],e[t-i]=r}}},{key:"removeNull",value:function(e){for(var t=0,n=0;n<e.length;n++)null!==e[n]&&t++;var i=new Array(t).fill(null);if(0===t)return i;for(var r=0,s=0;s<e.length;s++)null!==e[s]&&(i[r++]=e[s]);return i}},{key:"copyDeep",value:function(){if(1===arguments.length){for(var e=arguments[0],t=new Array(e.length).fill(null),n=0;n<e.length;n++)t[n]=e[n].copy();return t}if(5===arguments.length)for(var i=arguments[0],r=arguments[1],s=arguments[2],a=arguments[3],o=arguments[4],u=0;u<o;u++)s[a+u]=i[r+u].copy()}},{key:"isEqualReversed",value:function(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=t[e.length-n-1];if(0!==i.compareTo(r))return!1}return!0}},{key:"envelope",value:function(e){for(var t=new X,n=0;n<e.length;n++)t.expandToInclude(e[n]);return t}},{key:"toCoordinateArray",value:function(t){return t.toArray(e.coordArrayType)}},{key:"dimension",value:function(e){if(null===e||0===e.length)return 3;var t,n=0,i=o(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n=Math.max(n,He.dimension(r))}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"atLeastNCoordinatesOrNothing",value:function(e,t){return t.length>=e?t:[]}},{key:"indexOf",value:function(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return n;return-1}},{key:"increasingDirection",value:function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var n=e.length-1-t,i=e[t].compareTo(e[n]);if(0!==i)return i}return 1}},{key:"compare",value:function(e,t){for(var n=0;n<e.length&&n<t.length;){var i=e[n].compareTo(t[n]);if(0!==i)return i;n++}return n<t.length?-1:n<e.length?1:0}},{key:"minCoordinate",value:function(e){for(var t=null,n=0;n<e.length;n++)(null===t||t.compareTo(e[n])>0)&&(t=e[n]);return t}},{key:"extract",value:function(e,t,n){t=ke.clamp(t,0,e.length);var i=(n=ke.clamp(n,-1,e.length))-t+1;n<0&&(i=0),t>=e.length&&(i=0),n<t&&(i=0);var r=new Array(i).fill(null);if(0===i)return r;for(var s=0,a=t;a<=n;a++)r[s++]=e[a];return r}}])}(),Ke=a(function e(){n(this,e)},[{key:"compare",value:function(e,t){var n=e,i=t;return We.compare(n,i)}},{key:"interfaces_",get:function(){return[D]}}]),Je=a(function e(){n(this,e)},[{key:"compare",value:function(e,t){var n=e,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;var r=We.compare(n,i);return We.isEqualReversed(n,i)?0:r}},{key:"OLDcompare",value:function(e,t){var n=e,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;for(var r=We.increasingDirection(n),s=We.increasingDirection(i),a=r>0?0:n.length-1,o=s>0?0:n.length-1,u=0;u<n.length;u++){var l=n[a].compareTo(i[o]);if(0!==l)return l;a+=r,o+=s}return 0}},{key:"interfaces_",get:function(){return[D]}}]);We.ForwardComparator=Ke,We.BidirectionalComparator=Je,We.coordArrayType=new Array(0).fill(null);var Qe=a(function e(t){n(this,e),this.str=t},[{key:"append",value:function(e){this.str+=e}},{key:"setCharAt",value:function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)}},{key:"toString",value:function(){return this.str}}]),$e=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getM",value:function(e){return this.hasM()?this._coordinates[e].getM():A.NaN}},{key:"setOrdinate",value:function(e,t,n){switch(t){case he.X:this._coordinates[e].x=n;break;case he.Y:this._coordinates[e].y=n;break;default:this._coordinates[e].setOrdinate(t,n)}}},{key:"getZ",value:function(e){return this.hasZ()?this._coordinates[e].getZ():A.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(e,t){switch(t){case he.X:return this._coordinates[e].x;case he.Y:return this._coordinates[e].y;default:return this._coordinates[e].getOrdinate(t)}}},{key:"getCoordinate",value:function(){if(1===arguments.length){var e=arguments[0];return this._coordinates[e]}if(2===arguments.length){var t=arguments[0];arguments[1].setCoordinate(this._coordinates[t])}}},{key:"getCoordinateCopy",value:function(e){var t=this.createCoordinate();return t.setCoordinate(this._coordinates[e]),t}},{key:"createCoordinate",value:function(){return He.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(e){return this._coordinates[e].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(e){for(var t=0;t<this._coordinates.length;t++)e.expandToInclude(this._coordinates[t]);return e}},{key:"copy",value:function(){for(var t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++){var i=this.createCoordinate();i.setCoordinate(this._coordinates[n]),t[n]=i}return new e(t,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var e=new Qe(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var t=1;t<this._coordinates.length;t++)e.append(", "),e.append(this._coordinates[t]);return e.append(")"),e.toString()}return"()"}},{key:"getY",value:function(e){return this._coordinates[e].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[he,I]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];e.constructor_.call(this,t,We.dimension(t),We.measures(t))}else if(Number.isInteger(arguments[0])){var n=arguments[0];this._coordinates=new Array(n).fill(null);for(var i=0;i<n;i++)this._coordinates[i]=new B}else if(se(arguments[0],he)){var r=arguments[0];if(null===r)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._measures=r.getMeasures(),this._coordinates=new Array(r.size()).fill(null);for(var s=0;s<this._coordinates.length;s++)this._coordinates[s]=r.getCoordinateCopy(s)}}else if(2===arguments.length){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var a=arguments[0],o=arguments[1];e.constructor_.call(this,a,o,We.measures(a))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],l=arguments[1];this._coordinates=new Array(u).fill(null),this._dimension=l;for(var c=0;c<u;c++)this._coordinates[c]=He.create(l)}}else if(3===arguments.length)if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var h=arguments[0],f=arguments[1],d=arguments[2];this._dimension=f,this._measures=d,this._coordinates=null===h?new Array(0).fill(null):h}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var g=arguments[0],v=arguments[1],y=arguments[2];this._coordinates=new Array(g).fill(null),this._dimension=v,this._measures=y;for(var p=0;p<g;p++)this._coordinates[p]=this.createCoordinate()}}}])}(),et=function(){function e(){n(this,e)}return a(e,[{key:"readResolve",value:function(){return e.instance()}},{key:"create",value:function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new $e(arguments[0]);if(se(arguments[0],he))return new $e(arguments[0])}else{if(2===arguments.length){var e=arguments[1];return e>3&&(e=3),e<2&&(e=2),new $e(arguments[0],e)}if(3===arguments.length){var t=arguments[2],n=arguments[1]-t;return t>1&&(t=1),n>3&&(n=3),n<2&&(n=2),new $e(arguments[0],n+t,t)}}}},{key:"interfaces_",get:function(){return[Ee,I]}}],[{key:"instance",value:function(){return e.instanceObject}}])}();et.instanceObject=new et;var tt=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"copyInternal",value:function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new i(e,this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof V){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&d(i,"equalsExact",this,1).call(this,e,t)}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return V.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var e=new ye,t=0;t<this._geometries.length;t++)for(var n=this._geometries[t].getBoundary(),i=0;i<n.getNumGeometries();i++)e.add(n.getGeometryN(i));var r=new Array(e.size()).fill(null);return this.getFactory().createMultiLineString(e.toArray(r))}},{key:"getGeometryType",value:function(){return V.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[De]}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];qe.constructor_.call(this,e,t)}}])}(qe),nt=a(function e(){n(this,e)},[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}]),it=function(e){function i(){var e;return n(this,i),(e=t(this,i)).map=new Map,e}return c(i,e),a(i,[{key:"get",value:function(e){return this.map.get(e)||null}},{key:"put",value:function(e,t){return this.map.set(e,t),t}},{key:"values",value:function(){for(var e=new ye,t=this.map.values(),n=t.next();!n.done;)e.add(n.value),n=t.next();return e}},{key:"entrySet",value:function(){var e=new Q;return this.map.entries().forEach(function(t){return e.add(t)}),e}},{key:"size",value:function(){return this.map.size()}}])}(nt),rt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;return this._modelType===n._modelType&&this._scale===n._scale}},{key:"compareTo",value:function(e){var t=e,n=this.getMaximumSignificantDigits(),i=t.getMaximumSignificantDigits();return oe.compare(n,i)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===e.FLOATING||this._modelType===e.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var t="UNKNOWN";return this._modelType===e.FLOATING?t="Floating":this._modelType===e.FLOATING_SINGLE?t="Floating-Single":this._modelType===e.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t}},{key:"makePrecise",value:function(){if("number"==typeof arguments[0]){var t=arguments[0];return A.isNaN(t)||this._modelType===e.FLOATING_SINGLE?t:this._modelType===e.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof B){var n=arguments[0];if(this._modelType===e.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}}},{key:"getMaximumSignificantDigits",value:function(){var t=16;return this._modelType===e.FLOATING?t=16:this._modelType===e.FLOATING_SINGLE?t=6:this._modelType===e.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t}},{key:"setScale",value:function(e){this._scale=Math.abs(e)}},{key:"interfaces_",get:function(){return[I,N]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=e.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof st){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this._modelType=e.FIXED,this.setScale(n)}else if(arguments[0]instanceof e){var i=arguments[0];this._modelType=i._modelType,this._scale=i._scale}}},{key:"mostPrecise",value:function(e,t){return e.compareTo(t)>=0?e:t}}])}(),st=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"readResolve",value:function(){return e.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[I]}}],[{key:"constructor_",value:function(){this._name=null;var t=arguments[0];this._name=t,e.nameToTypeMap.put(t,this)}}])}();st.nameToTypeMap=new it,rt.Type=st,rt.FIXED=new st("FIXED"),rt.FLOATING=new st("FLOATING"),rt.FLOATING_SINGLE=new st("FLOATING SINGLE"),rt.maximumPreciseValue=9007199254740992;var at=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"copyInternal",value:function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new i(e,this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof V){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&d(i,"equalsExact",this,1).call(this,e,t)}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Ce.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return V.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new K}},{key:"getGeometryType",value:function(){return V.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[we]}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];qe.constructor_.call(this,e,t)}}])}(qe),ot=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"createEmpty",value:function(e){switch(e){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new x("Invalid dimension: "+e)}}},{key:"toGeometry",value:function(e){return e.isNull()?this.createPoint():e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new B(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new B(e.getMinX(),e.getMinY()),new B(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new B(e.getMinX(),e.getMinY()),new B(e.getMinX(),e.getMaxY()),new B(e.getMaxX(),e.getMaxY()),new B(e.getMaxX(),e.getMinY()),new B(e.getMinX(),e.getMinY())]),null)}},{key:"createLineString",value:function(){if(0===arguments.length)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLineString(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(se(arguments[0],he))return new Re(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return 0===arguments.length?new at(null,this):1===arguments.length?new at(arguments[0],this):void 0}},{key:"buildGeometry",value:function(t){for(var n=null,i=!1,r=!1,s=t.iterator();s.hasNext();){var a=s.next(),o=a.getTypeCode();null===n&&(n=o),o!==n&&(i=!0),a instanceof qe&&(r=!0)}if(null===n)return this.createGeometryCollection();if(i||r)return this.createGeometryCollection(e.toGeometryArray(t));var u=t.iterator().next();if(t.size()>1){if(u instanceof Fe)return this.createMultiPolygon(e.toPolygonArray(t));if(u instanceof Re)return this.createMultiLineString(e.toLineStringArray(t));if(u instanceof Me)return this.createMultiPoint(e.toPointArray(t));G.shouldNeverReachHere("Unhandled geometry type: "+u.getGeometryType())}return u}},{key:"createMultiPointFromCoords",value:function(e){return this.createMultiPoint(null!==e?this.getCoordinateSequenceFactory().create(e):null)}},{key:"createPoint",value:function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof B){var e=arguments[0];return this.createPoint(null!==e?this.getCoordinateSequenceFactory().create([e]):null)}if(se(arguments[0],he))return new Me(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(0===arguments.length)return this.createPolygon(null,null);if(1===arguments.length){if(se(arguments[0],he)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Be){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length)return new Fe(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return 0===arguments.length?new qe(null,this):1===arguments.length?new qe(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(se(arguments[0],he))return new Be(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return 0===arguments.length?new tt(null,this):1===arguments.length?new tt(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(0===arguments.length)return new Ye(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Ye(arguments[0],this);if(se(arguments[0],he)){var e=arguments[0];if(null===e)return this.createMultiPoint(new Array(0).fill(null));for(var t=new Array(e.size()).fill(null),n=0;n<e.size();n++){var i=this.getCoordinateSequenceFactory().create(1,e.getDimension(),e.getMeasures());Se.copy(e,n,i,0,1),t[n]=this.createPoint(i)}return this.createMultiPoint(t)}}}},{key:"interfaces_",get:function(){return[I]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,0===arguments.length)e.constructor_.call(this,new rt,0);else if(1===arguments.length){if(se(arguments[0],Ee)){var t=arguments[0];e.constructor_.call(this,new rt,0,t)}else if(arguments[0]instanceof rt){var n=arguments[0];e.constructor_.call(this,n,0,e.getDefaultCoordinateSequenceFactory())}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];e.constructor_.call(this,i,r,e.getDefaultCoordinateSequenceFactory())}else if(3===arguments.length){var s=arguments[0],a=arguments[1],o=arguments[2];this._precisionModel=s,this._coordinateSequenceFactory=o,this._SRID=a}}},{key:"toMultiPolygonArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toGeometryArray",value:function(e){if(null===e)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return et.instance()}},{key:"toMultiLineStringArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toLineStringArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toMultiPointArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toLinearRingArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toPointArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toPolygonArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"createPointFromInternalCoord",value:function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)}}])}(),ut="XY",lt="XYZ",ct="XYM",ht="XYZM",ft={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},dt="EMPTY",gt=1,vt=2,yt=3,pt=4,mt=5,_t=6;for(var xt in ft)ft[xt].toUpperCase();var kt=a(function e(t){n(this,e),this.wkt=t,this.index_=-1},[{key:"isAlpha_",value:function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}},{key:"isNumeric_",value:function(e,t){return e>="0"&&e<="9"||"."==e&&!(void 0!==t&&t)}},{key:"isWhiteSpace_",value:function(e){return" "==e||"\t"==e||"\r"==e||"\n"==e}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var e,t=this.nextChar_(),n=this.index_,i=t;if("("==t)e=vt;else if(","==t)e=mt;else if(")"==t)e=yt;else if(this.isNumeric_(t)||"-"==t)e=pt,i=this.readNumber_();else if(this.isAlpha_(t))e=gt,i=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(""!==t)throw new Error("Unexpected character: "+t);e=_t}return{position:n,value:i,type:e}}},{key:"readNumber_",value:function(){var e,t=this.index_,n=!1,i=!1;do{"."==e?n=!0:"e"!=e&&"E"!=e||(i=!0),e=this.nextChar_()}while(this.isNumeric_(e,n)||!i&&("e"==e||"E"==e)||i&&("-"==e||"+"==e));return parseFloat(this.wkt.substring(t,this.index_--))}},{key:"readText_",value:function(){var e,t=this.index_;do{e=this.nextChar_()}while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()}}]),Nt=a(function e(t,i){n(this,e),this.lexer_=t,this.token_,this.layout_=ut,this.factory=i},[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(e){return this.token_.type==e}},{key:"match",value:function(e){var t=this.isTokenType(e);return t&&this.consume_(),t}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var e=ut,t=this.token_;if(this.isTokenType(gt)){var n=t.value;"Z"===n?e=lt:"M"===n?e=ct:"ZM"===n&&(e=ht),e!==ut&&this.consume_()}return e}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(vt)){var e=[];do{e.push(this.parseGeometry_())}while(this.match(mt));if(this.match(yt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(vt)){var e=this.parsePoint_();if(this.match(yt))return e}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(vt)){var e=this.parsePointList_();if(this.match(yt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(vt)){var e=this.parseLineStringTextList_();if(this.match(yt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var e;if(this.match(vt)){if(e=this.token_.type==vt?this.parsePointTextList_():this.parsePointList_(),this.match(yt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(vt)){var e=this.parseLineStringTextList_();if(this.match(yt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(vt)){var e=this.parsePolygonTextList_();if(this.match(yt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var e=[],t=this.layout_.length,n=0;n<t;++n){var i=this.token_;if(!this.match(pt))break;e.push(i.value)}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var e=[this.parsePoint_()];this.match(mt);)e.push(this.parsePoint_());return e}},{key:"parsePointTextList_",value:function(){for(var e=[this.parsePointText_()];this.match(mt);)e.push(this.parsePointText_());return e}},{key:"parseLineStringTextList_",value:function(){for(var e=[this.parseLineStringText_()];this.match(mt);)e.push(this.parseLineStringText_());return e}},{key:"parsePolygonTextList_",value:function(){for(var e=[this.parsePolygonText_()];this.match(mt);)e.push(this.parsePolygonText_());return e}},{key:"isEmptyGeometry_",value:function(){var e=this.isTokenType(gt)&&this.token_.value==dt;return e&&this.consume_(),e}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var e=this.factory,t=function(e){return i(B,g(e))},n=function(n){var i=n.map(function(n){return e.createLinearRing(n.map(t))});return i.length>1?e.createPolygon(i[0],i.slice(1)):e.createPolygon(i[0])},r=this.token_;if(this.match(gt)){var s=r.value;if(this.layout_=this.parseGeometryLayout_(),"GEOMETRYCOLLECTION"==s){var a=this.parseGeometryCollectionText_();return e.createGeometryCollection(a)}switch(s){case"POINT":var o=this.parsePointText_();return o?e.createPoint(i(B,g(o))):e.createPoint();case"LINESTRING":var u=this.parseLineStringText_().map(t);return e.createLineString(u);case"LINEARRING":var l=this.parseLineStringText_().map(t);return e.createLinearRing(l);case"POLYGON":var c=this.parsePolygonText_();return c&&0!==c.length?n(c):e.createPolygon();case"MULTIPOINT":var h=this.parseMultiPointText_();if(!h||0===h.length)return e.createMultiPoint();var f=h.map(t).map(function(t){return e.createPoint(t)});return e.createMultiPoint(f);case"MULTILINESTRING":var d=this.parseMultiLineStringText_().map(function(n){return e.createLineString(n.map(t))});return e.createMultiLineString(d);case"MULTIPOLYGON":var v=this.parseMultiPolygonText_();if(!v||0===v.length)return e.createMultiPolygon();var y=v.map(n);return e.createMultiPolygon(y);default:throw new Error("Invalid geometry type: "+s)}}throw new Error(this.formatErrorMessage_())}}]);function Et(e){if(e.isEmpty())return"";var t=e.getCoordinate(),n=[t.x,t.y];return void 0===t.z||Number.isNaN(t.z)||n.push(t.z),void 0===t.m||Number.isNaN(t.m)||n.push(t.m),n.join(" ")}function It(e){for(var t=e.getCoordinates().map(function(e){var t=[e.x,e.y];return void 0===e.z||Number.isNaN(e.z)||t.push(e.z),void 0===e.m||Number.isNaN(e.m)||t.push(e.m),t}),n=[],i=0,r=t.length;i<r;++i)n.push(t[i].join(" "));return n.join(", ")}function bt(e){var t=[];t.push("("+It(e.getExteriorRing())+")");for(var n=0,i=e.getNumInteriorRing();n<i;++n)t.push("("+It(e.getInteriorRingN(n))+")");return t.join(", ")}var wt={Point:Et,LineString:It,LinearRing:It,Polygon:bt,MultiPoint:function(e){for(var t=[],n=0,i=e.getNumGeometries();n<i;++n)t.push("("+Et(e.getGeometryN(n))+")");return t.join(", ")},MultiLineString:function(e){for(var t=[],n=0,i=e.getNumGeometries();n<i;++n)t.push("("+It(e.getGeometryN(n))+")");return t.join(", ")},MultiPolygon:function(e){for(var t=[],n=0,i=e.getNumGeometries();n<i;++n)t.push("("+bt(e.getGeometryN(n))+")");return t.join(", ")},GeometryCollection:function(e){for(var t=[],n=0,i=e.getNumGeometries();n<i;++n)t.push(St(e.getGeometryN(n)));return t.join(", ")}};function St(e){var t=e.getGeometryType(),n=wt[t];t=t.toUpperCase();var i=function(e){var t="";if(e.isEmpty())return t;var n=e.getCoordinate();return void 0===n.z||Number.isNaN(n.z)||(t+="Z"),void 0===n.m||Number.isNaN(n.m)||(t+="M"),t}(e);return i.length>0&&(t+=" "+i),e.isEmpty()?t+" "+dt:t+" ("+n(e)+")"}var Ct=a(function e(t){n(this,e),this.geometryFactory=t||new ot,this.precisionModel=this.geometryFactory.getPrecisionModel()},[{key:"read",value:function(e){var t=new kt(e);return new Nt(t,this.geometryFactory).parse()}},{key:"write",value:function(e){return St(e)}}]),Tt=a(function e(t){n(this,e),this.parser=new Ct(t)},[{key:"write",value:function(e){return this.parser.write(e)}}],[{key:"toLineString",value:function(e,t){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"}}]),Lt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getIndexAlongSegment",value:function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]}},{key:"getTopologySummary",value:function(){var e=new Qe;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()}},{key:"computeIntersection",value:function(e,t,n,i){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=n,this._inputLines[1][1]=i,this._result=this.computeIntersect(e,t,n,i)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var e=arguments[0];this.getEdgeDistance(e,0)>this.getEdgeDistance(e,1)?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(e){this._precisionModel=e}},{key:"isInteriorIntersection",value:function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var e=arguments[0],t=0;t<this._result;t++)if(!this._intPt[t].equals2D(this._inputLines[e][0])&&!this._intPt[t].equals2D(this._inputLines[e][1]))return!0;return!1}}},{key:"getIntersection",value:function(e){return this._intPt[e]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==e.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(t,n){return e.computeEdgeDistance(this._intPt[n],this._inputLines[t][0],this._inputLines[t][1])}},{key:"isCollinear",value:function(){return this._result===e.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return Tt.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Tt.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(e,t){return this._inputLines[e][t]}},{key:"isIntersection",value:function(e){for(var t=0;t<this._result;t++)if(this._intPt[t].equals2D(e))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new B,this._intPt[1]=new B,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(e,t,n){var i=Math.abs(n.x-t.x),r=Math.abs(n.y-t.y),s=-1;if(e.equals(t))s=0;else if(e.equals(n))s=i>r?i:r;else{var a=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y);0!==(s=i>r?a:o)||e.equals(t)||(s=Math.max(a,o))}return G.isTrue(!(0===s&&!e.equals(t)),"Bad distance calculation"),s}},{key:"nonRobustComputeEdgeDistance",value:function(e,t,n){var i=e.x-t.x,r=e.y-t.y,s=Math.sqrt(i*i+r*r);return G.isTrue(!(0===s&&!e.equals(t)),"Invalid distance calculation"),s}}])}();Lt.DONT_INTERSECT=0,Lt.DO_INTERSECT=1,Lt.COLLINEAR=2,Lt.NO_INTERSECTION=0,Lt.POINT_INTERSECTION=1,Lt.COLLINEAR_INTERSECTION=2;var Rt=function(e){function i(){return n(this,i),t(this,i)}return c(i,e),a(i,[{key:"isInSegmentEnvelopes",value:function(e){var t=new X(this._inputLines[0][0],this._inputLines[0][1]),n=new X(this._inputLines[1][0],this._inputLines[1][1]);return t.contains(e)&&n.contains(e)}},{key:"computeIntersection",value:function(){if(3!==arguments.length)return d(i,"computeIntersection",this,1).apply(this,arguments);var e=arguments[0],t=arguments[1],n=arguments[2];if(this._isProper=!1,X.intersects(t,n,e)&&0===fe.index(t,n,e)&&0===fe.index(n,t,e))return this._isProper=!0,(e.equals(t)||e.equals(n))&&(this._isProper=!1),this._result=Lt.POINT_INTERSECTION,null;this._result=Lt.NO_INTERSECTION}},{key:"intersection",value:function(e,t,n,r){var s=this.intersectionSafe(e,t,n,r);return this.isInSegmentEnvelopes(s)||(s=new B(i.nearestEndpoint(e,t,n,r))),null!==this._precisionModel&&this._precisionModel.makePrecise(s),s}},{key:"checkDD",value:function(e,t,n,i,r){var s=ce.intersection(e,t,n,i),a=this.isInSegmentEnvelopes(s);xe.out.println("DD in env = "+a+"  --------------------- "+s),r.distance(s)>1e-4&&xe.out.println("Distance = "+r.distance(s))}},{key:"intersectionSafe",value:function(e,t,n,r){var s=_e.intersection(e,t,n,r);return null===s&&(s=i.nearestEndpoint(e,t,n,r)),s}},{key:"computeCollinearIntersection",value:function(e,t,n,i){var r=X.intersects(e,t,n),s=X.intersects(e,t,i),a=X.intersects(n,i,e),o=X.intersects(n,i,t);return r&&s?(this._intPt[0]=n,this._intPt[1]=i,Lt.COLLINEAR_INTERSECTION):a&&o?(this._intPt[0]=e,this._intPt[1]=t,Lt.COLLINEAR_INTERSECTION):r&&a?(this._intPt[0]=n,this._intPt[1]=e,!n.equals(e)||s||o?Lt.COLLINEAR_INTERSECTION:Lt.POINT_INTERSECTION):r&&o?(this._intPt[0]=n,this._intPt[1]=t,!n.equals(t)||s||a?Lt.COLLINEAR_INTERSECTION:Lt.POINT_INTERSECTION):s&&a?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||r||o?Lt.COLLINEAR_INTERSECTION:Lt.POINT_INTERSECTION):s&&o?(this._intPt[0]=i,this._intPt[1]=t,!i.equals(t)||r||a?Lt.COLLINEAR_INTERSECTION:Lt.POINT_INTERSECTION):Lt.NO_INTERSECTION}},{key:"computeIntersect",value:function(e,t,n,i){if(this._isProper=!1,!X.intersects(e,t,n,i))return Lt.NO_INTERSECTION;var r=fe.index(e,t,n),s=fe.index(e,t,i);if(r>0&&s>0||r<0&&s<0)return Lt.NO_INTERSECTION;var a=fe.index(n,i,e),o=fe.index(n,i,t);return a>0&&o>0||a<0&&o<0?Lt.NO_INTERSECTION:0===r&&0===s&&0===a&&0===o?this.computeCollinearIntersection(e,t,n,i):(0===r||0===s||0===a||0===o?(this._isProper=!1,e.equals2D(n)||e.equals2D(i)?this._intPt[0]=e:t.equals2D(n)||t.equals2D(i)?this._intPt[0]=t:0===r?this._intPt[0]=new B(n):0===s?this._intPt[0]=new B(i):0===a?this._intPt[0]=new B(e):0===o&&(this._intPt[0]=new B(t))):(this._isProper=!0,this._intPt[0]=this.intersection(e,t,n,i)),Lt.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(e,t,n,i){var r=e,s=Ne.pointToSegment(e,n,i),a=Ne.pointToSegment(t,n,i);return a<s&&(s=a,r=t),(a=Ne.pointToSegment(n,e,t))<s&&(s=a,r=n),(a=Ne.pointToSegment(i,e,t))<s&&(s=a,r=i),r}}])}(Lt),Ot=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"countSegment",value:function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var n=e.x,i=t.x;return n>i&&(n=t.x,i=e.x),this._p.x>=n&&this._p.x<=i&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var r=fe.index(e,t,this._p);if(r===fe.COLLINEAR)return this._isPointOnSegment=!0,null;t.y<e.y&&(r=-r),r===fe.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==H.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?H.BOUNDARY:this._crossingCount%2==1?H.INTERIOR:H.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof B&&se(arguments[1],he)){for(var t=arguments[1],n=new e(arguments[0]),i=new B,r=new B,s=1;s<t.size();s++)if(t.getCoordinate(s,i),t.getCoordinate(s-1,r),n.countSegment(i,r),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof B&&arguments[1]instanceof Array){for(var a=arguments[1],o=new e(arguments[0]),u=1;u<a.length;u++){var l=a[u],c=a[u-1];if(o.countSegment(l,c),o.isOnSegment())return o.getLocation()}return o.getLocation()}}}])}(),Mt=function(){function e(){n(this,e)}return a(e,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof B&&se(arguments[1],he)){for(var e=arguments[0],t=arguments[1],n=new Rt,i=new B,r=new B,s=t.size(),a=1;a<s;a++)if(t.getCoordinate(a-1,i),t.getCoordinate(a,r),n.computeIntersection(e,i,r),n.hasIntersection())return!0;return!1}if(arguments[0]instanceof B&&arguments[1]instanceof Array){for(var o=arguments[0],u=arguments[1],l=new Rt,c=1;c<u.length;c++){var h=u[c-1],f=u[c];if(l.computeIntersection(o,h,f),l.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(e,t){return Ot.locatePointInRing(e,t)}},{key:"isInRing",value:function(t,n){return e.locateInRing(t,n)!==H.EXTERIOR}}])}(),Pt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"setAllLocations",value:function(e){for(var t=0;t<this.location.length;t++)this.location[t]=e}},{key:"isNull",value:function(){for(var e=0;e<this.location.length;e++)if(this.location[e]!==H.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(e){for(var t=0;t<this.location.length;t++)this.location[t]===H.NONE&&(this.location[t]=e)}},{key:"isLine",value:function(){return 1===this.location.length}},{key:"merge",value:function(e){if(e.location.length>this.location.length){var t=new Array(3).fill(null);t[ee.ON]=this.location[ee.ON],t[ee.LEFT]=H.NONE,t[ee.RIGHT]=H.NONE,this.location=t}for(var n=0;n<this.location.length;n++)this.location[n]===H.NONE&&n<e.location.length&&(this.location[n]=e.location[n])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var e=this.location[ee.LEFT];this.location[ee.LEFT]=this.location[ee.RIGHT],this.location[ee.RIGHT]=e}},{key:"toString",value:function(){var e=new ae;return this.location.length>1&&e.append(H.toLocationSymbol(this.location[ee.LEFT])),e.append(H.toLocationSymbol(this.location[ee.ON])),this.location.length>1&&e.append(H.toLocationSymbol(this.location[ee.RIGHT])),e.toString()}},{key:"setLocations",value:function(e,t,n){this.location[ee.ON]=e,this.location[ee.LEFT]=t,this.location[ee.RIGHT]=n}},{key:"get",value:function(e){return e<this.location.length?this.location[e]:H.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var e=0;e<this.location.length;e++)if(this.location[e]===H.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(1===arguments.length){var e=arguments[0];this.setLocation(ee.ON,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.location[t]=n}}},{key:"init",value:function(e){this.location=new Array(e).fill(null),this.setAllLocations(H.NONE)}},{key:"isEqualOnSide",value:function(e,t){return this.location[t]===e.location[t]}},{key:"allPositionsEqual",value:function(e){for(var t=0;t<this.location.length;t++)if(this.location[t]!==e)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[ee.ON]=n}else if(arguments[0]instanceof e){var i=arguments[0];if(this.init(i.location.length),null!==i)for(var r=0;r<this.location.length;r++)this.location[r]=i.location[r]}}else if(3===arguments.length){var s=arguments[0],a=arguments[1],o=arguments[2];this.init(3),this.location[ee.ON]=s,this.location[ee.LEFT]=a,this.location[ee.RIGHT]=o}}}])}(),At=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getGeometryCount",value:function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e}},{key:"setAllLocations",value:function(e,t){this.elt[e].setAllLocations(t)}},{key:"isNull",value:function(e){return this.elt[e].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(1===arguments.length){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}}},{key:"isLine",value:function(e){return this.elt[e].isLine()}},{key:"merge",value:function(e){for(var t=0;t<2;t++)null===this.elt[t]&&null!==e.elt[t]?this.elt[t]=new Pt(e.elt[t]):this.elt[t].merge(e.elt[t])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(1===arguments.length){var e=arguments[0];return this.elt[e].get(ee.ON)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}}},{key:"toString",value:function(){var e=new ae;return null!==this.elt[0]&&(e.append("A:"),e.append(this.elt[0].toString())),null!==this.elt[1]&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()}},{key:"isArea",value:function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var e=arguments[0];return this.elt[e].isArea()}}},{key:"isAnyNull",value:function(e){return this.elt[e].isAnyNull()}},{key:"setLocation",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(ee.ON,t)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.elt[n].setLocation(i,r)}}},{key:"isEqualOnSide",value:function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)}},{key:"allPositionsEqual",value:function(e,t){return this.elt[e].allPositionsEqual(t)}},{key:"toLine",value:function(e){this.elt[e].isArea()&&(this.elt[e]=new Pt(this.elt[e].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Pt(t),this.elt[1]=new Pt(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.elt[0]=new Pt(n.elt[0]),this.elt[1]=new Pt(n.elt[1])}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.elt[0]=new Pt(H.NONE),this.elt[1]=new Pt(H.NONE),this.elt[i].setLocation(r)}else if(3===arguments.length){var s=arguments[0],a=arguments[1],o=arguments[2];this.elt[0]=new Pt(s,a,o),this.elt[1]=new Pt(s,a,o)}else if(4===arguments.length){var u=arguments[0],l=arguments[1],c=arguments[2],h=arguments[3];this.elt[0]=new Pt(H.NONE,H.NONE,H.NONE),this.elt[1]=new Pt(H.NONE,H.NONE,H.NONE),this.elt[u].setLocations(l,c,h)}}},{key:"toLineLabel",value:function(t){for(var n=new e(H.NONE),i=0;i<2;i++)n.setLocation(i,t.getLocation(i));return n}}])}(),Dt=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"computeRing",value:function(){if(null!==this._ring)return null;for(var e=new Array(this._pts.size()).fill(null),t=0;t<this._pts.size();t++)e[t]=this._pts.get(t);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=fe.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return 1===this._label.getGeometryCount()}},{key:"computePoints",value:function(e){this._startDe=e;var t=e,n=!0;do{if(null===t)throw new ge("Found null DirectedEdge");if(t.getEdgeRing()===this)throw new ge("Directed Edge visited twice during ring-building at "+t.getCoordinate());this._edges.add(t);var i=t.getLabel();G.isTrue(i.isArea()),this.mergeLabel(i),this.addPoints(t.getEdge(),t.isForward(),n),n=!1,this.setEdgeRing(t,this),t=this.getNext(t)}while(t!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(e){return this._pts.get(e)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var e=this._startDe;do{var t=e.getNode().getEdges().getOutgoingDegree(this);t>this._maxNodeDegree&&(this._maxNodeDegree=t),e=this.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(e,t,n){var i=e.getCoordinates();if(t){var r=1;n&&(r=0);for(var s=r;s<i.length;s++)this._pts.add(i[s])}else{var a=i.length-2;n&&(a=i.length-1);for(var o=a;o>=0;o--)this._pts.add(i[o])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var e=this._startDe;do{e.getEdge().setInResult(!0),e=e.getNext()}while(e!==this._startDe)}},{key:"containsPoint",value:function(e){var t=this.getLinearRing();if(!t.getEnvelopeInternal().contains(e))return!1;if(!Mt.isInRing(e,t.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();)if(n.next().containsPoint(e))return!1;return!0}},{key:"addHole",value:function(e){this._holes.add(e)}},{key:"isShell",value:function(){return null===this._shell}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(1===arguments.length){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(2===arguments.length){var t=arguments[1],n=arguments[0].getLocation(t,ee.RIGHT);if(n===H.NONE)return null;if(this._label.getLocation(t)===H.NONE)return this._label.setLocation(t,n),null}}},{key:"setShell",value:function(e){this._shell=e,null!==e&&e.addHole(this)}},{key:"toPolygon",value:function(e){for(var t=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)t[n]=this._holes.get(n).getLinearRing();return e.createPolygon(this.getLinearRing(),t)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new ye,this._pts=new ye,this._label=new At(H.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new ye,this._geometryFactory=null,0===arguments.length);else if(2===arguments.length){var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()}}}]),Ft=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"setEdgeRing",value:function(e,t){e.setMinEdgeRing(t)}},{key:"getNext",value:function(e){return e.getNextMin()}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];Dt.constructor_.call(this,e,t)}}])}(Dt),jt=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"buildMinimalRings",value:function(){var e=new ye,t=this._startDe;do{if(null===t.getMinEdgeRing()){var n=new Ft(t,this._geometryFactory);e.add(n)}t=t.getNext()}while(t!==this._startDe);return e}},{key:"setEdgeRing",value:function(e,t){e.setEdgeRing(t)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var e=this._startDe;do{e.getNode().getEdges().linkMinimalDirectedEdges(this),e=e.getNext()}while(e!==this._startDe)}},{key:"getNext",value:function(e){return e.getNext()}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];Dt.constructor_.call(this,e,t)}}])}(Dt),Gt=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"setVisited",value:function(e){this._isVisited=e}},{key:"setInResult",value:function(e){this._isInResult=e}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(e){this._label=e}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(e){this._isCovered=e,this._isCoveredSet=!0}},{key:"updateIM",value:function(e){G.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this._label=e}}}]),zt=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"isIncidentEdgeInResult",value:function(){for(var e=this.getEdges().getEdges().iterator();e.hasNext();)if(e.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return 1===this._label.getGeometryCount()}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(e){e.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(e){}},{key:"computeMergedLocation",value:function(e,t){var n=H.NONE;if(n=this._label.getLocation(t),!e.isNull(t)){var i=e.getLocation(t);n!==H.BOUNDARY&&(n=i)}return n}},{key:"setLabel",value:function(){if(2!==arguments.length||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return d(i,"setLabel",this,1).apply(this,arguments);var e=arguments[0],t=arguments[1];null===this._label?this._label=new At(e,t):this._label.setLocation(e,t)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof i){var e=arguments[0];this.mergeLabel(e._label)}else if(arguments[0]instanceof At)for(var t=arguments[0],n=0;n<2;n++){var r=this.computeMergedLocation(t,n);this._label.getLocation(n)===H.NONE&&this._label.setLocation(n,r)}}},{key:"add",value:function(e){this._edges.insert(e),e.setNode(this)}},{key:"setLabelBoundary",value:function(e){if(null===this._label)return null;var t=H.NONE;null!==this._label&&(t=this._label.getLocation(e));var n=null;switch(t){case H.BOUNDARY:n=H.INTERIOR;break;case H.INTERIOR:default:n=H.BOUNDARY}this._label.setLocation(e,n)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var e=arguments[0],t=arguments[1];this._coord=e,this._edges=t,this._label=new At(0,H.NONE)}}])}(Gt),qt=function(e){function i(){return n(this,i),t(this,i,arguments)}return c(i,e),a(i)}(nt);function Yt(e){return null==e?0:e.color}function Bt(e){return null==e?null:e.parent}function Ut(e,t){null!==e&&(e.color=t)}function Xt(e){return null==e?null:e.left}function Vt(e){return null==e?null:e.right}var Ht=function(e){function i(){var e;return n(this,i),(e=t(this,i)).root_=null,e.size_=0,e}return c(i,e),a(i,[{key:"get",value:function(e){for(var t=this.root_;null!==t;){var n=e.compareTo(t.key);if(n<0)t=t.left;else{if(!(n>0))return t.value;t=t.right}}return null}},{key:"put",value:function(e,t){if(null===this.root_)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,i,r=this.root_;do{if(n=r,(i=e.compareTo(r.key))<0)r=r.left;else{if(!(i>0)){var s=r.value;return r.value=t,s}r=r.right}}while(null!==r);var a={key:e,left:null,right:null,value:t,parent:n,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?n.left=a:n.right=a,this.fixAfterInsertion(a),this.size_++,null}},{key:"fixAfterInsertion",value:function(e){var t;for(e.color=1;null!=e&&e!==this.root_&&1===e.parent.color;)Bt(e)===Xt(Bt(Bt(e)))?1===Yt(t=Vt(Bt(Bt(e))))?(Ut(Bt(e),0),Ut(t,0),Ut(Bt(Bt(e)),1),e=Bt(Bt(e))):(e===Vt(Bt(e))&&(e=Bt(e),this.rotateLeft(e)),Ut(Bt(e),0),Ut(Bt(Bt(e)),1),this.rotateRight(Bt(Bt(e)))):1===Yt(t=Xt(Bt(Bt(e))))?(Ut(Bt(e),0),Ut(t,0),Ut(Bt(Bt(e)),1),e=Bt(Bt(e))):(e===Xt(Bt(e))&&(e=Bt(e),this.rotateRight(e)),Ut(Bt(e),0),Ut(Bt(Bt(e)),1),this.rotateLeft(Bt(Bt(e))));this.root_.color=0}},{key:"values",value:function(){var e=new ye,t=this.getFirstEntry();if(null!==t)for(e.add(t.value);null!==(t=i.successor(t));)e.add(t.value);return e}},{key:"entrySet",value:function(){var e=new Q,t=this.getFirstEntry();if(null!==t)for(e.add(t);null!==(t=i.successor(t));)e.add(t);return e}},{key:"rotateLeft",value:function(e){if(null!=e){var t=e.right;e.right=t.left,null!=t.left&&(t.left.parent=e),t.parent=e.parent,null==e.parent?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}}},{key:"rotateRight",value:function(e){if(null!=e){var t=e.left;e.left=t.right,null!=t.right&&(t.right.parent=e),t.parent=e.parent,null==e.parent?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}}},{key:"getFirstEntry",value:function(){var e=this.root_;if(null!=e)for(;null!=e.left;)e=e.left;return e}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(e){for(var t=this.root_;null!==t;){var n=e.compareTo(t.key);if(n<0)t=t.left;else{if(!(n>0))return!0;t=t.right}}return!1}}],[{key:"successor",value:function(e){var t;if(null===e)return null;if(null!==e.right){for(t=e.right;null!==t.left;)t=t.left;return t}t=e.parent;for(var n=e;null!==t&&n===t.right;)n=t,t=t.parent;return t}}])}(qt),Zt=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"find",value:function(e){return this.nodeMap.get(e)}},{key:"addNode",value:function(){if(arguments[0]instanceof B){var e=arguments[0],t=this.nodeMap.get(e);return null===t&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}if(arguments[0]instanceof zt){var n=arguments[0],i=this.nodeMap.get(n.getCoordinate());return null===i?(this.nodeMap.put(n.getCoordinate(),n),n):(i.mergeLabel(n),i)}}},{key:"print",value:function(e){for(var t=this.iterator();t.hasNext();)t.next().print(e)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(e){for(var t=new ye,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(e)===H.BOUNDARY&&t.add(i)}return t}},{key:"add",value:function(e){var t=e.getCoordinate();this.addNode(t).add(e)}}],[{key:"constructor_",value:function(){this.nodeMap=new Ht,this.nodeFact=null;var e=arguments[0];this.nodeFact=e}}]),Wt=function(){function e(){n(this,e)}return a(e,null,[{key:"isNorthern",value:function(t){return t===e.NE||t===e.NW}},{key:"isOpposite",value:function(e,t){return e!==t&&2==(e-t+4)%4}},{key:"commonHalfPlane",value:function(e,t){if(e===t)return e;if(2==(e-t+4)%4)return-1;var n=e<t?e:t;return 0===n&&3===(e>t?e:t)?3:n}},{key:"isInHalfPlane",value:function(t,n){return n===e.SE?t===e.SE||t===e.SW:t===n||t===n+1}},{key:"quadrant",value:function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1];if(0===t&&0===n)throw new x("Cannot compute the quadrant for point ( "+t+", "+n+" )");return t>=0?n>=0?e.NE:e.SE:n>=0?e.NW:e.SW}if(arguments[0]instanceof B&&arguments[1]instanceof B){var i=arguments[0],r=arguments[1];if(r.x===i.x&&r.y===i.y)throw new x("Cannot compute the quadrant for two identical points "+i);return r.x>=i.x?r.y>=i.y?e.NE:e.SE:r.y>=i.y?e.NW:e.SW}}}])}();Wt.NE=0,Wt.NW=1,Wt.SW=2,Wt.SE=3;var Kt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"compareDirection",value:function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:fe.index(e._p0,e._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(e){this._node=e}},{key:"print",value:function(e){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);e.print("  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)}},{key:"compareTo",value:function(e){var t=e;return this.compareDirection(t)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf(".");return"  "+t.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label}},{key:"computeLabel",value:function(e){}},{key:"init",value:function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=Wt.quadrant(this._dx,this._dy),G.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[N]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];e.constructor_.call(this,n,i,r,null)}else if(4===arguments.length){var s=arguments[0],a=arguments[1],o=arguments[2],u=arguments[3];e.constructor_.call(this,s),this.init(a,o),this._label=u}}}])}(),Jt=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(e){return this._depth[e]}},{key:"setVisited",value:function(e){this._isVisited=e}},{key:"computeDirectedLabel",value:function(){this._label=new At(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(e,t){if(-999!==this._depth[e]&&this._depth[e]!==t)throw new ge("assigned depths do not match",this.getCoordinate());this._depth[e]=t}},{key:"isInteriorAreaEdge",value:function(){for(var e=!0,t=0;t<2;t++)this._label.isArea(t)&&this._label.getLocation(t,ee.LEFT)===H.INTERIOR&&this._label.getLocation(t,ee.RIGHT)===H.INTERIOR||(e=!1);return e}},{key:"setNextMin",value:function(e){this._nextMin=e}},{key:"print",value:function(e){d(i,"print",this,1).call(this,e),e.print(" "+this._depth[ee.LEFT]+"/"+this._depth[ee.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")}},{key:"setMinEdgeRing",value:function(e){this._minEdgeRing=e}},{key:"isLineEdge",value:function(){var e=this._label.isLine(0)||this._label.isLine(1),t=!this._label.isArea(0)||this._label.allPositionsEqual(0,H.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,H.EXTERIOR);return e&&t&&n}},{key:"setEdgeRing",value:function(e){this._edgeRing=e}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var e=this._edge.getDepthDelta();return this._isForward||(e=-e),e}},{key:"setInResult",value:function(e){this._isInResult=e}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(e){this.print(e),e.print(" "),this._isForward?this._edge.print(e):this._edge.printReverse(e)}},{key:"setSym",value:function(e){this._sym=e}},{key:"setVisitedEdge",value:function(e){this.setVisited(e),this._sym.setVisited(e)}},{key:"setEdgeDepths",value:function(e,t){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var i=1;e===ee.LEFT&&(i=-1);var r=ee.opposite(e),s=t+n*i;this.setDepth(e,t),this.setDepth(r,s)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(e){this._next=e}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var e=arguments[0],t=arguments[1];if(Kt.constructor_.call(this,e),this._isForward=t,t)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var n=e.getNumPoints()-1;this.init(e.getCoordinate(n),e.getCoordinate(n-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(e,t){return e===H.EXTERIOR&&t===H.INTERIOR?1:e===H.INTERIOR&&t===H.EXTERIOR?-1:0}}])}(Kt),Qt=a(function e(){n(this,e)},[{key:"createNode",value:function(e){return new zt(e,null)}}]),$t=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"printEdges",value:function(e){e.println("Edges:");for(var t=0;t<this._edges.size();t++){e.println("edge "+t+":");var n=this._edges.get(t);n.print(e),n.eiList.print(e)}}},{key:"find",value:function(e){return this._nodes.find(e)}},{key:"addNode",value:function(){if(arguments[0]instanceof zt){var e=arguments[0];return this._nodes.addNode(e)}if(arguments[0]instanceof B){var t=arguments[0];return this._nodes.addNode(t)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(e){xe.out.println(e)}},{key:"isBoundaryNode",value:function(e,t){var n=this._nodes.find(t);if(null===n)return!1;var i=n.getLabel();return null!==i&&i.getLocation(e)===H.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(e,t,n,i){return!!e.equals(n)&&fe.index(e,t,i)===fe.COLLINEAR&&Wt.quadrant(e,t)===Wt.quadrant(n,i)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(e){xe.out.print(e)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(e,t){for(var n=0;n<this._edges.size();n++){var i=this._edges.get(n),r=i.getCoordinates();if(this.matchInSameDirection(e,t,r[0],r[1]))return i;if(this.matchInSameDirection(e,t,r[r.length-1],r[r.length-2]))return i}return null}},{key:"insertEdge",value:function(e){this._edges.add(e)}},{key:"findEdgeEnd",value:function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===e)return n}return null}},{key:"addEdges",value:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();this._edges.add(n);var i=new Jt(n,!0),r=new Jt(n,!1);i.setSym(r),r.setSym(i),this.add(i),this.add(r)}}},{key:"add",value:function(e){this._nodes.add(e),this._edgeEndList.add(e)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(e,t){for(var n=0;n<this._edges.size();n++){var i=this._edges.get(n),r=i.getCoordinates();if(e.equals(r[0])&&t.equals(r[1]))return i}return null}}],[{key:"constructor_",value:function(){if(this._edges=new ye,this._nodes=null,this._edgeEndList=new ye,0===arguments.length)this._nodes=new Zt(new Qt);else if(1===arguments.length){var e=arguments[0];this._nodes=new Zt(e)}}},{key:"linkResultDirectedEdges",value:function(e){for(var t=e.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()}}]),en=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"sortShellsAndHoles",value:function(e,t,n){for(var i=e.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):t.add(r)}}},{key:"computePolygons",value:function(e){for(var t=new ye,n=e.iterator();n.hasNext();){var i=n.next().toPolygon(this._geometryFactory);t.add(i)}return t}},{key:"placeFreeHoles",value:function(t,n){for(var i=n.iterator();i.hasNext();){var r=i.next();if(null===r.getShell()){var s=e.findEdgeRingContaining(r,t);if(null===s)throw new ge("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(s)}}}},{key:"buildMinimalEdgeRings",value:function(e,t,n){for(var i=new ye,r=e.iterator();r.hasNext();){var s=r.next();if(s.getMaxNodeDegree()>2){s.linkDirectedEdgesForMinimalEdgeRings();var a=s.buildMinimalRings(),o=this.findShell(a);null!==o?(this.placePolygonHoles(o,a),t.add(o)):n.addAll(a)}else i.add(s)}return i}},{key:"buildMaximalEdgeRings",value:function(e){for(var t=new ye,n=e.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&i.getLabel().isArea()&&null===i.getEdgeRing()){var r=new jt(i,this._geometryFactory);t.add(r),r.setInResult()}}return t}},{key:"placePolygonHoles",value:function(e,t){for(var n=t.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(e)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(e){for(var t=0,n=null,i=e.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,t++)}return G.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n}},{key:"add",value:function(){if(1===arguments.length){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(2===arguments.length){var t=arguments[0],n=arguments[1];$t.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(t),r=new ye,s=this.buildMinimalEdgeRings(i,this._shellList,r);this.sortShellsAndHoles(s,this._shellList,r),this.placeFreeHoles(this._shellList,r)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new ye;var e=arguments[0];this._geometryFactory=e}},{key:"findEdgeRingContaining",value:function(e,t){for(var n=e.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),s=null,a=null,o=t.iterator();o.hasNext();){var u=o.next(),l=u.getLinearRing(),c=l.getEnvelopeInternal();if(!c.equals(i)&&c.contains(i)){r=We.ptNotInList(n.getCoordinates(),l.getCoordinates());var h=!1;Mt.isInRing(r,l.getCoordinates())&&(h=!0),h&&(null===s||a.contains(c))&&(a=(s=u).getLinearRing().getEnvelopeInternal())}}return s}}])}(),tn=a(function e(){n(this,e)},[{key:"getBounds",value:function(){}}]),nn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[tn,I]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t}}]),rn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"poll",value:function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(e){for(var t=null,n=this._items.get(e);2*e<=this._size&&((t=2*e)!==this._size&&this._items.get(t+1).compareTo(this._items.get(t))<0&&t++,this._items.get(t).compareTo(n)<0);e=t)this._items.set(e,this._items.get(t));this._items.set(e,n)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return 0===this._size}},{key:"add",value:function(e){this._items.add(null),this._size+=1;var t=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(t/2)))<0;t/=2)this._items.set(t,this._items.get(Math.trunc(t/2)));this._items.set(t,e)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new ye,this._items.add(null)}}]),sn=a(function e(){n(this,e)},[{key:"insert",value:function(e,t){}},{key:"remove",value:function(e,t){}},{key:"query",value:function(){}}]),an=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(e){G.isTrue(null===this._bounds),this._childBoundables.add(e)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[tn,I]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new ye,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this._level=e}}}]),on={reverseOrder:function(){return{compare:function(e,t){return t.compareTo(e)}}},min:function(e){return on.sort(e),e.get(0)},sort:function(e,t){var n=e.toArray();t?Ae.sort(n,t):Ae.sort(n);for(var i=e.iterator(),r=0,s=n.length;r<s;r++)i.next(),i.set(n[r])},singletonList:function(e){var t=new ye;return t.add(e),t}},un=function(){function e(){n(this,e)}return a(e,null,[{key:"maxDistance",value:function(t,n,i,r,s,a,o,u){var l=e.distance(t,n,s,a);return l=Math.max(l,e.distance(t,n,o,u)),l=Math.max(l,e.distance(i,r,s,a)),Math.max(l,e.distance(i,r,o,u))}},{key:"distance",value:function(e,t,n,i){var r=n-e,s=i-t;return Math.sqrt(r*r+s*s)}},{key:"maximumDistance",value:function(t,n){var i=Math.min(t.getMinX(),n.getMinX()),r=Math.min(t.getMinY(),n.getMinY()),s=Math.max(t.getMaxX(),n.getMaxX()),a=Math.max(t.getMaxY(),n.getMaxY());return e.distance(i,r,s,a)}},{key:"minMaxDistance",value:function(t,n){var i=t.getMinX(),r=t.getMinY(),s=t.getMaxX(),a=t.getMaxY(),o=n.getMinX(),u=n.getMinY(),l=n.getMaxX(),c=n.getMaxY(),h=e.maxDistance(i,r,i,a,o,u,o,c);return h=Math.min(h,e.maxDistance(i,r,i,a,o,u,l,u)),h=Math.min(h,e.maxDistance(i,r,i,a,l,c,o,c)),h=Math.min(h,e.maxDistance(i,r,i,a,l,c,l,u)),h=Math.min(h,e.maxDistance(i,r,s,r,o,u,o,c)),h=Math.min(h,e.maxDistance(i,r,s,r,o,u,l,u)),h=Math.min(h,e.maxDistance(i,r,s,r,l,c,o,c)),h=Math.min(h,e.maxDistance(i,r,s,r,l,c,l,u)),h=Math.min(h,e.maxDistance(s,a,i,a,o,u,o,c)),h=Math.min(h,e.maxDistance(s,a,i,a,o,u,l,u)),h=Math.min(h,e.maxDistance(s,a,i,a,l,c,o,c)),h=Math.min(h,e.maxDistance(s,a,i,a,l,c,l,u)),h=Math.min(h,e.maxDistance(s,a,s,r,o,u,o,c)),h=Math.min(h,e.maxDistance(s,a,s,r,o,u,l,u)),h=Math.min(h,e.maxDistance(s,a,s,r,l,c,o,c)),Math.min(h,e.maxDistance(s,a,s,r,l,c,l,u))}}])}(),ln=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"maximumDistance",value:function(){return un.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(t,n){var i=e.isComposite(this._boundable1),r=e.isComposite(this._boundable2);if(i&&r)return e.area(this._boundable1)>e.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,t,n),null):(this.expand(this._boundable2,this._boundable1,!0,t,n),null);if(i)return this.expand(this._boundable1,this._boundable2,!1,t,n),null;if(r)return this.expand(this._boundable2,this._boundable1,!0,t,n),null;throw new x("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(e.isComposite(this._boundable1)||e.isComposite(this._boundable2))}},{key:"compareTo",value:function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0}},{key:"expand",value:function(t,n,i,r,s){for(var a=t.getChildBoundables().iterator();a.hasNext();){var o=a.next(),u=null;(u=i?new e(n,o,this._itemDistance):new e(o,n,this._itemDistance)).getDistance()<s&&r.add(u)}}},{key:"getBoundable",value:function(e){return 0===e?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[N]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=n,this._distance=this.distance()}},{key:"area",value:function(e){return e.getBounds().getArea()}},{key:"isComposite",value:function(e){return e instanceof an}}])}(),cn=a(function e(){n(this,e)},[{key:"visitItem",value:function(e){}}]),hn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"queryInternal",value:function(){if(se(arguments[2],cn)&&arguments[0]instanceof Object&&arguments[1]instanceof an)for(var e=arguments[0],t=arguments[2],n=arguments[1].getChildBoundables(),i=0;i<n.size();i++){var r=n.get(i);this.getIntersectsOp().intersects(r.getBounds(),e)&&(r instanceof an?this.queryInternal(e,r,t):r instanceof nn?t.visitItem(r.getItem()):G.shouldNeverReachHere())}else if(se(arguments[2],ie)&&arguments[0]instanceof Object&&arguments[1]instanceof an)for(var s=arguments[0],a=arguments[2],o=arguments[1].getChildBoundables(),u=0;u<o.size();u++){var l=o.get(u);this.getIntersectsOp().intersects(l.getBounds(),s)&&(l instanceof an?this.queryInternal(s,l,a):l instanceof nn?a.add(l.getItem()):G.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(e){return e.get(e.size()-1)}},{key:"size",value:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var n=t.next();n instanceof an?e+=this.size(n):n instanceof nn&&(e+=1)}return e}}},{key:"removeItem",value:function(e,t){for(var n=null,i=e.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof nn&&r.getItem()===t&&(n=r)}return null!==n&&(e.getChildBoundables().remove(n),!0)}},{key:"itemsTree",value:function(){if(0===arguments.length){this.build();var e=this.itemsTree(this._root);return null===e?new ye:e}if(1===arguments.length){for(var t=arguments[0],n=new ye,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof an){var s=this.itemsTree(r);null!==s&&n.add(s)}else r instanceof nn?n.add(r.getItem()):G.shouldNeverReachHere()}return n.size()<=0?null:n}}},{key:"insert",value:function(e,t){G.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new nn(e,t))}},{key:"boundablesAtLevel",value:function(){if(1===arguments.length){var e=arguments[0],t=new ye;return this.boundablesAtLevel(e,this._root,t),t}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];if(G.isTrue(n>-2),i.getLevel()===n)return r.add(i),null;for(var s=i.getChildBoundables().iterator();s.hasNext();){var a=s.next();a instanceof an?this.boundablesAtLevel(n,a,r):(G.isTrue(a instanceof nn),-1===n&&r.add(a))}return null}}},{key:"query",value:function(){if(1===arguments.length){var e=arguments[0];this.build();var t=new ye;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.queryInternal(e,this._root,t),t}if(2===arguments.length){var n=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.queryInternal(n,this._root,i)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,t)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],s=this.removeItem(i,r);if(s)return!0;for(var a=null,o=i.getChildBoundables().iterator();o.hasNext();){var u=o.next();if(this.getIntersectsOp().intersects(u.getBounds(),n)&&u instanceof an&&(s=this.remove(n,u,r))){a=u;break}}return null!==a&&a.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(a),s}}},{key:"createHigherLevels",value:function(e,t){G.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,t+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,t+1)}},{key:"depth",value:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var n=t.next();if(n instanceof an){var i=this.depth(n);i>e&&(e=i)}}return e+1}}},{key:"createParentBoundables",value:function(e,t){G.isTrue(!e.isEmpty());var n=new ye;n.add(this.createNode(t));var i=new ye(e);on.sort(i,this.getComparator());for(var r=i.iterator();r.hasNext();){var s=r.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(t)),this.lastNode(n).addChildBoundable(s)}return n}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[I]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new ye,this._nodeCapacity=null,0===arguments.length)e.constructor_.call(this,e.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var t=arguments[0];G.isTrue(t>1,"Node capacity must be greater than 1"),this._nodeCapacity=t}}},{key:"compareDoubles",value:function(e,t){return e>t?1:e<t?-1:0}}])}();hn.IntersectsOp=function(){},hn.DEFAULT_NODE_CAPACITY=10;var fn=a(function e(){n(this,e)},[{key:"distance",value:function(e,t){}}]),dn=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"createParentBoundablesFromVerticalSlices",value:function(e,t){G.isTrue(e.length>0);for(var n=new ye,i=0;i<e.length;i++)n.addAll(this.createParentBoundablesFromVerticalSlice(e[i],t));return n}},{key:"nearestNeighbourK",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return this.nearestNeighbourK(e,A.POSITIVE_INFINITY,t)}if(3===arguments.length){var n=arguments[0],r=arguments[2],s=arguments[1],a=new rn;a.add(n);for(var o=new rn;!a.isEmpty()&&s>=0;){var u=a.poll(),l=u.getDistance();if(l>=s)break;u.isLeaves()?o.size()<r?o.add(u):(o.peek().getDistance()>l&&(o.poll(),o.add(u)),s=o.peek().getDistance()):u.expandToQueue(a,s)}return i.getItems(o)}}},{key:"createNode",value:function(e){return new gn(e)}},{key:"size",value:function(){return 0===arguments.length?d(i,"size",this,1).call(this):d(i,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(2===arguments.length&&arguments[1]instanceof Object&&arguments[0]instanceof X))return d(i,"insert",this,1).apply(this,arguments);var e=arguments[0],t=arguments[1];if(e.isNull())return null;d(i,"insert",this,1).call(this,e,t)}},{key:"getIntersectsOp",value:function(){return i.intersectsOp}},{key:"verticalSlices",value:function(e,t){for(var n=Math.trunc(Math.ceil(e.size()/t)),i=new Array(t).fill(null),r=e.iterator(),s=0;s<t;s++){i[s]=new ye;for(var a=0;r.hasNext()&&a<n;){var o=r.next();i[s].add(o),a++}}return i}},{key:"query",value:function(){if(1===arguments.length){var e=arguments[0];return d(i,"query",this,1).call(this,e)}if(2===arguments.length){var t=arguments[0],n=arguments[1];d(i,"query",this,1).call(this,t,n)}}},{key:"getComparator",value:function(){return i.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(e,t){return d(i,"createParentBoundables",this,1).call(this,e,t)}},{key:"remove",value:function(){if(2===arguments.length&&arguments[1]instanceof Object&&arguments[0]instanceof X){var e=arguments[0],t=arguments[1];return d(i,"remove",this,1).call(this,e,t)}return d(i,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return 0===arguments.length?d(i,"depth",this,1).call(this):d(i,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(e,t){G.isTrue(!e.isEmpty());var n=Math.trunc(Math.ceil(e.size()/this.getNodeCapacity())),r=new ye(e);on.sort(r,i.xComparator);var s=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(s,t)}},{key:"nearestNeighbour",value:function(){if(1===arguments.length){if(se(arguments[0],fn)){var e=arguments[0];if(this.isEmpty())return null;var t=new ln(this.getRoot(),this.getRoot(),e);return this.nearestNeighbour(t)}if(arguments[0]instanceof ln){var n=arguments[0],i=A.POSITIVE_INFINITY,r=null,s=new rn;for(s.add(n);!s.isEmpty()&&i>0;){var a=s.poll(),o=a.getDistance();if(o>=i)break;a.isLeaves()?(i=o,r=a):a.expandToQueue(s,i)}return null===r?null:[r.getBoundable(0).getItem(),r.getBoundable(1).getItem()]}}else{if(2===arguments.length){var u=arguments[0],l=arguments[1];if(this.isEmpty()||u.isEmpty())return null;var c=new ln(this.getRoot(),u.getRoot(),l);return this.nearestNeighbour(c)}if(3===arguments.length){var h=arguments[2],f=new nn(arguments[0],arguments[1]),d=new ln(this.getRoot(),f,h);return this.nearestNeighbour(d)[0]}if(4===arguments.length){var g=arguments[2],v=arguments[3],y=new nn(arguments[0],arguments[1]),p=new ln(this.getRoot(),y,g);return this.nearestNeighbourK(p,v)}}}},{key:"isWithinDistance",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],n=A.POSITIVE_INFINITY,i=new rn;for(i.add(e);!i.isEmpty();){var r=i.poll(),s=r.getDistance();if(s>t)return!1;if(r.maximumDistance()<=t)return!0;if(r.isLeaves()){if((n=s)<=t)return!0}else r.expandToQueue(i,n)}return!1}if(3===arguments.length){var a=arguments[0],o=arguments[1],u=arguments[2],l=new ln(this.getRoot(),a.getRoot(),o);return this.isWithinDistance(l,u)}}},{key:"interfaces_",get:function(){return[sn,I]}}],[{key:"constructor_",value:function(){if(0===arguments.length)i.constructor_.call(this,i.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var e=arguments[0];hn.constructor_.call(this,e)}}},{key:"centreX",value:function(e){return i.avg(e.getMinX(),e.getMaxX())}},{key:"avg",value:function(e,t){return(e+t)/2}},{key:"getItems",value:function(e){for(var t=new Array(e.size()).fill(null),n=0;!e.isEmpty();){var i=e.poll();t[n]=i.getBoundable(0).getItem(),n++}return t}},{key:"centreY",value:function(e){return i.avg(e.getMinY(),e.getMaxY())}}])}(hn),gn=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"computeBounds",value:function(){for(var e=null,t=this.getChildBoundables().iterator();t.hasNext();){var n=t.next();null===e?e=new X(n.getBounds()):e.expandToInclude(n.getBounds())}return e}}],[{key:"constructor_",value:function(){var e=arguments[0];an.constructor_.call(this,e)}}])}(an);dn.STRtreeNode=gn,dn.xComparator=new(a(function e(){n(this,e)},[{key:"interfaces_",get:function(){return[D]}},{key:"compare",value:function(e,t){return hn.compareDoubles(dn.centreX(e.getBounds()),dn.centreX(t.getBounds()))}}])),dn.yComparator=new(a(function e(){n(this,e)},[{key:"interfaces_",get:function(){return[D]}},{key:"compare",value:function(e,t){return hn.compareDoubles(dn.centreY(e.getBounds()),dn.centreY(t.getBounds()))}}])),dn.intersectsOp=new(a(function e(){n(this,e)},[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(e,t){return e.intersects(t)}}])),dn.DEFAULT_NODE_CAPACITY=10;var vn=function(){function e(){n(this,e)}return a(e,null,[{key:"relativeSign",value:function(e,t){return e<t?-1:e>t?1:0}},{key:"compare",value:function(t,n,i){if(n.equals2D(i))return 0;var r=e.relativeSign(n.x,i.x),s=e.relativeSign(n.y,i.y);switch(t){case 0:return e.compareValue(r,s);case 1:return e.compareValue(s,r);case 2:return e.compareValue(s,-r);case 3:return e.compareValue(-r,s);case 4:return e.compareValue(-r,-s);case 5:return e.compareValue(-s,-r);case 6:return e.compareValue(-s,r);case 7:return e.compareValue(r,-s)}return G.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0}}])}(),yn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:this._isInterior?t._isInterior?vn.compare(this._segmentOctant,this.coord,t.coord):1:-1}},{key:"isEndPoint",value:function(e){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===e}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[N]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this._segString=e,this.coord=new B(t),this.segmentIndex=n,this._segmentOctant=i,this._isInterior=!t.equals2D(e.getCoordinate(n))}}]),pn=a(function e(){n(this,e)},[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}]),mn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getSplitCoordinates",value:function(){var e=new Ze;this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next();this.addEdgeCoordinates(n,i,e),n=i}return e.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var e=new ye;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var t=e.iterator();t.hasNext();){var n=t.next().intValue();this.add(this._edge.getCoordinate(n),n)}}},{key:"createSplitEdgePts",value:function(e,t){var n=t.segmentIndex-e.segmentIndex+2;if(2===n)return[new B(e.coord),new B(t.coord)];var i=this._edge.getCoordinate(t.segmentIndex),r=t.isInterior()||!t.coord.equals2D(i);r||n--;var s=new Array(n).fill(null),a=0;s[a++]=new B(e.coord);for(var o=e.segmentIndex+1;o<=t.segmentIndex;o++)s[a++]=this._edge.getCoordinate(o);return r&&(s[a]=new B(t.coord)),s}},{key:"print",value:function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(e)}},{key:"findCollapsesFromExistingVertices",value:function(e){for(var t=0;t<this._edge.size()-2;t++){var n=this._edge.getCoordinate(t);this._edge.getCoordinate(t+1);var i=this._edge.getCoordinate(t+2);n.equals2D(i)&&e.add(oe.valueOf(t+1))}}},{key:"addEdgeCoordinates",value:function(e,t,n){var i=this.createSplitEdgePts(e,t);n.add(i,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(e){this.addEndpoints(),this.addCollapsedNodes();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next(),r=this.createSplitEdge(n,i);e.add(r),n=i}}},{key:"findCollapseIndex",value:function(e,t,n){if(!e.coord.equals2D(t.coord))return!1;var i=t.segmentIndex-e.segmentIndex;return t.isInterior()||i--,1===i&&(n[0]=e.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(e){for(var t=new Array(1).fill(null),n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();this.findCollapseIndex(i,r,t)&&e.add(oe.valueOf(t[0])),i=r}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)}},{key:"createSplitEdge",value:function(e,t){var n=this.createSplitEdgePts(e,t);return new Nn(n,this._edge.getData())}},{key:"add",value:function(e,t){var n=new yn(this._edge,e,t,this._edge.getSegmentOctant(t)),i=this._nodeMap.get(n);return null!==i?(G.isTrue(i.coord.equals2D(e),"Found equal nodes with different coordinates"),i):(this._nodeMap.put(n,n),n)}},{key:"checkSplitEdgesCorrectness",value:function(e){var t=this._edge.getCoordinates(),n=e.get(0).getCoordinate(0);if(!n.equals2D(t[0]))throw new F("bad split edge start point at "+n);var i=e.get(e.size()-1).getCoordinates(),r=i[i.length-1];if(!r.equals2D(t[t.length-1]))throw new F("bad split edge end point at "+r)}}],[{key:"constructor_",value:function(){this._nodeMap=new Ht,this._edge=null;var e=arguments[0];this._edge=e}}]),_n=function(){function e(){n(this,e)}return a(e,null,[{key:"octant",value:function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1];if(0===t&&0===n)throw new x("Cannot compute the octant for point ( "+t+", "+n+" )");var i=Math.abs(t),r=Math.abs(n);return t>=0?n>=0?i>=r?0:1:i>=r?7:6:n>=0?i>=r?3:2:i>=r?4:5}if(arguments[0]instanceof B&&arguments[1]instanceof B){var s=arguments[0],a=arguments[1],o=a.x-s.x,u=a.y-s.y;if(0===o&&0===u)throw new x("Cannot compute the octant for two identical points "+s);return e.octant(o,u)}}}])}(),xn=a(function e(){n(this,e)},[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(e){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(e){}},{key:"getData",value:function(){}}]),kn=a(function e(){n(this,e)},[{key:"addIntersection",value:function(e,t){}},{key:"interfaces_",get:function(){return[xn]}}]),Nn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(e){return this._pts[e]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))}},{key:"setData",value:function(e){this._data=e}},{key:"safeOctant",value:function(e,t){return e.equals2D(t)?0:_n.octant(e,t)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(4===arguments.length){var n=arguments[1],i=arguments[3],r=new B(arguments[0].getIntersection(i));this.addIntersection(r,n)}}},{key:"toString",value:function(){return Tt.toLineString(new $e(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(e,t){var n=t,i=n+1;if(i<this._pts.length){var r=this._pts[i];e.equals2D(r)&&(n=i)}return this._nodeList.add(e,n)}},{key:"addIntersections",value:function(e,t,n){for(var i=0;i<e.getIntersectionNum();i++)this.addIntersection(e,t,n,i)}},{key:"interfaces_",get:function(){return[kn]}}],[{key:"constructor_",value:function(){this._nodeList=new mn(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t}},{key:"getNodedSubstrings",value:function(){if(1===arguments.length){var t=arguments[0],n=new ye;return e.getNodedSubstrings(t,n),n}if(2===arguments.length)for(var i=arguments[1],r=arguments[0].iterator();r.hasNext();)r.next().getNodeList().addSplitEdges(i)}}])}(),En=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof e){var t=arguments[0],n=fe.index(this.p0,this.p1,t.p0),i=fe.index(this.p0,this.p1,t.p1);return n>=0&&i>=0||n<=0&&i<=0?Math.max(n,i):0}if(arguments[0]instanceof B){var r=arguments[0];return fe.index(this.p0,this.p1,r)}}},{key:"toGeometry",value:function(e){return e.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;return this.p0.equals(n.p0)&&this.p1.equals(n.p1)}},{key:"intersection",value:function(e){var t=new Rt;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof B){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new B(t);var n=this.projectionFactor(t),i=new B;return i.x=this.p0.x+n*(this.p1.x-this.p0.x),i.y=this.p0.y+n*(this.p1.y-this.p0.y),i}if(arguments[0]instanceof e){var r=arguments[0],s=this.projectionFactor(r.p0),a=this.projectionFactor(r.p1);if(s>=1&&a>=1)return null;if(s<=0&&a<=0)return null;var o=this.project(r.p0);s<0&&(o=this.p0),s>1&&(o=this.p1);var u=this.project(r.p1);return a<0&&(u=this.p0),a>1&&(u=this.p1),new e(o,u)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(e){return 0===e?this.p0:this.p1}},{key:"distancePerpendicular",value:function(e){return Ne.pointToLinePerpendicular(e,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return e.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=t*t+n*n;return i<=0?A.NaN:((e.x-this.p0.x)*t+(e.y-this.p0.y)*n)/i}},{key:"closestPoints",value:function(e){var t=this.intersection(e);if(null!==t)return[t,t];var n=new Array(2).fill(null),i=A.MAX_VALUE,r=null,s=this.closestPoint(e.p0);i=s.distance(e.p0),n[0]=s,n[1]=e.p0;var a=this.closestPoint(e.p1);(r=a.distance(e.p1))<i&&(i=r,n[0]=a,n[1]=e.p1);var o=e.closestPoint(this.p0);(r=o.distance(this.p0))<i&&(i=r,n[0]=this.p0,n[1]=o);var u=e.closestPoint(this.p1);return(r=u.distance(this.p1))<i&&(i=r,n[0]=this.p1,n[1]=u),n}},{key:"closestPoint",value:function(e){var t=this.projectionFactor(e);return t>0&&t<1?this.project(e):this.p0.distance(e)<this.p1.distance(e)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(e){var t=e,n=this.p0.compareTo(t.p0);return 0!==n?n:this.p1.compareTo(t.p1)}},{key:"reverse",value:function(){var e=this.p0;this.p0=this.p1,this.p1=e}},{key:"equalsTopo",value:function(e){return this.p0.equals(e.p0)&&this.p1.equals(e.p1)||this.p0.equals(e.p1)&&this.p1.equals(e.p0)}},{key:"lineIntersection",value:function(e){return _e.intersection(this.p0,this.p1,e.p0,e.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(e,t){var n=this.p0.x+e*(this.p1.x-this.p0.x),i=this.p0.y+e*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,s=this.p1.y-this.p0.y,a=Math.sqrt(r*r+s*s),o=0,u=0;if(0!==t){if(a<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");o=t*r/a,u=t*s/a}return new B(n-u,i+o)}},{key:"setCoordinates",value:function(){if(1===arguments.length){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}}},{key:"segmentFraction",value:function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||A.isNaN(t))&&(t=1),t}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(e){var t=this.p1.getY()-this.p0.getY(),n=this.p0.getX()-this.p1.getX(),i=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),r=t*t+n*n,s=t*t-n*n,a=e.getX(),o=e.getY();return new B((-s*a-2*t*n*o-2*t*i)/r,(s*o-2*t*n*a-2*n*i)/r)}},{key:"distance",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return Ne.segmentToSegment(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof B){var n=arguments[0];return Ne.pointToSegment(n,this.p0,this.p1)}}},{key:"pointAlong",value:function(e){var t=new B;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t}},{key:"hashCode",value:function(){var e=A.doubleToLongBits(this.p0.x);e^=31*A.doubleToLongBits(this.p0.y);var t=Math.trunc(e)^Math.trunc(e>>32),n=A.doubleToLongBits(this.p1.x);return n^=31*A.doubleToLongBits(this.p1.y),t^Math.trunc(n)^Math.trunc(n>>32)}},{key:"interfaces_",get:function(){return[N,I]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,0===arguments.length)e.constructor_.call(this,new B,new B);else if(1===arguments.length){var t=arguments[0];e.constructor_.call(this,t.p0,t.p1)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.p0=n,this.p1=i}else if(4===arguments.length){var r=arguments[0],s=arguments[1],a=arguments[2],o=arguments[3];e.constructor_.call(this,new B(r,s),new B(a,o))}}},{key:"midPoint",value:function(e,t){return new B((e.x+t.x)/2,(e.y+t.y)/2)}}])}(),In=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"overlap",value:function(){if(2===arguments.length);else if(4===arguments.length){var e=arguments[1],t=arguments[2],n=arguments[3];arguments[0].getLineSegment(e,this._overlapSeg1),t.getLineSegment(n,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new En,this._overlapSeg2=new En}}]),bn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getLineSegment",value:function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]}},{key:"computeSelect",value:function(e,t,n,i){var r=this._pts[t],s=this._pts[n];if(n-t==1)return i.select(this,t),null;if(!e.intersects(r,s))return null;var a=Math.trunc((t+n)/2);t<a&&this.computeSelect(e,t,a,i),a<n&&this.computeSelect(e,a,n,i)}},{key:"getCoordinates",value:function(){for(var e=new Array(this._end-this._start+1).fill(null),t=0,n=this._start;n<=this._end;n++)e[t++]=this._pts[n];return e}},{key:"computeOverlaps",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.computeOverlaps(this._start,this._end,e,e._start,e._end,t)}else if(6===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],s=arguments[3],a=arguments[4],o=arguments[5];if(i-n==1&&a-s==1)return o.overlap(this,n,r,s),null;if(!this.overlaps(n,i,r,s,a))return null;var u=Math.trunc((n+i)/2),l=Math.trunc((s+a)/2);n<u&&(s<l&&this.computeOverlaps(n,u,r,s,l,o),l<a&&this.computeOverlaps(n,u,r,l,a,o)),u<i&&(s<l&&this.computeOverlaps(u,i,r,s,l,o),l<a&&this.computeOverlaps(u,i,r,l,a,o))}}},{key:"setId",value:function(e){this._id=e}},{key:"select",value:function(e,t){this.computeSelect(e,this._start,this._end,t)}},{key:"getEnvelope",value:function(){if(null===this._env){var e=this._pts[this._start],t=this._pts[this._end];this._env=new X(e,t)}return this._env}},{key:"overlaps",value:function(e,t,n,i,r){return X.intersects(this._pts[e],this._pts[t],n._pts[i],n._pts[r])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this._pts=e,this._start=t,this._end=n,this._context=i}}]),wn=function(){function e(){n(this,e)}return a(e,null,[{key:"findChainEnd",value:function(e,t){for(var n=t;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var i=Wt.quadrant(e[n],e[n+1]),r=t+1;r<e.length&&(e[r-1].equals2D(e[r])||Wt.quadrant(e[r-1],e[r])===i);)r++;return r-1}},{key:"getChains",value:function(){if(1===arguments.length){var t=arguments[0];return e.getChains(t,null)}if(2===arguments.length){var n=arguments[0],i=arguments[1],r=new ye,s=0;do{var a=e.findChainEnd(n,s),o=new bn(n,s,a,i);r.add(o),s=a}while(s<n.length-1);return r}}}])}(),Sn=a(function e(){n(this,e)},[{key:"computeNodes",value:function(e){}},{key:"getNodedSubstrings",value:function(){}}]),Cn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"setSegmentIntersector",value:function(e){this._segInt=e}},{key:"interfaces_",get:function(){return[Sn]}}],[{key:"constructor_",value:function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setSegmentIntersector(e)}}}]),Tn=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return Nn.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(e){for(var t=wn.getChains(e.getCoordinates(),e).iterator();t.hasNext();){var n=t.next();n.setId(this._idCounter++),this._index.insert(n.getEnvelope(),n),this._monoChains.add(n)}}},{key:"computeNodes",value:function(e){this._nodedSegStrings=e;for(var t=e.iterator();t.hasNext();)this.add(t.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var e=new Ln(this._segInt),t=this._monoChains.iterator();t.hasNext();)for(var n=t.next(),i=this._index.query(n.getEnvelope()).iterator();i.hasNext();){var r=i.next();if(r.getId()>n.getId()&&(n.computeOverlaps(r,e),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new ye,this._index=new dn,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,0===arguments.length);else if(1===arguments.length){var e=arguments[0];Cn.constructor_.call(this,e)}}}])}(Cn),Ln=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"overlap",value:function(){if(4!==arguments.length)return d(i,"overlap",this,1).apply(this,arguments);var e=arguments[1],t=arguments[2],n=arguments[3],r=arguments[0].getContext(),s=t.getContext();this._si.processIntersections(r,e,s,n)}}],[{key:"constructor_",value:function(){this._si=null;var e=arguments[0];this._si=e}}])}(In);Tn.SegmentOverlapAction=Ln;var Rn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"isDeletable",value:function(e,t,n,i){var r=this._inputLine[e],s=this._inputLine[t],a=this._inputLine[n];return!!this.isConcave(r,s,a)&&!!this.isShallow(r,s,a,i)&&this.isShallowSampled(r,s,e,n,i)}},{key:"deleteShallowConcavities",value:function(){for(var t=1,n=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(n),r=!1;i<this._inputLine.length;){var s=!1;this.isDeletable(t,n,i,this._distanceTol)&&(this._isDeleted[n]=e.DELETE,s=!0,r=!0),t=s?i:n,n=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(n)}return r}},{key:"isShallowConcavity",value:function(e,t,n,i){return fe.index(e,t,n)===this._angleOrientation&&Ne.pointToSegment(t,e,n)<i}},{key:"isShallowSampled",value:function(t,n,i,r,s){var a=Math.trunc((r-i)/e.NUM_PTS_TO_CHECK);a<=0&&(a=1);for(var o=i;o<r;o+=a)if(!this.isShallow(t,n,this._inputLine[o],s))return!1;return!0}},{key:"isConcave",value:function(e,t,n){return fe.index(e,t,n)===this._angleOrientation}},{key:"simplify",value:function(e){this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=fe.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var t=!1;do{t=this.deleteShallowConcavities()}while(t);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(t){for(var n=t+1;n<this._inputLine.length&&this._isDeleted[n]===e.DELETE;)n++;return n}},{key:"isShallow",value:function(e,t,n,i){return Ne.pointToSegment(t,e,n)<i}},{key:"collapseLine",value:function(){for(var t=new Ze,n=0;n<this._inputLine.length;n++)this._isDeleted[n]!==e.DELETE&&t.add(this._inputLine[n]);return t.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=fe.COUNTERCLOCKWISE;var e=arguments[0];this._inputLine=e}},{key:"simplify",value:function(t,n){return new e(t).simplify(n)}}])}();Rn.INIT=0,Rn.DELETE=1,Rn.KEEP=1,Rn.NUM_PTS_TO_CHECK=10;var On=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getCoordinates",value:function(){return this._ptList.toArray(e.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(e){this._precisionModel=e}},{key:"addPt",value:function(e){var t=new B(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(e,t){if(t)for(var n=0;n<e.length;n++)this.addPt(e[n]);else for(var i=e.length-1;i>=0;i--)this.addPt(e[i])}},{key:"isRedundant",value:function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1);return e.distance(t)<this._minimimVertexDistance}},{key:"toString",value:function(){return(new ot).createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var e=new B(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)}},{key:"setMinimumVertexDistance",value:function(e){this._minimimVertexDistance=e}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new ye}}])}();On.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Mn=function(){function e(){n(this,e)}return a(e,null,[{key:"toDegrees",value:function(e){return 180*e/Math.PI}},{key:"normalize",value:function(t){for(;t>Math.PI;)t-=e.PI_TIMES_2;for(;t<=-Math.PI;)t+=e.PI_TIMES_2;return t}},{key:"angle",value:function(){if(1===arguments.length){var e=arguments[0];return Math.atan2(e.y,e.x)}if(2===arguments.length){var t=arguments[0],n=arguments[1],i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)}}},{key:"isAcute",value:function(e,t,n){var i=e.x-t.x,r=e.y-t.y;return i*(n.x-t.x)+r*(n.y-t.y)>0}},{key:"isObtuse",value:function(e,t,n){var i=e.x-t.x,r=e.y-t.y;return i*(n.x-t.x)+r*(n.y-t.y)<0}},{key:"interiorAngle",value:function(t,n,i){var r=e.angle(n,t),s=e.angle(n,i);return Math.abs(s-r)}},{key:"normalizePositive",value:function(t){if(t<0){for(;t<0;)t+=e.PI_TIMES_2;t>=e.PI_TIMES_2&&(t=0)}else{for(;t>=e.PI_TIMES_2;)t-=e.PI_TIMES_2;t<0&&(t=0)}return t}},{key:"angleBetween",value:function(t,n,i){var r=e.angle(n,t),s=e.angle(n,i);return e.diff(r,s)}},{key:"diff",value:function(e,t){var n=null;return(n=e<t?t-e:e-t)>Math.PI&&(n=2*Math.PI-n),n}},{key:"toRadians",value:function(e){return e*Math.PI/180}},{key:"getTurn",value:function(t,n){var i=Math.sin(n-t);return i>0?e.COUNTERCLOCKWISE:i<0?e.CLOCKWISE:e.NONE}},{key:"angleBetweenOriented",value:function(t,n,i){var r=e.angle(n,t),s=e.angle(n,i)-r;return s<=-Math.PI?s+e.PI_TIMES_2:s>Math.PI?s-e.PI_TIMES_2:s}}])}();Mn.PI_TIMES_2=2*Math.PI,Mn.PI_OVER_2=Math.PI/2,Mn.PI_OVER_4=Math.PI/4,Mn.COUNTERCLOCKWISE=fe.COUNTERCLOCKWISE,Mn.CLOCKWISE=fe.CLOCKWISE,Mn.NONE=fe.COLLINEAR;var Pn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"addNextSegment",value:function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=fe.index(this._s0,this._s1,this._s2),i=n===fe.CLOCKWISE&&this._side===ee.LEFT||n===fe.COUNTERCLOCKWISE&&this._side===ee.RIGHT;0===n?this.addCollinear(t):i?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)}},{key:"addLineEndCap",value:function(e,t){var n=new En(e,t),i=new En;this.computeOffsetSegment(n,ee.LEFT,this._distance,i);var r=new En;this.computeOffsetSegment(n,ee.RIGHT,this._distance,r);var s=t.x-e.x,a=t.y-e.y,o=Math.atan2(a,s);switch(this._bufParams.getEndCapStyle()){case m.CAP_ROUND:this._segList.addPt(i.p1),this.addDirectedFillet(t,o+Math.PI/2,o-Math.PI/2,fe.CLOCKWISE,this._distance),this._segList.addPt(r.p1);break;case m.CAP_FLAT:this._segList.addPt(i.p1),this._segList.addPt(r.p1);break;case m.CAP_SQUARE:var u=new B;u.x=Math.abs(this._distance)*Math.cos(o),u.y=Math.abs(this._distance)*Math.sin(o);var l=new B(i.p1.x+u.x,i.p1.y+u.y),c=new B(r.p1.x+u.x,r.p1.y+u.y);this._segList.addPt(l),this._segList.addPt(c)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(e,t,n,i){var r=_e.intersection(t.p0,t.p1,n.p0,n.p1);if(null!==r&&(i<=0?1:r.distance(e)/Math.abs(i))<=this._bufParams.getMitreLimit())return this._segList.addPt(r),null;this.addLimitedMitreJoin(t,n,i,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(t,n){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*e.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===m.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===m.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(n&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(e){this._segList.addPt(new B(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new B(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new B(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new B(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(e,t){this._segList.addPts(e,t)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(e,t,n,i,r){var s=t.x-e.x,a=t.y-e.y,o=Math.atan2(a,s),u=n.x-e.x,l=n.y-e.y,c=Math.atan2(l,u);i===fe.CLOCKWISE?o<=c&&(o+=2*Math.PI):o>=c&&(o-=2*Math.PI),this._segList.addPt(t),this.addDirectedFillet(e,o,c,i,r),this._segList.addPt(n)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(e,t,n){this._s1=e,this._s2=t,this._side=n,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(e,t,n,i){var r=this._seg0.p1,s=Mn.angle(r,this._seg0.p0),a=Mn.angleBetweenOriented(this._seg0.p0,r,this._seg1.p1)/2,o=Mn.normalize(s+a),u=Mn.normalize(o+Math.PI),l=i*n,c=n-l*Math.abs(Math.sin(a)),h=r.x+l*Math.cos(u),f=r.y+l*Math.sin(u),d=new B(h,f),g=new En(r,d),v=g.pointAlongOffset(1,c),y=g.pointAlongOffset(1,-c);this._side===ee.LEFT?(this._segList.addPt(v),this._segList.addPt(y)):(this._segList.addPt(y),this._segList.addPt(v))}},{key:"addDirectedFillet",value:function(e,t,n,i,r){var s=i===fe.CLOCKWISE?-1:1,a=Math.abs(t-n),o=Math.trunc(a/this._filletAngleQuantum+.5);if(o<1)return null;for(var u=a/o,l=new B,c=0;c<o;c++){var h=t+s*c*u;l.x=e.x+r*Math.cos(h),l.y=e.y+r*Math.sin(h),this._segList.addPt(l)}}},{key:"computeOffsetSegment",value:function(e,t,n,i){var r=t===ee.LEFT?1:-1,s=e.p1.x-e.p0.x,a=e.p1.y-e.p0.y,o=Math.sqrt(s*s+a*a),u=r*n*s/o,l=r*n*a/o;i.p0.x=e.p0.x-l,i.p0.y=e.p0.y+u,i.p1.x=e.p1.x-l,i.p1.y=e.p1.y+u}},{key:"addInsideTurn",value:function(t,n){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*e.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var i=new B((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i);var r=new B((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(e){var t=new B(e.x+this._distance,e.y);this._segList.addPt(t),this.addDirectedFillet(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)}},{key:"init",value:function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new On,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*e.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===m.JOIN_BEVEL||this._bufParams.getJoinStyle()===m.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,fe.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new En,this._seg1=new En,this._offset0=new En,this._offset1=new En,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],n=arguments[1],i=arguments[2];this._precisionModel=t,this._bufParams=n,this._li=new Rt,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===m.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)}}])}();Pn.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Pn.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Pn.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Pn.MAX_CLOSING_SEG_LEN_FACTOR=80;var An=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getOffsetCurve",value:function(e,t){if(this._distance=t,0===t)return null;var n=t<0,i=Math.abs(t),r=this.getSegGen(i);e.length<=1?this.computePointCurve(e[0],r):this.computeOffsetCurve(e,n,r);var s=r.getCoordinates();return n&&We.reverse(s),s}},{key:"computeSingleSidedBufferCurve",value:function(e,t,n){var i=this.simplifyTolerance(this._distance);if(t){n.addSegments(e,!0);var r=Rn.simplify(e,-i),s=r.length-1;n.initSideSegments(r[s],r[s-1],ee.LEFT),n.addFirstSegment();for(var a=s-2;a>=0;a--)n.addNextSegment(r[a],!0)}else{n.addSegments(e,!1);var o=Rn.simplify(e,i),u=o.length-1;n.initSideSegments(o[0],o[1],ee.LEFT),n.addFirstSegment();for(var l=2;l<=u;l++)n.addNextSegment(o[l],!0)}n.addLastSegment(),n.closeRing()}},{key:"computeRingBufferCurve",value:function(e,t,n){var i=this.simplifyTolerance(this._distance);t===ee.RIGHT&&(i=-i);var r=Rn.simplify(e,i),s=r.length-1;n.initSideSegments(r[s-1],r[0],t);for(var a=1;a<=s;a++){var o=1!==a;n.addNextSegment(r[a],o)}n.closeRing()}},{key:"computeLineBufferCurve",value:function(e,t){var n=this.simplifyTolerance(this._distance),i=Rn.simplify(e,n),r=i.length-1;t.initSideSegments(i[0],i[1],ee.LEFT);for(var s=2;s<=r;s++)t.addNextSegment(i[s],!0);t.addLastSegment(),t.addLineEndCap(i[r-1],i[r]);var a=Rn.simplify(e,-n),o=a.length-1;t.initSideSegments(a[o],a[o-1],ee.LEFT);for(var u=o-2;u>=0;u--)t.addNextSegment(a[u],!0);t.addLastSegment(),t.addLineEndCap(a[1],a[0]),t.closeRing()}},{key:"computePointCurve",value:function(e,t){switch(this._bufParams.getEndCapStyle()){case m.CAP_ROUND:t.createCircle(e);break;case m.CAP_SQUARE:t.createSquare(e)}}},{key:"getLineCurve",value:function(e,t){if(this._distance=t,this.isLineOffsetEmpty(t))return null;var n=Math.abs(t),i=this.getSegGen(n);if(e.length<=1)this.computePointCurve(e[0],i);else if(this._bufParams.isSingleSided()){var r=t<0;this.computeSingleSidedBufferCurve(e,r,i)}else this.computeLineBufferCurve(e,i);return i.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(e){return e*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(t,n,i){if(this._distance=i,t.length<=2)return this.getLineCurve(t,i);if(0===i)return e.copyCoordinates(t);var r=this.getSegGen(i);return this.computeRingBufferCurve(t,n,r),r.getCoordinates()}},{key:"computeOffsetCurve",value:function(e,t,n){var i=this.simplifyTolerance(this._distance);if(t){var r=Rn.simplify(e,-i),s=r.length-1;n.initSideSegments(r[s],r[s-1],ee.LEFT),n.addFirstSegment();for(var a=s-2;a>=0;a--)n.addNextSegment(r[a],!0)}else{var o=Rn.simplify(e,i),u=o.length-1;n.initSideSegments(o[0],o[1],ee.LEFT),n.addFirstSegment();for(var l=2;l<=u;l++)n.addNextSegment(o[l],!0)}n.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(e){return 0===e||e<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(e){return new Pn(this._precisionModel,this._bufParams,e)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t}},{key:"copyCoordinates",value:function(e){for(var t=new Array(e.length).fill(null),n=0;n<t.length;n++)t[n]=new B(e[n]);return t}}])}(),Dn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"findStabbedSegments",value:function(){if(1===arguments.length){for(var e=arguments[0],t=new ye,n=this._subgraphs.iterator();n.hasNext();){var i=n.next(),r=i.getEnvelope();e.y<r.getMinY()||e.y>r.getMaxY()||this.findStabbedSegments(e,i.getDirectedEdges(),t)}return t}if(3===arguments.length)if(se(arguments[2],ie)&&arguments[0]instanceof B&&arguments[1]instanceof Jt){for(var s=arguments[0],a=arguments[1],o=arguments[2],u=a.getEdge().getCoordinates(),l=0;l<u.length-1;l++)if(this._seg.p0=u[l],this._seg.p1=u[l+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<s.x||this._seg.isHorizontal()||s.y<this._seg.p0.y||s.y>this._seg.p1.y||fe.index(this._seg.p0,this._seg.p1,s)===fe.RIGHT)){var c=a.getDepth(ee.LEFT);this._seg.p0.equals(u[l])||(c=a.getDepth(ee.RIGHT));var h=new Fn(this._seg,c);o.add(h)}}else if(se(arguments[2],ie)&&arguments[0]instanceof B&&se(arguments[1],ie))for(var f=arguments[0],d=arguments[2],g=arguments[1].iterator();g.hasNext();){var v=g.next();v.isForward()&&this.findStabbedSegments(f,v,d)}}},{key:"getDepth",value:function(e){var t=this.findStabbedSegments(e);return 0===t.size()?0:on.min(t)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new En;var e=arguments[0];this._subgraphs=e}}]),Fn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"compareTo",value:function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(t._upwardSeg);return 0!==n||0!=(n=-1*t._upwardSeg.orientationIndex(this._upwardSeg))?n:this._upwardSeg.compareTo(t._upwardSeg)}},{key:"compareX",value:function(e,t){var n=e.p0.compareTo(t.p0);return 0!==n?n:e.p1.compareTo(t.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[N]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new En(e),this._leftDepth=t}}]);Dn.DepthSegment=Fn;var jn=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,null,[{key:"constructor_",value:function(){_.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])}(_),Gn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getY",value:function(){var e=this.y/this.w;if(A.isNaN(e)||A.isInfinite(e))throw new jn;return e}},{key:"getX",value:function(){var e=this.x/this.w;if(A.isNaN(e)||A.isInfinite(e))throw new jn;return e}},{key:"getCoordinate",value:function(){var e=new B;return e.x=this.getX(),e.y=this.getY(),e}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],i=arguments[1];this.x=n,this.y=i,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var r=arguments[0],s=arguments[1];this.x=r.y*s.w-s.y*r.w,this.y=s.x*r.w-r.x*s.w,this.w=r.x*s.y-s.x*r.y}else if(arguments[0]instanceof B&&arguments[1]instanceof B){var a=arguments[0],o=arguments[1];this.x=a.y-o.y,this.y=o.x-a.x,this.w=a.x*o.y-o.x*a.y}}else if(3===arguments.length){var u=arguments[0],l=arguments[1],c=arguments[2];this.x=u,this.y=l,this.w=c}else if(4===arguments.length){var h=arguments[0],f=arguments[1],d=arguments[2],g=arguments[3],v=h.y-f.y,y=f.x-h.x,p=h.x*f.y-f.x*h.y,m=d.y-g.y,_=g.x-d.x,x=d.x*g.y-g.x*d.y;this.x=y*x-_*p,this.y=m*p-v*x,this.w=v*_-m*y}}}])}(),zn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"area",value:function(){return e.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return e.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(t){if(null===t)throw new x("Supplied point is null.");return e.interpolateZ(t,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return e.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return e.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return e.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return e.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return e.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return e.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.p0=e,this.p1=t,this.p2=n}},{key:"area",value:function(e,t,n){return Math.abs(((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2)}},{key:"signedArea",value:function(e,t,n){return((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2}},{key:"det",value:function(e,t,n,i){return e*i-t*n}},{key:"interpolateZ",value:function(e,t,n,i){var r=t.x,s=t.y,a=n.x-r,o=i.x-r,u=n.y-s,l=i.y-s,c=a*l-o*u,h=e.x-r,f=e.y-s,d=(l*h-o*f)/c,g=(-u*h+a*f)/c;return t.getZ()+d*(n.getZ()-t.getZ())+g*(i.getZ()-t.getZ())}},{key:"longestSideLength",value:function(e,t,n){var i=e.distance(t),r=t.distance(n),s=n.distance(e),a=i;return r>a&&(a=r),s>a&&(a=s),a}},{key:"circumcentreDD",value:function(e,t,n){var i=le.valueOf(e.x).subtract(n.x),r=le.valueOf(e.y).subtract(n.y),s=le.valueOf(t.x).subtract(n.x),a=le.valueOf(t.y).subtract(n.y),o=le.determinant(i,r,s,a).multiply(2),u=i.sqr().add(r.sqr()),l=s.sqr().add(a.sqr()),c=le.determinant(r,u,a,l),h=le.determinant(i,u,s,l),f=le.valueOf(n.x).subtract(c.divide(o)).doubleValue(),d=le.valueOf(n.y).add(h.divide(o)).doubleValue();return new B(f,d)}},{key:"isAcute",value:function(e,t,n){return!!Mn.isAcute(e,t,n)&&!!Mn.isAcute(t,n,e)&&!!Mn.isAcute(n,e,t)}},{key:"circumcentre",value:function(t,n,i){var r=i.x,s=i.y,a=t.x-r,o=t.y-s,u=n.x-r,l=n.y-s,c=2*e.det(a,o,u,l),h=e.det(o,a*a+o*o,l,u*u+l*l),f=e.det(a,a*a+o*o,u,u*u+l*l);return new B(r-h/c,s+f/c)}},{key:"perpendicularBisector",value:function(e,t){var n=t.x-e.x,i=t.y-e.y,r=new Gn(e.x+n/2,e.y+i/2,1),s=new Gn(e.x-i+n/2,e.y+n+i/2,1);return new Gn(r,s)}},{key:"angleBisector",value:function(e,t,n){var i=t.distance(e),r=i/(i+t.distance(n)),s=n.x-e.x,a=n.y-e.y;return new B(e.x+r*s,e.y+r*a)}},{key:"area3D",value:function(e,t,n){var i=t.x-e.x,r=t.y-e.y,s=t.getZ()-e.getZ(),a=n.x-e.x,o=n.y-e.y,u=n.getZ()-e.getZ(),l=r*u-s*o,c=s*a-i*u,h=i*o-r*a,f=l*l+c*c+h*h;return Math.sqrt(f)/2}},{key:"centroid",value:function(e,t,n){var i=(e.x+t.x+n.x)/3,r=(e.y+t.y+n.y)/3;return new B(i,r)}},{key:"inCentre",value:function(e,t,n){var i=t.distance(n),r=e.distance(n),s=e.distance(t),a=i+r+s,o=(i*e.x+r*t.x+s*n.x)/a,u=(i*e.y+r*t.y+s*n.y)/a;return new B(o,u)}}])}(),qn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"addRingSide",value:function(e,t,n,i,r){if(0===t&&e.length<Be.MINIMUM_VALID_SIZE)return null;var s=i,a=r;e.length>=Be.MINIMUM_VALID_SIZE&&fe.isCCW(e)&&(s=r,a=i,n=ee.opposite(n));var o=this._curveBuilder.getRingCurve(e,n,t);this.addCurve(o,s,a)}},{key:"addRingBothSides",value:function(e,t){this.addRingSide(e,t,ee.LEFT,H.EXTERIOR,H.INTERIOR),this.addRingSide(e,t,ee.RIGHT,H.INTERIOR,H.EXTERIOR)}},{key:"addPoint",value:function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,H.EXTERIOR,H.INTERIOR)}},{key:"addPolygon",value:function(e){var t=this._distance,n=ee.LEFT;this._distance<0&&(t=-this._distance,n=ee.RIGHT);var i=e.getExteriorRing(),r=We.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance))return null;if(this._distance<=0&&r.length<3)return null;this.addRingSide(r,t,n,H.EXTERIOR,H.INTERIOR);for(var s=0;s<e.getNumInteriorRing();s++){var a=e.getInteriorRingN(s),o=We.removeRepeatedPoints(a.getCoordinates());this._distance>0&&this.isErodedCompletely(a,-this._distance)||this.addRingSide(o,t,ee.opposite(n),H.INTERIOR,H.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(e,t){var n=new zn(e[0],e[1],e[2]),i=n.inCentre();return Ne.pointToSegment(i,n.p0,n.p1)<Math.abs(t)}},{key:"addLineString",value:function(e){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var t=We.removeRepeatedPoints(e.getCoordinates());if(We.isRing(t)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(t,this._distance);else{var n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,H.EXTERIOR,H.INTERIOR)}}},{key:"addCurve",value:function(e,t,n){if(null===e||e.length<2)return null;var i=new Nn(e,new At(0,H.BOUNDARY,t,n));this._curveList.add(i)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(e){if(e.isEmpty())return null;if(e instanceof Fe)this.addPolygon(e);else if(e instanceof Re)this.addLineString(e);else if(e instanceof Me)this.addPoint(e);else if(e instanceof Ye)this.addCollection(e);else if(e instanceof at)this.addCollection(e);else if(e instanceof tt)this.addCollection(e);else{if(!(e instanceof qe))throw new K(e.getGeometryType());this.addCollection(e)}}},{key:"isErodedCompletely",value:function(e,t){var n=e.getCoordinates();if(n.length<4)return t<0;if(4===n.length)return this.isTriangleErodedCompletely(n,t);var i=e.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return t<0&&2*Math.abs(t)>r}},{key:"addCollection",value:function(e){for(var t=0;t<e.getNumGeometries();t++){var n=e.getGeometryN(t);this.add(n)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new ye;var e=arguments[0],t=arguments[1],n=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=n}}]),Yn=a(function e(){n(this,e)},[{key:"locate",value:function(e){}}]),Bn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,e.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new W;var t=this._parent.getGeometryN(this._index++);return t instanceof qe?(this._subcollectionIterator=new e(t),this._subcollectionIterator.next()):t}},{key:"remove",value:function(){throw new K(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[pn]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()}},{key:"isAtomic",value:function(e){return!(e instanceof qe)}}])}(),Un=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"locate",value:function(t){return e.locate(t,this._geom)}},{key:"interfaces_",get:function(){return[Yn]}}],[{key:"constructor_",value:function(){this._geom=null;var e=arguments[0];this._geom=e}},{key:"locatePointInPolygon",value:function(t,n){if(n.isEmpty())return H.EXTERIOR;var i=n.getExteriorRing(),r=e.locatePointInRing(t,i);if(r!==H.INTERIOR)return r;for(var s=0;s<n.getNumInteriorRing();s++){var a=n.getInteriorRingN(s),o=e.locatePointInRing(t,a);if(o===H.BOUNDARY)return H.BOUNDARY;if(o===H.INTERIOR)return H.EXTERIOR}return H.INTERIOR}},{key:"locatePointInRing",value:function(e,t){return t.getEnvelopeInternal().intersects(e)?Mt.locateInRing(e,t.getCoordinates()):H.EXTERIOR}},{key:"containsPointInPolygon",value:function(t,n){return H.EXTERIOR!==e.locatePointInPolygon(t,n)}},{key:"locateInGeometry",value:function(t,n){if(n instanceof Fe)return e.locatePointInPolygon(t,n);if(n instanceof qe)for(var i=new Bn(n);i.hasNext();){var r=i.next();if(r!==n){var s=e.locateInGeometry(t,r);if(s!==H.EXTERIOR)return s}}return H.EXTERIOR}},{key:"isContained",value:function(t,n){return H.EXTERIOR!==e.locate(t,n)}},{key:"locate",value:function(t,n){return n.isEmpty()?H.EXTERIOR:n.getEnvelopeInternal().intersects(t)?e.locateInGeometry(t,n):H.EXTERIOR}}])}(),Xn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getNextCW",value:function(e){this.getEdges();var t=this._edgeList.indexOf(e),n=t-1;return 0===t&&(n=this._edgeList.size()-1),this._edgeList.get(n)}},{key:"propagateSideLabels",value:function(e){for(var t=H.NONE,n=this.iterator();n.hasNext();){var i=n.next().getLabel();i.isArea(e)&&i.getLocation(e,ee.LEFT)!==H.NONE&&(t=i.getLocation(e,ee.LEFT))}if(t===H.NONE)return null;for(var r=t,s=this.iterator();s.hasNext();){var a=s.next(),o=a.getLabel();if(o.getLocation(e,ee.ON)===H.NONE&&o.setLocation(e,ee.ON,r),o.isArea(e)){var u=o.getLocation(e,ee.LEFT),l=o.getLocation(e,ee.RIGHT);if(l!==H.NONE){if(l!==r)throw new ge("side location conflict",a.getCoordinate());u===H.NONE&&G.shouldNeverReachHere("found single null side (at "+a.getCoordinate()+")"),r=u}else G.isTrue(o.getLocation(e,ee.LEFT)===H.NONE,"found single null side"),o.setLocation(e,ee.RIGHT,r),o.setLocation(e,ee.LEFT,r)}}}},{key:"getCoordinate",value:function(){var e=this.iterator();return e.hasNext()?e.next().getCoordinate():null}},{key:"print",value:function(e){xe.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();)t.next().print(e)}},{key:"isAreaLabelsConsistent",value:function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(e){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,i=t.get(n).getLabel().getLocation(e,ee.LEFT);G.isTrue(i!==H.NONE,"Found unlabelled area edge");for(var r=i,s=this.iterator();s.hasNext();){var a=s.next().getLabel();G.isTrue(a.isArea(e),"Found non-area edge");var o=a.getLocation(e,ee.LEFT),u=a.getLocation(e,ee.RIGHT);if(o===u)return!1;if(u!==r)return!1;r=o}return!0}},{key:"findIndex",value:function(e){this.iterator();for(var t=0;t<this._edgeList.size();t++)if(this._edgeList.get(t)===e)return t;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return null===this._edgeList&&(this._edgeList=new ye(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(e,t,n){return this._ptInAreaLocation[e]===H.NONE&&(this._ptInAreaLocation[e]=Un.locate(t,n[e].getGeometry())),this._ptInAreaLocation[e]}},{key:"toString",value:function(){var e=new ae;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append("\n");for(var t=this.iterator();t.hasNext();){var n=t.next();e.append(n),e.append("\n")}return e.toString()}},{key:"computeEdgeEndLabels",value:function(e){for(var t=this.iterator();t.hasNext();)t.next().computeLabel(e)}},{key:"computeLabelling",value:function(e){this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var t=[!1,!1],n=this.iterator();n.hasNext();)for(var i=n.next().getLabel(),r=0;r<2;r++)i.isLine(r)&&i.getLocation(r)===H.BOUNDARY&&(t[r]=!0);for(var s=this.iterator();s.hasNext();)for(var a=s.next(),o=a.getLabel(),u=0;u<2;u++)if(o.isAnyNull(u)){var l=H.NONE;if(t[u])l=H.EXTERIOR;else{var c=a.getCoordinate();l=this.getLocation(u,c,e)}o.setAllLocationsIfNull(u,l)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(e,t){this._edgeMap.put(e,t),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Ht,this._edgeList=null,this._ptInAreaLocation=[H.NONE,H.NONE]}}]),Vn=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var e=null,t=null,n=this._SCANNING_FOR_INCOMING,i=0;i<this._resultAreaEdgeList.size();i++){var r=this._resultAreaEdgeList.get(i),s=r.getSym();if(r.getLabel().isArea())switch(null===e&&r.isInResult()&&(e=r),n){case this._SCANNING_FOR_INCOMING:if(!s.isInResult())continue;t=s,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!r.isInResult())continue;t.setNext(r),n=this._SCANNING_FOR_INCOMING}}if(n===this._LINKING_TO_OUTGOING){if(null===e)throw new ge("no outgoing dirEdge found",this.getCoordinate());G.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),t.setNext(e)}}},{key:"insert",value:function(e){var t=e;this.insertEdgeEnd(t,t)}},{key:"getRightmostEdge",value:function(){var e=this.getEdges(),t=e.size();if(t<1)return null;var n=e.get(0);if(1===t)return n;var i=e.get(t-1),r=n.getQuadrant(),s=i.getQuadrant();return Wt.isNorthern(r)&&Wt.isNorthern(s)?n:Wt.isNorthern(r)||Wt.isNorthern(s)?0!==n.getDy()?n:0!==i.getDy()?i:(G.shouldNeverReachHere("found two horizontal edges incident on node"),null):i}},{key:"print",value:function(e){xe.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();e.print("out "),n.print(e),e.println(),e.print("in "),n.getSym().print(e),e.println()}}},{key:"getResultAreaEdges",value:function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new ye;for(var e=this.iterator();e.hasNext();){var t=e.next();(t.isInResult()||t.getSym().isInResult())&&this._resultAreaEdgeList.add(t)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(e){for(var t=this.iterator();t.hasNext();){var n=t.next().getLabel();n.setAllLocationsIfNull(0,e.getLocation(0)),n.setAllLocationsIfNull(1,e.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var e=null,t=null,n=this._edgeList.size()-1;n>=0;n--){var i=this._edgeList.get(n),r=i.getSym();null===t&&(t=r),null!==e&&r.setNext(e),e=i}t.setNext(e)}},{key:"computeDepths",value:function(){if(1===arguments.length){var e=arguments[0],t=this.findIndex(e),n=e.getDepth(ee.LEFT),i=e.getDepth(ee.RIGHT),r=this.computeDepths(t+1,this._edgeList.size(),n);if(this.computeDepths(0,t,r)!==i)throw new ge("depth mismatch at "+e.getCoordinate())}else if(3===arguments.length){for(var s=arguments[1],a=arguments[2],o=arguments[0];o<s;o++){var u=this._edgeList.get(o);u.setEdgeDepths(ee.RIGHT,a),a=u.getDepth(ee.LEFT)}return a}}},{key:"mergeSymLabels",value:function(){for(var e=this.iterator();e.hasNext();){var t=e.next();t.getLabel().merge(t.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(e){for(var t=null,n=null,i=this._SCANNING_FOR_INCOMING,r=this._resultAreaEdgeList.size()-1;r>=0;r--){var s=this._resultAreaEdgeList.get(r),a=s.getSym();switch(null===t&&s.getEdgeRing()===e&&(t=s),i){case this._SCANNING_FOR_INCOMING:if(a.getEdgeRing()!==e)continue;n=a,i=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(s.getEdgeRing()!==e)continue;n.setNextMin(s),i=this._SCANNING_FOR_INCOMING}}i===this._LINKING_TO_OUTGOING&&(G.isTrue(null!==t,"found null for first outgoing dirEdge"),G.isTrue(t.getEdgeRing()===e,"unable to link last incoming dirEdge"),n.setNextMin(t))}},{key:"getOutgoingDegree",value:function(){if(0===arguments.length){for(var e=0,t=this.iterator();t.hasNext();)t.next().isInResult()&&e++;return e}if(1===arguments.length){for(var n=arguments[0],i=0,r=this.iterator();r.hasNext();)r.next().getEdgeRing()===n&&i++;return i}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var e=H.NONE,t=this.iterator();t.hasNext();){var n=t.next(),i=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){e=H.INTERIOR;break}if(i.isInResult()){e=H.EXTERIOR;break}}}if(e===H.NONE)return null;for(var r=e,s=this.iterator();s.hasNext();){var a=s.next(),o=a.getSym();a.isLineEdge()?a.getEdge().setCovered(r===H.INTERIOR):(a.isInResult()&&(r=H.EXTERIOR),o.isInResult()&&(r=H.INTERIOR))}}},{key:"computeLabelling",value:function(e){d(i,"computeLabelling",this,1).call(this,e),this._label=new At(H.NONE);for(var t=this.iterator();t.hasNext();)for(var n=t.next().getEdge().getLabel(),r=0;r<2;r++){var s=n.getLocation(r);s!==H.INTERIOR&&s!==H.BOUNDARY||this._label.setLocation(r,H.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])}(Xn),Hn=function(e){function i(){return n(this,i),t(this,i)}return c(i,e),a(i,[{key:"createNode",value:function(e){return new zt(e,new Vn)}}])}(Qt),Zn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"compareTo",value:function(t){var n=t;return e.compareOriented(this._pts,this._orientation,n._pts,n._orientation)}},{key:"interfaces_",get:function(){return[N]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)}},{key:"orientation",value:function(e){return 1===We.increasingDirection(e)}},{key:"compareOriented",value:function(e,t,n,i){for(var r=t?1:-1,s=i?1:-1,a=t?e.length:-1,o=i?n.length:-1,u=t?0:e.length-1,l=i?0:n.length-1;;){var c=e[u].compareTo(n[l]);if(0!==c)return c;var h=(u+=r)===a,f=(l+=s)===o;if(h&&!f)return-1;if(!h&&f)return 1;if(h&&f)return 0}}}])}(),Wn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"print",value:function(e){e.print("MULTILINESTRING ( ");for(var t=0;t<this._edges.size();t++){var n=this._edges.get(t);t>0&&e.print(","),e.print("(");for(var i=n.getCoordinates(),r=0;r<i.length;r++)r>0&&e.print(","),e.print(i[r].x+" "+i[r].y);e.println(")")}e.print(")  ")}},{key:"addAll",value:function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next())}},{key:"findEdgeIndex",value:function(e){for(var t=0;t<this._edges.size();t++)if(this._edges.get(t).equals(e))return t;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(e){return this._edges.get(e)}},{key:"findEqualEdge",value:function(e){var t=new Zn(e.getCoordinates());return this._ocaMap.get(t)}},{key:"add",value:function(e){this._edges.add(e);var t=new Zn(e.getCoordinates());this._ocaMap.put(t,e)}}],[{key:"constructor_",value:function(){this._edges=new ye,this._ocaMap=new Ht}}]),Kn=a(function e(){n(this,e)},[{key:"processIntersections",value:function(e,t,n,i){}},{key:"isDone",value:function(){}}]),Jn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"isTrivialIntersection",value:function(t,n,i,r){if(t===i&&1===this._li.getIntersectionNum()){if(e.isAdjacentSegments(n,r))return!0;if(t.isClosed()){var s=t.size()-1;if(0===n&&r===s||0===r&&n===s)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(e,t,n,i){if(e===n&&t===i)return null;this.numTests++;var r=e.getCoordinates()[t],s=e.getCoordinates()[t+1],a=n.getCoordinates()[i],o=n.getCoordinates()[i+1];this._li.computeIntersection(r,s,a,o),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,n,i)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Kn]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e}},{key:"isAdjacentSegments",value:function(e,t){return 1===Math.abs(e-t)}}])}(),Qn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)}},{key:"compareTo",value:function(e){var t=e;return this.compare(t.segmentIndex,t.dist)}},{key:"isEndPoint",value:function(e){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===e}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0}},{key:"interfaces_",get:function(){return[N]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.coord=new B(e),this.segmentIndex=t,this.dist=n}}]),$n=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"print",value:function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(e)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(e){this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next(),r=this.createSplitEdge(n,i);e.add(r),n=i}}},{key:"addEndpoints",value:function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)}},{key:"createSplitEdge",value:function(e,t){var n=t.segmentIndex-e.segmentIndex+2,i=this.edge.pts[t.segmentIndex],r=t.dist>0||!t.coord.equals2D(i);r||n--;var s=new Array(n).fill(null),a=0;s[a++]=new B(e.coord);for(var o=e.segmentIndex+1;o<=t.segmentIndex;o++)s[a++]=this.edge.pts[o];return r&&(s[a]=t.coord),new si(s,new At(this.edge._label))}},{key:"add",value:function(e,t,n){var i=new Qn(e,t,n),r=this._nodeMap.get(i);return null!==r?r:(this._nodeMap.put(i,i),i)}},{key:"isIntersection",value:function(e){for(var t=this.iterator();t.hasNext();)if(t.next().coord.equals(e))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Ht,this.edge=null;var e=arguments[0];this.edge=e}}]),ei=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(e.isTrue(this._matrix[H.INTERIOR][H.INTERIOR])||e.isTrue(this._matrix[H.INTERIOR][H.BOUNDARY])||e.isTrue(this._matrix[H.BOUNDARY][H.INTERIOR])||e.isTrue(this._matrix[H.BOUNDARY][H.BOUNDARY]))&&this._matrix[H.EXTERIOR][H.INTERIOR]===Ce.FALSE&&this._matrix[H.EXTERIOR][H.BOUNDARY]===Ce.FALSE}},{key:"isCoveredBy",value:function(){return(e.isTrue(this._matrix[H.INTERIOR][H.INTERIOR])||e.isTrue(this._matrix[H.INTERIOR][H.BOUNDARY])||e.isTrue(this._matrix[H.BOUNDARY][H.INTERIOR])||e.isTrue(this._matrix[H.BOUNDARY][H.BOUNDARY]))&&this._matrix[H.INTERIOR][H.EXTERIOR]===Ce.FALSE&&this._matrix[H.BOUNDARY][H.EXTERIOR]===Ce.FALSE}},{key:"set",value:function(){if(1===arguments.length)for(var e=arguments[0],t=0;t<e.length;t++){var n=Math.trunc(t/3),i=t%3;this._matrix[n][i]=Ce.toDimensionValue(e.charAt(t))}else if(3===arguments.length){var r=arguments[0],s=arguments[1],a=arguments[2];this._matrix[r][s]=a}}},{key:"isContains",value:function(){return e.isTrue(this._matrix[H.INTERIOR][H.INTERIOR])&&this._matrix[H.EXTERIOR][H.INTERIOR]===Ce.FALSE&&this._matrix[H.EXTERIOR][H.BOUNDARY]===Ce.FALSE}},{key:"setAtLeast",value:function(){if(1===arguments.length)for(var e=arguments[0],t=0;t<e.length;t++){var n=Math.trunc(t/3),i=t%3;this.setAtLeast(n,i,Ce.toDimensionValue(e.charAt(t)))}else if(3===arguments.length){var r=arguments[0],s=arguments[1],a=arguments[2];this._matrix[r][s]<a&&(this._matrix[r][s]=a)}}},{key:"setAtLeastIfValid",value:function(e,t,n){e>=0&&t>=0&&this.setAtLeast(e,t,n)}},{key:"isWithin",value:function(){return e.isTrue(this._matrix[H.INTERIOR][H.INTERIOR])&&this._matrix[H.INTERIOR][H.EXTERIOR]===Ce.FALSE&&this._matrix[H.BOUNDARY][H.EXTERIOR]===Ce.FALSE}},{key:"isTouches",value:function(t,n){return t>n?this.isTouches(n,t):(t===Ce.A&&n===Ce.A||t===Ce.L&&n===Ce.L||t===Ce.L&&n===Ce.A||t===Ce.P&&n===Ce.A||t===Ce.P&&n===Ce.L)&&this._matrix[H.INTERIOR][H.INTERIOR]===Ce.FALSE&&(e.isTrue(this._matrix[H.INTERIOR][H.BOUNDARY])||e.isTrue(this._matrix[H.BOUNDARY][H.INTERIOR])||e.isTrue(this._matrix[H.BOUNDARY][H.BOUNDARY]))}},{key:"isOverlaps",value:function(t,n){return t===Ce.P&&n===Ce.P||t===Ce.A&&n===Ce.A?e.isTrue(this._matrix[H.INTERIOR][H.INTERIOR])&&e.isTrue(this._matrix[H.INTERIOR][H.EXTERIOR])&&e.isTrue(this._matrix[H.EXTERIOR][H.INTERIOR]):t===Ce.L&&n===Ce.L&&1===this._matrix[H.INTERIOR][H.INTERIOR]&&e.isTrue(this._matrix[H.INTERIOR][H.EXTERIOR])&&e.isTrue(this._matrix[H.EXTERIOR][H.INTERIOR])}},{key:"isEquals",value:function(t,n){return t===n&&e.isTrue(this._matrix[H.INTERIOR][H.INTERIOR])&&this._matrix[H.INTERIOR][H.EXTERIOR]===Ce.FALSE&&this._matrix[H.BOUNDARY][H.EXTERIOR]===Ce.FALSE&&this._matrix[H.EXTERIOR][H.INTERIOR]===Ce.FALSE&&this._matrix[H.EXTERIOR][H.BOUNDARY]===Ce.FALSE}},{key:"toString",value:function(){for(var e=new Qe("123456789"),t=0;t<3;t++)for(var n=0;n<3;n++)e.setCharAt(3*t+n,Ce.toDimensionSymbol(this._matrix[t][n]));return e.toString()}},{key:"setAll",value:function(e){for(var t=0;t<3;t++)for(var n=0;n<3;n++)this._matrix[t][n]=e}},{key:"get",value:function(e,t){return this._matrix[e][t]}},{key:"transpose",value:function(){var e=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=e,e=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=e,e=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=e,this}},{key:"matches",value:function(t){if(9!==t.length)throw new x("Should be length 9: "+t);for(var n=0;n<3;n++)for(var i=0;i<3;i++)if(!e.matches(this._matrix[n][i],t.charAt(3*n+i)))return!1;return!0}},{key:"add",value:function(e){for(var t=0;t<3;t++)for(var n=0;n<3;n++)this.setAtLeast(t,n,e.get(t,n))}},{key:"isDisjoint",value:function(){return this._matrix[H.INTERIOR][H.INTERIOR]===Ce.FALSE&&this._matrix[H.INTERIOR][H.BOUNDARY]===Ce.FALSE&&this._matrix[H.BOUNDARY][H.INTERIOR]===Ce.FALSE&&this._matrix[H.BOUNDARY][H.BOUNDARY]===Ce.FALSE}},{key:"isCrosses",value:function(t,n){return t===Ce.P&&n===Ce.L||t===Ce.P&&n===Ce.A||t===Ce.L&&n===Ce.A?e.isTrue(this._matrix[H.INTERIOR][H.INTERIOR])&&e.isTrue(this._matrix[H.INTERIOR][H.EXTERIOR]):t===Ce.L&&n===Ce.P||t===Ce.A&&n===Ce.P||t===Ce.A&&n===Ce.L?e.isTrue(this._matrix[H.INTERIOR][H.INTERIOR])&&e.isTrue(this._matrix[H.EXTERIOR][H.INTERIOR]):t===Ce.L&&n===Ce.L&&0===this._matrix[H.INTERIOR][H.INTERIOR]}},{key:"interfaces_",get:function(){return[E]}}],[{key:"constructor_",value:function(){if(this._matrix=null,0===arguments.length)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(Ce.FALSE);else if(1===arguments.length)if("string"==typeof arguments[0]){var t=arguments[0];e.constructor_.call(this),this.set(t)}else if(arguments[0]instanceof e){var n=arguments[0];e.constructor_.call(this),this._matrix[H.INTERIOR][H.INTERIOR]=n._matrix[H.INTERIOR][H.INTERIOR],this._matrix[H.INTERIOR][H.BOUNDARY]=n._matrix[H.INTERIOR][H.BOUNDARY],this._matrix[H.INTERIOR][H.EXTERIOR]=n._matrix[H.INTERIOR][H.EXTERIOR],this._matrix[H.BOUNDARY][H.INTERIOR]=n._matrix[H.BOUNDARY][H.INTERIOR],this._matrix[H.BOUNDARY][H.BOUNDARY]=n._matrix[H.BOUNDARY][H.BOUNDARY],this._matrix[H.BOUNDARY][H.EXTERIOR]=n._matrix[H.BOUNDARY][H.EXTERIOR],this._matrix[H.EXTERIOR][H.INTERIOR]=n._matrix[H.EXTERIOR][H.INTERIOR],this._matrix[H.EXTERIOR][H.BOUNDARY]=n._matrix[H.EXTERIOR][H.BOUNDARY],this._matrix[H.EXTERIOR][H.EXTERIOR]=n._matrix[H.EXTERIOR][H.EXTERIOR]}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&"string"==typeof arguments[1]){var t=arguments[0],n=arguments[1];return n===Ce.SYM_DONTCARE||n===Ce.SYM_TRUE&&(t>=0||t===Ce.TRUE)||n===Ce.SYM_FALSE&&t===Ce.FALSE||n===Ce.SYM_P&&t===Ce.P||n===Ce.SYM_L&&t===Ce.L||n===Ce.SYM_A&&t===Ce.A}if("string"==typeof arguments[0]&&"string"==typeof arguments[1]){var i=arguments[1];return new e(arguments[0]).matches(i)}}},{key:"isTrue",value:function(e){return e>=0||e===Ce.TRUE}}])}(),ti=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(e){return null===e||0===e.length?null:(this.ensureCapacity(this._size+e.length),xe.arraycopy(e,0,this._data,this._size,e.length),void(this._size+=e.length))}},{key:"ensureCapacity",value:function(e){if(e<=this._data.length)return null;var t=Math.max(e,2*this._data.length);this._data=Ae.copyOf(this._data,t)}},{key:"toArray",value:function(){var e=new Array(this._size).fill(null);return xe.arraycopy(this._data,0,e,0,this._size),e}},{key:"add",value:function(e){this.ensureCapacity(this._size+1),this._data[this._size]=e,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,0===arguments.length)e.constructor_.call(this,10);else if(1===arguments.length){var t=arguments[0];this._data=new Array(t).fill(null)}}}])}(),ni=function(){function e(){n(this,e)}return a(e,[{key:"getChainStartIndices",value:function(e){var t=0,n=new ti(Math.trunc(e.length/2));n.add(t);do{var i=this.findChainEnd(e,t);n.add(i),t=i}while(t<e.length-1);return n.toArray()}},{key:"findChainEnd",value:function(e,t){for(var n=Wt.quadrant(e[t],e[t+1]),i=t+1;i<e.length&&Wt.quadrant(e[i-1],e[i])===n;)i++;return i-1}},{key:"OLDgetChainStartIndices",value:function(t){var n=0,i=new ye;i.add(n);do{var r=this.findChainEnd(t,n);i.add(r),n=r}while(n<t.length-1);return e.toIntArray(i)}}],[{key:"toIntArray",value:function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t}}])}(),ii=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t>n?t:n}},{key:"getMinX",value:function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t<n?t:n}},{key:"computeIntersectsForChain",value:function(){if(4===arguments.length){var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[n],t.startIndex[n+1],i)}else if(6===arguments.length){var r=arguments[0],s=arguments[1],a=arguments[2],o=arguments[3],u=arguments[4],l=arguments[5];if(s-r==1&&u-o==1)return l.addIntersections(this.e,r,a.e,o),null;if(!this.overlaps(r,s,a,o,u))return null;var c=Math.trunc((r+s)/2),h=Math.trunc((o+u)/2);r<c&&(o<h&&this.computeIntersectsForChain(r,c,a,o,h,l),h<u&&this.computeIntersectsForChain(r,c,a,h,u,l)),c<s&&(o<h&&this.computeIntersectsForChain(c,s,a,o,h,l),h<u&&this.computeIntersectsForChain(c,s,a,h,u,l))}}},{key:"overlaps",value:function(e,t,n,i,r){return X.intersects(this.pts[e],this.pts[t],n.pts[i],n.pts[r])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(e,t){for(var n=0;n<this.startIndex.length-1;n++)for(var i=0;i<e.startIndex.length-1;i++)this.computeIntersectsForChain(n,e,i,t)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new ni;this.startIndex=t.getChainStartIndices(this.pts)}}]),ri=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getDepth",value:function(e,t){return this._depth[e][t]}},{key:"setDepth",value:function(e,t,n){this._depth[e][t]=n}},{key:"isNull",value:function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(this._depth[t][n]!==e.NULL_VALUE)return!1;return!0}if(1===arguments.length){var i=arguments[0];return this._depth[i][1]===e.NULL_VALUE}if(2===arguments.length){var r=arguments[0],s=arguments[1];return this._depth[r][s]===e.NULL_VALUE}}},{key:"normalize",value:function(){for(var e=0;e<2;e++)if(!this.isNull(e)){var t=this._depth[e][1];this._depth[e][2]<t&&(t=this._depth[e][2]),t<0&&(t=0);for(var n=1;n<3;n++){var i=0;this._depth[e][n]>t&&(i=1),this._depth[e][n]=i}}}},{key:"getDelta",value:function(e){return this._depth[e][ee.RIGHT]-this._depth[e][ee.LEFT]}},{key:"getLocation",value:function(e,t){return this._depth[e][t]<=0?H.EXTERIOR:H.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(1===arguments.length)for(var t=arguments[0],n=0;n<2;n++)for(var i=1;i<3;i++){var r=t.getLocation(n,i);r!==H.EXTERIOR&&r!==H.INTERIOR||(this.isNull(n,i)?this._depth[n][i]=e.depthAtLocation(r):this._depth[n][i]+=e.depthAtLocation(r))}else if(3===arguments.length){var s=arguments[0],a=arguments[1];arguments[2]===H.INTERIOR&&this._depth[s][a]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var t=0;t<2;t++)for(var n=0;n<3;n++)this._depth[t][n]=e.NULL_VALUE}},{key:"depthAtLocation",value:function(t){return t===H.EXTERIOR?0:t===H.INTERIOR?1:e.NULL_VALUE}}])}();ri.NULL_VALUE=-1;var si=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var e=new Array(2).fill(null);return e[0]=this.pts[0],e[1]=this.pts[1],new i(e,At.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(e){this._isIsolated=e}},{key:"setName",value:function(e){this._name=e}},{key:"equals",value:function(e){if(!(e instanceof i))return!1;var t=e;if(this.pts.length!==t.pts.length)return!1;for(var n=!0,r=!0,s=this.pts.length,a=0;a<this.pts.length;a++)if(this.pts[a].equals2D(t.pts[a])||(n=!1),this.pts[a].equals2D(t.pts[--s])||(r=!1),!n&&!r)return!1;return!0}},{key:"getCoordinate",value:function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var e=arguments[0];return this.pts[e]}}},{key:"print",value:function(e){e.print("edge "+this._name+": "),e.print("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&e.print(","),e.print(this.pts[t].x+" "+this.pts[t].y);e.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(e){i.updateIM(this._label,e)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(e){e.print("edge "+this._name+": ");for(var t=this.pts.length-1;t>=0;t--)e.print(this.pts[t]+" ");e.println("")}},{key:"getMonotoneChainEdge",value:function(){return null===this._mce&&(this._mce=new ii(this)),this._mce}},{key:"getEnvelope",value:function(){if(null===this._env){this._env=new X;for(var e=0;e<this.pts.length;e++)this._env.expandToInclude(this.pts[e])}return this._env}},{key:"addIntersection",value:function(e,t,n,i){var r=new B(e.getIntersection(i)),s=t,a=e.getEdgeDistance(n,i),o=s+1;if(o<this.pts.length){var u=this.pts[o];r.equals2D(u)&&(s=o,a=0)}this.eiList.add(r,s,a)}},{key:"toString",value:function(){var e=new Qe;e.append("edge "+this._name+": "),e.append("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&e.append(","),e.append(this.pts[t].x+" "+this.pts[t].y);return e.append(")  "+this._label+" "+this._depthDelta),e.toString()}},{key:"isPointwiseEqual",value:function(e){if(this.pts.length!==e.pts.length)return!1;for(var t=0;t<this.pts.length;t++)if(!this.pts[t].equals2D(e.pts[t]))return!1;return!0}},{key:"setDepthDelta",value:function(e){this._depthDelta=e}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(e,t,n){for(var i=0;i<e.getIntersectionNum();i++)this.addIntersection(e,t,n,i)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new $n(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ri,this._depthDelta=0,1===arguments.length){var e=arguments[0];i.constructor_.call(this,e,null)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.pts=t,this._label=n}}},{key:"updateIM",value:function(){if(!(2===arguments.length&&arguments[1]instanceof ei&&arguments[0]instanceof At))return d(i,"updateIM",this).apply(this,arguments);var e=arguments[0],t=arguments[1];t.setAtLeastIfValid(e.getLocation(0,ee.ON),e.getLocation(1,ee.ON),1),e.isArea()&&(t.setAtLeastIfValid(e.getLocation(0,ee.LEFT),e.getLocation(1,ee.LEFT),2),t.setAtLeastIfValid(e.getLocation(0,ee.RIGHT),e.getLocation(1,ee.RIGHT),2))}}])}(Gt),ai=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"setWorkingPrecisionModel",value:function(e){this._workingPrecisionModel=e}},{key:"insertUniqueEdge",value:function(t){var n=this._edgeList.findEqualEdge(t);if(null!==n){var i=n.getLabel(),r=t.getLabel();n.isPointwiseEqual(t)||(r=new At(t.getLabel())).flip(),i.merge(r);var s=e.depthDelta(r),a=n.getDepthDelta()+s;n.setDepthDelta(a)}else this._edgeList.add(t),t.setDepthDelta(e.depthDelta(t.getLabel()))}},{key:"buildSubgraphs",value:function(e,t){for(var n=new ye,i=e.iterator();i.hasNext();){var r=i.next(),s=r.getRightmostCoordinate(),a=new Dn(n).getDepth(s);r.computeDepth(a),r.findResultEdges(),n.add(r),t.add(r.getDirectedEdges(),r.getNodes())}}},{key:"createSubgraphs",value:function(e){for(var t=new ye,n=e.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new me;r.create(i),t.add(r)}}return on.sort(t,on.reverseOrder()),t}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(e){if(null!==this._workingNoder)return this._workingNoder;var t=new Tn,n=new Rt;return n.setPrecisionModel(e),t.setSegmentIntersector(new Jn(n)),t}},{key:"buffer",value:function(e,t){var n=this._workingPrecisionModel;null===n&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var i=new An(n,this._bufParams),r=new qn(e,t,i).getCurves();if(r.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(r,n),this._graph=new $t(new Hn),this._graph.addEdges(this._edgeList.getEdges());var s=this.createSubgraphs(this._graph),a=new en(this._geomFact);this.buildSubgraphs(s,a);var o=a.getPolygons();return o.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(o)}},{key:"computeNodedEdges",value:function(e,t){var n=this.getNoder(t);n.computeNodes(e);for(var i=n.getNodedSubstrings().iterator();i.hasNext();){var r=i.next(),s=r.getCoordinates();if(2!==s.length||!s[0].equals2D(s[1])){var a=r.getData(),o=new si(r.getCoordinates(),new At(a));this.insertUniqueEdge(o)}}}},{key:"setNoder",value:function(e){this._workingNoder=e}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Wn;var e=arguments[0];this._bufParams=e}},{key:"depthDelta",value:function(e){var t=e.getLocation(0,ee.LEFT),n=e.getLocation(0,ee.RIGHT);return t===H.INTERIOR&&n===H.EXTERIOR?1:t===H.EXTERIOR&&n===H.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(e){for(var t=new ot,n=new ye;e.hasNext();){var i=e.next(),r=t.createLineString(i.getCoordinates());n.add(r)}return t.buildGeometry(n)}}])}(),oi=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"rescale",value:function(){if(se(arguments[0],Z))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.rescale(t.getCoordinates())}else if(arguments[0]instanceof Array){for(var n=arguments[0],i=0;i<n.length;i++)n[i].x=n[i].x/this._scaleFactor+this._offsetX,n[i].y=n[i].y/this._scaleFactor+this._offsetY;2===n.length&&n[0].equals2D(n[1])&&xe.out.println(n)}}},{key:"scale",value:function(){if(se(arguments[0],Z)){for(var e=arguments[0],t=new ye(e.size()),n=e.iterator();n.hasNext();){var i=n.next();t.add(new Nn(this.scale(i.getCoordinates()),i.getData()))}return t}if(arguments[0]instanceof Array){for(var r=arguments[0],s=new Array(r.length).fill(null),a=0;a<r.length;a++)s[a]=new B(Math.round((r[a].x-this._offsetX)*this._scaleFactor),Math.round((r[a].y-this._offsetY)*this._scaleFactor),r[a].getZ());return We.removeRepeatedPoints(s)}}},{key:"isIntegerPrecision",value:function(){return 1===this._scaleFactor}},{key:"getNodedSubstrings",value:function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e}},{key:"computeNodes",value:function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)}},{key:"interfaces_",get:function(){return[Sn]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],n=arguments[1];e.constructor_.call(this,t,n,0,0)}else if(4===arguments.length){var i=arguments[0],r=arguments[1];this._noder=i,this._scaleFactor=r,this._isScaled=!this.isIntegerPrecision()}}}])}(),ui=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"checkEndPtVertexIntersections",value:function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next().getCoordinates();this.checkEndPtVertexIntersections(t[0],this._segStrings),this.checkEndPtVertexIntersections(t[t.length-1],this._segStrings)}else if(2===arguments.length)for(var n=arguments[0],i=arguments[1].iterator();i.hasNext();)for(var r=i.next().getCoordinates(),s=1;s<r.length-1;s++)if(r[s].equals(n))throw new F("found endpt/interior pt intersection at index "+s+" :pt "+n)}},{key:"checkInteriorIntersections",value:function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();)for(var t=e.next(),n=this._segStrings.iterator();n.hasNext();){var i=n.next();this.checkInteriorIntersections(t,i)}else if(2===arguments.length)for(var r=arguments[0],s=arguments[1],a=r.getCoordinates(),o=s.getCoordinates(),u=0;u<a.length-1;u++)for(var l=0;l<o.length-1;l++)this.checkInteriorIntersections(r,u,s,l);else if(4===arguments.length){var c=arguments[0],h=arguments[1],f=arguments[2],d=arguments[3];if(c===f&&h===d)return null;var g=c.getCoordinates()[h],v=c.getCoordinates()[h+1],y=f.getCoordinates()[d],p=f.getCoordinates()[d+1];if(this._li.computeIntersection(g,v,y,p),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,g,v)||this.hasInteriorIntersection(this._li,y,p)))throw new F("found non-noded intersection at "+g+"-"+v+" and "+y+"-"+p)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next();this.checkCollapses(t)}else if(1===arguments.length)for(var n=arguments[0].getCoordinates(),i=0;i<n.length-2;i++)this.checkCollapse(n[i],n[i+1],n[i+2])}},{key:"hasInteriorIntersection",value:function(e,t,n){for(var i=0;i<e.getIntersectionNum();i++){var r=e.getIntersection(i);if(!r.equals(t)&&!r.equals(n))return!0}return!1}},{key:"checkCollapse",value:function(t,n,i){if(t.equals(i))throw new F("found non-noded collapse at "+e.fact.createLineString([t,n,i]))}}],[{key:"constructor_",value:function(){this._li=new Rt,this._segStrings=null;var e=arguments[0];this._segStrings=e}}])}();ui.fact=new ot;var li=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"intersectsScaled",value:function(e,t){var n=Math.min(e.x,t.x),i=Math.max(e.x,t.x),r=Math.min(e.y,t.y),s=Math.max(e.y,t.y),a=this._maxx<n||this._minx>i||this._maxy<r||this._miny>s;if(a)return!1;var o=this.intersectsToleranceSquare(e,t);return G.isTrue(!(a&&o),"Found bad envelope test"),o}},{key:"initCorners",value:function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new B(this._maxx,this._maxy),this._corner[1]=new B(this._minx,this._maxy),this._corner[2]=new B(this._minx,this._miny),this._corner[3]=new B(this._maxx,this._miny)}},{key:"intersects",value:function(e,t){return 1===this._scaleFactor?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(e){return Math.round(e*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)}},{key:"getSafeEnvelope",value:function(){if(null===this._safeEnv){var t=e.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new X(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))))}},{key:"intersectsToleranceSquare",value:function(e,t){var n=!1,i=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.isProper()||n&&i||e.equals(this._pt)||t.equals(this._pt)))))}},{key:"addSnappedNode",value:function(e,t){var n=e.getCoordinate(t),i=e.getCoordinate(t+1);return!!this.intersects(n,i)&&(e.addIntersection(this.getCoordinate(),t),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=n,t<=0)throw new x("Scale factor must be non-zero");1!==t&&(this._pt=new B(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new B,this._p1Scaled=new B),this.initCorners(this._pt)}}])}();li.SAFE_ENV_EXPANSION_FACTOR=.75;var ci=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"select",value:function(){if(1===arguments.length);else if(2===arguments.length){var e=arguments[1];arguments[0].getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}}}],[{key:"constructor_",value:function(){this.selectedSegment=new En}}]),hi=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"snap",value:function(){if(1===arguments.length){var e=arguments[0];return this.snap(e,null,-1)}if(3===arguments.length){var t=arguments[0],i=arguments[1],r=arguments[2],s=t.getSafeEnvelope(),o=new fi(t,i,r);return this._index.query(s,new(a(function e(){n(this,e)},[{key:"interfaces_",get:function(){return[cn]}},{key:"visitItem",value:function(e){e.select(s,o)}}]))),o.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var e=arguments[0];this._index=e}}]),fi=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),a(i,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(2===arguments.length&&Number.isInteger(arguments[1])&&arguments[0]instanceof bn))return d(i,"select",this,1).apply(this,arguments);var e=arguments[1],t=arguments[0].getContext();if(this._parentEdge===t&&(e===this._hotPixelVertexIndex||e+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(t,e)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._hotPixel=e,this._parentEdge=t,this._hotPixelVertexIndex=n}}])}(ci);hi.HotPixelSnapAction=fi;var di=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"processIntersections",value:function(e,t,n,i){if(e===n&&t===i)return null;var r=e.getCoordinates()[t],s=e.getCoordinates()[t+1],a=n.getCoordinates()[i],o=n.getCoordinates()[i+1];if(this._li.computeIntersection(r,s,a,o),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var u=0;u<this._li.getIntersectionNum();u++)this._interiorIntersections.add(this._li.getIntersection(u));e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Kn]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new ye}}]),gi=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"checkCorrectness",value:function(e){var t=Nn.getNodedSubstrings(e),n=new ui(t);try{n.checkValid()}catch(e){if(!(e instanceof _))throw e;e.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return Nn.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(e,t){var n=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(e)}},{key:"findInteriorIntersections",value:function(e,t){var n=new di(t);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(e),n.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(se(arguments[0],Z))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.computeVertexSnaps(t)}else if(arguments[0]instanceof Nn)for(var n=arguments[0],i=n.getCoordinates(),r=0;r<i.length;r++){var s=new li(i[r],this._scaleFactor,this._li);this._pointSnapper.snap(s,n,r)&&n.addIntersection(i[r],r)}}},{key:"computeNodes",value:function(e){this._nodedSegStrings=e,this._noder=new Tn,this._pointSnapper=new hi(this._noder.getIndex()),this.snapRound(e,this._li)}},{key:"computeIntersectionSnaps",value:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next(),i=new li(n,this._scaleFactor,this._li);this._pointSnapper.snap(i)}}},{key:"interfaces_",get:function(){return[Sn]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new Rt,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()}}]),vi=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"bufferFixedPrecision",value:function(e){var t=new oi(new gi(new rt(1)),e.getScale()),n=new ai(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(t),this._resultGeometry=n.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(0===arguments.length){for(var t=e.MAX_PRECISION_DIGITS;t>=0;t--){try{this.bufferReducedPrecision(t)}catch(e){if(!(e instanceof ge))throw e;this._saveException=e}if(null!==this._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var n=arguments[0],i=e.precisionScaleFactor(this._argGeom,this._distance,n),r=new rt(i);this.bufferFixedPrecision(r)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===rt.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(e){this._bufParams.setQuadrantSegments(e)}},{key:"bufferOriginalPrecision",value:function(){try{var e=new ai(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(e){if(!(e instanceof F))throw e;this._saveException=e}}},{key:"getResultGeometry",value:function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(e){this._bufParams.setEndCapStyle(e)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new m,this._resultGeometry=null,this._saveException=null,1===arguments.length){var e=arguments[0];this._argGeom=e}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this._argGeom=t,this._bufParams=n}}},{key:"bufferOp",value:function(){if(2===arguments.length){var t=arguments[1];return new e(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof V&&"number"==typeof arguments[1]){var n=arguments[1],i=arguments[2],r=new e(arguments[0]);return r.setQuadrantSegments(i),r.getResultGeometry(n)}if(arguments[2]instanceof m&&arguments[0]instanceof V&&"number"==typeof arguments[1]){var s=arguments[1];return new e(arguments[0],arguments[2]).getResultGeometry(s)}}else if(4===arguments.length){var a=arguments[1],o=arguments[2],u=arguments[3],l=new e(arguments[0]);return l.setQuadrantSegments(o),l.setEndCapStyle(u),l.getResultGeometry(a)}}},{key:"precisionScaleFactor",value:function(e,t,n){var i=e.getEnvelopeInternal(),r=ke.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY()))+2*(t>0?t:0),s=n-Math.trunc(Math.log(r)/Math.log(10)+1);return Math.pow(10,s)}}])}();vi.CAP_ROUND=m.CAP_ROUND,vi.CAP_BUTT=m.CAP_FLAT,vi.CAP_FLAT=m.CAP_FLAT,vi.CAP_SQUARE=m.CAP_SQUARE,vi.MAX_PRECISION_DIGITS=12;var yi=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],pi=a(function e(t){n(this,e),this.geometryFactory=t||new ot},[{key:"read",value:function(e){var t,n=(t="string"==typeof e?JSON.parse(e):e).type;if(!mi[n])throw new Error("Unknown GeoJSON type: "+t.type);return-1!==yi.indexOf(n)?mi[n].call(this,t.coordinates):"GeometryCollection"===n?mi[n].call(this,t.geometries):mi[n].call(this,t)}},{key:"write",value:function(e){var t=e.getGeometryType();if(!_i[t])throw new Error("Geometry is not supported");return _i[t].call(this,e)}}]),mi={Feature:function(e){var t={};for(var n in e)t[n]=e[n];if(e.geometry){var i=e.geometry.type;if(!mi[i])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=mi.bbox.call(this,e.bbox)),t},FeatureCollection:function(e){var t={};if(e.features){t.features=[];for(var n=0;n<e.features.length;++n)t.features.push(this.read(e.features[n]))}return e.bbox&&(t.bbox=this.parse.bbox.call(this,e.bbox)),t},coordinates:function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];t.push(i(B,g(r)))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new B(e[0],e[1]),new B(e[2],e[1]),new B(e[2],e[3]),new B(e[0],e[3]),new B(e[0],e[1])])},Point:function(e){var t=i(B,g(e));return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=[],n=0;n<e.length;++n)t.push(mi.Point.call(this,e[n]));return this.geometryFactory.createMultiPoint(t)},LineString:function(e){var t=mi.coordinates.call(this,e);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=[],n=0;n<e.length;++n)t.push(mi.LineString.call(this,e[n]));return this.geometryFactory.createMultiLineString(t)},Polygon:function(e){for(var t=mi.coordinates.call(this,e[0]),n=this.geometryFactory.createLinearRing(t),i=[],r=1;r<e.length;++r){var s=e[r],a=mi.coordinates.call(this,s),o=this.geometryFactory.createLinearRing(a);i.push(o)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];t.push(mi.Polygon.call(this,i))}return this.geometryFactory.createMultiPolygon(t)},GeometryCollection:function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];t.push(this.read(i))}return this.geometryFactory.createGeometryCollection(t)}},_i={coordinate:function(e){var t=[e.x,e.y];return e.z&&t.push(e.z),e.m&&t.push(e.m),t},Point:function(e){return{type:"Point",coordinates:_i.coordinate.call(this,e.getCoordinate())}},MultiPoint:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],r=_i.Point.call(this,i);t.push(r.coordinates)}return{type:"MultiPoint",coordinates:t}},LineString:function(e){for(var t=[],n=e.getCoordinates(),i=0;i<n.length;++i){var r=n[i];t.push(_i.coordinate.call(this,r))}return{type:"LineString",coordinates:t}},MultiLineString:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],r=_i.LineString.call(this,i);t.push(r.coordinates)}return{type:"MultiLineString",coordinates:t}},Polygon:function(e){var t=[],n=_i.LineString.call(this,e._shell);t.push(n.coordinates);for(var i=0;i<e._holes.length;++i){var r=e._holes[i],s=_i.LineString.call(this,r);t.push(s.coordinates)}return{type:"Polygon",coordinates:t}},MultiPolygon:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],r=_i.Polygon.call(this,i);t.push(r.coordinates)}return{type:"MultiPolygon",coordinates:t}},GeometryCollection:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],r=i.getGeometryType();t.push(_i[r].call(this,i))}return{type:"GeometryCollection",geometries:t}}};return{BufferOp:vi,GeoJSONReader:a(function e(t){n(this,e),this.parser=new pi(t||new ot)},[{key:"read",value:function(e){return this.parser.read(e)}}]),GeoJSONWriter:a(function e(){n(this,e),this.parser=new pi(this.geometryFactory)},[{key:"write",value:function(e){return this.parser.write(e)}}])}}()}(Ue)),Ue.exports),Ve=c(Xe);function He(){return new Ze}function Ze(){this.reset()}Ze.prototype={constructor:Ze,reset:function(){this.s=this.t=0},add:function(e){Ke(We,e,this.t),Ke(this,We.s,this.s),this.s?this.t+=We.t:this.s=We.t},valueOf:function(){return this.s}};var We=new Ze;function Ke(e,t,n){var i=e.s=t+n,r=i-t,s=i-r;e.t=t-s+(n-r)}var Je=1e-6,Qe=Math.PI,$e=Qe/2,et=Qe/4,tt=2*Qe,nt=180/Qe,it=Qe/180,rt=Math.abs,st=Math.atan,at=Math.atan2,ot=Math.cos,ut=Math.sin,lt=Math.sqrt;function ct(e){return e>1?0:e<-1?Qe:Math.acos(e)}function ht(e){return e>1?$e:e<-1?-$e:Math.asin(e)}function ft(){}function dt(e,t){e&&pt.hasOwnProperty(e.type)&&pt[e.type](e,t)}var gt,vt,yt={Feature:function(e,t){dt(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)dt(n[i].geometry,t)}},pt={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){mt(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)mt(n[i],t,0)},Polygon:function(e,t){_t(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)_t(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)dt(n[i],t)}};function mt(e,t,n){var i,r=-1,s=e.length-n;for(t.lineStart();++r<s;)i=e[r],t.point(i[0],i[1],i[2]);t.lineEnd()}function _t(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)mt(e[n],t,1);t.polygonEnd()}function xt(e){return[at(e[1],e[0]),ht(e[2])]}function kt(e){var t=e[0],n=e[1],i=ot(n);return[i*ot(t),i*ut(t),ut(n)]}function Nt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Et(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function It(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function bt(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function wt(e){var t=lt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function St(e,t){function n(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,i){return(n=t.invert(n,i))&&e.invert(n[0],n[1])}),n}function Ct(e,t){return[e>Qe?e-tt:e<-Qe?e+tt:e,t]}function Tt(e){return function(t,n){return[(t+=e)>Qe?t-tt:t<-Qe?t+tt:t,n]}}function Lt(e){var t=Tt(e);return t.invert=Tt(-e),t}function Rt(e,t){var n=ot(e),i=ut(e),r=ot(t),s=ut(t);function a(e,t){var a=ot(t),o=ot(e)*a,u=ut(e)*a,l=ut(t),c=l*n+o*i;return[at(u*r-c*s,o*n-l*i),ht(c*r+u*s)]}return a.invert=function(e,t){var a=ot(t),o=ot(e)*a,u=ut(e)*a,l=ut(t),c=l*r-u*s;return[at(u*r+l*s,o*n+c*i),ht(c*n-o*i)]},a}function Ot(e,t){(t=kt(t))[0]-=e,wt(t);var n=ct(-t[1]);return((-t[2]<0?-n:n)+tt-Je)%tt}function Mt(){var e,t=[];return{point:function(t,n){e.push([t,n])},lineStart:function(){t.push(e=[])},lineEnd:ft,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function Pt(e,t){return rt(e[0]-t[0])<Je&&rt(e[1]-t[1])<Je}function At(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Dt(e,t,n,i,r){var s,a,o=[],u=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n,i=e[0],a=e[t];if(Pt(i,a)){for(r.lineStart(),s=0;s<t;++s)r.point((i=e[s])[0],i[1]);r.lineEnd()}else o.push(n=new At(i,e,null,!0)),u.push(n.o=new At(i,null,n,!1)),o.push(n=new At(a,e,null,!1)),u.push(n.o=new At(a,null,n,!0))}}),o.length){for(u.sort(t),Ft(o),Ft(u),s=0,a=u.length;s<a;++s)u[s].e=n=!n;for(var l,c,h=o[0];;){for(var f=h,d=!0;f.v;)if((f=f.n)===h)return;l=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(s=0,a=l.length;s<a;++s)r.point((c=l[s])[0],c[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(d)for(l=f.p.z,s=l.length-1;s>=0;--s)r.point((c=l[s])[0],c[1]);else i(f.x,f.p.x,-1,r);f=f.p}l=(f=f.o).z,d=!d}while(!f.v);r.lineEnd()}}}function Ft(e){if(t=e.length){for(var t,n,i=0,r=e[0];++i<t;)r.n=n=e[i],n.p=r,r=n;r.n=n=e[0],n.p=r}}function jt(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Gt(e){for(var t,n,i,r=e.length,s=-1,a=0;++s<r;)a+=e[s].length;for(n=new Array(a);--r>=0;)for(t=(i=e[r]).length;--t>=0;)n[--a]=i[t];return n}He(),He(),He(),Ct.invert=Ct,1===(gt=jt).length&&(vt=gt,gt=function(e,t){return jt(vt(e),t)});var zt=1e9,qt=-zt;function Yt(e,t,n,i){function r(r,s){return e<=r&&r<=n&&t<=s&&s<=i}function s(r,s,o,l){var c=0,h=0;if(null==r||(c=a(r,o))!==(h=a(s,o))||u(r,s)<0^o>0)do{l.point(0===c||3===c?e:n,c>1?i:t)}while((c=(c+o+4)%4)!==h);else l.point(s[0],s[1])}function a(i,r){return rt(i[0]-e)<Je?r>0?0:3:rt(i[0]-n)<Je?r>0?2:1:rt(i[1]-t)<Je?r>0?1:0:r>0?3:2}function o(e,t){return u(e.x,t.x)}function u(e,t){var n=a(e,1),i=a(t,1);return n!==i?n-i:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(a){var u,l,c,h,f,d,g,v,y,p,m,_=a,x=Mt(),k={point:N,lineStart:function(){k.point=E,l&&l.push(c=[]);p=!0,y=!1,g=v=NaN},lineEnd:function(){u&&(E(h,f),d&&y&&x.rejoin(),u.push(x.result()));k.point=N,y&&_.lineEnd()},polygonStart:function(){_=x,u=[],l=[],m=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,r=l.length;n<r;++n)for(var s,a,o=l[n],u=1,c=o.length,h=o[0],f=h[0],d=h[1];u<c;++u)s=f,a=d,f=(h=o[u])[0],d=h[1],a<=i?d>i&&(f-s)*(i-a)>(d-a)*(e-s)&&++t:d<=i&&(f-s)*(i-a)<(d-a)*(e-s)&&--t;return t}(),n=m&&t,r=(u=Gt(u)).length;(n||r)&&(a.polygonStart(),n&&(a.lineStart(),s(null,null,1,a),a.lineEnd()),r&&Dt(u,o,t,s,a),a.polygonEnd());_=a,u=l=c=null}};function N(e,t){r(e,t)&&_.point(e,t)}function E(s,a){var o=r(s,a);if(l&&c.push([s,a]),p)h=s,f=a,d=o,p=!1,o&&(_.lineStart(),_.point(s,a));else if(o&&y)_.point(s,a);else{var u=[g=Math.max(qt,Math.min(zt,g)),v=Math.max(qt,Math.min(zt,v))],x=[s=Math.max(qt,Math.min(zt,s)),a=Math.max(qt,Math.min(zt,a))];!function(e,t,n,i,r,s){var a,o=e[0],u=e[1],l=0,c=1,h=t[0]-o,f=t[1]-u;if(a=n-o,h||!(a>0)){if(a/=h,h<0){if(a<l)return;a<c&&(c=a)}else if(h>0){if(a>c)return;a>l&&(l=a)}if(a=r-o,h||!(a<0)){if(a/=h,h<0){if(a>c)return;a>l&&(l=a)}else if(h>0){if(a<l)return;a<c&&(c=a)}if(a=i-u,f||!(a>0)){if(a/=f,f<0){if(a<l)return;a<c&&(c=a)}else if(f>0){if(a>c)return;a>l&&(l=a)}if(a=s-u,f||!(a<0)){if(a/=f,f<0){if(a>c)return;a>l&&(l=a)}else if(f>0){if(a<l)return;a<c&&(c=a)}return l>0&&(e[0]=o+l*h,e[1]=u+l*f),c<1&&(t[0]=o+c*h,t[1]=u+c*f),!0}}}}}(u,x,e,t,n,i)?o&&(_.lineStart(),_.point(s,a),m=!1):(y||(_.lineStart(),_.point(u[0],u[1])),_.point(x[0],x[1]),o||_.lineEnd(),m=!1)}g=s,v=a,y=o}return k}}var Bt=He();function Ut(e){return e}He(),He(),He();var Xt=1/0,Vt=Xt,Ht=-Xt,Zt=Ht,Wt={point:function(e,t){e<Xt&&(Xt=e);e>Ht&&(Ht=e);t<Vt&&(Vt=t);t>Zt&&(Zt=t)},lineStart:ft,lineEnd:ft,polygonStart:ft,polygonEnd:ft,result:function(){var e=[[Xt,Vt],[Ht,Zt]];return Ht=Zt=-(Vt=Xt=1/0),e}};function Kt(e,t,n,i){return function(r,s){var a,o,u,l=t(s),c=r.invert(i[0],i[1]),h=Mt(),f=t(h),d=!1,g={point:v,lineStart:p,lineEnd:m,polygonStart:function(){g.point=_,g.lineStart=x,g.lineEnd=k,o=[],a=[]},polygonEnd:function(){g.point=v,g.lineStart=p,g.lineEnd=m,o=Gt(o);var e=function(e,t){var n=t[0],i=t[1],r=[ut(n),-ot(n),0],s=0,a=0;Bt.reset();for(var o=0,u=e.length;o<u;++o)if(c=(l=e[o]).length)for(var l,c,h=l[c-1],f=h[0],d=h[1]/2+et,g=ut(d),v=ot(d),y=0;y<c;++y,f=m,g=x,v=k,h=p){var p=l[y],m=p[0],_=p[1]/2+et,x=ut(_),k=ot(_),N=m-f,E=N>=0?1:-1,I=E*N,b=I>Qe,w=g*x;if(Bt.add(at(w*E*ut(I),v*k+w*ot(I))),s+=b?N+E*tt:N,b^f>=n^m>=n){var S=Et(kt(h),kt(p));wt(S);var C=Et(r,S);wt(C);var T=(b^N>=0?-1:1)*ht(C[2]);(i>T||i===T&&(S[0]||S[1]))&&(a+=b^N>=0?1:-1)}}return(s<-Je||s<Je&&Bt<-Je)^1&a}(a,c);o.length?(d||(s.polygonStart(),d=!0),Dt(o,Qt,e,n,s)):e&&(d||(s.polygonStart(),d=!0),s.lineStart(),n(null,null,1,s),s.lineEnd()),d&&(s.polygonEnd(),d=!1),o=a=null},sphere:function(){s.polygonStart(),s.lineStart(),n(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function v(t,n){var i=r(t,n);e(t=i[0],n=i[1])&&s.point(t,n)}function y(e,t){var n=r(e,t);l.point(n[0],n[1])}function p(){g.point=y,l.lineStart()}function m(){g.point=v,l.lineEnd()}function _(e,t){u.push([e,t]);var n=r(e,t);f.point(n[0],n[1])}function x(){f.lineStart(),u=[]}function k(){_(u[0][0],u[0][1]),f.lineEnd();var e,t,n,i,r=f.clean(),l=h.result(),c=l.length;if(u.pop(),a.push(u),u=null,c)if(1&r){if((t=(n=l[0]).length-1)>0){for(d||(s.polygonStart(),d=!0),s.lineStart(),e=0;e<t;++e)s.point((i=n[e])[0],i[1]);s.lineEnd()}}else c>1&&2&r&&l.push(l.pop().concat(l.shift())),o.push(l.filter(Jt))}return g}}function Jt(e){return e.length>1}function Qt(e,t){return((e=e.x)[0]<0?e[1]-$e-Je:$e-e[1])-((t=t.x)[0]<0?t[1]-$e-Je:$e-t[1])}He();var $t=Kt(function(){return!0},function(e){var t,n=NaN,i=NaN,r=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(s,a){var o=s>0?Qe:-Qe,u=rt(s-n);rt(u-Qe)<Je?(e.point(n,i=(i+a)/2>0?$e:-$e),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(o,i),e.point(s,i),t=0):r!==o&&u>=Qe&&(rt(n-r)<Je&&(n-=r*Je),rt(s-o)<Je&&(s-=o*Je),i=function(e,t,n,i){var r,s,a=ut(e-n);return rt(a)>Je?st((ut(t)*(s=ot(i))*ut(n)-ut(i)*(r=ot(t))*ut(e))/(r*s*a)):(t+i)/2}(n,i,s,a),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(o,i),t=0),e.point(n=s,i=a),r=o},lineEnd:function(){e.lineEnd(),n=i=NaN},clean:function(){return 2-t}}},function(e,t,n,i){var r;if(null==e)r=n*$e,i.point(-Qe,r),i.point(0,r),i.point(Qe,r),i.point(Qe,0),i.point(Qe,-r),i.point(0,-r),i.point(-Qe,-r),i.point(-Qe,0),i.point(-Qe,r);else if(rt(e[0]-t[0])>Je){var s=e[0]<t[0]?Qe:-Qe;r=n*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(t[0],t[1])},[-Qe,-$e]);function en(e,t){var n=ot(e),i=n>0,r=rt(n)>Je;function s(e,t){return ot(e)*ot(t)>n}function a(e,t,i){var r=[1,0,0],s=Et(kt(e),kt(t)),a=Nt(s,s),o=s[0],u=a-o*o;if(!u)return!i&&e;var l=n*a/u,c=-n*o/u,h=Et(r,s),f=bt(r,l);It(f,bt(s,c));var d=h,g=Nt(f,d),v=Nt(d,d),y=g*g-v*(Nt(f,f)-1);if(!(y<0)){var p=lt(y),m=bt(d,(-g-p)/v);if(It(m,f),m=xt(m),!i)return m;var _,x=e[0],k=t[0],N=e[1],E=t[1];k<x&&(_=x,x=k,k=_);var I=k-x,b=rt(I-Qe)<Je;if(!b&&E<N&&(_=N,N=E,E=_),b||I<Je?b?N+E>0^m[1]<(rt(m[0]-x)<Je?N:E):N<=m[1]&&m[1]<=E:I>Qe^(x<=m[0]&&m[0]<=k)){var w=bt(d,(-g+p)/v);return It(w,f),[m,xt(w)]}}}function o(t,n){var r=i?e:Qe-e,s=0;return t<-r?s|=1:t>r&&(s|=2),n<-r?s|=4:n>r&&(s|=8),s}return Kt(s,function(e){var t,n,u,l,c;return{lineStart:function(){l=u=!1,c=1},point:function(h,f){var d,g=[h,f],v=s(h,f),y=i?v?0:o(h,f):v?o(h+(h<0?Qe:-Qe),f):0;if(!t&&(l=u=v)&&e.lineStart(),v!==u&&(!(d=a(t,g))||Pt(t,d)||Pt(g,d))&&(g[0]+=Je,g[1]+=Je,v=s(g[0],g[1])),v!==u)c=0,v?(e.lineStart(),d=a(g,t),e.point(d[0],d[1])):(d=a(t,g),e.point(d[0],d[1]),e.lineEnd()),t=d;else if(r&&t&&i^v){var p;y&n||!(p=a(g,t,!0))||(c=0,i?(e.lineStart(),e.point(p[0][0],p[0][1]),e.point(p[1][0],p[1][1]),e.lineEnd()):(e.point(p[1][0],p[1][1]),e.lineEnd(),e.lineStart(),e.point(p[0][0],p[0][1])))}!v||t&&Pt(t,g)||e.point(g[0],g[1]),t=g,u=v,n=y},lineEnd:function(){u&&e.lineEnd(),t=null},clean:function(){return c|(l&&u)<<1}}},function(n,i,r,s){!function(e,t,n,i,r,s){if(n){var a=ot(t),o=ut(t),u=i*n;null==r?(r=t+i*tt,s=t-u/2):(r=Ot(a,r),s=Ot(a,s),(i>0?r<s:r>s)&&(r+=i*tt));for(var l,c=r;i>0?c>s:c<s;c-=u)l=xt([a,-o*ot(c),-o*ut(c)]),e.point(l[0],l[1])}}(s,e,t,r,n,i)},i?[0,-e]:[-Qe,e-Qe])}function tn(e){return function(t){var n=new nn;for(var i in e)n[i]=e[i];return n.stream=t,n}}function nn(){}function rn(e,t,n){var i=t[1][0]-t[0][0],r=t[1][1]-t[0][1],s=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),null!=s&&e.clipExtent(null),function(e,t){e&&yt.hasOwnProperty(e.type)?yt[e.type](e,t):dt(e,t)}(n,e.stream(Wt));var a=Wt.result(),o=Math.min(i/(a[1][0]-a[0][0]),r/(a[1][1]-a[0][1])),u=+t[0][0]+(i-o*(a[1][0]+a[0][0]))/2,l=+t[0][1]+(r-o*(a[1][1]+a[0][1]))/2;return null!=s&&e.clipExtent(s),e.scale(150*o).translate([u,l])}nn.prototype={constructor:nn,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var sn=ot(30*it);function an(e,t){return+t?function(e,t){function n(i,r,s,a,o,u,l,c,h,f,d,g,v,y){var p=l-i,m=c-r,_=p*p+m*m;if(_>4*t&&v--){var x=a+f,k=o+d,N=u+g,E=lt(x*x+k*k+N*N),I=ht(N/=E),b=rt(rt(N)-1)<Je||rt(s-h)<Je?(s+h)/2:at(k,x),w=e(b,I),S=w[0],C=w[1],T=S-i,L=C-r,R=m*T-p*L;(R*R/_>t||rt((p*T+m*L)/_-.5)>.3||a*f+o*d+u*g<sn)&&(n(i,r,s,a,o,u,S,C,b,x/=E,k/=E,N,v,y),y.point(S,C),n(S,C,b,x,k,N,l,c,h,f,d,g,v,y))}}return function(t){var i,r,s,a,o,u,l,c,h,f,d,g,v={point:y,lineStart:p,lineEnd:_,polygonStart:function(){t.polygonStart(),v.lineStart=x},polygonEnd:function(){t.polygonEnd(),v.lineStart=p}};function y(n,i){n=e(n,i),t.point(n[0],n[1])}function p(){c=NaN,v.point=m,t.lineStart()}function m(i,r){var s=kt([i,r]),a=e(i,r);n(c,h,l,f,d,g,c=a[0],h=a[1],l=i,f=s[0],d=s[1],g=s[2],16,t),t.point(c,h)}function _(){v.point=y,t.lineEnd()}function x(){p(),v.point=k,v.lineEnd=N}function k(e,t){m(i=e,t),r=c,s=h,a=f,o=d,u=g,v.point=m}function N(){n(c,h,l,f,d,g,r,s,i,a,o,u,16,t),v.lineEnd=_,_()}return v}}(e,t):function(e){return tn({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var on=tn({point:function(e,t){this.stream.point(e*it,t*it)}});function un(e){return function(e){var t,n,i,r,s,a,o,u,l,c,h=150,f=480,d=250,g=0,v=0,y=0,p=0,m=0,_=null,x=$t,k=null,N=Ut,E=.5,I=an(S,E);function b(e){return[(e=s(e[0]*it,e[1]*it))[0]*h+n,i-e[1]*h]}function w(e){return(e=s.invert((e[0]-n)/h,(i-e[1])/h))&&[e[0]*nt,e[1]*nt]}function S(e,r){return[(e=t(e,r))[0]*h+n,i-e[1]*h]}function C(){s=St(r=function(e,t,n){return(e%=tt)?t||n?St(Lt(e),Rt(t,n)):Lt(e):t||n?Rt(t,n):Ct}(y,p,m),t);var e=t(g,v);return n=f-e[0]*h,i=d+e[1]*h,T()}function T(){return l=c=null,b}return b.stream=function(e){return l&&c===e?l:l=on(x(r,I(N(c=e))))},b.clipAngle=function(e){return arguments.length?(x=+e?en(_=e*it,6*it):(_=null,$t),T()):_*nt},b.clipExtent=function(e){return arguments.length?(N=null==e?(k=a=o=u=null,Ut):Yt(k=+e[0][0],a=+e[0][1],o=+e[1][0],u=+e[1][1]),T()):null==k?null:[[k,a],[o,u]]},b.scale=function(e){return arguments.length?(h=+e,C()):h},b.translate=function(e){return arguments.length?(f=+e[0],d=+e[1],C()):[f,d]},b.center=function(e){return arguments.length?(g=e[0]%360*it,v=e[1]%360*it,C()):[g*nt,v*nt]},b.rotate=function(e){return arguments.length?(y=e[0]%360*it,p=e[1]%360*it,m=e.length>2?e[2]%360*it:0,C()):[y*nt,p*nt,m*nt]},b.precision=function(e){return arguments.length?(I=an(S,E=e*e),T()):lt(E)},b.fitExtent=function(e,t){return rn(b,e,t)},b.fitSize=function(e,t){return function(e,t,n){return rn(e,[[0,0],t],n)}(b,e,t)},function(){return t=e.apply(this,arguments),b.invert=t.invert&&w,C()}}(function(){return e})()}function ln(e){return function(t,n){var i=ot(t),r=ot(n),s=e(i*r);return[s*r*ut(t),s*ut(n)]}}function cn(e){return function(t,n){var i=lt(t*t+n*n),r=e(i),s=ut(r),a=ot(r);return[at(t*s,i*a),ht(i&&n*s/i)]}}ln(function(e){return lt(2/(1+e))}).invert=cn(function(e){return 2*ht(e/2)});var hn=ln(function(e){return(e=ct(e))&&e/ut(e)});function fn(){return un(hn).scale(79.4188).clipAngle(179.999)}function dn(e,t){return[e,t]}hn.invert=cn(function(e){return e}),dn.invert=dn;var gn=Ve.BufferOp,vn=Ve.GeoJSONReader,yn=Ve.GeoJSONWriter;function pn(e,t,n,i){var r=e.properties||{},s="Feature"===e.type?e.geometry:e;if("GeometryCollection"===s.type){var a=[];return _e(e,function(e){var r=pn(e,t,n,i);r&&a.push(r)}),ce(a)}var o=function(e){var t=Ye(e).geometry.coordinates,n=[-t[0],-t[1]];return fn().rotate(n).scale(se)}(s),u={type:s.type,coordinates:_n(s.coordinates,o)},l=(new vn).read(u),c=he(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"kilometers",n=ae[t];if(!n)throw new Error(t+" units is invalid");return e/n}(t,n),"meters"),h=gn.bufferOp(l,c,i);if(!mn((h=(new yn).write(h)).coordinates))return oe({type:h.type,coordinates:xn(h.coordinates,o)},r)}function mn(e){return Array.isArray(e[0])?mn(e[0]):isNaN(e[0])}function _n(e,t){return"object"!==s(e[0])?t(e):e.map(function(e){return _n(e,t)})}function xn(e,t){return"object"!==s(e[0])?t.invert(e):e.map(function(e){return xn(e,t)})}function kn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t,n){var i=n,r=!1;return xe(e,function(e,s,a,o,u){i=!1===r&&void 0===n?e:t(i,e,s,a,o,u),r=!0}),i}(e,function(e,n){var i=n.geometry.coordinates;return e+function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=ge(e),r=ge(t),s=fe(r[1]-i[1]),a=fe(r[0]-i[0]),o=fe(i[1]),u=fe(r[1]),l=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(o)*Math.cos(u);return he(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),n.units)}(i[0],i[1],t)},0)}var Nn=function(e){return!!e&&("Polygon"===e.type||"MultiPolygon"===e.type)},En=function(e){return kn(e,{units:"kilometers"})},In=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:150,n={areaKm2:null,perimeterKm:null,bufferMeters:t,bufferedGeometry:e.geometry};try{var i=je(e);n.bufferedGeometry=i.geometry;var a=ke(i);Number.isFinite(a)&&(n.areaKm2=a/1e6);var o=De(i);if("FeatureCollection"===o.type){var u,l=0,c=r(o.features);try{for(c.s();!(u=c.n()).done;){var h=u.value;h&&h.geometry&&(l+=En(h))}}catch(g){c.e(g)}finally{c.f()}Number.isFinite(l)&&(n.perimeterKm=l)}else if("Feature"===o.type&&o.geometry){var f=En(o);Number.isFinite(f)&&(n.perimeterKm=f)}var d=function(e,t,n){var i=(n=n||{}).units||"kilometers",r=n.steps||8;if(!e)throw new Error("geojson is required");if("object"!==s(n))throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be an number");if(void 0===t)throw new Error("radius is required");if(r<=0)throw new Error("steps must be greater than 0");var a=[];switch(e.type){case"GeometryCollection":return _e(e,function(e){var n=pn(e,t,i,r);n&&a.push(n)}),ce(a);case"FeatureCollection":return me(e,function(e){var n=pn(e,t,i,r);n&&me(n,function(e){e&&a.push(e)})}),ce(a)}return pn(e,t,i,r)}(i,t,{units:"meters"});d&&Nn(d.geometry)&&(n.bufferedGeometry=d.geometry)}catch(v){}return n},bn=function(e,t){try{return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var i=ge(e),r=ye(t),s=r.type,a=t.bbox,o=r.coordinates;if(a&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(i,a))return!1;"Polygon"===s&&(o=[o]);for(var u=!1,l=0;l<o.length;++l){var c=Ae(i,o[l]);if(0===c)return!n.ignoreBoundary;c&&(u=!0)}return u}(ue(e),{type:"Feature",geometry:t,properties:{}})}catch(n){return!1}},wn={"Новая":"#0ea5e9","В работе":"#f97316","Выполнена":"#22c55e","Отменена":"#ef4444"},Sn={tasks:!0,optimized:!0},Cn="test"===function(){var e;if("object"===("undefined"==typeof globalThis?"undefined":s(globalThis))&&null!==globalThis)return null===(e=globalThis.process)||void 0===e||null===(e=e.env)||void 0===e?void 0:e.NODE_ENV}()?0:400,Tn=e("LOGISTICS_FLEET_POLL_INTERVAL_MS",15e3),Ln=["draft","approved","completed","unassigned","vehicle"],Rn={draft:"#6366f1",approved:"#22c55e",completed:"#0f172a",unassigned:"#f97316",vehicle:"#0891b2"},On={draft:"Черновик",approved:"Утверждён",completed:"Завершён",unassigned:"Без маршрута",vehicle:"Транспорт"},Mn=function(e){var t;return null!==(t=Rn[e])&&void 0!==t?t:"#0f172a"},Pn=function(e){return["+",["case",["all",["==",["get","entity"],"task"],["==",["get","routeStatus"],e]],1,0],0]},An={draft:Pn("draft"),approved:Pn("approved"),completed:Pn("completed"),unassigned:Pn("unassigned")},Dn={"Легковой":"#0ea5e9","Грузовой":"#f97316","Спецтехника":"#7c3aed","Пеший":"#22c55e","Без транспорта":"#9ca3af",default:"#475569"},Fn=["#7c3aed","#f97316","#06b6d4","#16a34a","#ec4899","#facc15","#9333ea","#0ea5e9"],jn="vehicle",Gn="Транспорт",zn="logistics-geozones",qn="logistics-geozones-fill",Yn="logistics-geozones-outline",Bn="logistics-task-routes",Un="logistics-task-routes-line",Xn="logistics-task-markers",Vn="logistics-task-clusters",Hn="logistics-task-cluster-count",Zn="logistics-task-points",Wn="logistics-task-animation",Kn="logistics-task-animation-symbol",Jn="logistics-optimized-routes",Qn="logistics-optimized-routes-line",$n="⬤",ei="⦿",ti="▶",ni=O/3600,ii=function(){return{type:"FeatureCollection",features:[]}},ri=function(e){return e.trim().toLowerCase()},si=function(e){var t=e.trim();if(!t)return"Без транспорта";var n=t.toLowerCase();return n.startsWith("лег")?"Легковой":n.startsWith("груз")?"Грузовой":n.includes("спец")?"Спецтехника":n.includes("пеш")?"Пеший":t},ai=function(e){var t,n=si(e);return null!==(t=Dn[n])&&void 0!==t?t:Dn.default},oi=function(e){var t=function(e){var t=e.startsWith("#")?e.slice(1):e;if(3===t.length){var n=i(t.split(""),3),r=n[0],s=n[1],a=n[2];return{r:parseInt(r+r,16),g:parseInt(s+s,16),b:parseInt(a+a,16)}}return 6===t.length?{r:parseInt(t.slice(0,2),16),g:parseInt(t.slice(2,4),16),b:parseInt(t.slice(4,6),16)}:null}(e);return t&&.299*t.r+.587*t.g+.114*t.b>186?"#0f172a":"#ffffff"},ui=function(e,t,n,i){return["marker",e,t,n,i].map(function(e){return e.replace(/\s+/g,"-").toLowerCase()}).join("-")},li=function(e,t,n,i,r,s,a,o){if(!n||t.has(n)||e.hasImage(n))t.add(n);else{var u=function(e,t,n,i,r){if("undefined"==typeof document)return null;var s=96,a=("undefined"!=typeof window&&window.devicePixelRatio?window.devicePixelRatio:1)>1?2:1,o=document.createElement("canvas");o.width=s*a,o.height=s*a;var u=o.getContext("2d");if(!u)return null;u.scale(a,a);var l=48;return u.clearRect(0,0,s,s),u.beginPath(),u.arc(l,l,44,0,2*Math.PI),u.fillStyle=e,u.fill(),u.lineWidth=6,u.strokeStyle=t,u.stroke(),r&&(u.beginPath(),u.arc(l,l,44*.55,0,2*Math.PI),u.lineWidth=4,u.strokeStyle=r,u.stroke()),n&&(u.fillStyle=i,u.font="bold 32px 'Open Sans', 'Arial Unicode MS', sans-serif",u.textAlign="center",u.textBaseline="middle",u.fillText(n.slice(0,2),l,l)),u.getImageData(0,0,s*a,s*a)}(i,r,s,a,o);u&&(e.addImage(n,u,{pixelRatio:2}),t.add(n))}},ci=function(e){if(!e)return null;var t=e.lat,n=e.lng;return Number.isFinite(t)&&Number.isFinite(n)?[n,t]:null},hi=function(e){var t=e.logistics_details,n="string"==typeof(null==t?void 0:t.transport_type)?t.transport_type.trim():"",i="string"==typeof e.transport_type?e.transport_type.trim():"";return si(n||i)},fi=function(e){return function(e){var t=e.trim();if(!t)return"Задача";if(1===t.length)return t.toUpperCase();var n=t.toLowerCase();return n.charAt(0).toUpperCase()+n.slice(1)}("string"==typeof e.task_type?e.task_type:"string"==typeof e.type?e.type:"")},di=function(e){if(!e)return"З";var t=e.trim();return t?t.charAt(0).toUpperCase():"З"},gi=function(e){var t=e.position;if(!t)return null;var n="number"==typeof t.lat?t.lat:"number"==typeof t.latitude?t.latitude:null,i="number"==typeof t.lon?t.lon:"number"==typeof t.lng?t.lng:"number"==typeof t.long?t.long:"number"==typeof t.longitude?t.longitude:null;return null!==n&&null!==i&&Number.isFinite(n)&&Number.isFinite(i)?[i,n]:null},vi=function(e,t,n){if(!t.length||!n.length)return e;var i=t.filter(function(e){return n.includes(e.id)});return i.length?e.filter(function(e){var t=[],n=ci(e.startCoordinates),r=ci(e.finishCoordinates);return n&&t.push(n),r&&t.push(r),!!t.length&&t.some(function(e){return i.some(function(t){var n=Nn(t.bufferedFeature.geometry)?t.bufferedFeature.geometry:Nn(t.feature.geometry)?t.feature.geometry:null;return!!n&&bn(e,n)})})}):e},yi=function(e){return{lng:e[0],lat:e[1]}},pi=function(e,t,n,i){if(e.length<2)return null;for(var r=[0],s=0,a=1;a<e.length;a+=1){var o=e[a-1],u=e[a];s+=L(yi(o),yi(u)),r.push(s)}return s<.01?null:{taskId:n,title:i,color:t,coordinates:e,cumulative:r,total:s,progress:0}},mi=function(e,t){for(var n,i,r=Math.max(0,Math.min(t,e.total)),s=e.cumulative,a=e.coordinates,o=0,u=0;u<s.length-1;u+=1)if(r>=s[u]&&r<=s[u+1]){o=u;break}var l,c,h,f,d,g,v,y=a[o],p=null!==(n=a[o+1])&&void 0!==n?n:a[o],m=s[o],_=(null!==(i=s[o+1])&&void 0!==i?i:e.total)-m,x=_>0?(r-m)/_:0;return{position:[y[0]+(p[0]-y[0])*x,y[1]+(p[1]-y[1])*x],bearing:(l=y,c=p,h=l[1]*Math.PI/180,f=c[1]*Math.PI/180,d=(c[0]-l[0])*Math.PI/180,g=Math.sin(d)*Math.cos(f),v=Math.cos(h)*Math.sin(f)-Math.sin(h)*Math.cos(f)*Math.cos(d),(180*Math.atan2(g,v)/Math.PI+360)%360)}},_i=function(e){var n,i,r=e.id,s=e.drawId,a=e.name,o=e.createdAt,u=e.geometry,l=e.properties,c=void 0===l?{}:l,h=e.active,f=e.bufferMeters,d=t(t({},c),{},{zoneId:r,active:h}),g=In({type:"Feature",geometry:u,properties:d},f),v=t(t({},d),{},{areaKm2:null!==(n=g.areaKm2)&&void 0!==n?n:void 0,perimeterKm:null!==(i=g.perimeterKm)&&void 0!==i?i:void 0,bufferMeters:g.bufferMeters});return{id:r,drawId:s,name:a,createdAt:o,feature:{type:"Feature",geometry:u,properties:v},bufferedFeature:{type:"Feature",geometry:g.bufferedGeometry,properties:v},metrics:{areaKm2:g.areaKm2,perimeterKm:g.perimeterKm,bufferMeters:g.bufferMeters}}},xi=[S[1],S[0]],ki=b,Ni="pmtiles"!==R}}})}();
//# sourceMappingURL=Logistics-legacy-BAO-VxLd.js.map
