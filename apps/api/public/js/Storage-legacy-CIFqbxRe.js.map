{"version":3,"file":"Storage-legacy-CIFqbxRe.js","sources":["../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/ArrowDownTrayIcon.js","../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/DocumentTextIcon.js","../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/DocumentIcon.js","../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/TrashIcon.js","../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/VideoCameraIcon.js","../../../web/src/columns/storageColumns.tsx","../../../web/src/services/storage.ts","../../../web/src/pages/Storage.tsx"],"sourcesContent":["import * as React from \"react\";\nfunction ArrowDownTrayIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(ArrowDownTrayIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction DocumentTextIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(DocumentTextIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction DocumentIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(DocumentIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction TrashIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(TrashIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction VideoCameraIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(VideoCameraIcon);\nexport default ForwardRef;","// Конфигурация колонок таблицы файлов хранилища\n// Основные модули: React, @tanstack/react-table, heroicons\nimport React from 'react';\nimport type { ColumnDef } from '@tanstack/react-table';\nimport { ArrowDownTrayIcon, TrashIcon } from '@heroicons/react/24/outline';\nimport EmployeeLink from '../components/EmployeeLink';\nimport type { StoredFile } from '../services/storage';\n\nexport interface StorageRow extends StoredFile {\n  sizeLabel: string;\n  uploadedLabel: string;\n  userDisplay: string;\n  userHint: string;\n  taskDisplay: string;\n  taskParam?: string;\n  taskLink?: string;\n  onDownload: () => void;\n  onDelete: () => void;\n  selectedTaskId: string;\n  onTaskSelect: (taskId: string) => void;\n  onAttach: () => void;\n  attachLoading: boolean;\n  attachDisabled: boolean;\n}\n\ninterface Labels {\n  name: string;\n  user: string;\n  type: string;\n  size: string;\n  task: string;\n  uploaded: string;\n  download: string;\n  delete: string;\n  taskTitleHint: (title: string) => string;\n  attachTitle: string;\n  attachPlaceholder: string;\n  attachAction: string;\n  attachProcessing: string;\n  attachEmpty: string;\n  attachLoading: string;\n}\n\ntype TaskOption = { value: string; label: string };\n\nconst userBadgeClass = [\n  'inline-flex max-w-full items-center gap-1',\n  'rounded-full border border-blue-200 bg-blue-50 px-2 py-0.5 text-xs font-semibold text-blue-700 shadow-xs',\n  'transition-colors duration-150 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2',\n  'dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100',\n].join(' ');\n\nexport default function createStorageColumns(\n  labels: Labels,\n  options: {\n    onTaskOpen?: (taskId: string) => void;\n    taskOptions?: TaskOption[];\n    tasksLoading?: boolean;\n  } = {},\n): ColumnDef<StorageRow>[] {\n  const handleTaskOpen = options.onTaskOpen;\n  const attachOptions = options.taskOptions ?? [];\n  const isTasksLoading = Boolean(options.tasksLoading);\n  return [\n    {\n      header: labels.name,\n      accessorKey: 'name',\n      meta: { minWidth: '12rem', maxWidth: '20rem', renderAsBadges: false },\n      cell: ({ row }) => {\n        const file = row.original;\n        return (\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <span className=\"truncate font-medium\" title={file.name}>\n                {file.name}\n              </span>\n              <div className=\"flex flex-shrink-0 items-center gap-1\">\n                <button\n                  type=\"button\"\n                  onClick={(event) => {\n                    event.stopPropagation();\n                    file.onDownload();\n                  }}\n                  className=\"inline-flex items-center rounded border border-blue-200 bg-blue-50 px-2 py-1 text-xs text-blue-700 hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100\"\n                  aria-label={labels.download}\n                >\n                  <ArrowDownTrayIcon className=\"mr-1 size-4\" aria-hidden />\n                  {labels.download}\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={(event) => {\n                    event.stopPropagation();\n                    file.onDelete();\n                  }}\n                  className=\"inline-flex items-center rounded border border-red-200 bg-red-50 px-2 py-1 text-xs text-red-700 hover:bg-red-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500 dark:border-red-500/30 dark:bg-red-500/10 dark:text-red-100\"\n                  aria-label={labels.delete}\n                >\n                  <TrashIcon className=\"mr-1 size-4\" aria-hidden />\n                  {labels.delete}\n                </button>\n              </div>\n            </div>\n            <div className=\"space-y-2 rounded-md border border-border/60 bg-muted/40 p-3 text-xs\">\n              <span className=\"block font-semibold uppercase tracking-wide text-muted-foreground\">\n                {labels.attachTitle}\n              </span>\n              <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center\">\n                <select\n                  value={file.selectedTaskId}\n                  onChange={(event) => {\n                    event.stopPropagation();\n                    file.onTaskSelect(event.target.value);\n                  }}\n                  disabled={file.attachLoading || isTasksLoading}\n                  className=\"h-9 min-w-[12rem] rounded-md border border-input bg-background px-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\"\n                >\n                  <option value=\"\">{labels.attachPlaceholder}</option>\n                  {attachOptions.map((option) => (\n                    <option key={option.value} value={option.value}>\n                      {option.label}\n                    </option>\n                  ))}\n                </select>\n                <button\n                  type=\"button\"\n                  onClick={(event) => {\n                    event.stopPropagation();\n                    file.onAttach();\n                  }}\n                  className=\"inline-flex items-center justify-center rounded-md border border-blue-200 bg-blue-600 px-3 py-1.5 text-xs font-semibold text-white transition hover:bg-blue-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:border-border disabled:bg-muted disabled:text-muted-foreground\"\n                  disabled={file.attachDisabled}\n                >\n                  {file.attachLoading\n                    ? labels.attachProcessing\n                    : labels.attachAction}\n                </button>\n              </div>\n              {isTasksLoading ? (\n                <span className=\"block text-muted-foreground\">\n                  {labels.attachLoading}\n                </span>\n              ) : attachOptions.length === 0 ? (\n                <span className=\"block text-muted-foreground\">\n                  {labels.attachEmpty}\n                </span>\n              ) : null}\n            </div>\n          </div>\n        );\n      },\n    },\n    {\n      header: labels.user,\n      accessorKey: 'userDisplay',\n      meta: { minWidth: '8rem', maxWidth: '12rem', renderAsBadges: false },\n      cell: ({ row }) => {\n        const file = row.original;\n        const label = file.userDisplay;\n        if (!file.userId) {\n          return (\n            <span className=\"truncate text-sm\" title={file.userHint}>\n              {label}\n            </span>\n          );\n        }\n        return (\n          <EmployeeLink\n            employeeId={file.userId}\n            stopPropagation\n            className={userBadgeClass}\n            title={file.userHint}\n          >\n            <span className=\"truncate\">{label}</span>\n          </EmployeeLink>\n        );\n      },\n    },\n    {\n      header: labels.type,\n      accessorKey: 'type',\n      meta: { minWidth: '8rem', maxWidth: '10rem' },\n      cell: ({ row }) => row.original.type || '',\n    },\n    {\n      header: labels.size,\n      accessorKey: 'sizeLabel',\n      meta: { minWidth: '6rem', maxWidth: '8rem' },\n      cell: ({ row }) => row.original.sizeLabel,\n    },\n    {\n      header: labels.task,\n      accessorKey: 'taskDisplay',\n      meta: { minWidth: '10rem', maxWidth: '16rem', renderAsBadges: false },\n      cell: ({ row }) => {\n        const file = row.original;\n        const content = (\n          <span className=\"block\">\n            {file.taskDisplay}\n            {file.taskTitle ? (\n              <span className=\"block text-xs text-muted-foreground\">\n                {file.taskTitle}\n              </span>\n            ) : null}\n          </span>\n        );\n        if (!file.taskParam) {\n          return content;\n        }\n        if (handleTaskOpen) {\n          return (\n            <button\n              type=\"button\"\n              onClick={(event) => {\n                event.stopPropagation();\n                handleTaskOpen(file.taskParam as string);\n              }}\n              className=\"inline-flex w-full flex-col items-start gap-0.5 rounded-lg border border-blue-200 bg-blue-50 px-2 py-1 text-left text-xs font-semibold text-blue-700 transition hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100\"\n              title={\n                file.taskTitle\n                  ? labels.taskTitleHint(file.taskTitle)\n                  : undefined\n              }\n            >\n              {content}\n            </button>\n          );\n        }\n        if (file.taskLink) {\n          return (\n            <a\n              href={file.taskLink}\n              className=\"inline-flex w-full flex-col items-start gap-0.5 rounded-lg border border-blue-200 bg-blue-50 px-2 py-1 text-left text-xs font-semibold text-blue-700 no-underline transition hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100\"\n              onClick={(event) => event.stopPropagation()}\n              title={\n                file.taskTitle\n                  ? labels.taskTitleHint(file.taskTitle)\n                  : undefined\n              }\n            >\n              {content}\n            </a>\n          );\n        }\n        return content;\n      },\n    },\n    {\n      header: labels.uploaded,\n      accessorKey: 'uploadedLabel',\n      meta: { minWidth: '10rem', maxWidth: '12rem' },\n      cell: ({ row }) => row.original.uploadedLabel,\n    },\n  ];\n}\n","// Назначение: запросы к API хранения файлов\n// Основные модули: authFetch\nimport authFetch from '../utils/authFetch';\n\nexport interface StoredFile {\n  id: string;\n  path: string;\n  userId: number;\n  name: string;\n  type: string;\n  url: string;\n  thumbnailUrl?: string;\n  previewUrl?: string;\n  size?: number;\n  uploadedAt?: string;\n  taskId?: string | number | null;\n  taskNumber?: string | null;\n  taskTitle?: string | null;\n}\n\nexport interface StorageDiagnosticsReport {\n  generatedAt: string;\n  snapshot: {\n    totalFiles: number;\n    linkedFiles: number;\n    detachedFiles: number;\n  };\n  detachedFiles: Array<{\n    id: string;\n    name: string;\n    path: string;\n    size: number;\n    uploadedAt: string;\n    userId: number;\n  }>;\n}\n\nexport const fetchFiles = (params?: { userId?: number; type?: string }) => {\n  const qs = new URLSearchParams();\n  if (params?.userId) qs.set('userId', String(params.userId));\n  if (params?.type) qs.set('type', params.type);\n  const url = `/api/v1/storage${qs.toString() ? `?${qs}` : ''}`;\n  return authFetch(url).then((r) => (r.ok ? r.json() : [])) as Promise<\n    StoredFile[]\n  >;\n};\n\nexport const fetchFile = (id: string) =>\n  authFetch(`/api/v1/storage/${encodeURIComponent(id)}`).then((res) =>\n    res.ok ? (res.json() as Promise<StoredFile>) : Promise.reject(res),\n  );\n\nexport const removeFile = (id: string) =>\n  authFetch(`/api/v1/storage/${encodeURIComponent(id)}`, {\n    method: 'DELETE',\n  });\n\nexport const runDiagnostics = async (): Promise<StorageDiagnosticsReport> => {\n  const response = await authFetch(`/api/v1/storage/diagnostics`);\n  if (!response.ok) {\n    throw new Error('diagnostics');\n  }\n  return (await response.json()) as StorageDiagnosticsReport;\n};\n\nexport default { fetchFiles, fetchFile, removeFile, runDiagnostics };\n","// Страница управления файлами: таблица, фильтры и карточка файла\n// Основные модули: React, DataTable, heroicons, storageService, react-router\nimport React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useSearchParams } from 'react-router-dom';\nimport {\n  ArrowDownTrayIcon,\n  DocumentIcon,\n  DocumentTextIcon,\n  PhotoIcon,\n  VideoCameraIcon,\n  TrashIcon,\n} from '@heroicons/react/24/outline';\n\nimport Breadcrumbs from '../components/Breadcrumbs';\nimport DataTable from '../components/DataTable';\nimport Modal from '../components/Modal';\nimport { Button } from '../components/ui/button';\nimport { Input } from '../components/ui/input';\nimport createStorageColumns, {\n  type StorageRow,\n} from '../columns/storageColumns';\nimport {\n  fetchFile,\n  fetchFiles,\n  removeFile,\n  runDiagnostics,\n  type StorageDiagnosticsReport,\n  type StoredFile,\n} from '../services/storage';\nimport { fetchUsers } from '../services/users';\nimport type { User } from '../types/user';\nimport authFetch from '../utils/authFetch';\nimport { showToast } from '../utils/toast';\nimport { PROJECT_TIMEZONE, PROJECT_TIMEZONE_LABEL } from 'shared';\n\nconst PAGE_SIZE = 25;\n\nconst dateTimeFormatter = new Intl.DateTimeFormat('ru-RU', {\n  day: '2-digit',\n  month: '2-digit',\n  year: 'numeric',\n  hour: '2-digit',\n  minute: '2-digit',\n  hour12: false,\n  timeZone: PROJECT_TIMEZONE,\n});\n\ntype SortOption = 'uploaded_desc' | 'uploaded_asc' | 'size_desc' | 'size_asc';\n\ntype PreviewMode = 'image' | 'video' | 'pdf' | 'text';\n\ntype PreviewState = {\n  mode: PreviewMode;\n  inlineUrl: string;\n  mime: string;\n  loading?: boolean;\n  error?: string;\n  content?: string;\n};\n\ntype TaskOption = {\n  id: string;\n  label: string;\n  title: string;\n  number?: string | null;\n  changedAt: number;\n};\n\nconst previewIcons: Record<\n  PreviewMode,\n  React.ComponentType<{ className?: string }>\n> = {\n  image: PhotoIcon,\n  video: VideoCameraIcon,\n  pdf: DocumentIcon,\n  text: DocumentTextIcon,\n};\n\nfunction isTextLike(mime: string): boolean {\n  return (\n    mime.startsWith('text/') ||\n    mime.includes('json') ||\n    mime.endsWith('xml') ||\n    mime === 'application/sql'\n  );\n}\n\nfunction formatSize(bytes: number | undefined): string {\n  if (!bytes || Number.isNaN(bytes)) return '—';\n  if (bytes <= 0) return '0 Б';\n  const units = ['Б', 'КБ', 'МБ', 'ГБ', 'ТБ'];\n  const index = Math.min(\n    Math.floor(Math.log(bytes) / Math.log(1024)),\n    units.length - 1,\n  );\n  const value = bytes / Math.pow(1024, index);\n  return `${value.toFixed(value >= 10 || index === 0 ? 0 : 1)} ${units[index]}`;\n}\n\nfunction formatDate(value?: string): string {\n  if (!value) return '—';\n  const time = Date.parse(value);\n  if (Number.isNaN(time)) return '—';\n  const label = dateTimeFormatter.format(new Date(time)).replace(', ', ' ');\n  return `${label} ${PROJECT_TIMEZONE_LABEL}`;\n}\n\nexport default function StoragePage() {\n  const { t } = useTranslation();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const [files, setFiles] = React.useState<StoredFile[]>([]);\n  const [loading, setLoading] = React.useState(false);\n  const [usersById, setUsersById] = React.useState<Record<number, User>>({});\n  const [search, setSearch] = React.useState('');\n  const [sort, setSort] = React.useState<SortOption>('uploaded_desc');\n  const [pageIndex, setPageIndex] = React.useState(0);\n  const [selectedId, setSelectedId] = React.useState<string | null>(\n    searchParams.get('file'),\n  );\n  const [selectedFile, setSelectedFile] = React.useState<StoredFile | null>(\n    null,\n  );\n  const [detailsLoading, setDetailsLoading] = React.useState(false);\n  const [preview, setPreview] = React.useState<PreviewState | null>(null);\n  const [tasksLoading, setTasksLoading] = React.useState(false);\n  const [taskOptions, setTaskOptions] = React.useState<TaskOption[]>([]);\n  const [taskMetaById, setTaskMetaById] = React.useState<\n    Record<string, TaskOption>\n  >({});\n  const [selectionByFile, setSelectionByFile] = React.useState<\n    Record<string, string>\n  >({});\n  const [attachLoadingId, setAttachLoadingId] = React.useState<string | null>(\n    null,\n  );\n\n  const [diagnostics, setDiagnostics] =\n    React.useState<StorageDiagnosticsReport | null>(null);\n  const [diagnosticsLoading, setDiagnosticsLoading] = React.useState(false);\n  const [diagnosticsError, setDiagnosticsError] = React.useState<string | null>(\n    null,\n  );\n\n  const attachFileToTask = React.useCallback(\n    async (fileId: string, taskId: string): Promise<void> => {\n      const response = await authFetch(\n        `/api/v1/files/${encodeURIComponent(fileId)}/attach`,\n        {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ taskId }),\n        },\n      );\n      if (!response.ok) {\n        const error = new Error('attach');\n        (error as { status?: number }).status = response.status;\n        throw error;\n      }\n      await response.json().catch(() => ({}));\n    },\n    [],\n  );\n\n  const loadFiles = React.useCallback(() => {\n    setLoading(true);\n    return fetchFiles()\n      .then((list) => {\n        setFiles(Array.isArray(list) ? list : []);\n      })\n      .catch(() => {\n        showToast(t('storage.loadError'), 'error');\n      })\n      .finally(() => setLoading(false));\n  }, [t]);\n\n  const detachedCount = React.useMemo(\n    () => files.filter((file) => !file.taskId).length,\n    [files],\n  );\n\n  const handleDiagnostics = React.useCallback(() => {\n    setDiagnosticsLoading(true);\n    setDiagnosticsError(null);\n    return runDiagnostics()\n      .then((report) => {\n        setDiagnostics(report);\n        showToast(t('storage.diagnostics.success'), 'success');\n        return loadFiles();\n      })\n      .catch(() => {\n        setDiagnosticsError(t('storage.diagnostics.error'));\n        showToast(t('storage.diagnostics.error'), 'error');\n      })\n      .finally(() => {\n        setDiagnosticsLoading(false);\n      });\n  }, [loadFiles, t]);\n\n  React.useEffect(() => {\n    void loadFiles();\n  }, [loadFiles]);\n\n  React.useEffect(() => {\n    let active = true;\n    fetchUsers()\n      .then((list) => {\n        if (!active) return;\n        const map: Record<number, User> = {};\n        list.forEach((user) => {\n          if (typeof user.telegram_id === 'number') {\n            map[user.telegram_id] = user;\n          }\n        });\n        setUsersById(map);\n      })\n      .catch(() => {\n        showToast(t('storage.usersLoadError'), 'error');\n      });\n    return () => {\n      active = false;\n    };\n  }, [t]);\n\n  React.useEffect(() => {\n    let cancelled = false;\n    setTasksLoading(true);\n    authFetch('/api/v1/tasks/mentioned')\n      .then((res) => (res.ok ? res.json() : []))\n      .then((data) => {\n        if (cancelled) return;\n        const list = Array.isArray(data)\n          ? (data as Record<string, unknown>[])\n          : [];\n        const normalized = list\n          .map((task): TaskOption | null => {\n            const rawId =\n              typeof (task as { _id?: unknown })._id === 'string'\n                ? ((task as { _id: string })._id ?? '').trim()\n                : typeof (task as { id?: unknown }).id === 'string'\n                  ? ((task as { id: string }).id ?? '').trim()\n                  : '';\n            if (!rawId) {\n              return null;\n            }\n            const rawTitle = (task as { title?: unknown }).title;\n            const title =\n              typeof rawTitle === 'string' && rawTitle.trim().length > 0\n                ? rawTitle.trim()\n                : t('storage.attach.untitled');\n            const rawNumber = (task as { task_number?: unknown }).task_number;\n            const number =\n              typeof rawNumber === 'string' && rawNumber.trim().length > 0\n                ? rawNumber.trim()\n                : null;\n            const timestamps = [\n              (task as { changed_at?: unknown }).changed_at,\n              (task as { changedAt?: unknown }).changedAt,\n              (task as { updatedAt?: unknown }).updatedAt,\n              (task as { createdAt?: unknown }).createdAt,\n              (task as { submission_date?: unknown }).submission_date,\n            ];\n            const changedAt = timestamps\n              .map((value) => {\n                if (value instanceof Date) {\n                  const time = value.getTime();\n                  return Number.isNaN(time) ? 0 : time;\n                }\n                if (typeof value === 'string') {\n                  const time = Date.parse(value);\n                  return Number.isNaN(time) ? 0 : time;\n                }\n                if (typeof value === 'number' && Number.isFinite(value)) {\n                  return value;\n                }\n                return 0;\n              })\n              .reduce((max, current) => (current > max ? current : max), 0);\n            const shortId = rawId.slice(-6) || rawId;\n            const label = number\n              ? t('storage.attach.optionNumber', { number, title })\n              : t('storage.attach.optionId', { id: shortId, title });\n            return { id: rawId, label, title, number, changedAt };\n          })\n          .filter((item): item is TaskOption => Boolean(item));\n        normalized.sort((a, b) => b.changedAt - a.changedAt);\n        const limited = normalized.slice(0, 6);\n        const meta = limited.reduce<Record<string, TaskOption>>(\n          (acc, option) => {\n            acc[option.id] = option;\n            return acc;\n          },\n          {},\n        );\n        setTaskOptions(limited);\n        setTaskMetaById(meta);\n      })\n      .catch(() => {\n        if (cancelled) return;\n        setTaskOptions([]);\n        setTaskMetaById({});\n        showToast(t('storage.attach.tasksLoadError'), 'error');\n      })\n      .finally(() => {\n        if (!cancelled) {\n          setTasksLoading(false);\n        }\n      });\n    return () => {\n      cancelled = true;\n    };\n  }, [t]);\n\n  React.useEffect(() => {\n    if (!taskOptions.length) {\n      setSelectionByFile((current) =>\n        Object.keys(current).length ? ({} as Record<string, string>) : current,\n      );\n      return;\n    }\n    const validIds = new Set(taskOptions.map((option) => option.id));\n    setSelectionByFile((current) => {\n      let changed = false;\n      const next: Record<string, string> = {};\n      Object.entries(current).forEach(([fileId, value]) => {\n        if (value && validIds.has(value)) {\n          next[fileId] = value;\n        } else if (value) {\n          changed = true;\n        }\n      });\n      return changed ? next : current;\n    });\n  }, [taskOptions]);\n\n  React.useEffect(() => {\n    const queryId = searchParams.get('file');\n    setSelectedId(queryId);\n  }, [searchParams]);\n\n  React.useEffect(() => {\n    if (!selectedId) {\n      setSelectedFile(null);\n      setDetailsLoading(false);\n      setPreview(null);\n      return;\n    }\n    const existing = files.find((file) => file.id === selectedId);\n    if (existing) {\n      setSelectedFile(existing);\n      return;\n    }\n    setDetailsLoading(true);\n    fetchFile(selectedId)\n      .then((file) => {\n        setSelectedFile(file);\n      })\n      .catch(() => {\n        showToast(t('storage.loadError'), 'error');\n        setSelectedFile(null);\n      })\n      .finally(() => setDetailsLoading(false));\n  }, [selectedId, files, t]);\n\n  React.useEffect(() => {\n    if (!selectedFile) {\n      setPreview(null);\n      return;\n    }\n    const mime = selectedFile.type || 'application/octet-stream';\n    const inlineUrl =\n      selectedFile.previewUrl || `${selectedFile.url}?mode=inline`;\n    if (mime.startsWith('image/')) {\n      setPreview({ mode: 'image', inlineUrl, mime });\n      return;\n    }\n    if (mime.startsWith('video/')) {\n      setPreview({ mode: 'video', inlineUrl, mime });\n      return;\n    }\n    if (mime === 'application/pdf') {\n      setPreview({ mode: 'pdf', inlineUrl, mime });\n      return;\n    }\n    if (isTextLike(mime)) {\n      let cancelled = false;\n      setPreview({ mode: 'text', inlineUrl, mime, loading: true });\n      authFetch(inlineUrl)\n        .then((res) => {\n          if (!res.ok) throw new Error('preview');\n          return res.text();\n        })\n        .then((content) => {\n          if (cancelled) return;\n          setPreview({ mode: 'text', inlineUrl, mime, content });\n        })\n        .catch(() => {\n          if (cancelled) return;\n          setPreview({\n            mode: 'text',\n            inlineUrl,\n            mime,\n            error: t('storage.previewError'),\n          });\n        });\n      return () => {\n        cancelled = true;\n      };\n    }\n    setPreview(null);\n    // неподдерживаемые типы доступны только для скачивания\n  }, [selectedFile, t]);\n\n  const filteredFiles = React.useMemo(() => {\n    const query = search.trim().toLowerCase();\n    return files.filter((file) =>\n      query ? file.name.toLowerCase().includes(query) : true,\n    );\n  }, [files, search]);\n\n  const sortedFiles = React.useMemo(() => {\n    const list = [...filteredFiles];\n    list.sort((a, b) => {\n      switch (sort) {\n        case 'uploaded_asc': {\n          const left = Date.parse(a.uploadedAt || '');\n          const right = Date.parse(b.uploadedAt || '');\n          return (left || 0) - (right || 0);\n        }\n        case 'uploaded_desc': {\n          const left = Date.parse(a.uploadedAt || '');\n          const right = Date.parse(b.uploadedAt || '');\n          return (right || 0) - (left || 0);\n        }\n        case 'size_asc':\n          return (a.size || 0) - (b.size || 0);\n        case 'size_desc':\n          return (b.size || 0) - (a.size || 0);\n        default:\n          return 0;\n      }\n    });\n    return list;\n  }, [filteredFiles, sort]);\n\n  const pagedFiles = React.useMemo(() => {\n    const start = pageIndex * PAGE_SIZE;\n    return sortedFiles.slice(start, start + PAGE_SIZE);\n  }, [sortedFiles, pageIndex]);\n\n  const taskOptionsForSelect = React.useMemo(\n    () =>\n      taskOptions.map((option) => ({ value: option.id, label: option.label })),\n    [taskOptions],\n  );\n\n  const handleDownload = React.useCallback(\n    (file: StoredFile) => {\n      if (!file.url) return;\n      window.open(file.url, '_blank', 'noopener,noreferrer');\n      showToast(t('storage.openedInNewTab'), 'success');\n    },\n    [t],\n  );\n\n  const handleDelete = React.useCallback(\n    (file: StoredFile) => {\n      const confirmed = window.confirm(\n        t('storage.deleteConfirm', { name: file.name }),\n      );\n      if (!confirmed) return;\n      removeFile(file.id)\n        .then((res) => {\n          if (!res.ok) throw new Error('delete');\n          showToast(t('storage.deleteSuccess'), 'success');\n          setFiles((current) =>\n            current.filter((candidate) => candidate.id !== file.id),\n          );\n          if (selectedId === file.id) {\n            const next = new URLSearchParams(searchParams.toString());\n            next.delete('file');\n            setSearchParams(next, { replace: true });\n          }\n        })\n        .catch(() => {\n          showToast(t('storage.deleteError'), 'error');\n        });\n    },\n    [searchParams, selectedId, setSearchParams, t],\n  );\n\n  const handleAttach = React.useCallback(\n    (file: StoredFile) => {\n      const selectedTaskId = selectionByFile[file.id];\n      if (!selectedTaskId) {\n        return;\n      }\n      if (!taskOptions.some((option) => option.id === selectedTaskId)) {\n        return;\n      }\n      setAttachLoadingId(file.id);\n      attachFileToTask(file.id, selectedTaskId)\n        .then(() => {\n          const meta = taskMetaById[selectedTaskId];\n          setFiles((current) =>\n            current.map((candidate) =>\n              candidate.id === file.id\n                ? {\n                    ...candidate,\n                    taskId: selectedTaskId,\n                    taskNumber: meta?.number ?? candidate.taskNumber ?? null,\n                    taskTitle: meta?.title ?? candidate.taskTitle ?? null,\n                  }\n                : candidate,\n            ),\n          );\n          if (selectedId === file.id) {\n            setSelectedFile((current) =>\n              current\n                ? {\n                    ...current,\n                    taskId: selectedTaskId,\n                    taskNumber: meta?.number ?? current.taskNumber ?? null,\n                    taskTitle: meta?.title ?? current.taskTitle ?? null,\n                  }\n                : current,\n            );\n          }\n          showToast(t('storage.attach.success'), 'success');\n        })\n        .catch((error) => {\n          const status = (error as { status?: number }).status;\n          if (status === 403) {\n            showToast(t('storage.attach.forbidden'), 'error');\n          } else {\n            showToast(t('storage.attach.error'), 'error');\n          }\n        })\n        .finally(() => {\n          setAttachLoadingId((current) =>\n            current === file.id ? null : current,\n          );\n        });\n    },\n    [\n      attachFileToTask,\n      selectionByFile,\n      taskOptions,\n      taskMetaById,\n      setFiles,\n      selectedId,\n      setSelectedFile,\n      t,\n    ],\n  );\n\n  const toRow = React.useCallback(\n    (file: StoredFile): StorageRow => {\n      const hasTaskId = file.taskId != null && file.taskId !== '';\n      const normalizedTaskId = hasTaskId ? String(file.taskId) : undefined;\n      const normalizedTitle =\n        typeof file.taskTitle === 'string' && file.taskTitle.trim()\n          ? file.taskTitle.trim()\n          : undefined;\n      const identifier = hasTaskId\n        ? file.taskNumber && file.taskNumber !== ''\n          ? t('storage.taskNumberLabel', { number: file.taskNumber })\n          : t('storage.taskLabel', { id: normalizedTaskId })\n        : t('storage.taskMissing');\n      const user =\n        typeof file.userId === 'number' ? usersById[file.userId] : undefined;\n      const displayName =\n        (typeof user?.name === 'string' && user.name.trim()) ||\n        (typeof user?.telegram_username === 'string' &&\n          user.telegram_username.trim()) ||\n        (typeof user?.username === 'string' && user.username.trim()) ||\n        t('storage.userLabel', { id: file.userId });\n      const userHint =\n        typeof file.userId === 'number'\n          ? t('storage.details.userId', { id: file.userId })\n          : t('storage.details.userId', { id: '—' });\n      let taskLink: string | undefined;\n      if (normalizedTaskId) {\n        const paramsWithTask = new URLSearchParams(searchParams.toString());\n        paramsWithTask.set('task', normalizedTaskId);\n        taskLink = `?${paramsWithTask.toString()}`;\n      }\n      const selectedCandidate = selectionByFile[file.id] ?? '';\n      const hasValidSelection = taskOptions.some(\n        (option) => option.id === selectedCandidate,\n      );\n      const selectedTaskId = hasValidSelection ? selectedCandidate : '';\n      return {\n        ...file,\n        taskTitle: normalizedTitle,\n        sizeLabel: formatSize(file.size),\n        uploadedLabel: formatDate(file.uploadedAt),\n        userDisplay: displayName,\n        userHint,\n        taskDisplay: identifier,\n        taskParam: normalizedTaskId,\n        taskLink,\n        onDownload: () => handleDownload(file),\n        onDelete: () => handleDelete(file),\n        selectedTaskId,\n        onTaskSelect: (taskId: string) => {\n          setSelectionByFile((current) => ({ ...current, [file.id]: taskId }));\n        },\n        onAttach: () => handleAttach(file),\n        attachLoading: attachLoadingId === file.id,\n        attachDisabled:\n          attachLoadingId === file.id ||\n          tasksLoading ||\n          !taskOptions.length ||\n          !hasValidSelection,\n      };\n    },\n    [\n      attachLoadingId,\n      handleAttach,\n      handleDelete,\n      handleDownload,\n      searchParams,\n      selectionByFile,\n      setSelectionByFile,\n      t,\n      taskOptions,\n      tasksLoading,\n      usersById,\n    ],\n  );\n\n  const rows = React.useMemo<StorageRow[]>(\n    () => pagedFiles.map((file) => toRow(file)),\n    [pagedFiles, toRow],\n  );\n\n  const pageCount = React.useMemo(() => {\n    if (!sortedFiles.length) return 1;\n    return Math.max(1, Math.ceil(sortedFiles.length / PAGE_SIZE));\n  }, [sortedFiles.length]);\n\n  const openTaskDialog = React.useCallback(\n    (taskId?: string) => {\n      if (!taskId) return;\n      const next = new URLSearchParams(searchParams.toString());\n      next.set('task', taskId);\n      setSearchParams(next, { replace: false });\n    },\n    [searchParams, setSearchParams],\n  );\n\n  const closeModal = React.useCallback(() => {\n    const next = new URLSearchParams(searchParams.toString());\n    next.delete('file');\n    setSearchParams(next, { replace: true });\n  }, [searchParams, setSearchParams]);\n\n  const selectedRow = React.useMemo(\n    () => (selectedFile ? toRow(selectedFile) : null),\n    [selectedFile, toRow],\n  );\n\n  const details = React.useMemo(() => {\n    if (!selectedRow) return [];\n    const empty = t('storage.details.empty');\n    return [\n      {\n        key: 'task',\n        label: t('storage.details.task'),\n        value: selectedRow.taskDisplay,\n      },\n      {\n        key: 'taskNumber',\n        label: t('storage.details.taskNumber'),\n        value: selectedRow.taskNumber || empty,\n      },\n      {\n        key: 'taskId',\n        label: t('storage.details.taskId'),\n        value: selectedRow.taskId || empty,\n      },\n      {\n        key: 'taskTitle',\n        label: t('storage.details.taskTitle'),\n        value: selectedRow.taskTitle || empty,\n      },\n      {\n        key: 'user',\n        label: t('storage.details.user'),\n        value: (\n          <span className=\"flex flex-col\">\n            {selectedRow.userDisplay}\n            <span className=\"text-xs text-muted-foreground\">\n              {selectedRow.userHint}\n            </span>\n          </span>\n        ),\n      },\n      {\n        key: 'uploaded',\n        label: t('storage.details.uploaded'),\n        value: selectedRow.uploadedLabel || empty,\n      },\n      {\n        key: 'size',\n        label: t('storage.details.size'),\n        value: selectedRow.sizeLabel || empty,\n      },\n      {\n        key: 'type',\n        label: t('storage.details.type'),\n        value: selectedRow.type || empty,\n      },\n      {\n        key: 'path',\n        label: t('storage.details.path'),\n        value: <code className=\"break-all text-xs\">{selectedRow.path}</code>,\n      },\n    ];\n  }, [selectedRow, t]);\n\n  const previewIcon = preview ? previewIcons[preview.mode] : null;\n  const diagnosticsTimestamp = React.useMemo(\n    () => (diagnostics ? formatDate(diagnostics.generatedAt) : null),\n    [diagnostics],\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      <Breadcrumbs items={[{ label: t('storage.title') }]} />\n      <section className=\"rounded border border-amber-300 bg-amber-50 p-5 shadow-sm\">\n        <div className=\"flex flex-col gap-4 md:flex-row md:items-start md:justify-between\">\n          <div className=\"space-y-2\">\n            <h2 className=\"text-base font-semibold text-amber-900\">\n              {t('storage.diagnostics.title')}\n            </h2>\n            <p className=\"text-sm text-amber-800\">\n              {t('storage.diagnostics.description')}\n            </p>\n            <p className=\"text-sm text-amber-900\">\n              {detachedCount === 0\n                ? t('storage.sync.ok', { count: files.length })\n                : t('storage.sync.warning', { count: detachedCount })}\n            </p>\n          </div>\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            className=\"self-start border-amber-400 text-amber-900 hover:bg-amber-100\"\n            disabled={diagnosticsLoading}\n            onClick={() => {\n              void handleDiagnostics();\n            }}\n          >\n            {diagnosticsLoading\n              ? t('storage.diagnostics.progress')\n              : t('storage.diagnostics.cta')}\n          </Button>\n        </div>\n        {diagnosticsError ? (\n          <p className=\"mt-3 text-sm text-red-700\">{diagnosticsError}</p>\n        ) : null}\n        {diagnostics ? (\n          <div className=\"mt-3 space-y-1 text-sm text-amber-900\">\n            <p>\n              {t('storage.diagnostics.lastRun', {\n                date: diagnosticsTimestamp ?? '—',\n              })}\n            </p>\n            <p>\n              {t('storage.diagnostics.snapshot', {\n                total: diagnostics.snapshot.totalFiles,\n                linked: diagnostics.snapshot.linkedFiles,\n                detached: diagnostics.snapshot.detachedFiles,\n              })}\n            </p>\n          </div>\n        ) : (\n          <p className=\"mt-3 text-sm text-amber-800\">\n            {t('storage.diagnostics.placeholder')}\n          </p>\n        )}\n      </section>\n      <section className=\"space-y-5 rounded border border-border bg-card p-5 shadow-sm\">\n        <header className=\"flex flex-col gap-4 border-b border-border pb-4\">\n          <div className=\"flex flex-col gap-1\">\n            <h2 className=\"text-lg font-semibold text-foreground\">\n              {t('storage.title')}\n            </h2>\n            <p className=\"text-sm text-muted-foreground\">\n              {t('storage.total', { count: filteredFiles.length })}\n            </p>\n          </div>\n          <div className=\"flex flex-col gap-2 md:flex-row md:items-center md:justify-between\">\n            <div className=\"flex flex-wrap items-center gap-2\">\n              <Input\n                value={search}\n                onChange={(event) => {\n                  setSearch(event.target.value);\n                  setPageIndex(0);\n                }}\n                placeholder={t('storage.searchPlaceholder') ?? ''}\n                className=\"max-w-xs\"\n              />\n              <select\n                value={sort}\n                onChange={(event) => {\n                  setSort(event.target.value as SortOption);\n                  setPageIndex(0);\n                }}\n                className=\"h-9 rounded-md border border-input bg-background px-2 text-sm\"\n              >\n                <option value=\"uploaded_desc\">\n                  {t('storage.sort.uploadedDesc')}\n                </option>\n                <option value=\"uploaded_asc\">\n                  {t('storage.sort.uploadedAsc')}\n                </option>\n                <option value=\"size_desc\">{t('storage.sort.sizeDesc')}</option>\n                <option value=\"size_asc\">{t('storage.sort.sizeAsc')}</option>\n              </select>\n              <Button\n                type=\"button\"\n                variant=\"secondary\"\n                onClick={() => void loadFiles()}\n                disabled={loading}\n              >\n                {t('storage.refresh')}\n              </Button>\n            </div>\n            <div className=\"text-xs text-muted-foreground md:text-sm\">\n              {loading ? t('loading') : null}\n            </div>\n          </div>\n        </header>\n        <DataTable<StorageRow>\n          columns={createStorageColumns(\n            {\n              name: t('storage.columns.name'),\n              user: t('storage.columns.user'),\n              type: t('storage.columns.type'),\n              size: t('storage.columns.size'),\n              task: t('storage.columns.task'),\n              uploaded: t('storage.columns.uploaded'),\n              download: t('storage.download'),\n              delete: t('storage.delete'),\n              taskTitleHint: (title: string) =>\n                t('storage.taskTitleHint', { title }),\n              attachTitle: t('storage.attach.title'),\n              attachPlaceholder: t('storage.attach.placeholder'),\n              attachAction: t('storage.attach.button'),\n              attachProcessing: t('storage.attach.processing'),\n              attachEmpty: t('storage.attach.empty'),\n              attachLoading: t('storage.attach.loading'),\n            },\n            {\n              onTaskOpen: openTaskDialog,\n              taskOptions: taskOptionsForSelect,\n              tasksLoading,\n            },\n          )}\n          data={rows}\n          pageIndex={pageIndex}\n          pageSize={PAGE_SIZE}\n          pageCount={pageCount}\n          onPageChange={setPageIndex}\n          showGlobalSearch={false}\n          showFilters={false}\n          wrapCellsAsBadges\n          onRowClick={(row) => {\n            const next = new URLSearchParams(searchParams.toString());\n            next.set('file', row.id);\n            setSearchParams(next, { replace: false });\n          }}\n        />\n      </section>\n      <Modal open={Boolean(selectedId)} onClose={closeModal}>\n        {detailsLoading ? (\n          <div className=\"p-4 text-center text-sm text-muted-foreground\">\n            {t('loading')}\n          </div>\n        ) : selectedRow ? (\n          <div className=\"space-y-4\">\n            <header className=\"flex items-start justify-between gap-4\">\n              <div>\n                <h2 className=\"text-lg font-semibold\">{selectedRow.name}</h2>\n                <p className=\"text-sm text-muted-foreground\">\n                  {selectedRow.type || t('storage.details.type')}\n                </p>\n              </div>\n              <div className=\"flex flex-wrap items-center gap-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => handleDownload(selectedRow)}\n                >\n                  <ArrowDownTrayIcon className=\"mr-2 size-4\" />\n                  {t('storage.download')}\n                </Button>\n                <Button\n                  type=\"button\"\n                  variant=\"destructive\"\n                  onClick={() => handleDelete(selectedRow)}\n                >\n                  <TrashIcon className=\"mr-2 size-4\" />\n                  {t('storage.delete')}\n                </Button>\n              </div>\n            </header>\n            {preview ? (\n              <div className=\"space-y-2 rounded-lg border border-dashed border-border p-4\">\n                <div className=\"flex items-center gap-2 text-sm font-semibold\">\n                  {previewIcon ? <previewIcon className=\"size-5\" /> : null}\n                  <span>{t('storage.previewTitle')}</span>\n                  <span className=\"text-xs text-muted-foreground\">\n                    {t('storage.mimeLabel', { mime: preview.mime })}\n                  </span>\n                </div>\n                {preview.mode === 'image' ? (\n                  <img\n                    src={preview.inlineUrl}\n                    alt={selectedRow.name}\n                    className=\"max-h-[300px] w-full rounded-md object-contain\"\n                  />\n                ) : preview.mode === 'video' ? (\n                  <video\n                    controls\n                    src={preview.inlineUrl}\n                    className=\"max-h-[320px] w-full rounded-md\"\n                  />\n                ) : preview.mode === 'pdf' ? (\n                  <iframe\n                    title={selectedRow.name}\n                    src={preview.inlineUrl}\n                    className=\"h-[320px] w-full rounded-md\"\n                  />\n                ) : preview.mode === 'text' ? (\n                  preview.loading ? (\n                    <div className=\"text-sm text-muted-foreground\">\n                      {t('storage.previewLoading')}\n                    </div>\n                  ) : preview.error ? (\n                    <div className=\"text-sm text-red-500\">{preview.error}</div>\n                  ) : (\n                    <pre className=\"max-h-[320px] overflow-auto rounded bg-muted p-3 text-xs\">\n                      {preview.content}\n                    </pre>\n                  )\n                ) : null}\n              </div>\n            ) : null}\n            <section className=\"space-y-3\">\n              <h3 className=\"text-sm font-semibold\">\n                {t('storage.attach.title')}\n              </h3>\n              <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center\">\n                <select\n                  value={selectedRow.selectedTaskId}\n                  onChange={(event) =>\n                    selectedRow.onTaskSelect(event.target.value)\n                  }\n                  disabled={selectedRow.attachLoading || tasksLoading}\n                  className=\"h-9 min-w-[12rem] rounded-md border border-input bg-background px-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\"\n                >\n                  <option value=\"\">{t('storage.attach.placeholder')}</option>\n                  {taskOptionsForSelect.map((option) => (\n                    <option key={option.value} value={option.value}>\n                      {option.label}\n                    </option>\n                  ))}\n                </select>\n                <Button\n                  type=\"button\"\n                  onClick={() => selectedRow.onAttach()}\n                  disabled={selectedRow.attachDisabled}\n                >\n                  {selectedRow.attachLoading\n                    ? t('storage.attach.processing')\n                    : t('storage.attach.button')}\n                </Button>\n              </div>\n              {tasksLoading ? (\n                <p className=\"text-xs text-muted-foreground\">\n                  {t('storage.attach.loading')}\n                </p>\n              ) : taskOptionsForSelect.length === 0 ? (\n                <p className=\"text-xs text-muted-foreground\">\n                  {t('storage.attach.empty')}\n                </p>\n              ) : null}\n            </section>\n            <section className=\"space-y-2\">\n              <h3 className=\"text-sm font-semibold\">\n                {t('storage.details.title')}\n              </h3>\n              <dl className=\"grid gap-2 sm:grid-cols-2\">\n                {details.map((item) => (\n                  <div\n                    key={item.key}\n                    className=\"rounded-md border border-border p-3 text-sm\"\n                  >\n                    <dt className=\"text-xs font-semibold uppercase text-muted-foreground\">\n                      {item.label}\n                    </dt>\n                    <dd className=\"mt-1 text-sm\">{item.value}</dd>\n                  </div>\n                ))}\n              </dl>\n              {selectedRow.taskId ? (\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  onClick={() => openTaskDialog(selectedRow.taskId)}\n                >\n                  {t('storage.details.openTask')}\n                </Button>\n              ) : null}\n            </section>\n          </div>\n        ) : (\n          <div className=\"p-4 text-sm text-muted-foreground\">\n            {t('storage.loadError')}\n          </div>\n        )}\n      </Modal>\n    </div>\n  );\n}\n"],"names":["ArrowDownTrayIcon","_ref","svgRef","title","titleId","props","_objectWithoutProperties","_excluded","React.createElement","Object","assign","xmlns","fill","viewBox","strokeWidth","stroke","ref","id","strokeLinecap","strokeLinejoin","d","ForwardRef","React.forwardRef","DocumentTextIcon","_ref2","_excluded2","exports","DocumentIcon","_ref3","_excluded3","TrashIcon","_ref4","_excluded4","VideoCameraIcon","_ref5","_excluded5","userBadgeClass","join","createStorageColumns","labels","_options$taskOptions","options","arguments","length","undefined","handleTaskOpen","onTaskOpen","attachOptions","taskOptions","isTasksLoading","Boolean","tasksLoading","header","name","accessorKey","meta","minWidth","maxWidth","renderAsBadges","cell","_ref6","file","row","original","jsxs","className","children","jsx","type","onClick","event","stopPropagation","onDownload","download","onDelete","delete","attachTitle","value","selectedTaskId","onChange","onTaskSelect","target","disabled","attachLoading","attachPlaceholder","map","option","label","onAttach","attachDisabled","attachProcessing","attachAction","attachEmpty","user","_ref7","userDisplay","userId","EmployeeLink","employeeId","userHint","size","_ref9","sizeLabel","task","_ref0","content","taskDisplay","taskTitle","taskParam","taskTitleHint","taskLink","href","uploaded","_ref1","uploadedLabel","fetchFiles","params","qs","URLSearchParams","set","String","url","concat","toString","authFetch","then","r","ok","json","fetchFile","encodeURIComponent","res","Promise","reject","removeFile","method","runDiagnostics","_callee","response","_regenerator","w","_context","n","v","Error","a","PAGE_SIZE","dateTimeFormatter","Intl","DateTimeFormat","day","month","year","hour","minute","hour12","timeZone","PROJECT_TIMEZONE","previewIcons","image","PhotoIcon","video","pdf","text","formatSize","bytes","Number","isNaN","units","index","Math","min","floor","log","pow","toFixed","formatDate","time","Date","parse","format","replace","PROJECT_TIMEZONE_LABEL","StoragePage","_t","t","useTranslation","_useSearchParams2","_slicedToArray","useSearchParams","searchParams","setSearchParams","_React$useState2","React","useState","files","setFiles","_React$useState4","loading","setLoading","_React$useState6","usersById","setUsersById","_React$useState8","search","setSearch","_React$useState0","sort","setSort","_React$useState10","pageIndex","setPageIndex","_React$useState12","get","selectedId","setSelectedId","_React$useState14","selectedFile","setSelectedFile","_React$useState16","detailsLoading","setDetailsLoading","_React$useState18","preview","setPreview","_React$useState20","setTasksLoading","_React$useState22","setTaskOptions","_React$useState24","taskMetaById","setTaskMetaById","_React$useState26","selectionByFile","setSelectionByFile","_React$useState28","attachLoadingId","setAttachLoadingId","_React$useState30","diagnostics","setDiagnostics","_React$useState32","diagnosticsLoading","setDiagnosticsLoading","_React$useState34","diagnosticsError","setDiagnosticsError","attachFileToTask","useCallback","_ref11","_asyncToGenerator","m","_callee2","fileId","taskId","error","_context2","headers","body","JSON","stringify","status","catch","_x","_x2","apply","this","loadFiles","list","Array","isArray","showToast","finally","detachedCount","useMemo","filter","handleDiagnostics","report","useEffect","active","fetchUsers","forEach","telegram_id","cancelled","data","normalized","_task$_id","_task$id","rawId","_id","trim","rawTitle","rawNumber","task_number","number","changedAt","changed_at","updatedAt","createdAt","submission_date","getTime","isFinite","reduce","max","current","shortId","slice","item","b","limited","acc","validIds","Set","changed","next","entries","_ref12","_ref13","has","keys","queryId","existing","find","mime","inlineUrl","previewUrl","startsWith","mode","includes","endsWith","isTextLike","filteredFiles","query","toLowerCase","sortedFiles","_toConsumableArray","uploadedAt","left","pagedFiles","start","taskOptionsForSelect","handleDownload","window","open","handleDelete","confirm","candidate","handleAttach","some","_ref14","_meta$number","_ref15","_meta$title","_objectSpread","taskNumber","_ref16","_meta$number2","_ref17","_meta$title2","toRow","_selectionByFile$file","hasTaskId","normalizedTaskId","normalizedTitle","identifier","displayName","telegram_username","username","paramsWithTask","selectedCandidate","hasValidSelection","_defineProperty","rows","pageCount","ceil","openTaskDialog","closeModal","selectedRow","details","empty","key","path","previewIcon","diagnosticsTimestamp","generatedAt","Breadcrumbs","items","count","Button","variant","date","total","snapshot","totalFiles","linked","linkedFiles","detached","detachedFiles","Input","placeholder","DataTable","columns","pageSize","onPageChange","showGlobalSearch","showFilters","wrapCellsAsBadges","onRowClick","Modal","onClose","src","alt","controls"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4]}