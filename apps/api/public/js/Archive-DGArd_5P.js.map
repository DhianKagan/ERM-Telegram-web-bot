{"version":3,"file":"Archive-DGArd_5P.js","sources":["../../../web/src/columns/archiveColumns.tsx","../../../web/src/services/archives.ts","../../../web/src/pages/Archive.tsx"],"sourcesContent":["// Конфигурация колонок архива задач\r\n// Основные модули: React, @tanstack/react-table\r\nimport React from \"react\";\r\nimport type { ColumnDef } from \"@tanstack/react-table\";\r\nimport type { ArchiveTask } from \"../types/archive\";\r\n\r\nconst dateTimeFormatter = new Intl.DateTimeFormat(\"ru-RU\", {\r\n  dateStyle: \"short\",\r\n  timeStyle: \"short\",\r\n});\r\n\r\nfunction formatDate(value?: string) {\r\n  if (!value) return \"—\";\r\n  const date = new Date(value);\r\n  if (Number.isNaN(date.getTime())) return value;\r\n  return dateTimeFormatter.format(date);\r\n}\r\n\r\nexport default function archiveColumns({\r\n  enableSelection,\r\n  selectedIds,\r\n  onToggleRow,\r\n  onToggleAll,\r\n  visibleCount,\r\n}: {\r\n  enableSelection: boolean;\r\n  selectedIds: Set<string>;\r\n  onToggleRow: (id: string, checked: boolean) => void;\r\n  onToggleAll: (checked: boolean) => void;\r\n  visibleCount: number;\r\n}): ColumnDef<ArchiveTask>[] {\r\n  const columns: ColumnDef<ArchiveTask>[] = [];\r\n  if (enableSelection) {\r\n    columns.push({\r\n      id: \"select\",\r\n      header: () => {\r\n        const allSelected =\r\n          visibleCount > 0 && selectedIds.size >= visibleCount;\r\n        const indeterminate =\r\n          selectedIds.size > 0 && selectedIds.size < visibleCount;\r\n        return (\r\n          <input\r\n            type=\"checkbox\"\r\n            aria-label=\"Выбрать все\"\r\n            checked={allSelected}\r\n            ref={(el) => {\r\n              if (el) el.indeterminate = indeterminate && !allSelected;\r\n            }}\r\n            onChange={(event) => onToggleAll(event.target.checked)}\r\n          />\r\n        );\r\n      },\r\n      cell: ({ row }) => {\r\n        const id = row.original.id;\r\n        if (!id) {\r\n          return <span className=\"text-muted-foreground\">—</span>;\r\n        }\r\n        return (\r\n          <input\r\n            type=\"checkbox\"\r\n            aria-label={`Выбрать задачу ${row.original.task_number || id}`}\r\n            checked={selectedIds.has(id)}\r\n            onChange={(event) => onToggleRow(id, event.target.checked)}\r\n          />\r\n        );\r\n      },\r\n      meta: { width: \"3rem\", minWidth: \"3rem\", maxWidth: \"3rem\" },\r\n    });\r\n  }\r\n  columns.push(\r\n    {\r\n      header: \"Номер\",\r\n      accessorKey: \"task_number\",\r\n      meta: {\r\n        width: \"8rem\",\r\n        minWidth: \"6rem\",\r\n        maxWidth: \"8rem\",\r\n        cellClassName: \"font-mono text-xs sm:text-sm\",\r\n      },\r\n      cell: ({ row }) => row.original.task_number || row.original.id || \"—\",\r\n    },\r\n    {\r\n      header: \"Название\",\r\n      accessorKey: \"title\",\r\n      meta: {\r\n        width: \"16rem\",\r\n        minWidth: \"10rem\",\r\n        maxWidth: \"22rem\",\r\n        cellClassName: \"whitespace-normal\",\r\n      },\r\n      cell: ({ row }) => {\r\n        const title = row.original.title || \"—\";\r\n        return <span className=\"line-clamp-2 break-words text-sm\">{title}</span>;\r\n      },\r\n    },\r\n    {\r\n      header: \"Статус\",\r\n      accessorKey: \"status\",\r\n      meta: {\r\n        width: \"8rem\",\r\n        minWidth: \"6rem\",\r\n        maxWidth: \"10rem\",\r\n      },\r\n      cell: ({ row }) => row.original.status || \"—\",\r\n    },\r\n    {\r\n      header: \"Удалена\",\r\n      accessorKey: \"archived_at\",\r\n      meta: {\r\n        width: \"10rem\",\r\n        minWidth: \"8rem\",\r\n        maxWidth: \"12rem\",\r\n      },\r\n      cell: ({ row }) => formatDate(row.original.archived_at),\r\n    },\r\n  );\r\n  return columns;\r\n}\r\n","// Назначение: запросы к API архива задач\r\n// Основные модули: authFetch\r\nimport authFetch from \"../utils/authFetch\";\r\n\r\nexport interface ArchiveListResult {\r\n  items: Array<Record<string, unknown>>;\r\n  total: number;\r\n  page: number;\r\n  pages: number;\r\n}\r\n\r\nexport async function fetchArchive(\r\n  params: { page?: number; limit?: number; search?: string } = {},\r\n): Promise<ArchiveListResult> {\r\n  const query = new URLSearchParams();\r\n  if (params.page) query.set(\"page\", String(params.page));\r\n  if (params.limit) query.set(\"limit\", String(params.limit));\r\n  if (params.search) query.set(\"search\", params.search.trim());\r\n  const suffix = query.toString();\r\n  const url = suffix ? `/api/v1/archives?${suffix}` : \"/api/v1/archives\";\r\n  const response = await authFetch(url);\r\n  if (!response.ok) {\r\n    const text = await response.text().catch(() => \"\");\r\n    throw new Error(text || \"Не удалось загрузить архив задач\");\r\n  }\r\n  const data = await response.json();\r\n  return {\r\n    items: Array.isArray(data.items) ? data.items : [],\r\n    total: Number(data.total) || 0,\r\n    page: Number(data.page) || 1,\r\n    pages: Number(data.pages) || 0,\r\n  };\r\n}\r\n\r\nexport async function purgeArchive(ids: string[]): Promise<number> {\r\n  if (!Array.isArray(ids) || ids.length === 0) {\r\n    return 0;\r\n  }\r\n  const response = await authFetch(\"/api/v1/archives/purge\", {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    body: JSON.stringify({ ids }),\r\n  });\r\n  if (!response.ok) {\r\n    const text = await response.text().catch(() => \"\");\r\n    throw new Error(text || \"Не удалось выполнить полное удаление\");\r\n  }\r\n  const payload = await response.json();\r\n  return Number(payload.removed) || 0;\r\n}\r\n","// Страница архива задач\r\n// Основные модули: React, DataTable, сервисы архива\r\nimport React from \"react\";\r\nimport DataTable from \"../components/DataTable\";\r\nimport archiveColumns from \"../columns/archiveColumns\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { useToast } from \"../context/useToast\";\r\nimport { useAuth } from \"../context/useAuth\";\r\nimport { fetchArchive, purgeArchive } from \"../services/archives\";\r\nimport type { ArchiveTask } from \"../types/archive\";\r\nimport {\r\n  ARCHIVE_ACCESS,\r\n  ACCESS_TASK_DELETE,\r\n  hasAccess,\r\n} from \"../utils/access\";\r\n\r\nconst PAGE_SIZE = 25;\r\n\r\nconst toId = (value: unknown): string => {\r\n  if (!value) return \"\";\r\n  if (typeof value === \"string\") return value;\r\n  if (typeof value === \"number\") return String(value);\r\n  if (typeof value === \"object\" && value !== null && \"toString\" in value) {\r\n    try {\r\n      return (value as { toString(): string }).toString();\r\n    } catch {\r\n      return \"\";\r\n    }\r\n  }\r\n  return \"\";\r\n};\r\n\r\nconst normalizeDate = (value: unknown): string | undefined => {\r\n  if (typeof value === \"string\") return value;\r\n  if (value instanceof Date) return value.toISOString();\r\n  return undefined;\r\n};\r\n\r\nexport default function ArchivePage() {\r\n  const { addToast } = useToast();\r\n  const { user } = useAuth();\r\n  const [rows, setRows] = React.useState<ArchiveTask[]>([]);\r\n  const [page, setPage] = React.useState(0);\r\n  const [pageCount, setPageCount] = React.useState(0);\r\n  const [total, setTotal] = React.useState(0);\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [purging, setPurging] = React.useState(false);\r\n  const [search, setSearch] = React.useState(\"\");\r\n  const [appliedSearch, setAppliedSearch] = React.useState(\"\");\r\n  const [refreshKey, setRefreshKey] = React.useState(0);\r\n  const [selectedIds, setSelectedIds] = React.useState<Set<string>>(new Set());\r\n\r\n  const access = typeof user?.access === \"number\" ? user.access : 0;\r\n  const canViewArchive = hasAccess(access, ARCHIVE_ACCESS);\r\n  const canPurge = hasAccess(access, ACCESS_TASK_DELETE);\r\n\r\n  const visibleCount = React.useMemo(\r\n    () => rows.filter((row) => row.id).length,\r\n    [rows],\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    let cancelled = false;\r\n    const load = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const data = await fetchArchive({\r\n          page: page + 1,\r\n          limit: PAGE_SIZE,\r\n          search: appliedSearch || undefined,\r\n        });\r\n        if (cancelled) return;\r\n        const mapped = data.items.map((item) => {\r\n          const record = item as Record<string, unknown>;\r\n          const id = toId(record._id ?? record.id ?? record.task_number ?? \"\");\r\n          return {\r\n            id,\r\n            task_number:\r\n              typeof record.task_number === \"string\"\r\n                ? record.task_number\r\n                : undefined,\r\n            title:\r\n              typeof record.title === \"string\" ? record.title : undefined,\r\n            status:\r\n              typeof record.status === \"string\" ? record.status : undefined,\r\n            archived_at: normalizeDate(record.archived_at),\r\n            createdAt: normalizeDate(record.createdAt),\r\n            archived_by:\r\n              typeof record.archived_by === \"number\" &&\r\n              Number.isFinite(record.archived_by)\r\n                ? (record.archived_by as number)\r\n                : undefined,\r\n          } satisfies ArchiveTask;\r\n        });\r\n        setRows(mapped);\r\n        setTotal(data.total);\r\n        setPageCount(data.pages);\r\n        setSelectedIds((prev) => {\r\n          const next = new Set<string>();\r\n          mapped.forEach((row) => {\r\n            if (row.id && prev.has(row.id)) {\r\n              next.add(row.id);\r\n            }\r\n          });\r\n          return next;\r\n        });\r\n        const maxPageIndex = Math.max((data.pages || 1) - 1, 0);\r\n        if (page > maxPageIndex) {\r\n          setPage(maxPageIndex);\r\n        }\r\n      } catch (error) {\r\n        if (!cancelled) {\r\n          const message =\r\n            error instanceof Error\r\n              ? error.message\r\n              : \"Не удалось загрузить архив задач\";\r\n          addToast(message, \"error\");\r\n        }\r\n      } finally {\r\n        if (!cancelled) {\r\n          setLoading(false);\r\n        }\r\n      }\r\n    };\r\n    if (canViewArchive) {\r\n      void load();\r\n    }\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [page, appliedSearch, refreshKey, canViewArchive, addToast]);\r\n\r\n  const handleSearchSubmit = React.useCallback(\r\n    (event: React.FormEvent<HTMLFormElement>) => {\r\n      event.preventDefault();\r\n      setAppliedSearch(search.trim());\r\n      setPage(0);\r\n    },\r\n    [search],\r\n  );\r\n\r\n  const handleSearchReset = React.useCallback(() => {\r\n    setSearch(\"\");\r\n    setAppliedSearch(\"\");\r\n    setPage(0);\r\n  }, []);\r\n\r\n  const handleToggleRow = React.useCallback((id: string, checked: boolean) => {\r\n    setSelectedIds((prev) => {\r\n      const next = new Set(prev);\r\n      if (checked) {\r\n        next.add(id);\r\n      } else {\r\n        next.delete(id);\r\n      }\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  const handleToggleAll = React.useCallback(\r\n    (checked: boolean) => {\r\n      if (checked) {\r\n        const next = new Set<string>();\r\n        rows.forEach((row) => {\r\n          if (row.id) {\r\n            next.add(row.id);\r\n          }\r\n        });\r\n        setSelectedIds(next);\r\n      } else {\r\n        setSelectedIds(new Set());\r\n      }\r\n    },\r\n    [rows],\r\n  );\r\n\r\n  const handlePurge = React.useCallback(async () => {\r\n    if (!selectedIds.size) return;\r\n    setPurging(true);\r\n    try {\r\n      const removed = await purgeArchive(Array.from(selectedIds));\r\n      if (removed > 0) {\r\n        addToast(`Удалено ${removed} задач`, \"success\");\r\n      } else {\r\n        addToast(\"Задачи не были удалены\", \"error\");\r\n      }\r\n      setSelectedIds(new Set());\r\n      setRefreshKey((prev) => prev + 1);\r\n    } catch (error) {\r\n      const message =\r\n        error instanceof Error\r\n          ? error.message\r\n          : \"Не удалось выполнить полное удаление\";\r\n      addToast(message, \"error\");\r\n    } finally {\r\n      setPurging(false);\r\n    }\r\n  }, [selectedIds, addToast]);\r\n\r\n  const columns = React.useMemo(\r\n    () =>\r\n      archiveColumns({\r\n        enableSelection: canPurge,\r\n        selectedIds,\r\n        onToggleRow: handleToggleRow,\r\n        onToggleAll: handleToggleAll,\r\n        visibleCount,\r\n      }),\r\n    [canPurge, selectedIds, handleToggleRow, handleToggleAll, visibleCount],\r\n  );\r\n\r\n  if (!canViewArchive) {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        <h1 className=\"text-2xl font-semibold\">Архив задач</h1>\r\n        <p className=\"text-sm text-muted-foreground\">\r\n          Недостаточно прав для просмотра архива.\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const totalLabel = (() => {\r\n    const remainder10 = total % 10;\r\n    const remainder100 = total % 100;\r\n    if (remainder10 === 1 && remainder100 !== 11) return \"задача\";\r\n    if ([2, 3, 4].includes(remainder10) && ![12, 13, 14].includes(remainder100))\r\n      return \"задачи\";\r\n    return \"задач\";\r\n  })();\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-semibold\">Архив задач</h1>\r\n          <p className=\"text-sm text-muted-foreground\">\r\n            Здесь отображаются удалённые задачи только для чтения.\r\n          </p>\r\n        </div>\r\n        {canPurge ? (\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"destructive\"\r\n            disabled={!selectedIds.size || purging || loading}\r\n            onClick={handlePurge}\r\n          >\r\n            Полное удаление\r\n          </Button>\r\n        ) : null}\r\n      </div>\r\n      <form\r\n        onSubmit={handleSearchSubmit}\r\n        className=\"flex flex-col gap-2 sm:flex-row sm:items-center\"\r\n      >\r\n        <Input\r\n          value={search}\r\n          onChange={(event) => setSearch(event.target.value)}\r\n          placeholder=\"Поиск по номеру или названию\"\r\n          aria-label=\"Поиск по архиву\"\r\n        />\r\n        <div className=\"flex gap-2\">\r\n          <Button type=\"submit\" variant=\"secondary\" disabled={loading}>\r\n            Искать\r\n          </Button>\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"ghost\"\r\n            disabled={loading || (!appliedSearch && !search)}\r\n            onClick={handleSearchReset}\r\n          >\r\n            Сбросить\r\n          </Button>\r\n        </div>\r\n      </form>\r\n      {loading ? (\r\n        <div className=\"text-sm text-muted-foreground\">Загрузка архива...</div>\r\n      ) : null}\r\n      <DataTable<ArchiveTask>\r\n        columns={columns}\r\n        data={rows}\r\n        pageIndex={page}\r\n        pageSize={PAGE_SIZE}\r\n        pageCount={pageCount}\r\n        onPageChange={setPage}\r\n        showGlobalSearch={false}\r\n        showFilters={false}\r\n      />\r\n      <div className=\"text-sm text-muted-foreground\">\r\n        Найдено {total} {totalLabel}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["dateTimeFormatter","formatDate","value","date","archiveColumns","enableSelection","selectedIds","onToggleRow","onToggleAll","visibleCount","columns","allSelected","indeterminate","jsx","el","event","row","id","title","fetchArchive","params","query","suffix","url","response","authFetch","text","data","purgeArchive","ids","payload","PAGE_SIZE","toId","e","normalizeDate","ArchivePage","addToast","useToast","user","useAuth","rows","setRows","React","page","setPage","pageCount","setPageCount","total","setTotal","loading","setLoading","purging","setPurging","search","setSearch","appliedSearch","setAppliedSearch","refreshKey","setRefreshKey","setSelectedIds","access","canViewArchive","hasAccess","ARCHIVE_ACCESS","canPurge","ACCESS_TASK_DELETE","cancelled","mapped","item","record","_c","_b","_a","prev","next","maxPageIndex","error","message","handleSearchSubmit","handleSearchReset","handleToggleRow","checked","handleToggleAll","handlePurge","removed","jsxs","totalLabel","remainder10","remainder100","Button","Input","DataTable"],"mappings":"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"}