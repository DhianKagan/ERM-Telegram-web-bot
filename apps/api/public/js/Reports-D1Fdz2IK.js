const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/react-apexcharts.min-zsnjzXmB.js","js/vendor-DBLHOZWC.js","js/index-Chjiymov.js"])))=>i.map(i=>d[i]);
import{j as r,_ as S}from"./index-DAGCYRZX.js";import{R as c,b as g}from"./vendor-DBLHOZWC.js";import{B as j,h as v,s as R}from"./App-DjzPhsfn.js";import{z as F}from"./index-D4chY9-1.js";function C({onChange:o}){const[a,n]=c.useState(""),[u,i]=c.useState(""),l=d=>{d.preventDefault(),o&&o({from:a,to:u})};return r.jsxs("form",{onSubmit:l,className:"flex flex-wrap items-end gap-2",children:[r.jsx("input",{type:"date",id:"report-from",name:"reportFrom",value:a,onChange:d=>n(d.target.value),className:"focus:border-accentPrimary focus:ring-brand-200 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-800 focus:ring focus:outline-none"}),r.jsx("input",{type:"date",id:"report-to",name:"reportTo",value:u,onChange:d=>i(d.target.value),className:"focus:border-accentPrimary focus:ring-brand-200 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-800 focus:ring focus:outline-none"}),r.jsx(j,{type:"submit",children:"Применить"})]})}function P({count:o,time:a}){return r.jsxs("div",{className:"flex space-x-4",children:[r.jsxs("div",{className:"rounded border p-2",children:["Всего задач: ",o]}),r.jsxs("div",{className:"rounded border p-2",children:["Затрачено минут: ",a]})]})}const D=c.lazy(()=>S(()=>import("./react-apexcharts.min-zsnjzXmB.js").then(o=>o.r),__vite__mapDeps([0,1,2]))),L=o=>{const a=new URLSearchParams;o!=null&&o.from&&a.set("from",o.from),o!=null&&o.to&&a.set("to",o.to);const n=a.toString();return n?"?".concat(n):""};function T({filters:o}){const[a,n]=g.useState([{data:[]}]),[u,i]=g.useState([]),{theme:l}=F();g.useEffect(()=>{let p=!1;return v("/api/v1/tasks/report/chart".concat(L(o))).then(m=>m.ok?m.json():{data:[],labels:[]}).then(({data:m,labels:x})=>{if(p)return;const f=Array.isArray(m)?m.map(e=>{const t=Number(e);return Number.isFinite(t)?t:0}):[],y=Array.isArray(x)?x.map(e=>String(e)):[];n([{data:f}]),i(y)}).catch(()=>{p||(n([{data:[]}]),i([]))}),()=>{p=!0}},[o==null?void 0:o.from,o==null?void 0:o.to]);const d={chart:{height:200,type:"line",fontFamily:"Inter, sans-serif",toolbar:{show:!1},background:l==="dark"?"#24303F":void 0},colors:["#2563EB"],stroke:{width:2,curve:"smooth"},xaxis:{categories:u,labels:{style:{colors:l==="dark"?"#DEE4EE":"#6B7280"}}},yaxis:{labels:{style:{colors:l==="dark"?"#DEE4EE":"#6B7280"}}}};return r.jsx(c.Suspense,{fallback:r.jsx("div",{children:"Загрузка..."}),children:r.jsx(D,{series:a,options:d,type:"line",height:200})})}function B(){const[o,a]=c.useState({count:0,time:0}),[n,u]=c.useState({}),[i,l]=c.useState({pdf:!1,xlsx:!1}),d=e=>{const t={};if(e!=null&&e.from){const s=e.from.trim();s&&(t.from=s)}if(e!=null&&e.to){const s=e.to.trim();s&&(t.to=s)}return t},p=e=>{const t=new URLSearchParams;e.from&&t.set("from",e.from),e.to&&t.set("to",e.to);const s=t.toString();return s?"?".concat(s):""},m=(e,t)=>{if(!e)return t;const s=e.match(/filename\*?=(?:UTF-8'')?"?([^";]+)/i);if(s&&s[1])try{return decodeURIComponent(s[1])}catch(h){return s[1]}return t},x=c.useCallback(async e=>{l(t=>({...t,[e]:!0}));try{const t=p(n),s=e==="pdf"?"/api/v1/tasks/report.pdf".concat(t):"/api/v1/tasks/report.xlsx".concat(t),h=await v(s,{noRedirect:!0});if(!h.ok)throw new Error("HTTP ".concat(h.status));const k=await h.blob(),E=h.headers.get("Content-Disposition"),N=m(E,e==="pdf"?"tasks-report.pdf":"tasks-report.xlsx"),w=window.URL.createObjectURL(k),b=document.createElement("a");b.href=w,b.download=N,document.body.appendChild(b),b.click(),b.remove(),window.URL.revokeObjectURL(w)}catch(t){console.error("report download error",t),R("Не удалось скачать отчёт","error")}finally{l(t=>({...t,[e]:!1}))}},[n]),f=c.useCallback(e=>{v("/api/v1/tasks/report/summary".concat(p(e))).then(t=>t.ok?t.json():{count:0,time:0}).then(a)},[]),y=e=>{const t=d(e);u(t),f(t)};return c.useEffect(()=>{f({})},[f]),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"space-y-4 rounded-lg bg-white p-4 shadow-sm",children:[r.jsx("h2",{className:"text-xl font-semibold",children:"Отчёты"}),r.jsx(C,{onChange:y}),r.jsx(P,{count:o.count,time:o.time}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsx(j,{onClick:()=>x("pdf"),disabled:i.pdf,children:i.pdf?"Формируем PDF...":"Скачать PDF"}),r.jsx(j,{variant:"outline",onClick:()=>x("xlsx"),disabled:i.xlsx,children:i.xlsx?"Формируем Excel...":"Скачать Excel"})]})]}),r.jsxs("div",{className:"space-y-4 rounded-lg bg-white p-4 shadow-sm",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Динамика задач"}),r.jsx(T,{filters:n})]})]})}export{B as default};
//# sourceMappingURL=Reports-D1Fdz2IK.js.map
