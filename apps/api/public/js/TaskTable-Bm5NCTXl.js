const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/DataTable-r-lWgJ1H.js","js/index-DgL4A3Hy.js","js/vendor-bFQg9Mu4.js","js/index-DWJbAmBQ.css","js/input-3UdN7pFZ.js","js/App-C5qf9m0C.js","js/AuthenticatedApp-m87IzzAI.js"])))=>i.map(i=>d[i]);
import{j as _,_ as I}from"./index-DgL4A3Hy.js";import{R as x,b as S}from"./vendor-bFQg9Mu4.js";import{t as w}from"./taskColumns-cbsood-k.js";import{u as z}from"./AuthenticatedApp-m87IzzAI.js";import{g as F}from"./App-C5qf9m0C.js";const E=e=>{const r=e.trim().toLowerCase();if(!r)return[];const t=r.replace(/[\s\-_/]+/g,"");return t&&t!==r?[r,t]:[r]},b=(e,r)=>{if(typeof r=="string"){E(r).forEach(t=>e.add(t));return}if(typeof r=="number"&&Number.isFinite(r)){const t=String(r);E(t).forEach(s=>e.add(s))}},y=(e,r,t=0)=>{if(!(t>2||e===null||e===void 0)){if(Array.isArray(e)){e.forEach(s=>y(s,r,t+1));return}if(e instanceof Date){b(r,e.toISOString());return}if(typeof e=="object"){Object.values(e).forEach(s=>y(s,r,t+1));return}b(r,e)}},L=(e,r)=>{if(!e)return;[e.name,e.username,e.telegram_username,e.telegramId,e.telegram_id,e.phone,e.mobNumber,e.email].forEach(s=>b(r,s))},O=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const r=e.trim();if(!r)return;const t=Number(r);if(Number.isFinite(t))return t}},V=(e,r)=>{var g,l,d;const t=new Set;[e.id,e._id,e.request_id,e.task_number,e.title,e.task_description,e.location,e.start_location,e.end_location,e.project,e.comment,e.status,e.priority,e.task_type,e.route_distance_km].forEach(n=>b(t,n));const m=new Set,c=n=>{const f=O(n);f!==void 0?(m.add(f),b(t,f)):typeof n=="string"&&b(t,n)};return c((l=(g=e.created_by)!=null?g:e.creator)!=null?l:e.createdBy),c(e.assigned_user_id),c(e.controller_user_id),(e.assignees||[]).forEach(n=>c(n)),(d=e.controllers)==null||d.forEach(n=>c(n)),m.forEach(n=>L(r[n],t)),y(e.custom,t),y(e.applicant,t),y(e.logistics_details,t),y(e.procurement_details,t),y(e.work_details,t),Array.from(t)},q=e=>e.trim().toLowerCase().split(/\s+/).filter(Boolean);function B(e,r,t){const s=q(r);if(!s.length)return!0;const m=V(e,t);return m.length?s.every(c=>E(c).some(l=>m.some(d=>d.includes(l)))):!1}const M=S.lazy(()=>I(()=>import("./DataTable-r-lWgJ1H.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function G({tasks:e,users:r,page:t,pageCount:s,mine:m=!1,entityKind:c="task",onPageChange:g,onMineChange:l,onRowClick:d,toolbarChildren:n,onDataChange:f}){const{query:T,filters:o}=z(),h=x.useMemo(()=>r!=null?r:{},[r]),A=x.useMemo(()=>w(h,c),[h,c]);return x.useEffect(()=>{f==null||f(e)},[f,e]),_.jsx(S.Suspense,{fallback:_.jsx("div",{children:"Загрузка таблицы..."}),children:_.jsx(M,{columns:A,data:e.filter(i=>{if(T&&!B(i,T,h)||o.status.length&&!o.status.includes(i.status)||o.priority.length&&!o.priority.includes(i.priority))return!1;if(o.taskTypes.length){const a=typeof i.task_type=="string"?i.task_type.trim():"";if(!a||!o.taskTypes.includes(a))return!1}if(o.assignees.length){const a=new Set,N=u=>{if(typeof u=="number"&&Number.isFinite(u))a.add(u);else if(typeof u=="string"){const j=Number(u.trim());Number.isFinite(j)&&a.add(j)}};if(Array.isArray(i.assignees)&&i.assignees.forEach(N),N(i.assigned_user_id),!o.assignees.some(u=>a.has(Number(u))))return!1}const p=i.createdAt?new Date(i.createdAt):null;return!(o.from&&p&&p<new Date(o.from)||o.to&&p&&p>new Date(o.to))}),pageIndex:t,pageSize:25,pageCount:s,onPageChange:g,onRowClick:i=>{const p=i,a=F(p._id)||F(p.id);a&&(d==null||d(a))},toolbarChildren:_.jsxs(_.Fragment,{children:[typeof l=="function"&&_.jsxs("label",{className:"flex items-center gap-1 text-sm",htmlFor:"task-table-mine",children:[_.jsx("input",{id:"task-table-mine",name:"mineTasks",type:"checkbox",checked:m,onChange:i=>l(i.target.checked)}),"Мои"]}),n]})})})}export{G as T};
//# sourceMappingURL=TaskTable-Bm5NCTXl.js.map
