!function(){function e(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var r,n,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function c(e,a,i,o){var c=a&&a.prototype instanceof s?a:s,l=Object.create(c.prototype);return t(l,"_invoke",function(e,t,a){var i,o,c,s=0,l=a||[],f=!1,d={p:0,n:0,v:r,a:m,f:m.bind(r,4),d:function(e,t){return i=e,o=0,c=r,d.n=t,u}};function m(e,t){for(o=e,c=t,n=0;!f&&s&&!a&&n<l.length;n++){var a,i=l[n],m=d.p,h=i[2];e>3?(a=h===t)&&(c=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=r):i[0]<=m&&((a=e<2&&m<i[1])?(o=0,d.v=t,d.n=i[1]):m<h&&(a=e<3||i[0]>t||t>h)&&(i[4]=e,i[5]=t,d.n=h,o=0))}if(a||e>1)return u;throw f=!0,t}return function(a,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&m(l,h),o=l,c=h;(n=o<2?r:c)||!f;){i||(o?o<3?(o>1&&(d.n=-1),m(o,c)):d.n=c:d.v=c);try{if(s=2,i){if(o||(a="next"),n=i[a]){if(!(n=n.call(i,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,o<2&&(o=0)}else 1===o&&(n=i.return)&&n.call(i),o<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),o=1);i=r}else if((n=(f=d.n<0)?c:e.call(t,d))!==u)break}catch(n){i=r,o=1,c=n}finally{s=1}}return{value:n,done:f}}}(e,i,o),!0),l}var u={};function s(){}function l(){}function f(){}n=Object.getPrototypeOf;var d=[][i]?n(n([][i]())):(t(n={},i,function(){return this}),n),m=f.prototype=s.prototype=Object.create(d);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,t(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e}return l.prototype=f,t(m,"constructor",f),t(f,"constructor",l),l.displayName="GeneratorFunction",t(f,o,"GeneratorFunction"),t(m),t(m,o,"Generator"),t(m,i,function(){return this}),t(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:h}})()}function t(e,r,n,a){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}t=function(e,r,n,a){function o(r,n){t(e,r,function(e){return this._invoke(r,n,e)})}r?i?i(e,r,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[r]=n:(o("next",0),o("throw",1),o("return",2))},t(e,r,n,a)}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,c=[],u=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){s=!0,a=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(s)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(e,t,r,n,a,i,o){try{var c=e[i](o),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function o(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function c(e){i(o,n,a,c,u,"next",e)}function u(e){i(o,n,a,c,u,"throw",e)}c(void 0)})}}System.register(["./index-legacy-Cw3EU-FN.js","./vendor-legacy-3V6tX1hl.js","./DataTable-legacy-BVxdFFVf.js","./App-legacy-92jDSsGS.js","./input-legacy-DL0_TS5-.js","./useToast-legacy-CCtM2qzd.js","./AuthenticatedApp-legacy-BR--zcF1.js"],function(t,n){"use strict";var i,c,u,s,l,f,d,m,h,p,v;return{setters:[function(e){i=e.j},function(e){c=e.R},function(e){u=e.default},function(e){s=e.h,l=e.a,f=e.B},function(e){d=e.I},function(e){m=e.u},function(e){h=e.h,p=e.j,v=e.k}],execute:function(){t("default",function(){var t=m().addToast,a=l().user,s=r(c.useState([]),2),b=s[0],x=s[1],k=r(c.useState(0),2),N=k[0],_=k[1],A=r(c.useState(0),2),C=A[0],T=A[1],O=r(c.useState(0),2),E=O[0],W=O[1],I=r(c.useState(!1),2),P=I[0],G=I[1],z=r(c.useState(!1),2),F=z[0],D=z[1],R=r(c.useState(""),2),K=R[0],M=R[1],U=r(c.useState(""),2),B=U[0],J=U[1],L=r(c.useState(0),2),$=L[0],q=L[1],H=r(c.useState(new Set),2),Q=H[0],V=H[1],X="number"==typeof(null==a?void 0:a.access)?a.access:0,Y=h(X,p),Z=h(X,v),ee=c.useMemo(function(){return b.filter(function(e){return e.id}).length},[b]);c.useEffect(function(){var r=!1,n=function(){var n=o(e().m(function n(){var a,i,o,c,u;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return G(!0),e.p=1,e.n=2,y({page:N+1,limit:w,search:B||void 0});case 2:if(a=e.v,!r){e.n=3;break}return e.a(2);case 3:i=a.items.map(function(e){var t,r,n,a=e;return{id:S(null!==(t=null!==(r=null!==(n=a._id)&&void 0!==n?n:a.id)&&void 0!==r?r:a.task_number)&&void 0!==t?t:""),task_number:"string"==typeof a.task_number?a.task_number:void 0,title:"string"==typeof a.title?a.title:void 0,status:"string"==typeof a.status?a.status:void 0,archived_at:j(a.archived_at),createdAt:j(a.createdAt),archived_by:"number"==typeof a.archived_by&&Number.isFinite(a.archived_by)?a.archived_by:void 0}}),x(i),W(a.total),T(a.pages),V(function(e){var t=new Set;return i.forEach(function(r){r.id&&e.has(r.id)&&t.add(r.id)}),t}),o=Math.max((a.pages||1)-1,0),N>o&&_(o),e.n=5;break;case 4:e.p=4,u=e.v,r||(c=u instanceof Error?u.message:"Не удалось загрузить архив задач",t(c,"error"));case 5:return e.p=5,r||G(!1),e.f(5);case 6:return e.a(2)}},n,null,[[1,4,5,6]])}));return function(){return n.apply(this,arguments)}}();return Y&&n(),function(){r=!0}},[N,B,$,Y,t]);var te=c.useCallback(function(e){e.preventDefault(),J(K.trim()),_(0)},[K]),re=c.useCallback(function(){M(""),J(""),_(0)},[]),ne=c.useCallback(function(e,t){V(function(r){var n=new Set(r);return t?n.add(e):n.delete(e),n})},[]),ae=c.useCallback(function(e){if(e){var t=new Set;b.forEach(function(e){e.id&&t.add(e.id)}),V(t)}else V(new Set)},[b]),ie=c.useCallback(o(e().m(function r(){var n,a,i;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(Q.size){e.n=1;break}return e.a(2);case 1:return D(!0),e.p=2,e.n=3,g(Array.from(Q));case 3:(n=e.v)>0?t("Удалено ".concat(n," задач"),"success"):t("Задачи не были удалены","error"),V(new Set),q(function(e){return e+1}),e.n=5;break;case 4:e.p=4,i=e.v,a=i instanceof Error?i.message:"Не удалось выполнить полное удаление",t(a,"error");case 5:return e.p=5,D(!1),e.f(5);case 6:return e.a(2)}},r,null,[[2,4,5,6]])})),[Q,t]),oe=c.useMemo(function(){return function(e){var t=e.enableSelection,r=e.selectedIds,a=e.onToggleRow,o=e.onToggleAll,c=e.visibleCount,u=[];t&&u.push({id:"select",header:function(){var e=c>0&&r.size>=c,t=r.size>0&&r.size<c;return i.jsx("input",{type:"checkbox","aria-label":"Выбрать все",checked:e,ref:function(r){r&&(r.indeterminate=t&&!e)},onChange:function(e){return o(e.target.checked)}})},cell:function(e){var t=e.row,n=t.original.id;return n?i.jsx("input",{type:"checkbox","aria-label":"Выбрать задачу ".concat(t.original.task_number||n),checked:r.has(n),onChange:function(e){return a(n,e.target.checked)}}):i.jsx("span",{className:"text-muted-foreground",children:"—"})},meta:{width:"3rem",minWidth:"3rem",maxWidth:"3rem"}});return u.push({header:"Номер",accessorKey:"task_number",meta:{width:"8rem",minWidth:"6rem",maxWidth:"8rem",cellClassName:"font-mono text-xs sm:text-sm"},cell:function(e){var t=e.row;return t.original.task_number||t.original.id||"—"}},{header:"Название",accessorKey:"title",meta:{width:"16rem",minWidth:"10rem",maxWidth:"22rem",cellClassName:"whitespace-normal"},cell:function(e){var t=e.row.original.title||"—";return i.jsx("span",{className:"line-clamp-2 break-words text-sm",children:t})}},{header:"Статус",accessorKey:"status",meta:{width:"8rem",minWidth:"6rem",maxWidth:"10rem"},cell:function(e){return e.row.original.status||"—"}},{header:"Удалена",accessorKey:"archived_at",meta:{width:"10rem",minWidth:"8rem",maxWidth:"12rem"},cell:function(e){return function(e){if(!e)return"—";var t=new Date(e);return Number.isNaN(t.getTime())?e:n.format(t)}(e.row.original.archived_at)}}),u}({enableSelection:Z,selectedIds:Q,onToggleRow:ne,onToggleAll:ae,visibleCount:ee})},[Z,Q,ne,ae,ee]);if(!Y)return i.jsxs("div",{className:"space-y-4",children:[i.jsx("h1",{className:"text-2xl font-semibold",children:"Архив задач"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Недостаточно прав для просмотра архива."})]});var ce=(ue=E%10,se=E%100,1===ue&&11!==se?"задача":[2,3,4].includes(ue)&&![12,13,14].includes(se)?"задачи":"задач");var ue,se;return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold",children:"Архив задач"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Здесь отображаются удалённые задачи только для чтения."})]}),Z?i.jsx(f,{type:"button",variant:"destructive",disabled:!Q.size||F||P,onClick:ie,children:"Полное удаление"}):null]}),i.jsxs("form",{onSubmit:te,className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[i.jsx(d,{value:K,onChange:function(e){return M(e.target.value)},placeholder:"Поиск по номеру или названию","aria-label":"Поиск по архиву"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(f,{type:"submit",variant:"secondary",disabled:P,children:"Искать"}),i.jsx(f,{type:"button",variant:"ghost",disabled:P||!B&&!K,onClick:re,children:"Сбросить"})]})]}),P?i.jsx("div",{className:"text-sm text-muted-foreground",children:"Загрузка архива..."}):null,i.jsx(u,{columns:oe,data:b,pageIndex:N,pageSize:w,pageCount:C,onPageChange:_,showGlobalSearch:!1,showFilters:!1}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:["Найдено ",E," ",ce]})]})});var n=new Intl.DateTimeFormat("ru-RU",{dateStyle:"short",timeStyle:"short"});function y(){return b.apply(this,arguments)}function b(){return b=o(e().m(function t(){var r,n,a,i,o,c,u,l=arguments;return e().w(function(e){for(;;)switch(e.n){case 0:return r=l.length>0&&void 0!==l[0]?l[0]:{},n=new URLSearchParams,r.page&&n.set("page",String(r.page)),r.limit&&n.set("limit",String(r.limit)),r.search&&n.set("search",r.search.trim()),a=n.toString(),i=a?"/api/v1/archives?".concat(a):"/api/v1/archives",e.n=1,s(i);case 1:if((o=e.v).ok){e.n=3;break}return e.n=2,o.text().catch(function(){return""});case 2:throw c=e.v,new Error(c||"Не удалось загрузить архив задач");case 3:return e.n=4,o.json();case 4:return u=e.v,e.a(2,{items:Array.isArray(u.items)?u.items:[],total:Number(u.total)||0,page:Number(u.page)||1,pages:Number(u.pages)||0})}},t)})),b.apply(this,arguments)}function g(e){return x.apply(this,arguments)}function x(){return(x=o(e().m(function t(r){var n,a,i;return e().w(function(e){for(;;)switch(e.n){case 0:if(Array.isArray(r)&&0!==r.length){e.n=1;break}return e.a(2,0);case 1:return e.n=2,s("/api/v1/archives/purge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:r})});case 2:if((n=e.v).ok){e.n=4;break}return e.n=3,n.text().catch(function(){return""});case 3:throw a=e.v,new Error(a||"Не удалось выполнить полное удаление");case 4:return e.n=5,n.json();case 5:return i=e.v,e.a(2,Number(i.removed)||0)}},t)}))).apply(this,arguments)}var w=25,S=function(e){if(!e)return"";if("string"==typeof e)return e;if("number"==typeof e)return String(e);if("object"===a(e)&&null!==e&&"toString"in e)try{return e.toString()}catch(t){return""}return""},j=function(e){return"string"==typeof e?e:e instanceof Date?e.toISOString():void 0}}}})}();
//# sourceMappingURL=Archive-legacy-CBnbCVeS.js.map
