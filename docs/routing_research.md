<!-- Назначение файла: сравнение вариантов встраивания OR-Tools и поддерживаемых ограничений. Основные модули: docs, services/vrp. -->

# Исследование вариантов встраивания OR-Tools

## Поддерживаемые ограничения

| Подход                                           | Грузоподъёмность                                                     | Временные окна                                                           | Сервисное время                                                          |
| ------------------------------------------------ | -------------------------------------------------------------------- | ------------------------------------------------------------------------ | ------------------------------------------------------------------------ |
| OSRM (текущая интеграция)                        | Требует внешнего расчёта, прямой поддержки нет                       | Поддержка отсутствует, ограничения реализуются в бизнес-логике           | Нет встроенной поддержки, сервис рассчитывает только транспортное время  |
| OR-Tools через Python-сервис                     | Полноценная поддержка: задаём capacity на транспорт и demand у задач | Поддержка через TimeWindowConstraint; можно задавать индивидуальные окна | Поддержка через ServiceTime у задач или добавление в travel time матрицу |
| OR-Tools через gRPC                              | Аналогична Python-сервису, но требует описания protobuf              | Аналогична Python-сервису                                                | Аналогична Python-сервису                                                |
| Встраивание OR-Tools в TypeScript через REST API | Поддержка зависит от бэкенда (см. Python-сервис)                     | Поддержка зависит от бэкенда (см. Python-сервис)                         | Поддержка зависит от бэкенда (см. Python-сервис)                         |

## Сценарии встраивания

1. **REST-шлюз (по умолчанию)**
   - Сервис запускается как отдельный Python-приложение (FastAPI/Flask).
   - Node.js отправляет задачи и матрицу расстояний, получает маршрут и расписание.
   - Преимущества: простая интеграция, легко деплоить рядом с API.
   - Недостатки: нужно контролировать очереди задач и таймауты.

2. **gRPC-сервис**
   - Python-сервис описывается через protobuf, клиент в Node.js генерируется через `@grpc/grpc-js`.
   - Преимущества: двусторонний стриминг, строгая схема, проще мониторить долгие задачи.
   - Недостатки: дополнительная сложность инфраструктуры и генерации типов.

3. **Встроенный Python-сервис (child_process)**
   - Node.js запускает Python-скрипт по требованию, передаёт payload через stdin/stdout.
   - Подходит для экспериментов без деплоя отдельного сервиса.
   - Требует контроля повторного использования процессов и обработки ошибок.

## Выводы

- OR-Tools покрывает ключевые ограничения (грузоподъёмность, временные окна, сервисное время) без дополнительной логики.
- Для текущего прототипа достаточно REST или встроенного Python-сервиса; gRPC стоит рассматривать после стабилизации API.
- Матрицу расстояний можно по-прежнему получать из OSRM, передавая её в OR-Tools как входную матрицу стоимости.
