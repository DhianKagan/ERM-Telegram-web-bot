{"version":3,"file":"AttachmentMenu-DdEQCXYq.js","sources":["../../../web/src/pages/AttachmentMenu.tsx"],"sourcesContent":["// Страница выбора задачи для Attachment Menu\n// Модули: React, useToast, authFetch, shared\nimport React, { useEffect, useState } from 'react';\nimport type { Task } from 'shared';\n\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '../context/useToast';\nimport authFetch from '../utils/authFetch';\n\ntype MenuTask = Task & { task_number: string; createdAt: string };\n\nexport default function AttachmentMenu() {\n  const [tasks, setTasks] = useState<MenuTask[]>([]);\n  const { addToast } = useToast();\n\n  useEffect(() => {\n    authFetch('/api/v1/tasks?limit=10', { noRedirect: true })\n      .then((r) => {\n        if (r.status === 401) {\n          addToast('Сессия истекла, войдите снова', 'error');\n          return [];\n        }\n        return r.ok ? r.json() : [];\n      })\n      .then((data) =>\n        setTasks((Array.isArray(data) ? data : data.tasks || []) as MenuTask[]),\n      );\n  }, [addToast]);\n\n  function select(id: string) {\n    type TelegramApi = {\n      WebApp?: {\n        sendData?: (data: string) => void;\n      };\n    };\n    const telegram = (\n      globalThis as typeof globalThis & { Telegram?: TelegramApi }\n    ).Telegram;\n    telegram?.WebApp?.sendData?.(`task_selected:${id}`);\n  }\n\n  return (\n    <div className=\"p-4\">\n      <h1 className=\"mb-4 text-lg\">Выберите задачу</h1>\n      <ul>\n        {tasks.map((t) => (\n          <li key={t._id} className=\"mb-2\">\n            <Button\n              onClick={() => select(t._id)}\n              variant=\"link\"\n              size=\"sm\"\n              className=\"px-0\"\n            >\n              {`${t.task_number} ${t.createdAt.slice(0, 10)} ${t.title}`}\n            </Button>\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n}\n"],"names":["AttachmentMenu","tasks","setTasks","useState","addToast","useToast","useEffect","authFetch","r","data","select","id","telegram","_b","_a","jsxs","jsx","t","Button"],"mappings":"yKAWA,SAAwBA,GAAiB,CACvC,KAAM,CAACC,EAAOC,CAAQ,EAAIC,EAAAA,SAAqB,CAAA,CAAE,EAC3C,CAAE,SAAAC,CAAA,EAAaC,EAAA,EAErBC,EAAAA,UAAU,IAAM,CACdC,EAAU,yBAA0B,CAAE,WAAY,EAAA,CAAM,EACrD,KAAMC,GACDA,EAAE,SAAW,KACfJ,EAAS,gCAAiC,OAAO,EAC1C,CAAA,GAEFI,EAAE,GAAKA,EAAE,KAAA,EAAS,CAAA,CAC1B,EACA,KAAMC,GACLP,EAAU,MAAM,QAAQO,CAAI,EAAIA,EAAOA,EAAK,OAAS,CAAA,CAAiB,CAAA,CAE5E,EAAG,CAACL,CAAQ,CAAC,EAEb,SAASM,EAAOC,EAAY,SAM1B,MAAMC,EACJ,WACA,UACFC,GAAAC,EAAAF,GAAA,YAAAA,EAAU,SAAV,YAAAE,EAAkB,WAAlB,MAAAD,EAAA,KAAAC,EAA6B,iBAAiB,OAAAH,GAChD,CAEA,OACEI,EAAAA,KAAC,MAAA,CAAI,UAAU,MACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,eAAe,SAAA,kBAAe,EAC5CA,EAAAA,IAAC,MACE,SAAAf,EAAM,IAAKgB,GACVD,EAAAA,IAAC,KAAA,CAAe,UAAU,OACxB,SAAAA,EAAAA,IAACE,EAAA,CACC,QAAS,IAAMR,EAAOO,EAAE,GAAG,EAC3B,QAAQ,OACR,KAAK,KACL,UAAU,OAET,SAAA,GAAG,OAAAA,EAAE,YAAW,KAAI,OAAAA,EAAE,UAAU,MAAM,EAAG,EAAE,EAAC,KAAI,OAAAA,EAAE,MAAK,CAAA,GAPnDA,EAAE,GASX,CACD,CAAA,CACH,CAAA,EACF,CAEJ"}