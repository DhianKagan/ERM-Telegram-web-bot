const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/react-apexcharts.min-Dqny7S9j.js","js/vendor-bFQg9Mu4.js","js/index-Chjiymov.js"])))=>i.map(i=>d[i]);
import{j as t,_ as xr}from"./index-DgL4A3Hy.js";import{b as l,l as pr,R as F,i as gr,p as br,m as vr,s as yr}from"./vendor-bFQg9Mu4.js";import{d as Me,B as K,h as We,M as mt,s as we,b as cs,a as jr}from"./App-C5qf9m0C.js";import{B as Nr}from"./Breadcrumbs-K53BHuST.js";import ut from"./DataTable-r-lWgJ1H.js";import{b as wr,c as kr,d as Sr,e as Cr,P as gt,f as ds,R as Er,I as Ir,g as Rt,i as _r,S as ke,F as Tr,h as Ar,A as Rr,j as Dr}from"./AuthenticatedApp-m87IzzAI.js";import{f as ft,t as it,a as Te,b as Mr,c as Dt,u as Mt,r as Wt}from"./collections-D369OXTN.js";import{C as Se}from"./ConfirmDialog-CQLmQCUJ.js";import{f as ye,a as ms,R as Wr,E as Or}from"./EmployeeCardForm-BXoI5Ug_.js";import{I as Re}from"./input-3UdN7pFZ.js";import Fr from"./Archive-BI6wqMHL.js";import Lr from"./Logs-CyRVoBUl.js";import{F as Ur,S as Pr}from"./Storage-DBw_WAq7.js";import{F as Kr}from"./ArrowPathIcon-CFf_6S57.js";import{f as $r,d as Ma,c as Vr,u as Hr}from"./users-Dvp7_OPk.js";import"./useToast-CyXuzwzd.js";import"./EmployeeLink-Cf0n-sug.js";import"./PhotoIcon-COuocIGv.js";function Br({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"}))}const zr=l.forwardRef(Br);function qr({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"}))}const Gr=l.forwardRef(qr);function Zr({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008Zm0 3h.008v.008h-.008v-.008Zm0 3h.008v.008h-.008v-.008Z"}))}const Jr=l.forwardRef(Zr);function Yr({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const Qr=l.forwardRef(Yr);function Xr({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"}))}const en=l.forwardRef(Xr);function tn({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm1.294 6.336a6.721 6.721 0 0 1-3.17.789 6.721 6.721 0 0 1-3.168-.789 3.376 3.376 0 0 1 6.338 0Z"}))}const an=l.forwardRef(tn);function sn({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"}))}const rn=l.forwardRef(sn);function nn({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"}))}const ln=l.forwardRef(nn);function on({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25v13.5m-7.5-13.5v13.5"}))}const cn=l.forwardRef(on);function dn({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const Wa=l.forwardRef(dn);function mn({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6.878V6a2.25 2.25 0 0 1 2.25-2.25h7.5A2.25 2.25 0 0 1 18 6v.878m-12 0c.235-.083.487-.128.75-.128h10.5c.263 0 .515.045.75.128m-12 0A2.25 2.25 0 0 0 4.5 9v.878m13.5-3A2.25 2.25 0 0 1 19.5 9v.878m0 0a2.246 2.246 0 0 0-.75-.128H5.25c-.263 0-.515.045-.75.128m15 0A2.25 2.25 0 0 1 21 12v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6c0-.98.626-1.813 1.5-2.122"}))}const un=l.forwardRef(mn);function fn({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"}))}const hn=l.forwardRef(fn);function xn({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"}))}const pn=l.forwardRef(xn);function gn({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 18.75a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 0 1-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 0 0-3.213-9.193 2.056 2.056 0 0 0-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 0 0-10.026 0 1.106 1.106 0 0 0-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12"}))}const bn=l.forwardRef(gn);function vn({title:e,titleId:a,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},r),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"}))}const yn=l.forwardRef(vn);var Ve={exports:{}},Oa;function jn(){if(Oa)return Ve.exports;Oa=1;var e={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",Ấ:"A",Ắ:"A",Ẳ:"A",Ẵ:"A",Ặ:"A",Æ:"AE",Ầ:"A",Ằ:"A",Ȃ:"A",Ả:"A",Ạ:"A",Ẩ:"A",Ẫ:"A",Ậ:"A",Ç:"C",Ḉ:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ế:"E",Ḗ:"E",Ề:"E",Ḕ:"E",Ḝ:"E",Ȇ:"E",Ẻ:"E",Ẽ:"E",Ẹ:"E",Ể:"E",Ễ:"E",Ệ:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ḯ:"I",Ȋ:"I",Ỉ:"I",Ị:"I",Ð:"D",Ñ:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",Ố:"O",Ṍ:"O",Ṓ:"O",Ȏ:"O",Ỏ:"O",Ọ:"O",Ổ:"O",Ỗ:"O",Ộ:"O",Ờ:"O",Ở:"O",Ỡ:"O",Ớ:"O",Ợ:"O",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ủ:"U",Ụ:"U",Ử:"U",Ữ:"U",Ự:"U",Ý:"Y",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",ấ:"a",ắ:"a",ẳ:"a",ẵ:"a",ặ:"a",æ:"ae",ầ:"a",ằ:"a",ȃ:"a",ả:"a",ạ:"a",ẩ:"a",ẫ:"a",ậ:"a",ç:"c",ḉ:"c",è:"e",é:"e",ê:"e",ë:"e",ế:"e",ḗ:"e",ề:"e",ḕ:"e",ḝ:"e",ȇ:"e",ẻ:"e",ẽ:"e",ẹ:"e",ể:"e",ễ:"e",ệ:"e",ì:"i",í:"i",î:"i",ï:"i",ḯ:"i",ȋ:"i",ỉ:"i",ị:"i",ð:"d",ñ:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",ố:"o",ṍ:"o",ṓ:"o",ȏ:"o",ỏ:"o",ọ:"o",ổ:"o",ỗ:"o",ộ:"o",ờ:"o",ở:"o",ỡ:"o",ớ:"o",ợ:"o",ù:"u",ú:"u",û:"u",ü:"u",ủ:"u",ụ:"u",ử:"u",ữ:"u",ự:"u",ý:"y",ÿ:"y",Ā:"A",ā:"a",Ă:"A",ă:"a",Ą:"A",ą:"a",Ć:"C",ć:"c",Ĉ:"C",ĉ:"c",Ċ:"C",ċ:"c",Č:"C",č:"c",C̆:"C",c̆:"c",Ď:"D",ď:"d",Đ:"D",đ:"d",Ē:"E",ē:"e",Ĕ:"E",ĕ:"e",Ė:"E",ė:"e",Ę:"E",ę:"e",Ě:"E",ě:"e",Ĝ:"G",Ǵ:"G",ĝ:"g",ǵ:"g",Ğ:"G",ğ:"g",Ġ:"G",ġ:"g",Ģ:"G",ģ:"g",Ĥ:"H",ĥ:"h",Ħ:"H",ħ:"h",Ḫ:"H",ḫ:"h",Ĩ:"I",ĩ:"i",Ī:"I",ī:"i",Ĭ:"I",ĭ:"i",Į:"I",į:"i",İ:"I",ı:"i",Ĳ:"IJ",ĳ:"ij",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",Ḱ:"K",ḱ:"k",K̆:"K",k̆:"k",Ĺ:"L",ĺ:"l",Ļ:"L",ļ:"l",Ľ:"L",ľ:"l",Ŀ:"L",ŀ:"l",Ł:"l",ł:"l",Ḿ:"M",ḿ:"m",M̆:"M",m̆:"m",Ń:"N",ń:"n",Ņ:"N",ņ:"n",Ň:"N",ň:"n",ŉ:"n",N̆:"N",n̆:"n",Ō:"O",ō:"o",Ŏ:"O",ŏ:"o",Ő:"O",ő:"o",Œ:"OE",œ:"oe",P̆:"P",p̆:"p",Ŕ:"R",ŕ:"r",Ŗ:"R",ŗ:"r",Ř:"R",ř:"r",R̆:"R",r̆:"r",Ȓ:"R",ȓ:"r",Ś:"S",ś:"s",Ŝ:"S",ŝ:"s",Ş:"S",Ș:"S",ș:"s",ş:"s",Š:"S",š:"s",Ţ:"T",ţ:"t",ț:"t",Ț:"T",Ť:"T",ť:"t",Ŧ:"T",ŧ:"t",T̆:"T",t̆:"t",Ũ:"U",ũ:"u",Ū:"U",ū:"u",Ŭ:"U",ŭ:"u",Ů:"U",ů:"u",Ű:"U",ű:"u",Ų:"U",ų:"u",Ȗ:"U",ȗ:"u",V̆:"V",v̆:"v",Ŵ:"W",ŵ:"w",Ẃ:"W",ẃ:"w",X̆:"X",x̆:"x",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Y̆:"Y",y̆:"y",Ź:"Z",ź:"z",Ż:"Z",ż:"z",Ž:"Z",ž:"z",ſ:"s",ƒ:"f",Ơ:"O",ơ:"o",Ư:"U",ư:"u",Ǎ:"A",ǎ:"a",Ǐ:"I",ǐ:"i",Ǒ:"O",ǒ:"o",Ǔ:"U",ǔ:"u",Ǖ:"U",ǖ:"u",Ǘ:"U",ǘ:"u",Ǚ:"U",ǚ:"u",Ǜ:"U",ǜ:"u",Ứ:"U",ứ:"u",Ṹ:"U",ṹ:"u",Ǻ:"A",ǻ:"a",Ǽ:"AE",ǽ:"ae",Ǿ:"O",ǿ:"o",Þ:"TH",þ:"th",Ṕ:"P",ṕ:"p",Ṥ:"S",ṥ:"s",X́:"X",x́:"x",Ѓ:"Г",ѓ:"г",Ќ:"К",ќ:"к",A̋:"A",a̋:"a",E̋:"E",e̋:"e",I̋:"I",i̋:"i",Ǹ:"N",ǹ:"n",Ồ:"O",ồ:"o",Ṑ:"O",ṑ:"o",Ừ:"U",ừ:"u",Ẁ:"W",ẁ:"w",Ỳ:"Y",ỳ:"y",Ȁ:"A",ȁ:"a",Ȅ:"E",ȅ:"e",Ȉ:"I",ȉ:"i",Ȍ:"O",ȍ:"o",Ȑ:"R",ȑ:"r",Ȕ:"U",ȕ:"u",B̌:"B",b̌:"b",Č̣:"C",č̣:"c",Ê̌:"E",ê̌:"e",F̌:"F",f̌:"f",Ǧ:"G",ǧ:"g",Ȟ:"H",ȟ:"h",J̌:"J",ǰ:"j",Ǩ:"K",ǩ:"k",M̌:"M",m̌:"m",P̌:"P",p̌:"p",Q̌:"Q",q̌:"q",Ř̩:"R",ř̩:"r",Ṧ:"S",ṧ:"s",V̌:"V",v̌:"v",W̌:"W",w̌:"w",X̌:"X",x̌:"x",Y̌:"Y",y̌:"y",A̧:"A",a̧:"a",B̧:"B",b̧:"b",Ḑ:"D",ḑ:"d",Ȩ:"E",ȩ:"e",Ɛ̧:"E",ɛ̧:"e",Ḩ:"H",ḩ:"h",I̧:"I",i̧:"i",Ɨ̧:"I",ɨ̧:"i",M̧:"M",m̧:"m",O̧:"O",o̧:"o",Q̧:"Q",q̧:"q",U̧:"U",u̧:"u",X̧:"X",x̧:"x",Z̧:"Z",z̧:"z",й:"и",Й:"И",ё:"е",Ё:"Е"},a=Object.keys(e).join("|"),r=new RegExp(a,"g"),n=new RegExp(a,"");function c(d){return e[d]}var i=function(d){return d.replace(r,c)},m=function(d){return!!d.match(n)};return Ve.exports=i,Ve.exports.has=m,Ve.exports.remove=i,Ve.exports}var Nn=jn();const wn=pr(Nn);const Y={CASE_SENSITIVE_EQUAL:7,EQUAL:6,STARTS_WITH:5,WORD_STARTS_WITH:4,CONTAINS:3,ACRONYM:2,MATCHES:1,NO_MATCH:0},kn=(e,a)=>String(e.rankedValue).localeCompare(String(a.rankedValue));function us(e,a,r={}){const{keys:n,threshold:c=Y.MATCHES,baseSort:i=kn,sorter:m=b=>b.sort((x,v)=>_n(x,v,i))}=r,d=e.reduce(u,[]);return m(d).map(({item:b})=>b);function u(b,x,v){const y=Sn(x,n,a,r),{rank:j,keyThreshold:k=c}=y;return j>=k&&b.push({...y,item:x,index:v}),b}}us.rankings=Y;function Sn(e,a,r,n){if(!a){const i=e;return{rankedValue:i,rank:Fa(i,r,n),keyIndex:-1,keyThreshold:n.threshold}}return Rn(e,a).reduce(({rank:i,rankedValue:m,keyIndex:d,keyThreshold:u},{itemValue:b,attributes:x},v)=>{let y=Fa(b,r,n),j=m;const{minRanking:k,maxRanking:R,threshold:M}=x;return y<k&&y>=Y.MATCHES?y=k:y>R&&(y=R),y>i&&(i=y,d=v,u=M,j=b),{rankedValue:j,rank:i,keyIndex:d,keyThreshold:u}},{rankedValue:e,rank:Y.NO_MATCH,keyIndex:-1,keyThreshold:n.threshold})}function*Cn(e,a){let r=-1;for(;(r=e.indexOf(a,r+1))>-1;)yield r;return-1}function Fa(e,a,r){if(e=La(e,r),a=La(a,r),a.length>e.length)return Y.NO_MATCH;if(e===a)return Y.CASE_SENSITIVE_EQUAL;e=e.toLowerCase(),a=a.toLowerCase();const n=Cn(e,a),c=n.next(),i=c.value;if(e.length===a.length&&i===0)return Y.EQUAL;if(i===0)return Y.STARTS_WITH;let m=c;for(;!m.done;){if(m.value>0&&e[m.value-1]===" ")return Y.WORD_STARTS_WITH;m=n.next()}return i>0?Y.CONTAINS:a.length===1?Y.NO_MATCH:En(e).includes(a)?Y.ACRONYM:In(e,a)}function En(e){let a="",r=" ";for(let n=0;n<e.length;n++){const c=e.charAt(n);(r===" "||r==="-")&&!(c===" "||c==="-")&&(a+=c),r=c}return a}function In(e,a){let r=0,n=0;function c(u,b,x){for(let v=x,y=b.length;v<y;v++)if(b[v]===u)return r+=1,v+1;return-1}function i(u){const b=1/u,x=r/a.length;return Y.MATCHES+x*b}const m=c(a[0],e,0);if(m<0)return Y.NO_MATCH;n=m;for(let u=1,b=a.length;u<b;u++){const x=a[u];if(n=c(x,e,n),!(n>-1))return Y.NO_MATCH}const d=n-m;return i(d)}function _n(e,a,r){const{rank:i,keyIndex:m}=e,{rank:d,keyIndex:u}=a;return i===d?m===u?r(e,a):m<u?-1:1:i>d?-1:1}function La(e,{keepDiacritics:a}){return e="".concat(e),a||(e=wn(e)),e}function Tn(e,a){typeof a=="object"&&(a=a.key);let r;if(typeof a=="function")r=a(e);else if(e==null)r=null;else if(Object.hasOwnProperty.call(e,a))r=e[a];else{if(a.includes("."))return An(a,e);r=null}return r==null?[]:Array.isArray(r)?r:[String(r)]}function An(e,a){const r=e.split(".");let n=[a];for(let c=0,i=r.length;c<i;c++){const m=r[c];let d=[];for(let u=0,b=n.length;u<b;u++){const x=n[u];if(x!=null)if(Object.hasOwnProperty.call(x,m)){const v=x[m];v!=null&&d.push(v)}else m==="*"&&(d=d.concat(x))}n=d}return Array.isArray(n[0])?[].concat(...n):n}function Rn(e,a){const r=[];for(let n=0,c=a.length;n<c;n++){const i=a[n],m=Dn(i),d=Tn(e,i);for(let u=0,b=d.length;u<b;u++)r.push({itemValue:d[u],attributes:m})}return r}const Ua={maxRanking:1/0,minRanking:-1/0};function Dn(e){return typeof e=="string"?Ua:{...Ua,...e}}var bt="Tabs",[Mn,no]=Sr(bt,[ds]),fs=ds(),[Wn,Zt]=Mn(bt),hs=l.forwardRef((e,a)=>{const{__scopeTabs:r,value:n,onValueChange:c,defaultValue:i,orientation:m="horizontal",dir:d,activationMode:u="automatic",...b}=e,x=wr(d),[v,y]=kr({prop:n,onChange:c,defaultProp:i!=null?i:"",caller:bt});return t.jsx(Wn,{scope:r,baseId:Cr(),value:v,onValueChange:y,orientation:m,dir:x,activationMode:u,children:t.jsx(gt.div,{dir:x,"data-orientation":m,...b,ref:a})})});hs.displayName=bt;var xs="TabsList",ps=l.forwardRef((e,a)=>{const{__scopeTabs:r,loop:n=!0,...c}=e,i=Zt(xs,r),m=fs(r);return t.jsx(Er,{asChild:!0,...m,orientation:i.orientation,dir:i.dir,loop:n,children:t.jsx(gt.div,{role:"tablist","aria-orientation":i.orientation,...c,ref:a})})});ps.displayName=xs;var gs="TabsTrigger",bs=l.forwardRef((e,a)=>{const{__scopeTabs:r,value:n,disabled:c=!1,...i}=e,m=Zt(gs,r),d=fs(r),u=js(m.baseId,n),b=Ns(m.baseId,n),x=n===m.value;return t.jsx(Ir,{asChild:!0,...d,focusable:!c,active:x,children:t.jsx(gt.button,{type:"button",role:"tab","aria-selected":x,"aria-controls":b,"data-state":x?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:u,...i,ref:a,onMouseDown:Rt(e.onMouseDown,v=>{!c&&v.button===0&&v.ctrlKey===!1?m.onValueChange(n):v.preventDefault()}),onKeyDown:Rt(e.onKeyDown,v=>{[" ","Enter"].includes(v.key)&&m.onValueChange(n)}),onFocus:Rt(e.onFocus,()=>{const v=m.activationMode!=="manual";!x&&!c&&v&&m.onValueChange(n)})})})});bs.displayName=gs;var vs="TabsContent",ys=l.forwardRef((e,a)=>{const{__scopeTabs:r,value:n,forceMount:c,children:i,...m}=e,d=Zt(vs,r),u=js(d.baseId,n),b=Ns(d.baseId,n),x=n===d.value,v=l.useRef(x);return l.useEffect(()=>{const y=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(y)},[]),t.jsx(_r,{present:c||x,children:({present:y})=>t.jsx(gt.div,{"data-state":x?"active":"inactive","data-orientation":d.orientation,role:"tabpanel","aria-labelledby":u,hidden:!y,id:b,tabIndex:0,...m,ref:a,style:{...e.style,animationDuration:v.current?"0s":void 0},children:y&&i})})});ys.displayName=vs;function js(e,a){return"".concat(e,"-trigger-").concat(a)}function Ns(e,a){return"".concat(e,"-content-").concat(a)}var On=hs,Fn=ps,Ln=bs,Un=ys;function Pa({className:e,...a}){return t.jsx(On,{"data-slot":"tabs",className:Me("flex flex-col gap-2",e),...a})}function Ka({className:e,...a}){return t.jsx(Fn,{"data-slot":"tabs-list",className:Me("bg-muted text-muted-foreground inline-flex h-9 w-full max-w-full items-center justify-start overflow-x-auto rounded-lg p-[3px]",e),...a})}function $a({className:e,...a}){return t.jsx(Ln,{"data-slot":"tabs-trigger",className:Me("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] shrink-0 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...a})}function ce({className:e,...a}){return t.jsx(Un,{"data-slot":"tabs-content",className:Me("flex-1 outline-none",e),...a})}function Pn({breadcrumbs:e,title:a,description:r,toolbar:n,children:c,className:i}){return t.jsxs("section",{className:Me("flex flex-col gap-3 rounded-3xl border border-[color:var(--color-gray-200)]","bg-[color:var(--color-gray-25)] p-4 shadow-[var(--shadow-theme-sm)] sm:p-6","dark:border-[color:var(--color-gray-700)] dark:bg-[color:var(--color-gray-dark)]",i),children:[e?t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-[color:var(--color-gray-500)] dark:text-[color:var(--color-gray-300)]",children:e}):null,a||r||n?t.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[t.jsxs("div",{className:"min-w-0 space-y-1",children:[a?t.jsx("h1",{className:"text-lg font-semibold text-[color:var(--color-gray-900)] dark:text-white sm:text-xl",children:a}):null,r?t.jsx("p",{className:"text-sm text-[color:var(--color-gray-600)] dark:text-[color:var(--color-gray-300)]",children:r}):null]}),n?t.jsx("div",{className:"flex flex-wrap items-center justify-end gap-2",children:n}):null]}):null,c?t.jsx("div",{className:"space-y-3 sm:space-y-4",children:c}):null]})}function Kn({value:e,displayValue:a,copyHint:r,copiedHint:n,onCopy:c,className:i,disabled:m,...d}){const[u,b]=F.useState(!1),x=F.useRef(),v=a!=null?a:e,y=r!=null?r:"Copy",j=n!=null?n:"Copied";F.useEffect(()=>()=>{x.current&&window.clearTimeout(x.current)},[]),F.useEffect(()=>{if(u)return x.current=window.setTimeout(()=>b(!1),1600),()=>{x.current&&window.clearTimeout(x.current)}},[u]);const k=async()=>{if(!e||m)return;const R=async()=>{var p;if(typeof navigator<"u"&&((p=navigator.clipboard)!=null&&p.writeText))return await navigator.clipboard.writeText(e),!0;if(typeof document>"u")return!1;const M=document.createElement("textarea");M.value=e,M.setAttribute("readonly",""),M.style.position="absolute",M.style.left="-9999px",document.body.appendChild(M),M.select();try{return document.execCommand("copy")}catch(E){return!1}finally{document.body.removeChild(M)}};try{await R()&&b(!0)}finally{c==null||c({value:e})}};return t.jsxs("button",{type:"button",className:Me("inline-flex items-center gap-1.5 rounded-full border border-[color:var(--color-gray-300)]","bg-[color:var(--color-gray-25)] px-3 py-1 text-[11px] font-semibold tracking-wide text-[color:var(--color-gray-700)]","transition-colors duration-150 ease-out hover:border-[color:var(--color-brand-400)] hover:bg-[color:var(--color-brand-50)]","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-brand-500)] focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:border-[color:var(--color-gray-200)] disabled:text-[color:var(--color-gray-400)]","dark:border-[color:var(--color-gray-700)] dark:bg-[color:var(--color-gray-dark)] dark:text-[color:var(--color-gray-100)]","dark:hover:border-[color:var(--color-brand-400)] dark:hover:bg-[color:var(--color-gray-800)]",i),onClick:k,title:u?j:y,"aria-pressed":u,"aria-live":"polite",disabled:m,...d,children:[t.jsxs("span",{className:"inline-flex items-center gap-1",children:[u?t.jsx(Qr,{className:"h-4 w-4 text-[color:var(--color-brand-500)] dark:text-[color:var(--color-brand-400)]","aria-hidden":"true"}):t.jsx(en,{className:"h-4 w-4 text-[color:var(--color-gray-500)] dark:text-[color:var(--color-gray-300)]","aria-hidden":"true"}),t.jsx("span",{className:"truncate text-left",children:v})]}),t.jsx("span",{className:"sr-only",children:u?j:y})]})}function $n({form:e,onChange:a,onSubmit:r,onDelete:n,onReset:c,valueLabel:i="Значение",renderValueField:m,readonly:d=!1,readonlyNotice:u}){const[b,x]=F.useState(!1),[v,y]=F.useState(!1),j=k=>{k.preventDefault(),!d&&y(!0)};return t.jsxs("form",{onSubmit:j,className:"space-y-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Имя"}),t.jsx("input",{id:"collection-form-name",name:"collectionName",className:"h-10 w-full rounded border px-3",value:e.name,onChange:k=>a({...e,name:k.target.value}),required:!0,disabled:d})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:i}),m?m(e,d?()=>{}:a,{readonly:d}):t.jsx("input",{id:"collection-form-value",name:"collectionValue",className:"h-10 w-full rounded border px-3",value:e.value,onChange:k=>a({...e,value:k.target.value}),required:!0,disabled:d})]}),d?t.jsx("p",{className:"rounded border border-amber-200 bg-amber-50 p-2 text-sm text-amber-900",children:u!=null?u:"Элемент доступен только для чтения."}):null,t.jsxs("div",{className:"flex gap-2",children:[t.jsx(K,{type:"submit",disabled:d,children:"Сохранить"}),e._id?t.jsx(K,{type:"button",variant:"destructive",disabled:d,onClick:()=>{d||x(!0)},children:"Удалить"}):t.jsx(K,{type:"button",variant:"outline",onClick:c,disabled:d,children:"Очистить"})]}),t.jsx(Se,{open:v,message:"Сохранить изменения?",onConfirm:()=>{y(!1),r()},onCancel:()=>y(!1),confirmText:"Сохранить"}),t.jsx(Se,{open:b,message:"Удалить элемент?",onConfirm:()=>{x(!1),n()},onCancel:()=>x(!1)})]})}const Ne=new Map,Vn=(e,a,r)=>"".concat(e,"::").concat(a,"::").concat(r);function Jt(e,a){return e.ok?e.json():e.text().then(r=>{throw new Error(r||a)})}async function Hn(e="",a=1,r=10){const n=Vn(e,a,r),c=Ne.get(n);if(c)return c.promise;Ne.size>0&&Ne.forEach((u,b)=>{b!==n&&(u.controller.abort(),Ne.delete(b))});const i=new AbortController,m=new URLSearchParams;m.set("page",String(a)),m.set("limit",String(r)),e&&m.set("search",e);const d=We("/api/v1/fleets?".concat(m.toString()),{signal:i.signal}).then(u=>Jt(u,"Не удалось загрузить транспорт")).finally(()=>{const u=Ne.get(n);(u==null?void 0:u.controller)===i&&Ne.delete(n)});return Ne.set(n,{controller:i,promise:d}),d}async function Bn(e){const a=await We("/api/v1/fleets",{method:"POST",confirmed:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return Jt(a,"Не удалось создать транспорт")}async function zn(e,a){const r=await We("/api/v1/fleets/".concat(e),{method:"PUT",confirmed:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return Jt(r,"Не удалось обновить транспорт")}async function qn(e){const a=await We("/api/v1/fleets/".concat(e),{method:"DELETE",confirmed:!0});if(!a.ok){const r=await a.text().catch(()=>"");throw new Error(r||"Не удалось удалить транспорт")}}const Ot={name:"",registrationNumber:"",odometerInitial:"0",odometerCurrent:"0",mileageTotal:"0",transportType:"Легковой",fuelType:"Бензин",fuelRefilled:"0",fuelAverageConsumption:"0",fuelSpentTotal:"0",currentTasks:""},Gn=e=>e.split(/[\n,]/).map(a=>a.trim()).filter(Boolean);function Zn({open:e,mode:a,vehicle:r,saving:n,onSubmit:c,onDelete:i,onClose:m}){const[d,u]=l.useState(Ot),[b,x]=l.useState(null),[v,y]=l.useState(!1),[j,k]=l.useState(!1);l.useEffect(()=>{if(e&&r){const w=Array.isArray(r.currentTasks)?r.currentTasks.filter(Boolean):[];u({name:r.name,registrationNumber:r.registrationNumber,odometerInitial:String(r.odometerInitial),odometerCurrent:String(r.odometerCurrent),mileageTotal:String(r.mileageTotal),transportType:r.transportType,fuelType:r.fuelType,fuelRefilled:String(r.fuelRefilled),fuelAverageConsumption:String(r.fuelAverageConsumption),fuelSpentTotal:String(r.fuelSpentTotal),currentTasks:w.join("\n")}),x(null),y(!1),k(!1);return}e&&a==="create"&&(u(Ot),x(null),y(!1),k(!1)),e||(u(Ot),x(null),y(!1),k(!1))},[e,a,r]);const R=a==="update"&&r,M=l.useMemo(()=>({name:d.name.trim(),registrationNumber:d.registrationNumber.trim().toUpperCase(),odometerInitial:Number(d.odometerInitial||"0"),odometerCurrent:Number(d.odometerCurrent||"0"),mileageTotal:Number(d.mileageTotal||"0"),transportType:d.transportType,fuelType:d.fuelType,fuelRefilled:Number(d.fuelRefilled||"0"),fuelAverageConsumption:Number(d.fuelAverageConsumption||"0"),fuelSpentTotal:Number(d.fuelSpentTotal||"0"),currentTasks:Gn(d.currentTasks)}),[d]),p=w=>{if(w.preventDefault(),!d.name.trim()){x("Название обязательно");return}if(!/^[A-ZА-ЯІЇЄ]{2} \d{4} [A-ZА-ЯІЇЄ]{2}$/u.test(M.registrationNumber)){x("Регистрационный номер должен быть в формате XX 0000 XX");return}x(null),y(!0)},E=async()=>{try{await c(M,r==null?void 0:r.id),y(!1),m()}catch(w){const A=w instanceof Error?w.message:"Не удалось сохранить транспорт";x(A),y(!1)}},T=async()=>{if(!(!r||!i))try{await i(r.id),k(!1),m()}catch(w){const A=w instanceof Error?w.message:"Не удалось удалить транспорт";x(A),k(!1)}};return t.jsxs("form",{onSubmit:p,className:"space-y-3",children:[t.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium",children:"Название"}),t.jsx("input",{id:"fleet-vehicle-name",name:"name",className:"h-10 w-full rounded border px-3",value:d.name,onChange:w=>u(A=>({...A,name:w.target.value})),disabled:n,required:!0})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium",children:"Регистрационный номер"}),t.jsx("input",{id:"fleet-vehicle-registration",name:"registrationNumber",className:"h-10 w-full rounded border px-3 uppercase",value:d.registrationNumber,onChange:w=>u(A=>({...A,registrationNumber:w.target.value})),disabled:n,required:!0,placeholder:"AA 1234 BB"})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium",children:"Тип транспорта"}),t.jsxs("select",{id:"fleet-vehicle-transport-type",name:"transportType",className:"h-10 w-full rounded border px-3",value:d.transportType,onChange:w=>u(A=>({...A,transportType:w.target.value})),disabled:n,required:!0,children:[t.jsx("option",{value:"Легковой",children:"Легковой"}),t.jsx("option",{value:"Грузовой",children:"Грузовой"})]})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium",children:"Одометр начальный, км"}),t.jsx("input",{type:"number",min:"0",id:"fleet-vehicle-odometer-initial",name:"odometerInitial",className:"h-10 w-full rounded border px-3",value:d.odometerInitial,onChange:w=>u(A=>({...A,odometerInitial:w.target.value})),disabled:n,required:!0})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium",children:"Одометр текущий, км"}),t.jsx("input",{type:"number",min:"0",id:"fleet-vehicle-odometer-current",name:"odometerCurrent",className:"h-10 w-full rounded border px-3",value:d.odometerCurrent,onChange:w=>u(A=>({...A,odometerCurrent:w.target.value})),disabled:n,required:!0})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium",children:"Пробег общий, км"}),t.jsx("input",{type:"number",min:"0",id:"fleet-vehicle-mileage-total",name:"mileageTotal",className:"h-10 w-full rounded border px-3",value:d.mileageTotal,onChange:w=>u(A=>({...A,mileageTotal:w.target.value})),disabled:n,required:!0})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium",children:"Вид топлива"}),t.jsxs("select",{id:"fleet-vehicle-fuel-type",name:"fuelType",className:"h-10 w-full rounded border px-3",value:d.fuelType,onChange:w=>u(A=>({...A,fuelType:w.target.value})),disabled:n,children:[t.jsx("option",{value:"Бензин",children:"Бензин"}),t.jsx("option",{value:"Дизель",children:"Дизель"}),t.jsx("option",{value:"Газ",children:"Газ"})]})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium",children:"Топлива заправлено"}),t.jsx("input",{type:"number",min:"0",id:"fleet-vehicle-fuel-refilled",name:"fuelRefilled",className:"h-10 w-full rounded border px-3",value:d.fuelRefilled,onChange:w=>u(A=>({...A,fuelRefilled:w.target.value})),disabled:n,required:!0})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium",children:"Расход средний, л/км"}),t.jsx("input",{type:"number",min:"0",step:"0.01",id:"fleet-vehicle-fuel-average",name:"fuelAverageConsumption",className:"h-10 w-full rounded border px-3",value:d.fuelAverageConsumption,onChange:w=>u(A=>({...A,fuelAverageConsumption:w.target.value})),disabled:n,required:!0})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium",children:"Затрачено топлива всего, л"}),t.jsx("input",{type:"number",min:"0",id:"fleet-vehicle-fuel-spent",name:"fuelSpentTotal",className:"h-10 w-full rounded border px-3",value:d.fuelSpentTotal,onChange:w=>u(A=>({...A,fuelSpentTotal:w.target.value})),disabled:n,required:!0})]})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium",children:"Текущие задачи (ID через запятую или перенос строки)"}),t.jsx("textarea",{id:"fleet-vehicle-current-tasks",name:"currentTasks",className:"min-h-[5rem] w-full rounded border px-3 py-2",value:d.currentTasks,onChange:w=>u(A=>({...A,currentTasks:w.target.value})),disabled:n})]}),b?t.jsx("p",{className:"text-sm text-red-600",children:b}):null,t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx(K,{type:"submit",disabled:n,children:"Сохранить"}),t.jsx(K,{type:"button",variant:"outline",onClick:m,disabled:n,children:"Отмена"}),R&&i?t.jsx(K,{type:"button",variant:"destructive",onClick:()=>k(!0),disabled:n,children:"Удалить"}):null]}),t.jsx(Se,{open:v,message:"Сохранить транспорт?",confirmText:"Сохранить",onConfirm:E,onCancel:()=>y(!1)}),t.jsx(Se,{open:j,message:"Удалить транспорт?",confirmText:"Удалить",status:"danger",onConfirm:T,onCancel:()=>k(!1)})]})}const Va=e=>{if(e==null)return"";if(Array.isArray(e))return e.length?e.join(", "):"";if(typeof e=="object")try{return JSON.stringify(e)}catch(a){return String(e)}return String(e)},Jn=[{accessorKey:"name",header:"Название",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"registrationNumber",header:"Рег. номер",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"odometerInitial",header:"Одометр начальный",meta:{minWidth:"8rem",maxWidth:"14rem"}},{accessorKey:"odometerCurrent",header:"Одометр текущий",meta:{minWidth:"8rem",maxWidth:"14rem"}},{accessorKey:"mileageTotal",header:"Пробег",meta:{minWidth:"6rem",maxWidth:"12rem"}},{accessorKey:"transportType",header:"Тип транспорта",meta:{minWidth:"8rem",maxWidth:"14rem"}},{accessorKey:"fuelType",header:"Тип топлива",meta:{minWidth:"6rem",maxWidth:"12rem"}},{accessorKey:"fuelRefilled",header:"Заправлено",meta:{minWidth:"6rem",maxWidth:"10rem"}},{accessorKey:"fuelAverageConsumption",header:"Расход",meta:{minWidth:"6rem",maxWidth:"10rem"}},{accessorKey:"fuelSpentTotal",header:"Израсходовано",meta:{minWidth:"6rem",maxWidth:"10rem"}},{accessorKey:"currentTasks",header:"Текущие задачи",cell:({getValue:e})=>Va(e()),meta:{minWidth:"10rem",maxWidth:"24rem"}},{accessorKey:"transportHistoryInfo",header:"История задач",cell:({getValue:e})=>Va(e()),meta:{minWidth:"12rem",maxWidth:"28rem"}},{accessorKey:"createdAt",header:"Создан",meta:{minWidth:"10rem",maxWidth:"16rem"}},{accessorKey:"updatedAt",header:"Обновлён",meta:{minWidth:"10rem",maxWidth:"16rem"}},{accessorKey:"unitId",header:"Устройство",meta:{minWidth:"8rem",maxWidth:"12rem"}},{accessorKey:"remoteName",header:"Удалённое имя",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"notes",header:"Примечания",meta:{minWidth:"10rem",maxWidth:"20rem"}}],J="Нет данных",Yn=["inline-flex min-h-[1.65rem] min-w-0 max-w-full items-center justify-start gap-1","rounded-full px-2.5 py-0.5 text-[0.72rem] font-semibold leading-tight text-slate-900","ring-1 ring-slate-300/80 bg-slate-100/95 shadow-xs","dark:text-slate-100 dark:ring-slate-600/60 dark:bg-slate-800/80","truncate"].join(" "),De="".concat(Yn),qe="flex flex-wrap items-center gap-1.5",Ft=10,Qn=new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),Ha=e=>{if(!e)return"";const a=new Date(e);return Number.isNaN(a.getTime())?"":Qn.format(a)},ws=e=>{const a=Ha(e.assignedAt),r=Ha(e.removedAt),n=e.taskTitle&&e.taskTitle.trim().length?e.taskTitle.trim():e.taskId;return a&&r?"".concat(a," — ").concat(n," (до ").concat(r,")"):a?"".concat(a," — ").concat(n):r?"".concat(n," (до ").concat(r,")"):n},Xn=e=>e!=null&&e.length?e.map(ws).join("; "):"",el=[{id:"id",label:"ID",render:e=>e.id},{id:"name",label:"Название",render:e=>e.name},{id:"registrationNumber",label:"Регистрационный номер",render:e=>e.registrationNumber},{id:"odometerInitial",label:"Одометр начальный",render:e=>e.odometerInitial},{id:"odometerCurrent",label:"Одометр текущий",render:e=>e.odometerCurrent},{id:"mileageTotal",label:"Пробег",render:e=>e.mileageTotal},{id:"transportType",label:"Тип транспорта",render:e=>e.transportType},{id:"fuelType",label:"Тип топлива",render:e=>e.fuelType},{id:"fuelRefilled",label:"Заправлено",render:e=>e.fuelRefilled},{id:"fuelAverageConsumption",label:"Расход",render:e=>e.fuelAverageConsumption},{id:"fuelSpentTotal",label:"Израсходовано",render:e=>e.fuelSpentTotal},{id:"currentTasks",label:"Задачи",render:e=>e.currentTasks.length?e.currentTasks.join(", "):"—"},{id:"transportHistory",label:"История задач",render:e=>{var a;return(a=e.transportHistory)!=null&&a.length?t.jsx("ul",{className:"space-y-1 text-sm",children:e.transportHistory.map(r=>t.jsx("li",{className:"leading-snug",children:ws(r)},"".concat(r.taskId,"-").concat(r.assignedAt)))}):"—"}},{id:"createdAt",label:"Создан",render:e=>e.createdAt||"—"},{id:"updatedAt",label:"Обновлён",render:e=>e.updatedAt||"—"},{id:"unitId",label:"Устройство",render:e=>e.unitId!==void 0&&e.unitId!==null?e.unitId:"—"},{id:"remoteName",label:"Удалённое имя",render:e=>e.remoteName||"—"},{id:"notes",label:"Примечания",render:e=>e.notes||"—"}];function tl(){const[e,a]=l.useState([]),[r,n]=l.useState(0),[c,i]=l.useState(1),[m,d]=l.useState(""),[u,b]=l.useState(""),[x,v]=l.useState(!1),[y,j]=l.useState(""),[k,R]=l.useState(!1),[M,p]=l.useState("create"),[E,T]=l.useState(!1),[w,A]=l.useState(null),W=l.useMemo(()=>Math.max(1,Math.ceil(r/Ft)),[r]),z=l.useMemo(()=>e.map(L=>({...L,transportHistoryInfo:Xn(L.transportHistory)})),[e]),H=l.useMemo(()=>"".concat(De," whitespace-nowrap sm:text-sm"),[]),V=l.useMemo(()=>"".concat(qe," justify-start"),[]),X=l.useCallback(async()=>{v(!0),j("");try{const L=await Hn(u,c,Ft);a(L.items),n(L.total)}catch(L){const h=L instanceof Error?L.message:"Не удалось загрузить транспорт";j(h),a([]),n(0)}finally{v(!1)}},[u,c]);l.useEffect(()=>{X()},[X]);const q=()=>{p("create"),A(null),R(!0)},G=L=>{p("update"),A(L),R(!0)},de=()=>{E||(R(!1),A(null))},fe=async(L,h)=>{T(!0);try{M==="create"||!h?(await Bn(L),we("Транспорт создан","success")):(await zn(h,L),we("Транспорт обновлён","success")),await X(),A(null),R(!1)}finally{T(!1)}},ee=async L=>{T(!0);try{await qn(L),we("Транспорт удалён","success"),await X(),A(null),R(!1)}finally{T(!1)}},me=L=>{L.preventDefault(),i(1),b(m.trim())},he=L=>{L<1||L>W||i(L)};return t.jsxs("section",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:flex-wrap sm:items-start sm:gap-3 lg:items-center lg:gap-3",children:[t.jsxs("form",{onSubmit:me,className:"mt-2 flex w-full flex-col gap-2 sm:flex-row sm:flex-wrap sm:items-center sm:gap-2 lg:grid lg:flex-1 lg:grid-cols-[minmax(0,18rem)_auto] lg:items-center lg:gap-3",children:[t.jsxs("label",{className:"flex w-full flex-col gap-1 sm:w-64 lg:w-full lg:min-w-0",children:[t.jsx("span",{className:"text-sm font-medium",children:"Поиск"}),t.jsx("input",{id:"fleet-vehicles-search",name:"fleetVehicleSearch",className:"h-10 w-full rounded border px-3 text-sm lg:h-9 lg:text-xs",value:m,onChange:L=>d(L.target.value),placeholder:"Название или номер"})]}),t.jsx(K,{type:"submit",className:"h-10 w-full max-w-[11rem] px-3 text-sm font-semibold sm:h-10 sm:w-auto sm:px-3 lg:h-8 lg:text-xs",children:"Искать"})]}),t.jsx(K,{type:"button",variant:"success",className:"h-10 w-full max-w-[11rem] px-3 text-sm font-semibold sm:w-auto lg:h-8 lg:text-xs",onClick:q,children:"Добавить"})]}),x?t.jsx("p",{className:"text-sm text-gray-500",children:"Загрузка транспорта…"}):null,y?t.jsx("p",{className:"rounded border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:y}):null,!x&&!y&&!e.length?t.jsx("p",{className:"text-sm text-gray-500",children:"Транспорт не найден."}):null,t.jsx(ut,{columns:Jn,data:z,pageIndex:c-1,pageSize:Ft,pageCount:W,onPageChange:L=>he(L+1),showGlobalSearch:!1,showFilters:!1,onRowClick:L=>G(L),wrapCellsAsBadges:!0,badgeClassName:H,badgeWrapperClassName:V,badgeEmptyPlaceholder:J}),t.jsx(mt,{open:k,onClose:de,children:t.jsxs("div",{className:"space-y-4",children:[w?t.jsxs("article",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4 shadow-sm",children:[t.jsx("h3",{className:"text-base font-semibold",children:"Карточка транспорта"}),t.jsx("dl",{className:"mt-2 grid grid-cols-1 gap-2 text-sm sm:grid-cols-2",children:el.map(({id:L,label:h,render:N})=>t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:h}),t.jsx("dd",{className:"text-slate-900",children:N(w)})]},L))})]}):null,t.jsx(Zn,{open:k,mode:M,vehicle:w,saving:E,onSubmit:fe,onDelete:M==="update"?ee:void 0,onClose:de})]})})]})}const ks="rounded-lg border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900",Ba="space-y-4",al=({item:e,value:a,onChange:r,onSave:n,onReset:c,onDelete:i,saving:m,deleting:d,error:u})=>{var E,T,w,A,W,z;const[b,x]=F.useState(u);F.useEffect(()=>{x(u)},[u]);const v=(T=(E=e.meta)==null?void 0:E.defaultLabel)!=null?T:e.name,y=((w=e.value)==null?void 0:w.trim())||v,j=a.trim(),k=j!==y,R=async()=>{x(void 0);try{await n()}catch(H){const V=H instanceof Error?H.message:String(H);x(V)}},M=()=>{x(void 0),c()},p=async()=>{if(i){x(void 0);try{await i()}catch(H){const V=H instanceof Error?H.message:String(H);x(V)}}};return t.jsx("article",{className:ks,children:t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("div",{className:"flex flex-wrap items-center justify-between gap-2",children:t.jsxs("div",{children:[t.jsxs("h4",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:[v,(A=e.meta)!=null&&A.required?" *":""]}),t.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["Поле: ",t.jsx("span",{className:"font-mono",children:e.name}),(W=e.meta)!=null&&W.fieldType?" • Тип: ".concat(e.meta.fieldType):""]})]})}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Отображаемое название"}),t.jsx(Re,{value:a,onChange:H=>r(H.target.value),placeholder:v,"aria-label":"Название поля ".concat(v)})]}),b?t.jsx("p",{className:"text-sm text-rose-600",role:"alert",children:b}):null,t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx(K,{type:"button",size:"sm",onClick:R,disabled:m||d||!k||!j,children:m?t.jsx(ke,{}):"Сохранить"}),t.jsx(K,{type:"button",size:"sm",variant:"outline",onClick:M,disabled:m||d,children:"Сбросить"}),i&&!((z=e.meta)!=null&&z.virtual)?t.jsx(K,{type:"button",size:"sm",variant:"destructive",onClick:p,disabled:m||d,children:d?t.jsx(ke,{}):"Удалить"}):null]})]})})},sl=({item:e,label:a,url:r,photosUrl:n,onChangeLabel:c,onChangeUrl:i,onChangePhotosUrl:m,onSave:d,onReset:u,onDelete:b,saving:x,deleting:v,error:y})=>{var X,q,G,de,fe,ee,me,he,L,h;const[j,k]=F.useState(y);F.useEffect(()=>{k(y)},[y]);const R=(q=(X=e.meta)==null?void 0:X.defaultLabel)!=null?q:e.name,M=((G=e.value)==null?void 0:G.trim())||R,p=typeof((de=e.meta)==null?void 0:de.tg_theme_url)=="string"?e.meta.tg_theme_url:"",E=typeof((fe=e.meta)==null?void 0:fe.tg_photos_url)=="string"?e.meta.tg_photos_url:"",T=a.trim(),w=r.trim(),A=n.trim(),W=T!==M||w!==(p||"")||A!==(E||""),z=async()=>{k(void 0);try{await d()}catch(N){const S=N instanceof Error?N.message:String(N);k(S)}},H=()=>{k(void 0),u()},V=async()=>{if(b){k(void 0);try{await b()}catch(N){const S=N instanceof Error?N.message:String(N);k(S)}}};return t.jsx("article",{className:ks,children:t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("div",{className:"flex flex-wrap items-center justify-between gap-2",children:t.jsxs("div",{children:[t.jsx("h4",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:R}),t.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["Тип задачи: ",t.jsx("span",{className:"font-mono",children:e.name})]})]})}),t.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Отображаемое название"}),t.jsx(Re,{value:a,onChange:N=>c(N.target.value),placeholder:R,"aria-label":"Название типа ".concat(R)})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Ссылка на тему Telegram"}),t.jsx(Re,{value:r,onChange:N=>i(N.target.value),placeholder:"https://t.me/c/...","aria-label":"Ссылка темы для типа ".concat(R)})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Тема для фото"}),t.jsx(Re,{value:n,onChange:N=>m(N.target.value),placeholder:"https://t.me/c/...","aria-label":"Ссылка темы для фото ".concat(R)})]})]}),(ee=e.meta)!=null&&ee.tg_chat_id?t.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Чат: ",e.meta.tg_chat_id]}):null,(me=e.meta)!=null&&me.tg_topic_id?t.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Тема: ",e.meta.tg_topic_id]}):null,(he=e.meta)!=null&&he.tg_photos_chat_id?t.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Чат фото: ",e.meta.tg_photos_chat_id]}):null,(L=e.meta)!=null&&L.tg_photos_topic_id?t.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Тема фото: ",e.meta.tg_photos_topic_id]}):null,j?t.jsx("p",{className:"text-sm text-rose-600",role:"alert",children:j}):null,t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx(K,{type:"button",size:"sm",onClick:z,disabled:x||v||!T||!W,children:x?t.jsx(ke,{}):"Сохранить"}),t.jsx(K,{type:"button",size:"sm",variant:"outline",onClick:H,disabled:x||v,children:"Сбросить"}),b&&!((h=e.meta)!=null&&h.virtual)?t.jsx(K,{type:"button",size:"sm",variant:"destructive",onClick:V,disabled:x||v,children:v?t.jsx(ke,{}):"Удалить"}):null]})]})})},za=e=>[...e].sort((a,r)=>{var i,m;const n=typeof((i=a.meta)==null?void 0:i.order)=="number"?a.meta.order:0,c=typeof((m=r.meta)==null?void 0:m.order)=="number"?r.meta.order:0;return n-c}),qa=(e,a)=>{const[r,n]=F.useState({});return F.useEffect(()=>{n(c=>{let i=!1;const m={...c},d=new Set(e.map(u=>u.name));return e.forEach(u=>{const b=u.name;b in c||(m[b]=a(u),i=!0)}),Object.keys(c).forEach(u=>{d.has(u)||(delete m[u],i=!0)}),i?m:c})},[e,a]),[r,n]},rl=({fields:e,types:a,loading:r,onSaveField:n,onDeleteField:c,onSaveType:i,onDeleteType:m})=>{const d=F.useCallback(h=>{var N,S;return((N=h.value)==null?void 0:N.trim())||((S=h.meta)==null?void 0:S.defaultLabel)||h.name},[]),u=F.useCallback(h=>{var N,S,D,Z;return{label:((N=h.value)==null?void 0:N.trim())||((S=h.meta)==null?void 0:S.defaultLabel)||h.name,url:typeof((D=h.meta)==null?void 0:D.tg_theme_url)=="string"?h.meta.tg_theme_url:"",photosUrl:typeof((Z=h.meta)==null?void 0:Z.tg_photos_url)=="string"?h.meta.tg_photos_url:""}},[]),[b,x]=qa(e,d),[v,y]=qa(a,u),[j,k]=F.useState(null),[R,M]=F.useState(null),[p,E]=F.useState(null),[T,w]=F.useState(null),[A,W]=F.useState({}),[z,H]=F.useState({}),V=F.useMemo(()=>za(e),[e]),X=F.useMemo(()=>za(a),[a]),q=(h,N)=>{x(S=>({...S,[h]:N})),W(S=>({...S,[h]:""}))},G=(h,N)=>{y(S=>{var D,Z,le,xe,P,te;return{...S,[h]:{label:(Z=(D=S[h])==null?void 0:D.label)!=null?Z:"",url:(xe=(le=S[h])==null?void 0:le.url)!=null?xe:"",photosUrl:(te=(P=S[h])==null?void 0:P.photosUrl)!=null?te:"",...N}}}),H(S=>({...S,[h]:""}))},de=async h=>{var S;const N=(S=b[h.name])!=null?S:"";k(h.name),W(D=>({...D,[h.name]:""}));try{await n(h,N),x(D=>({...D,[h.name]:N}))}catch(D){const Z=D instanceof Error?D.message:String(D);throw W(le=>({...le,[h.name]:Z})),D}finally{k(D=>D===h.name?null:D)}},fe=async h=>{var N;if(!((N=h.meta)!=null&&N.virtual)){E(h.name),W(S=>({...S,[h.name]:""}));try{await c(h)}catch(S){const D=S instanceof Error?S.message:String(S);throw W(Z=>({...Z,[h.name]:D})),S}finally{E(S=>S===h.name?null:S)}}},ee=h=>{x(N=>({...N,[h.name]:d(h)})),W(N=>({...N,[h.name]:""}))},me=async h=>{var S;const N=(S=v[h.name])!=null?S:{label:"",url:"",photosUrl:""};M(h.name),H(D=>({...D,[h.name]:""}));try{await i(h,{label:N.label,tg_theme_url:N.url,tg_photos_url:N.photosUrl}),y(D=>({...D,[h.name]:{label:N.label,url:N.url,photosUrl:N.photosUrl}}))}catch(D){const Z=D instanceof Error?D.message:String(D);throw H(le=>({...le,[h.name]:Z})),D}finally{M(D=>D===h.name?null:D)}},he=async h=>{var N;if(!((N=h.meta)!=null&&N.virtual)){w(h.name),H(S=>({...S,[h.name]:""}));try{await m(h)}catch(S){const D=S instanceof Error?S.message:String(S);throw H(Z=>({...Z,[h.name]:D})),S}finally{w(S=>S===h.name?null:S)}}},L=h=>{y(N=>({...N,[h.name]:u(h)})),H(N=>({...N,[h.name]:""}))};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("section",{className:Ba,children:[t.jsxs("header",{className:"space-y-1",children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Поля задачи"}),t.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Настройте названия полей, которые видят пользователи в карточке задачи."})]}),r&&!V.length?t.jsx("div",{className:"flex items-center justify-center py-6",children:t.jsx(ke,{})}):t.jsx("div",{className:"grid gap-4 lg:grid-cols-2",children:V.map(h=>{var N,S;return t.jsx(al,{item:h,value:(N=b[h.name])!=null?N:"",onChange:D=>q(h.name,D),onSave:()=>de(h),onReset:()=>ee(h),onDelete:(S=h.meta)!=null&&S.virtual?void 0:()=>fe(h),saving:j===h.name,deleting:p===h.name,error:A[h.name]},h._id)})})]}),t.jsxs("section",{className:Ba,children:[t.jsxs("header",{className:"space-y-1",children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Типы задач и темы Telegram"}),t.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Для каждого типа задачи можно задать отображаемое название, основную тему чата Telegram и отдельную тему для альбома фото."})]}),r&&!X.length?t.jsx("div",{className:"flex items-center justify-center py-6",children:t.jsx(ke,{})}):t.jsx("div",{className:"grid gap-4 lg:grid-cols-2",children:X.map(h=>{var N,S,D,Z,le,xe,P;return t.jsx(sl,{item:h,label:(S=(N=v[h.name])==null?void 0:N.label)!=null?S:"",url:(Z=(D=v[h.name])==null?void 0:D.url)!=null?Z:"",photosUrl:(xe=(le=v[h.name])==null?void 0:le.photosUrl)!=null?xe:"",onChangeLabel:te=>G(h.name,{label:te}),onChangeUrl:te=>G(h.name,{url:te}),onChangePhotosUrl:te=>G(h.name,{photosUrl:te}),onSave:()=>me(h),onReset:()=>L(h),onDelete:(P=h.meta)!=null&&P.virtual?void 0:()=>he(h),saving:R===h.name,deleting:T===h.name,error:z[h.name]},h._id)})})]})]})};async function nl(e={}){const a=new URLSearchParams;e.from&&a.set("from",e.from),e.to&&a.set("to",e.to),e.status&&a.set("status",e.status);const r=a.toString(),n=await We("/api/v1/analytics/route-plans/summary".concat(r?"?".concat(r):""));if(!n.ok)throw new Error("Не удалось получить аналитику маршрутных планов");return await n.json()}const Lt=F.lazy(()=>xr(()=>import("./react-apexcharts.min-Dqny7S9j.js").then(e=>e.r),__vite__mapDeps([0,1,2]))),ll=1440*60*1e3,Ss=e=>new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString().slice(0,10),Ga=Ss(new Date),Za=Ss(new Date(Date.now()-ll*29)),ol=[{value:"all",label:"Все статусы"},{value:"draft",label:"Черновики"},{value:"approved",label:"Утверждённые"},{value:"completed",label:"Завершённые"}],Ut=new Intl.NumberFormat("ru-RU",{style:"percent",minimumFractionDigits:0,maximumFractionDigits:1}),Pt=new Intl.NumberFormat("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:1}),Kt=new Intl.NumberFormat("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:2}),il=e=>{const a={};return e.from&&(a.from=e.from),e.to&&(a.to=e.to),e.status!=="all"&&(a.status=e.status),a},cl=e=>{var a;return(a=e==null?void 0:e.mileage.byPeriod.map(r=>({x:r.date,y:typeof r.value=="number"?r.value:0})))!=null?a:[]},dl=e=>{var a;return(a=e==null?void 0:e.load.byPeriod.map(r=>({x:r.date,y:typeof r.value=="number"?r.value:null})))!=null?a:[]},ml=e=>{var a;return(a=e==null?void 0:e.sla.byPeriod.map(r=>({x:r.date,y:typeof r.rate=="number"?Number((r.rate*100).toFixed(2)):null})))!=null?a:[]};function ul(){var R,M,p;const{t:e}=cs(),[a,r]=F.useState({from:Za,to:Ga,status:"completed"}),[n,c]=F.useState(!1),[i,m]=F.useState(null),[d,u]=F.useState(null),b=F.useCallback(async E=>{c(!0),m(null);try{const T=await nl(il(E));u(T)}catch(T){console.error("Не удалось загрузить аналитику маршрутных планов",T),m(e("analytics.loadError"))}finally{c(!1)}},[e]);F.useEffect(()=>{b(a)},[a,b]);const x=E=>{E.preventDefault();const T=new FormData(E.currentTarget),w={from:String(T.get("from")||""),to:String(T.get("to")||""),status:T.get("status")||"all"};r(w)},v=()=>{r({from:Za,to:Ga,status:"completed"})},y=F.useMemo(()=>cl(d),[d]),j=F.useMemo(()=>dl(d),[d]),k=F.useMemo(()=>ml(d),[d]);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("h1",{className:"text-2xl font-semibold",children:e("analytics.title")}),t.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:e("analytics.description")})]}),t.jsxs("form",{onSubmit:x,className:"flex flex-wrap items-end gap-3 rounded-lg bg-white p-4 shadow-sm dark:bg-slate-900",children:[t.jsxs("label",{className:"flex flex-col text-sm text-slate-700 dark:text-slate-200",children:[e("analytics.filters.from"),t.jsx(Re,{type:"date",name:"from",defaultValue:a.from})]}),t.jsxs("label",{className:"flex flex-col text-sm text-slate-700 dark:text-slate-200",children:[e("analytics.filters.to"),t.jsx(Re,{type:"date",name:"to",defaultValue:a.to})]}),t.jsxs("label",{className:"flex flex-col text-sm text-slate-700 dark:text-slate-200",children:[e("analytics.filters.status"),t.jsx("select",{name:"status",defaultValue:a.status,className:"mt-1 w-48 rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/60 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100",children:ol.map(E=>t.jsx("option",{value:E.value,children:e("analytics.status.".concat(E.value))},E.value))})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx(K,{type:"submit",disabled:n,children:e(n?"analytics.loading":"analytics.apply")}),t.jsx(K,{type:"button",variant:"outline",onClick:v,children:e("analytics.reset")})]})]}),i?t.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-600 dark:border-red-800 dark:bg-red-900/30 dark:text-red-200",children:i}):null,t.jsxs("section",{className:"grid gap-4 md:grid-cols-3",children:[t.jsxs("article",{className:"rounded-lg bg-white p-4 shadow-sm dark:bg-slate-900",children:[t.jsx("h2",{className:"text-sm font-medium text-slate-500 dark:text-slate-300",children:e("analytics.cards.mileage")}),t.jsxs("p",{className:"mt-2 text-2xl font-semibold",children:[Pt.format((R=d==null?void 0:d.mileage.total)!=null?R:0)," км"]}),t.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:e("analytics.cards.period",{from:(M=d==null?void 0:d.period.from)!=null?M:a.from,to:(p=d==null?void 0:d.period.to)!=null?p:a.to})})]}),t.jsxs("article",{className:"rounded-lg bg-white p-4 shadow-sm dark:bg-slate-900",children:[t.jsx("h2",{className:"text-sm font-medium text-slate-500 dark:text-slate-300",children:e("analytics.cards.load")}),t.jsx("p",{className:"mt-2 text-2xl font-semibold",children:typeof(d==null?void 0:d.load.average)=="number"?"".concat(Kt.format(d.load.average)," кг"):e("analytics.noData")}),t.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:e("analytics.cards.loadHint")})]}),t.jsxs("article",{className:"rounded-lg bg-white p-4 shadow-sm dark:bg-slate-900",children:[t.jsx("h2",{className:"text-sm font-medium text-slate-500 dark:text-slate-300",children:"SLA"}),t.jsx("p",{className:"mt-2 text-2xl font-semibold",children:typeof(d==null?void 0:d.sla.average)=="number"?Ut.format(d.sla.average):e("analytics.noData")}),t.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:e("analytics.cards.slaHint")})]})]}),t.jsxs("section",{className:"grid gap-4 lg:grid-cols-3",children:[t.jsxs("div",{className:"space-y-2 rounded-lg bg-white p-4 shadow-sm dark:bg-slate-900 lg:col-span-3",children:[t.jsx("h3",{className:"text-base font-semibold text-slate-700 dark:text-slate-200",children:e("analytics.charts.mileage")}),t.jsx(F.Suspense,{fallback:t.jsx("div",{children:e("analytics.loading")}),children:t.jsx(Lt,{type:"area",height:280,series:[{name:e("analytics.cards.mileage"),data:y}],options:{chart:{id:"analytics-mileage",animations:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},xaxis:{type:"category"},yaxis:{labels:{formatter:E=>Pt.format(E)}},tooltip:{y:{formatter:E=>"".concat(Pt.format(E)," км")}}}})})]}),t.jsxs("div",{className:"space-y-2 rounded-lg bg-white p-4 shadow-sm dark:bg-slate-900",children:[t.jsx("h3",{className:"text-base font-semibold text-slate-700 dark:text-slate-200",children:e("analytics.charts.load")}),t.jsx(F.Suspense,{fallback:t.jsx("div",{children:e("analytics.loading")}),children:t.jsx(Lt,{type:"bar",height:280,series:[{name:e("analytics.cards.load"),data:j}],options:{chart:{id:"analytics-load",animations:{enabled:!1}},dataLabels:{enabled:!1},xaxis:{type:"category"},yaxis:{labels:{formatter:E=>"".concat(Kt.format(E)," кг")}},tooltip:{y:{formatter:E=>"".concat(Kt.format(E)," кг")}}}})})]}),t.jsxs("div",{className:"space-y-2 rounded-lg bg-white p-4 shadow-sm dark:bg-slate-900",children:[t.jsx("h3",{className:"text-base font-semibold text-slate-700 dark:text-slate-200",children:e("analytics.charts.sla")}),t.jsx(F.Suspense,{fallback:t.jsx("div",{children:e("analytics.loading")}),children:t.jsx(Lt,{type:"line",height:280,series:[{name:"SLA",data:k}],options:{chart:{id:"analytics-sla",animations:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"straight",width:2},markers:{size:4},xaxis:{type:"category"},yaxis:{min:0,max:100,tickAmount:5,labels:{formatter:E=>Ut.format(E/100)}},tooltip:{y:{formatter:E=>Ut.format(E/100)}}}})})]})]})]})}const fl=e=>{if(!e||typeof e!="object")return!1;const a=e;return typeof a.name=="string"&&(a.status==="ok"||a.status==="warn"||a.status==="error")};async function hl(){const e=await We("/api/v1/system/health/run",{method:"POST"});if(!e.ok){const m=await e.text();throw new Error("Healthcheck недоступен: ".concat(e.status," ").concat(m))}const a=await e.json();if(!a||typeof a!="object")throw new Error("Неверный ответ healthcheck");const{ok:r,timestamp:n,results:c}=a;if(typeof r!="boolean"||typeof n!="string"||!Array.isArray(c))throw new Error("Неполный ответ healthcheck");const i=c.filter(fl);return{ok:r,timestamp:n,results:i}}const xl={ok:"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-200 dark:ring-emerald-700",warn:"bg-amber-50 text-amber-700 ring-1 ring-amber-200 dark:bg-amber-900/30 dark:text-amber-200 dark:ring-amber-700",error:"bg-rose-50 text-rose-700 ring-1 ring-rose-200 dark:bg-rose-900/30 dark:text-rose-200 dark:ring-rose-700"},pl={ok:"OK",warn:"Предупреждение",error:"Ошибка"},gl=6e4,bl=e=>{if(!e)return"ещё не запускалось";const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleString("ru-RU")},Ja=e=>{if(!e)return null;const a=e.hint;return typeof a=="string"?a:null};function vl(){const[e,a]=l.useState([]),[r,n]=l.useState(null),[c,i]=l.useState(!1),[m,d]=l.useState(!1),[u,b]=l.useState(null),x=l.useRef(null),v=l.useMemo(()=>[...e].sort((j,k)=>j.name.localeCompare(k.name,"ru-RU")),[e]),y=l.useCallback(async()=>{d(!0),b(null);try{const j=await hl();a(j.results),n(j.timestamp)}catch(j){const k=j instanceof Error?j.message:"Неизвестная ошибка";b(k)}finally{d(!1)}},[]);return l.useEffect(()=>(c&&(y(),x.current=window.setInterval(()=>{y()},gl)),()=>{x.current&&(clearInterval(x.current),x.current=null)}),[c,y]),t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsxs(K,{type:"button",variant:"success",size:"sm",className:"gap-2",disabled:m,onClick:()=>void y(),children:[m?t.jsx(Kr,{className:"h-4 w-4 animate-spin"}):t.jsx(Wa,{className:"h-4 w-4"}),"Запустить проверку"]}),t.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200",children:[t.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500 dark:border-slate-600",checked:c,onChange:j=>i(j.target.checked)}),t.jsxs("span",{className:"flex items-center gap-1",children:[c?t.jsx(cn,{className:"h-4 w-4"}):t.jsx(Wa,{className:"h-4 w-4"}),"Автоопрос раз в 60 секунд"]})]}),t.jsxs("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:["Последний запуск: ",bl(r)]})]}),u?t.jsx("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700 dark:border-rose-700 dark:bg-rose-900/40 dark:text-rose-100",children:u}):null,t.jsxs("div",{className:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-900",children:[t.jsxs("div",{className:"grid grid-cols-[1fr_auto_auto_2fr] items-center gap-2 bg-slate-50 px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-600 dark:bg-slate-800 dark:text-slate-300",children:[t.jsx("span",{children:"Компонент"}),t.jsx("span",{children:"Статус"}),t.jsx("span",{children:"Время"}),t.jsx("span",{children:"Детали"})]}),v.length===0?t.jsx("div",{className:"px-4 py-5 text-sm text-slate-600 dark:text-slate-300",children:"Результатов пока нет"}):t.jsx("ul",{className:"divide-y divide-slate-200 dark:divide-slate-800",children:v.map(j=>t.jsxs("li",{className:"grid grid-cols-[1fr_auto_auto_2fr] items-start gap-2 px-4 py-3 text-sm text-slate-800 dark:text-slate-100",children:[t.jsx("div",{className:"font-semibold capitalize",children:j.name}),t.jsx("div",{children:t.jsx("span",{className:"inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-semibold ".concat(xl[j.status]),children:pl[j.status]})}),t.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-300",children:typeof j.durationMs=="number"?"".concat(j.durationMs," мс"):"—"}),t.jsxs("div",{className:"space-y-2 text-xs text-slate-700 dark:text-slate-200",children:[j.message?t.jsx("div",{className:"font-medium text-rose-600 dark:text-rose-200",children:j.message}):null,Ja(j.meta)?t.jsxs("div",{className:"rounded-xl border border-amber-200 bg-amber-50 px-3 py-2 font-medium text-amber-800 dark:border-amber-600 dark:bg-amber-900/40 dark:text-amber-100",children:["Что делать: ",Ja(j.meta)]}):null,j.meta?t.jsx("pre",{className:"overflow-x-auto whitespace-pre-wrap rounded-xl bg-slate-50 p-3 text-[13px] leading-5 text-slate-800 ring-1 ring-slate-200 dark:bg-slate-800 dark:text-slate-100 dark:ring-slate-700",children:JSON.stringify(j.meta,null,2)}):null]})]},j.name))})]})]})}const yl=[{accessorKey:"name",header:"Название",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"value",header:"Значение",meta:{minWidth:"8rem",maxWidth:"20rem"}},{accessorKey:"displayValue",header:"Связанные данные",meta:{minWidth:"10rem",maxWidth:"24rem"}},{accessorKey:"type",header:"Тип",meta:{minWidth:"6rem",maxWidth:"12rem"}},{accessorKey:"_id",header:"Идентификатор",meta:{minWidth:"10rem",maxWidth:"16rem"}},{accessorKey:"metaSummary",header:"Доп. сведения",meta:{minWidth:"10rem",maxWidth:"24rem"}}],jl=[{accessorKey:"name",header:"Название",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"address",header:"Адрес",meta:{minWidth:"10rem",maxWidth:"20rem"}},{accessorKey:"coordinates",header:"Координаты",meta:{minWidth:"8rem",maxWidth:"14rem"}},{accessorKey:"_id",header:"Идентификатор",meta:{minWidth:"10rem",maxWidth:"16rem"}}],Nl=[{accessorKey:"telegram_id",header:"Telegram ID",meta:{minWidth:"8rem"}},{accessorKey:"username",header:"Логин",cell:({row:e})=>{var a,r;return(r=(a=e.original.telegram_username)!=null?a:e.original.username)!=null?r:""},meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"name",header:"Имя",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"phone",header:"Телефон",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"mobNumber",header:"Моб. номер",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"email",header:"E-mail",meta:{minWidth:"10rem",maxWidth:"20rem"}},{accessorKey:"role",header:"Роль",cell:({getValue:e})=>ye(e()),meta:{minWidth:"6rem",maxWidth:"12rem"}},{accessorKey:"access",header:"Доступ",cell:({getValue:e})=>{var a;return String((a=e())!=null?a:"")},meta:{minWidth:"6rem",maxWidth:"10rem"}},{accessorKey:"roleId",header:"Роль ID",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"departmentId",header:"Департамент",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"divisionId",header:"Отдел",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"positionId",header:"Должность",meta:{minWidth:"8rem",maxWidth:"16rem"}}],wl=e=>e==null?"":String(e),kl=[{accessorKey:"telegram_id",header:"Telegram ID",meta:{minWidth:"8rem"}},{accessorKey:"username",header:"Логин",cell:({row:e})=>{var a,r;return(r=(a=e.original.telegram_username)!=null?a:e.original.username)!=null?r:""},meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"name",header:"Имя",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"phone",header:"Телефон",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"mobNumber",header:"Моб. номер",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"email",header:"E-mail",meta:{minWidth:"10rem",maxWidth:"20rem"}},{accessorKey:"role",header:"Роль",cell:({getValue:e})=>ye(e()),meta:{minWidth:"6rem",maxWidth:"12rem"}},{accessorKey:"access",header:"Доступ",cell:({getValue:e})=>wl(e()),meta:{minWidth:"6rem",maxWidth:"10rem"}},{accessorKey:"roleId",header:"Роль ID",cell:({row:e})=>ye(e.original.roleName),meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"departmentId",header:"Департамент",cell:({row:e})=>e.original.departmentName||"—",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"divisionId",header:"Отдел",cell:({row:e})=>e.original.divisionName||"—",meta:{minWidth:"8rem",maxWidth:"16rem"}},{accessorKey:"positionId",header:"Должность",cell:({row:e})=>e.original.positionName||"—",meta:{minWidth:"8rem",maxWidth:"16rem"}}],He=e=>{if(typeof e!="string")return;const a=e.trim();return a.length?a:void 0},Sl=e=>typeof e=="number"&&Number.isFinite(e)?e:void 0,Cl=e=>{if(Array.isArray(e))return e.filter(a=>typeof a=="string").map(a=>a.trim()).filter(a=>a.length>0)},El=e=>{var i,m,d,u;const a={roleName:(i=He(e.roleName))!=null?i:"",departmentName:(m=He(e.departmentName))!=null?m:"",divisionName:(d=He(e.divisionName))!=null?d:"",positionName:(u=He(e.positionName))!=null?u:""},r=(b,x)=>{const v=He(x);v!==void 0&&(a[b]=v)},n=(b,x)=>{const v=Sl(x);v!==void 0&&(a[b]=v)};r("id",e.id),n("telegram_id",e.telegram_id),r("telegram_username",e.telegram_username),r("username",e.username),r("name",e.name),r("phone",e.phone),r("mobNumber",e.mobNumber),r("email",e.email),r("role",e.role),n("access",e.access);const c=Cl(e.permissions);return c!==void 0&&(a.permissions=c),r("roleId",e.roleId),r("roleName",a.roleName),r("departmentId",e.departmentId),r("departmentName",a.departmentName),r("divisionId",e.divisionId),r("divisionName",a.divisionName),r("positionId",e.positionId),r("positionName",a.positionName),a};function Il({form:e,onChange:a,onSubmit:r,onReset:n}){var M;const[c,i]=F.useState(!1),[m,d]=F.useState([]),[u,b]=F.useState([]),[x,v]=F.useState([]),[y,j]=F.useState([]);F.useEffect(()=>{ft("departments","",1,100).then(p=>d(p.items)).catch(()=>d([])),ft("divisions","",1,100).then(p=>b(p.items)).catch(()=>b([])),ft("positions","",1,100).then(p=>v(p.items)).catch(()=>v([])),ms().then(p=>j(p))},[]);const k=p=>{var T;const E=y.find(w=>w.name===p);a({...e,role:p,roleId:E==null?void 0:E._id,access:(T=E==null?void 0:E.access)!=null?T:1})},R=p=>{p.preventDefault(),i(!0)};return t.jsxs("form",{onSubmit:R,className:"space-y-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"ID"}),t.jsx("input",{id:"settings-user-telegram-id",name:"telegramId",className:"h-10 w-full rounded border px-3",value:(M=e.telegram_id)!=null?M:"",onChange:p=>a({...e,telegram_id:p.target.value?Number(p.target.value):void 0}),readOnly:!!e.telegram_id,required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Username"}),t.jsx("input",{id:"settings-user-username",name:"username",className:"h-10 w-full rounded border px-3",value:e.username||"",onChange:p=>a({...e,username:p.target.value}),readOnly:!!e.telegram_id})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Имя"}),t.jsx("input",{id:"settings-user-name",name:"name",className:"h-10 w-full rounded border px-3",value:e.name||"",onChange:p=>a({...e,name:p.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Телефон"}),t.jsx("input",{id:"settings-user-phone",name:"phone",className:"h-10 w-full rounded border px-3",value:e.phone||"",onChange:p=>a({...e,phone:p.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Доп. телефон"}),t.jsx("input",{id:"settings-user-mob",name:"mobNumber",className:"h-10 w-full rounded border px-3",value:e.mobNumber||"",onChange:p=>a({...e,mobNumber:p.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Email"}),t.jsx("input",{id:"settings-user-email",name:"email",className:"h-10 w-full rounded border px-3",value:e.email||"",onChange:p=>a({...e,email:p.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Роль"}),t.jsx("select",{className:"h-10 w-full rounded border px-3",value:e.role||"user",onChange:p=>k(p.target.value),children:Wr.map(p=>t.jsx("option",{value:p.value,children:p.label},p.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Департамент"}),t.jsxs("select",{className:"h-10 w-full rounded border px-3",value:e.departmentId||"",onChange:p=>a({...e,departmentId:p.target.value}),children:[t.jsx("option",{value:""}),m.map(p=>t.jsx("option",{value:p._id,children:p.name},p._id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Отдел"}),t.jsxs("select",{className:"h-10 w-full rounded border px-3",value:e.divisionId||"",onChange:p=>a({...e,divisionId:p.target.value}),children:[t.jsx("option",{value:""}),u.map(p=>t.jsx("option",{value:p._id,children:p.name},p._id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Должность"}),t.jsxs("select",{className:"h-10 w-full rounded border px-3",value:e.positionId||"",onChange:p=>a({...e,positionId:p.target.value}),children:[t.jsx("option",{value:""}),x.map(p=>t.jsx("option",{value:p._id,children:p.name},p._id))]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(K,{type:"submit",children:"Сохранить"}),t.jsx(K,{type:"button",variant:"outline",onClick:n,children:"Очистить"})]}),t.jsx(Se,{open:c,message:"Сохранить изменения?",onConfirm:()=>{i(!1),r()},onCancel:()=>i(!1),confirmText:"Сохранить"})]})}const qt=[{key:"directories",label:"Справочники",description:"Структура компании и доступы",icon:zr},{key:"reports",label:"Отчёты",description:"Аналитика процессов и KPI",icon:Tr},{key:"archive",label:"Архив",description:"История задач и записей",icon:Gr},{key:"logs",label:"Логи",description:"Журнал действий и событий",icon:Ur},{key:"storage",label:"Файлы",description:"Управление вложениями",icon:un},{key:"health",label:"Мониторинг",description:"Проверка прокси, Redis и MongoDB",icon:hn}],Ya=e=>qt.some(a=>a.key===e),ht=[{key:"departments",label:"Департамент",description:"Структура компании и направления"},{key:"divisions",label:"Отдел",description:"Команды внутри департаментов"},{key:"positions",label:"Должность",description:"Роли и рабочие позиции"},{key:"objects",label:"Объект",description:"Адреса и координаты площадок"},{key:"employees",label:"Сотрудник",description:"Карточки и доступы сотрудников"},{key:"fleets",label:"Автопарк",description:"Транспорт и связанный состав"},{key:"users",label:"Пользователь",description:"Учётные записи в системе"},{key:"tasks",label:"Задачи",description:"Поля формы и темы публикаций"}],Qa=()=>ht.reduce((e,a)=>(e[a.key]="",e),{}),Ae={telegram_id:void 0,username:"",name:"",phone:"",mobNumber:"",email:"",role:"user",access:1,roleId:"",departmentId:"",divisionId:"",positionId:""},Be={name:"",value:"",meta:void 0,address:"",latitude:"",longitude:""},_l={departments:Jr,divisions:pn,positions:an,objects:ln,employees:yn,fleets:bn,users:rn,tasks:Dr},$t=e=>e.length?t.jsx("div",{className:qe,children:e.map((a,r)=>t.jsx("span",{className:De,title:a,children:a},"".concat(a,"-").concat(r)))}):t.jsx("span",{className:De,title:J,children:J}),Tl=e=>{const a=e.trim();return a?a.replace(/^['"]+|['"]+$/g,"").replace(/^\[+|\]+$/g,"").replace(/^[{}]+|[{}]+$/g,"").replace(/,+$/g,"").trim():""},xt=e=>{if(typeof e=="string")return[e];if(Array.isArray(e))return e.flatMap(xt);if(e&&typeof e=="object"){const a=[];return Object.entries(e).forEach(([r,n])=>{if(Array.isArray(n)||n&&typeof n=="object"){a.push(...xt(n));return}if(typeof n=="string"){const c=n.trim();if(!c)return;(r.toLowerCase().includes("id")||!/\s/.test(c))&&a.push(c);return}(typeof n=="boolean"||typeof n=="number")&&n&&a.push(r)}),a}return[]},Al={telegram_id:"Telegram ID",telegram_username:"Логин Telegram",username:"Логин",name:"Имя",phone:"Телефон",mobNumber:"Моб. номер",email:"E-mail",role:"Роль",access:"Доступ",roleId:"Роль ID",departmentId:"Департамент",departmentName:"Департамент",divisionId:"Отдел",divisionName:"Отдел",positionId:"Должность",positionName:"Должность",permissions:"Права",fleetId:"Автопарк",source:"Источник",sourceId:"ID источника",readonly:"Только чтение",readonlyReason:"Причина ограничения",invalid:"Некорректен",invalidReason:"Причина ошибки",invalidCode:"Код ошибки",invalidAt:"Ошибка от",syncPending:"Ожидает синхронизации",syncWarning:"Предупреждение",syncError:"Ошибка синхронизации",syncFailedAt:"Сбой синхронизации",defaultLabel:"Название по умолчанию",fieldType:"Тип поля",required:"Обязательное",order:"Порядок",virtual:"Системный элемент",tg_theme_url:"Тема Telegram",tg_chat_id:"ID чата",tg_topic_id:"ID темы",tg_photos_url:"Тема для фото",tg_photos_chat_id:"ID чата фото",tg_photos_topic_id:"ID темы фото"},Cs=e=>{const a=Al[e];if(a)return a;const r=e.replace(/[_-]+/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").trim();return r?r.charAt(0).toUpperCase()+r.slice(1):e},pt=e=>e==null?"":typeof e=="boolean"?e?"Да":"Нет":typeof e=="number"?Number.isFinite(e)?String(e):"":typeof e=="string"?e.trim():Array.isArray(e)?e.map(r=>pt(r)).filter(Boolean).join(", "):e instanceof Date?e.toISOString():typeof e=="object"?Object.entries(e).map(([r,n])=>{const c=pt(n);return c?"".concat(Cs(r),"=").concat(c):""}).filter(Boolean).join("; "):"",Es=e=>e?Object.entries(e).map(([r,n])=>{const c=pt(n);return c?"".concat(Cs(r),": ").concat(c):""}).filter(Boolean).join("\n"):"",Rl=e=>{try{return JSON.parse(e)}catch(a){return}},Vt=e=>{const a=e.trim();if(!a)return"";const r=a.startsWith("{")||a.startsWith("[")?Rl(a):void 0;if(Array.isArray(r)){const n=r.map(c=>pt(c)).filter(Boolean);if(n.length)return n.join("\n")}else if(r&&typeof r=="object"){const n=Es(r);if(n)return n}if(a.includes(",")){const n=a.split(",").map(c=>c.trim()).filter(Boolean);if(n.length>1)return n.join("\n")}return a},Dl=br(e=>{if(e==null)return[];if(typeof e=="string"){const a=e.trim();if(!a)return[];if(a.startsWith("{")||a.startsWith("["))try{const r=JSON.parse(a);return xt(r)}catch(r){}return a.split(",").map(r=>r.trim()).filter(Boolean)}return Array.isArray(e)||e&&typeof e=="object"?xt(e):[String(e)]},vr(yr())).transform(e=>{const a=e.map(r=>Tl(String(r))).filter(r=>r.length>0);return Array.from(new Set(a))}),ze=e=>{const a=Dl.safeParse(e);return a.success?a.data:[]},Ht=(e,a)=>{if(!a.length)return e;const r=e.slice(),n=new Map;r.forEach((i,m)=>{n.set(i._id,m)});let c=!1;return a.forEach(i=>{const m=n.get(i._id);if(typeof m=="number"){r[m]!==i&&(r[m]=i,c=!0);return}n.set(i._id,r.length),r.push(i),c=!0}),c?r:e},ct=(e,a,r)=>{var i;const n=typeof r=="string"&&r.trim().length?r.trim():"";if(n)return n;if(typeof a!="string")return"";const c=a.trim();return c?(i=e.get(c))!=null?i:c:""},Yt=(e,a)=>{for(const n of a)if(n in e)return e[n];const r={};Object.entries(e).forEach(([n,c])=>{r[n.toLowerCase()]=c});for(const n of a){const c=n.toLowerCase();if(c in r)return r[c]}},Q=(e,a,r)=>{const n=Yt(e,a);if(typeof n=="string"){const c=n.trim();if(c.length)return c}if(typeof n=="number"&&Number.isFinite(n))return String(n);if(typeof r=="string"){const c=r.trim();if(c.length)return c}},Xa=(e,a)=>{const r=Yt(e,a);if(typeof r=="number"&&Number.isFinite(r))return r;if(typeof r=="string"){const n=r.trim();if(!n)return;const c=Number(n);if(Number.isFinite(c))return c}},Ml=(e,a)=>{const r=Yt(e,a);if(!Array.isArray(r))return;const n=r.filter(c=>typeof c=="string").map(c=>c.trim()).filter(c=>c.length>0);return n.length?n:void 0},Wl=e=>{var X;if(e.type!=="employees")return;const a=[];e.meta&&typeof e.meta=="object"&&a.push(e.meta);const r=e.value;if(typeof r=="string"){const q=r.trim();if(q)try{const G=JSON.parse(q);G&&typeof G=="object"&&!Array.isArray(G)&&a.push(G)}catch(G){}}else r&&typeof r=="object"&&!Array.isArray(r)&&a.push(r);if(!a.length){const q=(X=e.name)==null?void 0:X.trim();return q?{name:q}:void 0}const n=a.reduce((q,G)=>({...q,...G}),{}),c={},i=Xa(n,["telegram_id","telegramId","id"]);typeof i=="number"&&(c.telegram_id=i);const m=Q(n,["telegram_username","telegramUsername","telegram_login","telegramLogin"]);m&&(c.telegram_username=m);const d=Q(n,["username","login"]);d&&(c.username=d);const u=Q(n,["name","fullName"],e.name),b=Q(n,["firstName","first_name"]),x=Q(n,["lastName","last_name","surname","familyName"]),v=Q(n,["middleName","middle_name","patronymic"]);if(u)c.name=u;else{const q=[x,b,v].filter(G=>typeof G=="string"&&G.trim().length>0);q.length&&(c.name=q.join(" "))}const y=Q(n,["phone","phone_number","phoneNumber"]);y&&(c.phone=y);const j=Q(n,["mobNumber","mobile","mobile_phone","mobilePhone"]);j&&(c.mobNumber=j);const k=Q(n,["email","mail"]);k&&(c.email=k);const R=Q(n,["role","roleName"]);R&&(c.role=R);const M=Xa(n,["access","access_level","accessLevel"]);typeof M=="number"&&(c.access=M);const p=Q(n,["roleId","role_id"]);p&&(c.roleId=p);const E=Q(n,["roleName"]);E&&(c.roleName=E);const T=Q(n,["departmentId","department_id"]);T&&(c.departmentId=T);const w=Q(n,["departmentName"]);w&&(c.departmentName=w);const A=Q(n,["divisionId","division_id"]);A&&(c.divisionId=A);const W=Q(n,["divisionName"]);W&&(c.divisionName=W);const z=Q(n,["positionId","position_id"]);z&&(c.positionId=z);const H=Q(n,["positionName"]);H&&(c.positionName=H);const V=Ml(n,["permissions"]);return V&&(c.permissions=V),Object.keys(c).length?c:void 0},Ol=e=>{const a={byId:new Map,byTelegramUsername:new Map,byUsername:new Map};return e.forEach(r=>{const n=Wl(r);n&&(typeof n.telegram_id=="number"&&a.byId.set(String(n.telegram_id),n),typeof n.telegram_username=="string"&&a.byTelegramUsername.set(n.telegram_username.toLowerCase(),n),typeof n.username=="string"&&a.byUsername.set(n.username.toLowerCase(),n))}),a},es=(e,a)=>{if(!a)return e;const r={...e},n=i=>{const m=a[i];if(typeof m!="number"||!Number.isFinite(m))return;const d=r[i];typeof d=="number"&&Number.isFinite(d)||(r[i]=m)},c=i=>{const m=a[i];if(m==null)return;const d=typeof m=="string"?m.trim():typeof m=="number"&&Number.isFinite(m)?String(m):"";if(!d)return;const u=r[i];(u==null||typeof u=="string"&&!u.trim())&&(r[i]=d)};return n("telegram_id"),c("telegram_username"),c("username"),c("name"),c("phone"),c("mobNumber"),c("email"),c("role"),n("access"),c("roleId"),c("roleName"),c("departmentId"),c("departmentName"),c("divisionId"),c("divisionName"),c("positionId"),c("positionName"),(!r.permissions||!r.permissions.length)&&Array.isArray(a.permissions)&&a.permissions.length&&(r.permissions=a.permissions.slice()),r},Fl=/[\s,.;:/\\|_-]+/u,Ll=e=>{var n,c,i,m,d,u,b,x,v,y,j,k;const a=new Set,r=R=>{if(R==null)return;let M;if(typeof R=="number"){if(!Number.isFinite(R))return;M=String(R)}else if(typeof R=="string")M=R.trim();else return;M&&(a.add(M),M.split(Fl).map(p=>p.trim()).filter(p=>p.length>0).forEach(p=>a.add(p)))};return r((n=e.username)!=null?n:void 0),r((c=e.telegram_username)!=null?c:void 0),r((i=e.telegram_id)!=null?i:void 0),r((m=e.name)!=null?m:void 0),r((d=e.phone)!=null?d:void 0),r((u=e.mobNumber)!=null?u:void 0),r((b=e.email)!=null?b:void 0),r((x=e.role)!=null?x:void 0),r((v=e.roleName)!=null?v:void 0),r((y=e.departmentName)!=null?y:void 0),r((j=e.divisionName)!=null?j:void 0),r((k=e.positionName)!=null?k:void 0),Array.isArray(e.permissions)&&e.permissions.forEach(R=>r(R)),Array.from(a)},ts=(e,a,r)=>{const n=r?r.trim():typeof(e==null?void 0:e.telegram_id)=="number"?String(e.telegram_id):void 0;if(n){const m=a.byId.get(n);if(m)return m}const c=typeof(e==null?void 0:e.telegram_username)=="string"?e.telegram_username.trim().toLowerCase():void 0;if(c){const m=a.byTelegramUsername.get(c);if(m)return m}const i=typeof(e==null?void 0:e.username)=="string"?e.username.trim().toLowerCase():void 0;if(i){const m=a.byUsername.get(i);if(m)return m}},Bt="Не удалось загрузить пользователей",as="Обнаружены дублирующиеся отделы",zt="Не удалось загрузить настройки задач",ss="Не удалось сохранить поле задачи",rs="Не удалось сохранить тип задачи",dt="Не удалось удалить настройку задачи",Ul="Пользователь удалён",ns="Не удалось удалить пользователя",Pl="Сотрудник удалён",ls="Не удалось удалить сотрудника",os=e=>typeof e.accessorKey=="string",Gt=(e,a)=>{const r=[];return typeof e=="number"&&Number.isFinite(e)&&r.push(e.toString()),typeof a=="number"&&Number.isFinite(a)&&r.push(a.toString()),r.length?r.join(", "):J},is=Gt;function lo(){var ba,va,ya,ja,Na,wa,ka,Sa,Ca,Ea,Ia,_a,Ta;const{t:e}=cs(),[a,r]=gr(),[n,c]=l.useState(()=>{const s=a.get("module");return Ya(s)?s:"directories"}),[i,m]=l.useState("departments"),[d,u]=l.useState([]),[b,x]=l.useState(!1),[v,y]=l.useState(0),[j,k]=l.useState(1),[R,M]=l.useState(()=>Qa()),[p,E]=l.useState(()=>Qa()),[T,w]=l.useState(Be),[A,W]=l.useState(""),[z,H]=l.useState([]),[V,X]=l.useState([]),[q,G]=l.useState([]),[de,fe]=l.useState([]),ee=10,[me,he]=l.useState([]),[L,h]=l.useState(1),[N,S]=l.useState(""),[D,Z]=l.useState(""),[le,xe]=l.useState(!1),[P,te]=l.useState(Ae),[vt,yt]=l.useState(!1),[I,jt]=l.useState(null),pe=l.useRef(),[ge,be]=l.useState(void 0),[Is,Oe]=l.useState(!1),[Qt,Fe]=l.useState("create"),[_s,Xt]=l.useState([]),[Ts,ea]=l.useState([]),[As,ta]=l.useState(!1),{user:Nt}=jr(),[Rs,Ge]=l.useState(!1),[Ds,Ze]=l.useState(!1),aa=Ar(Nt==null?void 0:Nt.access,Rr);l.useEffect(()=>()=>{pe.current&&window.clearTimeout(pe.current)},[]),l.useEffect(()=>{const s=a.get("module"),o=Ya(s)?s:"directories";o!==n&&c(o)},[a,n]);const sa=l.useCallback(s=>{c(s);const o=new URLSearchParams(a.toString());s==="directories"?o.delete("module"):o.set("module",s),r(o,{replace:!0})},[a,r]),Ce=l.useMemo(()=>{var g;if(!(I!=null&&I.meta)||typeof I.meta!="object")return{readonly:!1,notice:void 0};const s=I.meta,o=!!((g=s.readonly)!=null?g:s.legacy),f=o?typeof s.readonlyReason=="string"?s.readonlyReason:s.legacy?"Элемент перенесён из старой коллекции и доступен только для чтения.":void 0:void 0;return{readonly:o,notice:f}},[I]),Je=l.useMemo(()=>(I==null?void 0:I.type)==="objects"?it(I):null,[I]),Ms=l.useMemo(()=>[{label:e("nav.settings"),href:"/settings"},{label:e("collections.page.title")}],[e]),Le=(ba=R[i])!=null?ba:"",Ue=(va=p[i])!=null?va:"",Pe=n==="directories"&&i!=="users"&&i!=="fleets"&&i!=="tasks",wt=n==="directories"&&i==="users",ra=n==="directories"&&i==="employees",Ye=l.useCallback(s=>{const o=s.trim();k(1),M(f=>f[i]===o?f:{...f,[i]:o})},[i]);l.useEffect(()=>{E(s=>({...s,[i]:Le}))},[i,Le]),l.useEffect(()=>{if(Pe)return pe.current&&window.clearTimeout(pe.current),pe.current=window.setTimeout(()=>{Ye(Ue)},400),()=>{pe.current&&window.clearTimeout(pe.current)}},[Ye,Ue,Pe]);const Qe=l.useCallback(async()=>{if(i==="users"||i==="tasks"){x(!1);return}x(!0);try{if(i==="fleets"){u([]),y(0),W("");return}if(i==="employees"){const o=await Te("employees");u(o),y(o.length),W("");return}if(i==="objects"){const{items:o,total:f}=await Mr(Le,j,ee);u(o),y(f),W("");return}const s=await ft(i,Le,j,ee);u(s.items),y(s.total),i==="departments"&&H(o=>Ht(o,s.items)),i==="divisions"&&X(o=>Ht(o,s.items)),i==="positions"&&G(o=>Ht(o,s.items)),W("")}catch(s){const o=s instanceof Error?s.message:"Не удалось загрузить элементы";u([]),y(0),W(o)}finally{x(!1)}},[i,Le,j]),oe=l.useCallback(async()=>{try{const s=await $r();he(s),W(o=>o===Bt?"":o)}catch(s){const o=s instanceof Error?s.message:Bt;he([]),W(o||Bt)}},[]),ue=l.useCallback(async()=>{ta(!0);try{const[s,o]=await Promise.all([Te("task_fields"),Te("task_types")]);Xt(s),ea(o),W(f=>f===zt?"":f)}catch(s){const o=s instanceof Error?s.message:zt;Xt([]),ea([]),W(o||zt)}finally{ta(!1)}},[W]);l.useEffect(()=>{i==="tasks"&&ue()},[i,ue]);const Ws=l.useCallback(async(s,o)=>{var g;const f=o.trim();if(!f)throw new Error("Название не может быть пустым");try{(g=s.meta)!=null&&g.virtual?await Dt("task_fields",{name:s.name,value:f}):await Mt(s._id,{name:s.name,value:f},{collectionType:"task_fields"}),await ue()}catch(_){const C=_ instanceof Error?_.message:ss;throw new Error(C||ss)}},[ue]),Os=l.useCallback(async s=>{var o;if(!((o=s.meta)!=null&&o.virtual))try{await Wt(s._id),await ue()}catch(f){const g=f instanceof Error?f.message:dt;throw new Error(g||dt)}},[ue]),Fs=l.useCallback(async(s,o)=>{var C;const f=o.label.trim();if(!f)throw new Error("Название не может быть пустым");const g=o.tg_theme_url.trim(),_=o.tg_photos_url.trim();try{const O=()=>{const U={};return g&&(U.tg_theme_url=g),_&&(U.tg_photos_url=_),U};if((C=s.meta)!=null&&C.virtual){const U=O();await Dt("task_types",{name:s.name,value:f,...Object.keys(U).length?{meta:U}:{}})}else{const U=O();g||(U.tg_theme_url=""),_||(U.tg_photos_url=""),await Mt(s._id,{name:s.name,value:f,meta:U},{collectionType:"task_types"})}await ue()}catch(O){const U=O instanceof Error?O.message:rs;throw new Error(U||rs)}},[ue]),Ls=l.useCallback(async s=>{var o;if(!((o=s.meta)!=null&&o.virtual))try{await Wt(s._id),await ue()}catch(f){const g=f instanceof Error?f.message:dt;throw new Error(g||dt)}},[ue]);l.useEffect(()=>{(i==="users"||i==="employees")&&Z(N)},[i,N]),l.useEffect(()=>{vt&&(I==null?void 0:I.type)==="divisions"&&oe()},[vt,I,oe]),l.useEffect(()=>{(async()=>{const[o,f,g]=await Promise.allSettled([Te("departments"),Te("divisions"),Te("positions")]),_=(C,O,U)=>{if(C.status==="fulfilled"){O(C.value);return}const $=C.reason,se=$ instanceof Error&&$.message?$.message:U;W(re=>re||se)};_(o,H,"Не удалось загрузить департаменты"),_(f,X,"Не удалось загрузить отделы"),_(g,G,"Не удалось загрузить должности")})(),ms().then(o=>fe(o)).catch(o=>{fe([]);const f=o instanceof Error?o.message:"Не удалось загрузить роли";W(g=>g||f)})},[]),l.useEffect(()=>{i!=="users"&&i!=="tasks"?(Qe(),i!=="fleets"&&w(Be)):W("")},[Qe,i]),l.useEffect(()=>{i==="users"&&(oe(),te(Ae),be(void 0)),i==="employees"&&(oe(),be(void 0),Fe("create"),Oe(!1)),i!=="employees"&&Oe(!1),(i==="users"||i==="employees"||i==="fleets"||i==="tasks")&&yt(!1),i!=="users"&&(xe(!1),te(Ae))},[i,oe]);const Xe=s=>{if(s){if(s.type==="objects"){const o=it(s);w({_id:o._id,name:o.name,value:o.address,meta:o.meta,address:o.address,latitude:o.latitude!==void 0?o.latitude.toString():"",longitude:o.longitude!==void 0?o.longitude.toString():""})}else w({_id:s._id,name:s.name,value:s.value,meta:s.meta});jt(s)}else w(Be),jt(null);yt(!0)},kt=()=>{yt(!1),jt(null),w(Be)},Us=s=>{var o,f,g,_,C,O,U,$,se,re,ae,ne;return{telegram_id:s==null?void 0:s.telegram_id,username:(f=(o=s==null?void 0:s.telegram_username)!=null?o:s==null?void 0:s.username)!=null?f:"",name:(g=s==null?void 0:s.name)!=null?g:"",phone:(_=s==null?void 0:s.phone)!=null?_:"",mobNumber:(C=s==null?void 0:s.mobNumber)!=null?C:"",email:(O=s==null?void 0:s.email)!=null?O:"",role:(U=s==null?void 0:s.role)!=null?U:"user",access:($=s==null?void 0:s.access)!=null?$:1,roleId:(se=s==null?void 0:s.roleId)!=null?se:"",departmentId:(re=s==null?void 0:s.departmentId)!=null?re:"",divisionId:(ae=s==null?void 0:s.divisionId)!=null?ae:"",positionId:(ne=s==null?void 0:s.positionId)!=null?ne:""}},St=s=>{te(s?Us(s):Ae),xe(!0)},et=l.useCallback(()=>{xe(!1),te(Ae)},[]),Ct=s=>{s?(be(String(s.telegram_id)),Fe("update")):(be(void 0),Fe("create")),Oe(!0)},Ke=l.useCallback(s=>{E(o=>({...o,[i]:s}))},[i]),Ee=l.useCallback(s=>{pe.current&&window.clearTimeout(pe.current),Ye(s!=null?s:Ue)},[Ye,Ue]),Ps=l.useCallback(s=>{Pe&&(s.key==="Enter"&&(s.preventDefault(),Ee(s.currentTarget.value)),s.key==="Escape"&&(s.preventDefault(),Ke(""),Ee("")))},[Pe,Ee,Ke]),Ks=l.useCallback(()=>{Ke(""),Ee("")},[Ee,Ke]),$e=l.useCallback(s=>{s==null||s.preventDefault(),h(1),S(D.trim()),be(void 0)},[D]),$s=l.useCallback(s=>{wt&&(s.key==="Enter"&&(s.preventDefault(),$e()),s.key==="Escape"&&(s.preventDefault(),Z(""),$e()))},[wt,$e]),Vs=s=>{oe(),s.telegram_id!==void 0&&(be(String(s.telegram_id)),Fe("update"))},Hs=l.useCallback(async()=>{if(!P.telegram_id){Ge(!1);return}try{await Ma(P.telegram_id),we(Ul,"success"),be(s=>s===String(P.telegram_id)?void 0:s),et(),await oe()}catch(s){const o=s instanceof Error?s.message:ns;we(o||ns,"error")}finally{Ge(!1)}},[P.telegram_id,et,oe,be]),Bs=l.useCallback(async()=>{if(!ge){Ze(!1);return}try{await Ma(ge),we(Pl,"success"),Oe(!1),be(void 0),Fe("create"),await oe()}catch(s){const o=s instanceof Error?s.message:ls;we(o||ls,"error")}finally{Ze(!1)}},[ge,oe]),zs=async()=>{var g,_,C,O;if(i==="fleets")return;const s=T.name.trim();if(!s)return;if(T._id&&Ce.readonly){W((g=Ce.notice)!=null?g:"Элемент перенесён из старой коллекции и доступен только для чтения.");return}let o=T.value,f;if(i==="departments")o=ze(T.value).join(",");else if(i==="objects"){const U=((C=(_=T.address)!=null?_:T.value)!=null?C:"").trim();if(!U){W("Укажите адрес объекта.");return}o=U;const $=oa(T.latitude),se=oa(T.longitude),re={...(O=T.meta)!=null?O:{},address:U};$!==void 0&&(re.latitude=$),se!==void 0&&(re.longitude=se),($!==void 0||se!==void 0)&&(re.location={lat:$,lng:se}),f=re}else if(o=T.value.trim(),!o){W("Заполните значение элемента.");return}try{let U=null;const $={name:s,value:o,...f?{meta:f}:{}};if(T._id?U=await Mt(T._id,$,{collectionType:i}):U=await Dt(i,$),!U)throw new Error("Сервер не вернул сохранённый элемент");W(""),await Qe(),kt()}catch(U){const $=U instanceof Error?U.message:"Не удалось сохранить элемент";W($)}},qs=async()=>{var s;if(T._id){if(Ce.readonly){W((s=Ce.notice)!=null?s:"Элемент перенесён из старой коллекции и доступен только для чтения.");return}try{await Wt(T._id),W(""),await Qe(),kt()}catch(o){const f=o instanceof Error?o.message:"";W(f)}}},Gs=async()=>{if(!P.telegram_id)return;const s=P.telegram_id;me.find(g=>g.telegram_id===s)||await Vr(s,P.username,P.roleId);const{telegram_id:o,...f}=P;await Hr(s,f),oe(),et()},ve=l.useMemo(()=>{const s=new Map;return z.forEach(o=>s.set(o._id,o.name)),s},[z]),ie=l.useMemo(()=>{const s=new Map;return V.forEach(o=>s.set(o._id,o.name)),s},[V]),tt=l.useMemo(()=>{const s=new Map;return q.forEach(o=>s.set(o._id,o.name)),s},[q]),at=l.useMemo(()=>Ol(d),[d]),st=l.useCallback(s=>es(s,ts(s,at)),[at]),je=l.useMemo(()=>me.map(s=>st(s)),[me,st]),rt=l.useMemo(()=>{const s=new Map;return de.forEach(o=>s.set(o._id,o.name)),s},[de]),{divisionOwners:na,duplicateDivisionIds:Et}=l.useMemo(()=>{const s=new Map,o=new Set;return z.forEach(f=>{ze(f.value).forEach(g=>{const _=s.get(g);if(_&&_!==f._id){o.add(g);return}_||s.set(g,f._id)})}),{divisionOwners:s,duplicateDivisionIds:Array.from(o)}},[z]),It=l.useMemo(()=>{if(!Et.length)return"";const s=Et.map(f=>{var g,_,C;return(C=(_=ie.get(f))!=null?_:(g=V.find(O=>O._id===f))==null?void 0:g.name)!=null?C:f}).filter(f=>!!f),o=s.length?": ".concat(s.join(", "),"."):".";return"".concat(as).concat(o)},[Et,ie,V]);l.useEffect(()=>{if(It){W(s=>s||It);return}W(s=>s&&s.startsWith(as)?"":s)},[It]);const Zs=l.useCallback((s,o)=>{var g,_,C,O,U,$,se,re;if(o==="departments"){const ae=ze(s.value);if(!ae.length)return J;const ne=ae.map(_e=>{var Aa,Ra,Da;return(Da=(Ra=ie.get(_e))!=null?Ra:(Aa=V.find(hr=>hr._id===_e))==null?void 0:Aa.name)!=null?Da:_e}).filter(_e=>!!_e);return ne.length?ne.join("\n"):J}if(o==="divisions"){const ae=(C=(_=ve.get(s.value))!=null?_:(g=z.find(ne=>ne._id===s.value))==null?void 0:g.name)!=null?C:s.value;return ae?Vt(ae):J}if(o==="positions"){const ae=($=(U=ie.get(s.value))!=null?U:(O=V.find(ne=>ne._id===s.value))==null?void 0:O.name)!=null?$:s.value;return ae?Vt(ae):J}if(o==="objects"){const ae=it(s),ne=Gt(ae.latitude,ae.longitude);return ne!==J?ne:((se=ae.address)==null?void 0:se.trim())||J}return Vt((re=s.value)!=null?re:"")||J},[z,V,ve,ie,Gt]),la=l.useCallback(s=>s&&Es(s)||J,[]),oa=l.useCallback(s=>{if(!s)return;const o=s.trim();if(!o)return;const f=Number.parseFloat(o);return Number.isFinite(f)?f:void 0},[]),ia=e("collections.actions.copyId"),ca=e("collections.actions.copiedId"),nt=l.useCallback(s=>s.map(o=>{if(!os(o))return o;switch(o.accessorKey){case"name":return{...o,header:e("collections.table.columns.name")};case"value":return{...o,header:e("collections.table.columns.value")};case"displayValue":return{...o,header:e("collections.table.columns.relations")};case"type":return{...o,header:e("collections.table.columns.type")};case"_id":return{...o,header:e("collections.table.columns.id"),cell:({getValue:f})=>{const g=f(),_=typeof g=="string"?g:"";return _?t.jsx(Kn,{value:_,copyHint:ia,copiedHint:ca}):t.jsx("span",{className:"text-xs text-[color:var(--color-gray-500)] dark:text-[color:var(--color-gray-300)]",children:J})}};case"metaSummary":return{...o,header:e("collections.table.columns.meta")};case"address":return{...o,header:e("collections.table.columns.address")};case"coordinates":return{...o,header:e("collections.table.columns.coordinates")};default:return o}}),[ca,ia,e]),_t=l.useMemo(()=>nt(yl),[nt]),Js=l.useMemo(()=>nt(jl),[nt]),Ys=e("collections.search.placeholder"),da=e("collections.search.hint"),lt=e("collections.actions.search"),ma=e("collections.actions.reset"),ua=e("collections.actions.add"),Tt=e("collections.table.empty.title"),At=e("collections.table.empty.description"),Qs=e("collections.table.empty.action"),Xs=e("collections.users.searchPlaceholder"),fa=e("collections.users.add"),er=e("collections.employees.searchPlaceholder"),ha=e("collections.employees.add"),Ie=l.useCallback(s=>_t.filter(o=>!os(o)||!s.includes(o.accessorKey)),[_t]),tr=l.useMemo(()=>Ie(["value","type","metaSummary"]),[Ie]),ar=l.useMemo(()=>Ie(["type","metaSummary"]),[Ie]),sr=l.useMemo(()=>Ie(["type","metaSummary"]),[Ie]),rr=l.useCallback((s,o,f)=>{const g=ze(s.value),_=C=>{const O=Array.from(C.target.selectedOptions).map(U=>U.value);o({...s,value:O.join(",")})};return t.jsx("select",{multiple:!0,className:"min-h-[8rem] w-full rounded border px-3 py-2",value:g,onChange:_,disabled:f==null?void 0:f.readonly,children:V.filter(C=>{const O=na.get(C._id);return!O||g.includes(C._id)?!0:s._id?O===s._id:!1}).map(C=>t.jsx("option",{value:C._id,children:C.name},C._id))})},[V,na]),nr=l.useCallback((s,o,f)=>t.jsxs("select",{className:"h-10 w-full rounded border px-3",value:s.value,onChange:g=>o({...s,value:g.target.value}),required:!0,disabled:f==null?void 0:f.readonly,children:[t.jsx("option",{value:"",disabled:!0,children:"Выберите департамент"}),z.map(g=>t.jsx("option",{value:g._id,children:g.name},g._id))]}),[z]),lr=l.useCallback((s,o,f)=>t.jsxs("select",{className:"h-10 w-full rounded border px-3",value:s.value,onChange:g=>o({...s,value:g.target.value}),required:!0,disabled:f==null?void 0:f.readonly,children:[t.jsx("option",{value:"",disabled:!0,children:"Выберите отдел"}),V.map(g=>t.jsx("option",{value:g._id,children:g.name},g._id))]}),[V]),or=l.useCallback((s,o,f)=>{var C,O,U;const g=f==null?void 0:f.readonly,_=(C=s.address)!=null?C:s.value;return t.jsxs("div",{className:"space-y-2",children:[t.jsx("input",{className:"h-10 w-full rounded border px-3",value:_,placeholder:"Адрес объекта",onChange:$=>o({...s,address:$.target.value,value:$.target.value}),required:!0,disabled:g}),t.jsxs("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2",children:[t.jsx("input",{className:"h-10 w-full rounded border px-3",value:(O=s.latitude)!=null?O:"",placeholder:"Широта",onChange:$=>o({...s,latitude:$.target.value}),disabled:g}),t.jsx("input",{className:"h-10 w-full rounded border px-3",value:(U=s.longitude)!=null?U:"",placeholder:"Долгота",onChange:$=>o({...s,longitude:$.target.value}),disabled:g})]})]})},[]),ir=Math.ceil(v/ee)||1,xa=l.useMemo(()=>{const s=N.trim();return s?us(je,s,{keys:[{key:o=>{var f;return(f=o.username)!=null?f:""},threshold:Y.STARTS_WITH},{key:o=>{var f;return(f=o.telegram_username)!=null?f:""},threshold:Y.STARTS_WITH},{key:o=>o.telegram_id!==void 0&&o.telegram_id!==null?String(o.telegram_id):"",threshold:Y.STARTS_WITH},{key:o=>Ll(o),threshold:Y.CONTAINS}]}):je},[N,je]),pa=Math.ceil(xa.length/ee)||1,ot=xa.slice((L-1)*ee,L*ee),ga=l.useMemo(()=>ot.map(s=>{const o=st(s),f=typeof o.roleId=="string"?o.roleId.trim():"",g=typeof o.departmentId=="string"?o.departmentId.trim():"",_=typeof o.divisionId=="string"?o.divisionId.trim():"",C=typeof o.positionId=="string"?o.positionId.trim():"",O=ct(rt,f,o.roleName),U=ct(ve,g,o.departmentName),$=ct(ie,_,o.divisionName),se=ct(tt,C,o.positionName),re=O||(o.role?ye(o.role):"");return El({...o,roleId:f,departmentId:g,divisionId:_,positionId:C,roleName:re,departmentName:U,divisionName:$,positionName:se})}),[ot,rt,ve,ie,tt,st]),B=l.useMemo(()=>{if(!ge)return;const s=je.find(g=>String(g.telegram_id)===ge);if(s)return s;const o=ts(void 0,at,ge);if(!o)return;const f={};if(typeof o.telegram_id=="number")f.telegram_id=o.telegram_id;else{const g=Number(ge);Number.isFinite(g)&&(f.telegram_id=g)}return o.username&&(f.username=o.username),o.telegram_username&&(f.telegram_username=o.telegram_username),es(f,o)},[at,je,ge]),cr=l.useMemo(()=>!I||I.type!=="departments"?[]:ze(I.value).map(o=>{var f,g,_;return(_=(g=ie.get(o))!=null?g:(f=V.find(C=>C._id===o))==null?void 0:f.name)!=null?_:o}).filter(o=>!!o),[I,ie,V]),dr=l.useMemo(()=>{var o,f,g;if(!I||I.type!=="divisions")return J;const s=I.value;return s?(g=(f=ve.get(s))!=null?f:(o=z.find(_=>_._id===s))==null?void 0:o.name)!=null?g:s:J},[I,ve,z]),mr=l.useMemo(()=>!I||I.type!=="divisions"?[]:q.filter(s=>s.value===I._id).map(s=>s.name).filter(s=>!!s),[I,q]),ur=l.useMemo(()=>!I||I.type!=="divisions"?[]:je.filter(s=>s.divisionId===I._id).map(s=>s.name&&s.name.trim()?s.name.trim():s.username&&s.username.trim()?s.username.trim():s.telegram_id!==void 0&&s.telegram_id!==null?"ID ".concat(s.telegram_id):"Без имени"),[I,je]),fr=(()=>{if(n!=="directories")return null;if(wt||ra){const s=ra,o=s?er:Xs,f=s?ha:fa,g=s?()=>Ct():()=>St();return t.jsxs("div",{className:"flex w-full flex-col gap-2 sm:flex-row sm:items-end sm:justify-between",children:[t.jsxs("div",{className:"flex w-full flex-col gap-1 sm:w-72",children:[t.jsx("label",{htmlFor:"settings-users-search",className:"sr-only",children:lt}),t.jsx("input",{id:"settings-users-search",className:"h-10 w-full rounded-2xl border border-[color:var(--color-gray-200)] bg-white px-3 text-sm text-[color:var(--color-gray-900)] shadow-sm outline-none transition focus:border-[color:var(--color-brand-400)] focus:ring-2 focus:ring-[color:var(--color-brand-200)] dark:border-[color:var(--color-gray-700)] dark:bg-[color:var(--color-gray-dark)] dark:text-white",value:D,onChange:_=>Z(_.target.value),onKeyDown:$s,placeholder:o}),t.jsx("span",{className:"text-[11px] text-[color:var(--color-gray-500)] dark:text-[color:var(--color-gray-300)]",children:da})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(K,{size:"sm",onClick:()=>$e(),children:lt}),t.jsx(K,{size:"sm",variant:"outline",onClick:()=>{Z(""),$e()},children:ma}),t.jsx(K,{size:"sm",variant:"success",onClick:g,children:f})]})]})}return Pe?t.jsxs("div",{className:"flex w-full flex-col gap-2 sm:flex-row sm:items-end sm:justify-between",children:[t.jsxs("div",{className:"flex w-full flex-col gap-1 sm:w-72",children:[t.jsx("label",{htmlFor:"settings-collections-search",className:"sr-only",children:lt}),t.jsx("input",{id:"settings-collections-search",className:"h-10 w-full rounded-2xl border border-[color:var(--color-gray-200)] bg-white px-3 text-sm text-[color:var(--color-gray-900)] shadow-sm outline-none transition focus:border-[color:var(--color-brand-400)] focus:ring-2 focus:ring-[color:var(--color-brand-200)] dark:border-[color:var(--color-gray-700)] dark:bg-[color:var(--color-gray-dark)] dark:text-white",value:Ue,onChange:s=>Ke(s.target.value),onKeyDown:Ps,placeholder:Ys}),t.jsx("span",{className:"text-[11px] text-[color:var(--color-gray-500)] dark:text-[color:var(--color-gray-300)]",children:da})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(K,{size:"sm",onClick:()=>Ee(),children:lt}),t.jsx(K,{size:"sm",variant:"outline",onClick:Ks,children:ma}),t.jsx(K,{size:"sm",variant:"success",onClick:()=>Xe(),children:ua})]})]}):t.jsx("div",{className:"flex flex-wrap items-center gap-2",children:t.jsx(K,{size:"sm",variant:"success",onClick:()=>Xe(),children:ua})})})();return t.jsx("div",{className:"mx-auto flex w-full max-w-screen-2xl flex-col gap-6 px-3 pb-12 pt-4 sm:px-4 lg:px-8",children:t.jsxs(Pa,{value:n,onValueChange:s=>sa(s),className:"space-y-6",children:[t.jsx(Pn,{breadcrumbs:t.jsx(Nr,{items:Ms}),title:e("collections.page.title"),description:e("collections.page.description"),toolbar:fr,children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"sm:hidden",children:[t.jsx("label",{htmlFor:"settings-module-select",className:"sr-only",children:e("collections.moduleSelectLabel")}),t.jsx("select",{id:"settings-module-select",className:"h-11 w-full rounded-2xl border border-[color:var(--color-gray-200)] bg-white px-3 text-sm font-semibold text-[color:var(--color-gray-800)] shadow-sm outline-none transition focus:border-[color:var(--color-brand-400)] focus:ring-2 focus:ring-[color:var(--color-brand-200)] dark:border-[color:var(--color-gray-700)] dark:bg-[color:var(--color-gray-dark)] dark:text-white",value:n,onChange:s=>sa(s.target.value),children:qt.map(s=>t.jsx("option",{value:s.key,children:s.label},s.key))})]}),t.jsx(Ka,{className:"hidden h-auto gap-2 bg-transparent p-0 sm:grid sm:gap-2 sm:p-1 sm:[grid-template-columns:repeat(5,minmax(11rem,1fr))]",children:qt.map(s=>{const o=s.icon,f="".concat(s.key,"-module-tab-label");return t.jsxs($a,{value:s.key,"aria-labelledby":f,className:"group flex h-full min-h-[3.4rem] w-full flex-col items-center justify-center gap-1.5 rounded-xl border border-transparent px-3 py-2 text-sm font-semibold text-[color:var(--color-gray-700)] transition-colors duration-200 ease-out hover:bg-[color:var(--color-gray-50)] focus-visible:ring-2 focus-visible:ring-[color:var(--color-brand-400)] focus-visible:ring-offset-2 dark:text-[color:var(--color-gray-200)] dark:hover:bg-[color:var(--color-gray-800)] data-[state=active]:border-[color:var(--color-gray-200)] data-[state=active]:bg-white data-[state=active]:text-[color:var(--color-brand-600)] data-[state=active]:shadow-sm dark:data-[state=active]:border-[color:var(--color-gray-700)] dark:data-[state=active]:bg-[color:var(--color-gray-dark)] dark:data-[state=active]:text-[color:var(--color-brand-300)]",children:[t.jsx(o,{className:"size-5 flex-shrink-0 text-[color:var(--color-gray-500)] transition-colors group-data-[state=active]:text-[color:var(--color-brand-600)] dark:text-[color:var(--color-gray-300)] dark:group-data-[state=active]:text-[color:var(--color-brand-300)] sm:size-6"}),t.jsx("span",{id:f,className:"truncate text-sm font-semibold leading-5 text-[color:var(--color-gray-800)] transition-colors group-data-[state=active]:text-[color:var(--color-brand-600)] dark:text-[color:var(--color-gray-100)] dark:group-data-[state=active]:text-[color:var(--color-brand-300)]",children:s.label}),s.description?t.jsx("span",{className:"hidden text-xs font-medium text-[color:var(--color-gray-500)] dark:text-[color:var(--color-gray-400)] sm:block",children:s.description}):null]},s.key)})})]})}),t.jsxs(ce,{value:"directories",className:"mt-0 space-y-6",children:[A?t.jsx("div",{className:"rounded-2xl border border-[color:var(--color-error-200)] bg-[color:var(--color-error-25)] p-4 text-sm text-[color:var(--color-error-600)] dark:border-[color:var(--color-error-700)] dark:bg-[color:var(--color-error-900)]/40 dark:text-[color:var(--color-error-200)]",children:A}):null,t.jsxs(Pa,{value:i,onValueChange:s=>{m(s),k(1)},className:"space-y-5",children:[t.jsxs("div",{className:"sm:hidden",children:[t.jsx("label",{htmlFor:"settings-section-select",className:"sr-only",children:e("collections.directorySelectLabel")}),t.jsx("select",{id:"settings-section-select",className:"h-11 w-full rounded-2xl border border-[color:var(--color-gray-200)] bg-white px-3 text-sm font-semibold text-[color:var(--color-gray-800)] shadow-sm outline-none transition focus:border-[color:var(--color-brand-400)] focus:ring-2 focus:ring-[color:var(--color-brand-200)] dark:border-[color:var(--color-gray-700)] dark:bg-[color:var(--color-gray-dark)] dark:text-white",value:i,onChange:s=>{m(s.target.value),k(1)},children:ht.map(s=>t.jsx("option",{value:s.key,children:s.label},s.key))})]}),t.jsx(Ka,{className:"hidden gap-2 sm:grid sm:gap-2 sm:overflow-visible sm:p-1 sm:[grid-template-columns:repeat(7,minmax(9.5rem,1fr))]",children:ht.map(s=>{const o=_l[s.key],f="".concat(s.key,"-tab-label");return t.jsxs($a,{value:s.key,"aria-labelledby":f,className:"group flex h-full min-h-[3.1rem] w-full flex-col items-center justify-center gap-1.5 rounded-xl border border-transparent px-3 py-2 text-sm font-semibold text-[color:var(--color-gray-700)] transition-colors duration-200 ease-out hover:bg-[color:var(--color-gray-50)] focus-visible:ring-2 focus-visible:ring-[color:var(--color-brand-400)] focus-visible:ring-offset-2 dark:text-[color:var(--color-gray-200)] dark:hover:bg-[color:var(--color-gray-800)] data-[state=active]:border-[color:var(--color-gray-200)] data-[state=active]:bg-white data-[state=active]:text-[color:var(--color-brand-600)] data-[state=active]:shadow-sm dark:data-[state=active]:border-[color:var(--color-gray-700)] dark:data-[state=active]:bg-[color:var(--color-gray-dark)] dark:data-[state=active]:text-[color:var(--color-brand-300)]",children:[o?t.jsx(o,{className:"size-5 flex-shrink-0 text-[color:var(--color-gray-500)] transition-colors group-data-[state=active]:text-[color:var(--color-brand-600)] dark:text-[color:var(--color-gray-300)] dark:group-data-[state=active]:text-[color:var(--color-brand-300)] sm:size-6"}):null,t.jsx("span",{id:f,className:"truncate text-sm font-semibold leading-5 text-[color:var(--color-gray-800)] transition-colors group-data-[state=active]:text-[color:var(--color-brand-600)] dark:text-[color:var(--color-gray-100)] dark:group-data-[state=active]:text-[color:var(--color-brand-300)]",children:s.label}),s.description?t.jsx("span",{"aria-hidden":"true",className:"hidden text-xs font-medium text-[color:var(--color-gray-500)] dark:text-[color:var(--color-gray-400)] sm:block",children:s.description}):null]},s.key)})}),ht.map(s=>{const o=s.key===i,f=o?d.map(C=>{if(s.key==="objects"){const O=it(C);return{...C,address:O.address,coordinates:is(O.latitude,O.longitude),displayValue:O.address||J,metaSummary:la(C.meta)}}return{...C,displayValue:Zs(C,s.key),metaSummary:la(C.meta)}}):[],g=s.key==="departments"?tr:s.key==="divisions"?ar:s.key==="positions"?sr:s.key==="objects"?Js:_t;if(s.key==="users"){const C=ot.length===0;return t.jsx(ce,{value:s.key,className:"mt-0 flex flex-col gap-4",children:C?t.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 rounded-2xl border border-[color:var(--color-gray-200)] bg-white p-8 text-center shadow-sm dark:border-[color:var(--color-gray-700)] dark:bg-[color:var(--color-gray-dark)]",children:[t.jsx("h3",{className:"text-lg font-semibold text-[color:var(--color-gray-800)] dark:text-white",children:Tt}),t.jsx("p",{className:"max-w-md text-sm text-[color:var(--color-gray-600)] dark:text-[color:var(--color-gray-300)]",children:At}),t.jsx(K,{variant:"success",onClick:()=>St(),children:fa})]}):t.jsx(ut,{columns:Nl,data:ot,pageIndex:L-1,pageSize:ee,pageCount:pa,onPageChange:O=>h(O+1),showGlobalSearch:!1,showFilters:!1,onRowClick:O=>St(O),wrapCellsAsBadges:!0,badgeClassName:De,badgeWrapperClassName:qe,badgeEmptyPlaceholder:J})},s.key)}if(s.key==="employees"){const C=ga.length===0;return t.jsx(ce,{value:s.key,className:"mt-0 flex flex-col gap-4",children:C?t.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 rounded-2xl border border-[color:var(--color-gray-200)] bg-white p-8 text-center shadow-sm dark:border-[color:var(--color-gray-700)] dark:bg-[color:var(--color-gray-dark)]",children:[t.jsx("h3",{className:"text-lg font-semibold text-[color:var(--color-gray-800)] dark:text-white",children:Tt}),t.jsx("p",{className:"max-w-md text-sm text-[color:var(--color-gray-600)] dark:text-[color:var(--color-gray-300)]",children:At}),t.jsx(K,{variant:"success",onClick:()=>Ct(),children:ha})]}):t.jsx(ut,{columns:kl,data:ga,pageIndex:L-1,pageSize:ee,pageCount:pa,onPageChange:O=>h(O+1),showGlobalSearch:!1,showFilters:!1,onRowClick:O=>Ct(O),wrapCellsAsBadges:!0,badgeClassName:De,badgeWrapperClassName:qe,badgeEmptyPlaceholder:J})},s.key)}if(s.key==="tasks")return t.jsx(ce,{value:s.key,className:"mt-0",children:t.jsx(rl,{fields:_s,types:Ts,loading:As,onSaveField:Ws,onDeleteField:Os,onSaveType:Fs,onDeleteType:Ls})},s.key);if(s.key==="fleets")return t.jsx(ce,{value:s.key,className:"mt-0",children:t.jsx(tl,{})},s.key);const _=f.length===0;return t.jsx(ce,{value:s.key,className:"mt-0 flex flex-col gap-4",children:o&&b?t.jsx("div",{className:"flex min-h-[12rem] items-center justify-center rounded-2xl border border-[color:var(--color-gray-200)] bg-white shadow-sm dark:border-[color:var(--color-gray-700)] dark:bg-[color:var(--color-gray-dark)]",children:t.jsx(ke,{className:"h-6 w-6 text-[color:var(--color-brand-500)]"})}):_?t.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 rounded-2xl border border-[color:var(--color-gray-200)] bg-white p-8 text-center shadow-sm dark:border-[color:var(--color-gray-700)] dark:bg-[color:var(--color-gray-dark)]",children:[t.jsx("h3",{className:"text-lg font-semibold text-[color:var(--color-gray-800)] dark:text-white",children:Tt}),t.jsx("p",{className:"max-w-md text-sm text-[color:var(--color-gray-600)] dark:text-[color:var(--color-gray-300)]",children:At}),t.jsx(K,{variant:"success",onClick:()=>Xe(),children:Qs})]}):t.jsx(ut,{columns:g,data:f,pageIndex:j-1,pageSize:ee,pageCount:ir,onPageChange:C=>k(C+1),showGlobalSearch:!1,showFilters:!1,onRowClick:C=>Xe(C),wrapCellsAsBadges:!0,badgeClassName:De,badgeWrapperClassName:qe,badgeEmptyPlaceholder:J})},s.key)})]})]}),t.jsx(mt,{open:vt,onClose:kt,children:t.jsxs("div",{className:"space-y-4",children:[I?t.jsx("article",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4 shadow-sm",children:I.type==="departments"?t.jsxs(t.Fragment,{children:[t.jsx("h3",{className:"text-base font-semibold",children:"Информация о департаменте"}),t.jsxs("dl",{className:"mt-2 space-y-3 text-sm",children:[t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"ID"}),t.jsx("dd",{className:"text-right text-slate-900",children:I._id})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Название"}),t.jsx("dd",{className:"text-right text-slate-900",children:I.name})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Отделы департамента"}),t.jsx("dd",{className:"mt-2",children:$t(cr)})]})]})]}):I.type==="divisions"?t.jsxs(t.Fragment,{children:[t.jsx("h3",{className:"text-base font-semibold",children:"Информация о департаменте"}),t.jsxs("dl",{className:"mt-2 space-y-3 text-sm",children:[t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"ID"}),t.jsx("dd",{className:"text-right text-slate-900",children:I._id})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Название"}),t.jsx("dd",{className:"text-right text-slate-900",children:I.name})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Департамент"}),t.jsx("dd",{className:"text-right text-slate-900",children:dr||"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Должности отдела"}),t.jsx("dd",{className:"mt-2",children:$t(mr)})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Сотрудники отдела"}),t.jsx("dd",{className:"mt-2",children:$t(ur)})]})]})]}):I.type==="objects"&&Je?t.jsxs(t.Fragment,{children:[t.jsx("h3",{className:"text-base font-semibold",children:"Информация об объекте"}),t.jsxs("dl",{className:"mt-2 space-y-3 text-sm",children:[t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"ID"}),t.jsx("dd",{className:"text-right text-slate-900",children:I._id})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Название"}),t.jsx("dd",{className:"text-right text-slate-900",children:I.name})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Адрес"}),t.jsx("dd",{className:"text-right text-slate-900",children:Je.address||"—"})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Координаты"}),t.jsx("dd",{className:"text-right text-slate-900",children:is(Je.latitude,Je.longitude)})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Meta"}),t.jsx("dd",{className:"mt-1",children:t.jsx("pre",{className:"max-h-48 overflow-auto rounded bg-white p-2 text-xs text-slate-800",children:I.meta?JSON.stringify(I.meta,null,2):"{}"})})]})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("h3",{className:"text-base font-semibold",children:"Карточка элемента"}),t.jsxs("dl",{className:"mt-2 space-y-1 text-sm",children:[t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"ID"}),t.jsx("dd",{className:"text-right text-slate-900",children:I._id})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Название"}),t.jsx("dd",{className:"text-right text-slate-900",children:I.name})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Тип"}),t.jsx("dd",{className:"text-right text-slate-900",children:I.type})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Значение"}),t.jsx("dd",{className:"mt-1 rounded bg-white p-2 font-mono text-xs text-slate-900",children:I.value||"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Meta"}),t.jsx("dd",{className:"mt-1",children:t.jsx("pre",{className:"max-h-48 overflow-auto rounded bg-white p-2 text-xs text-slate-800",children:I.meta?JSON.stringify(I.meta,null,2):"{}"})})]})]})]})}):null,t.jsx($n,{form:T,onChange:w,onSubmit:zs,onDelete:qs,onReset:()=>w(Be),valueLabel:i==="departments"?"Отделы":i==="divisions"?"Департамент":i==="positions"?"Отдел":i==="objects"?"Адрес":void 0,renderValueField:i==="departments"?rr:i==="divisions"?nr:i==="positions"?lr:i==="objects"?or:void 0,readonly:Ce.readonly,readonlyNotice:Ce.notice})]})}),t.jsx(mt,{open:le,onClose:et,children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("article",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4 shadow-sm",children:[t.jsxs("header",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold",children:"Карточка пользователя"}),t.jsxs("p",{className:"text-sm text-slate-500",children:["Telegram ID: ",(ya=P.telegram_id)!=null?ya:"—"]})]}),aa&&P.telegram_id?t.jsx(K,{type:"button",variant:"destructive",className:"h-9 px-3 text-sm",onClick:()=>Ge(!0),children:"Удалить"}):null]}),t.jsxs("dl",{className:"mt-2 grid grid-cols-1 gap-2 text-sm sm:grid-cols-2",children:[t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Логин"}),t.jsx("dd",{className:"text-slate-900",children:P.username||"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Имя"}),t.jsx("dd",{className:"text-slate-900",children:P.name||"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Телефон"}),t.jsx("dd",{className:"text-slate-900",children:P.phone||"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Мобильный"}),t.jsx("dd",{className:"text-slate-900",children:P.mobNumber||"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Email"}),t.jsx("dd",{className:"text-slate-900",children:P.email||"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Роль"}),t.jsx("dd",{className:"text-slate-900",children:ye(P.role)})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Доступ"}),t.jsx("dd",{className:"text-slate-900",children:P.access})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Роль ID"}),t.jsx("dd",{className:"text-slate-900",children:P.roleId?ye((ja=rt.get(P.roleId))!=null?ja:P.roleId):"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Департамент"}),t.jsx("dd",{className:"text-slate-900",children:P.departmentId?(Na=ve.get(P.departmentId))!=null?Na:P.departmentId:"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Отдел"}),t.jsx("dd",{className:"text-slate-900",children:P.divisionId?(wa=ie.get(P.divisionId))!=null?wa:P.divisionId:"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Должность"}),t.jsx("dd",{className:"text-slate-900",children:P.positionId?(ka=tt.get(P.positionId))!=null?ka:P.positionId:"—"})]})]})]}),t.jsx(Il,{form:P,onChange:te,onSubmit:Gs,onReset:()=>te(Ae)})]})}),t.jsx(mt,{open:Is,onClose:()=>Oe(!1),children:t.jsxs("div",{className:"space-y-4",children:[B?t.jsxs("article",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4 shadow-sm",children:[t.jsxs("header",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold",children:"Карточка сотрудника"}),t.jsxs("p",{className:"text-sm text-slate-500",children:["ID: ",(Sa=B.telegram_id)!=null?Sa:"—"]})]}),aa&&B.telegram_id?t.jsx(K,{type:"button",variant:"destructive",className:"h-9 px-3 text-sm",onClick:()=>Ze(!0),children:"Удалить"}):null]}),t.jsxs("dl",{className:"mt-2 grid grid-cols-1 gap-2 text-sm sm:grid-cols-2",children:[t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Telegram ID"}),t.jsx("dd",{className:"text-slate-900",children:B.telegram_id})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Логин"}),t.jsx("dd",{className:"text-slate-900",children:B.username||"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Имя"}),t.jsx("dd",{className:"text-slate-900",children:B.name||"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Телефон"}),t.jsx("dd",{className:"text-slate-900",children:B.phone||"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Мобильный"}),t.jsx("dd",{className:"text-slate-900",children:B.mobNumber||"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Email"}),t.jsx("dd",{className:"text-slate-900",children:B.email||"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Роль"}),t.jsx("dd",{className:"text-slate-900",children:ye(B.role)})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Доступ"}),t.jsx("dd",{className:"text-slate-900",children:(Ca=B.access)!=null?Ca:"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Роль ID"}),t.jsx("dd",{className:"text-slate-900",children:B.roleId?ye((Ea=rt.get(B.roleId))!=null?Ea:B.roleId):"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Департамент"}),t.jsx("dd",{className:"text-slate-900",children:B.departmentId?(Ia=ve.get(B.departmentId))!=null?Ia:B.departmentId:"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Отдел"}),t.jsx("dd",{className:"text-slate-900",children:B.divisionId?(_a=ie.get(B.divisionId))!=null?_a:B.divisionId:"—"})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"font-medium text-slate-500",children:"Должность"}),t.jsx("dd",{className:"text-slate-900",children:B.positionId?(Ta=tt.get(B.positionId))!=null?Ta:B.positionId:"—"})]})]})]}):null,t.jsx(Or,{telegramId:Qt==="update"?ge:void 0,mode:Qt,onSaved:Vs})]})}),t.jsx(Se,{open:Rs,message:"Удалить пользователя? Это действие нельзя отменить.",onConfirm:Hs,onCancel:()=>Ge(!1),confirmText:"Удалить"}),t.jsx(Se,{open:Ds,message:"Удалить сотрудника? Это действие нельзя отменить.",onConfirm:Bs,onCancel:()=>Ze(!1),confirmText:"Удалить"}),t.jsx(ce,{value:"reports",className:"mt-0",children:t.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900",children:t.jsx(ul,{})})}),t.jsx(ce,{value:"archive",className:"mt-0",children:t.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900",children:t.jsx(Fr,{})})}),t.jsx(ce,{value:"logs",className:"mt-0",children:t.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900",children:t.jsx(Lr,{})})}),t.jsx(ce,{value:"storage",className:"mt-0",children:t.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900",children:t.jsx(Pr,{})})}),t.jsx(ce,{value:"health",className:"mt-0",children:t.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900",children:t.jsx(vl,{})})})]})})}export{lo as default};
//# sourceMappingURL=index-BLKMfMqL.js.map
