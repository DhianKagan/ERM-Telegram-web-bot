const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/DataTable-zTJOOpCK.js","js/index-DAGCYRZX.js","js/vendor-DBLHOZWC.js","js/index-C9GJ36QG.css","js/input-D-Qc8kYd.js","js/App-DjzPhsfn.js","js/AuthenticatedApp-DKm_nmXg.js"])))=>i.map(i=>d[i]);
import{j as _,_ as A}from"./index-DAGCYRZX.js";import{R as N,b as F}from"./vendor-DBLHOZWC.js";import{t as I}from"./taskColumns-Ca4qs_dU.js";import{u as w}from"./AuthenticatedApp-DKm_nmXg.js";import{g as j}from"./App-DjzPhsfn.js";const h=e=>{const t=e.trim().toLowerCase();if(!t)return[];const r=t.replace(/[\s\-_/]+/g,"");return r&&r!==t?[t,r]:[t]},b=(e,t)=>{if(typeof t=="string"){h(t).forEach(r=>e.add(r));return}if(typeof t=="number"&&Number.isFinite(t)){const r=String(t);h(r).forEach(s=>e.add(s))}},y=(e,t,r=0)=>{if(!(r>2||e===null||e===void 0)){if(Array.isArray(e)){e.forEach(s=>y(s,t,r+1));return}if(e instanceof Date){b(t,e.toISOString());return}if(typeof e=="object"){Object.values(e).forEach(s=>y(s,t,r+1));return}b(t,e)}},z=(e,t)=>{if(!e)return;[e.name,e.username,e.telegram_username,e.telegramId,e.telegram_id,e.phone,e.mobNumber,e.email].forEach(s=>b(t,s))},L=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const t=e.trim();if(!t)return;const r=Number(t);if(Number.isFinite(r))return r}},O=(e,t)=>{var g,l,d;const r=new Set;[e.id,e._id,e.request_id,e.task_number,e.title,e.task_description,e.location,e.start_location,e.end_location,e.project,e.comment,e.status,e.priority,e.task_type,e.route_distance_km].forEach(n=>b(r,n));const m=new Set,c=n=>{const f=L(n);f!==void 0?(m.add(f),b(r,f)):typeof n=="string"&&b(r,n)};return c((l=(g=e.created_by)!=null?g:e.creator)!=null?l:e.createdBy),c(e.assigned_user_id),c(e.controller_user_id),(e.assignees||[]).forEach(n=>c(n)),(d=e.controllers)==null||d.forEach(n=>c(n)),m.forEach(n=>z(t[n],r)),y(e.custom,r),y(e.applicant,r),y(e.logistics_details,r),y(e.procurement_details,r),y(e.work_details,r),Array.from(r)},V=e=>e.trim().toLowerCase().split(/\s+/).filter(Boolean);function q(e,t,r){const s=V(t);if(!s.length)return!0;const m=O(e,r);return m.length?s.every(c=>h(c).some(l=>m.some(d=>d.includes(l)))):!1}const B=F.lazy(()=>A(()=>import("./DataTable-zTJOOpCK.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function G({tasks:e,users:t={},page:r,pageCount:s,mine:m=!1,entityKind:c="task",onPageChange:g,onMineChange:l,onRowClick:d,toolbarChildren:n,onDataChange:f}){const{query:x,filters:o}=w(),S=N.useMemo(()=>I(t,c),[t,c]);return N.useEffect(()=>{f==null||f(e)},[f,e]),_.jsx(F.Suspense,{fallback:_.jsx("div",{children:"Загрузка таблицы..."}),children:_.jsx(B,{columns:S,data:e.filter(i=>{if(x&&!q(i,x,t)||o.status.length&&!o.status.includes(i.status)||o.priority.length&&!o.priority.includes(i.priority))return!1;if(o.taskTypes.length){const a=typeof i.task_type=="string"?i.task_type.trim():"";if(!a||!o.taskTypes.includes(a))return!1}if(o.assignees.length){const a=new Set,E=p=>{if(typeof p=="number"&&Number.isFinite(p))a.add(p);else if(typeof p=="string"){const T=Number(p.trim());Number.isFinite(T)&&a.add(T)}};if(Array.isArray(i.assignees)&&i.assignees.forEach(E),E(i.assigned_user_id),!o.assignees.some(p=>a.has(Number(p))))return!1}const u=i.createdAt?new Date(i.createdAt):null;return!(o.from&&u&&u<new Date(o.from)||o.to&&u&&u>new Date(o.to))}),pageIndex:r,pageSize:25,pageCount:s,onPageChange:g,onRowClick:i=>{const u=i,a=j(u._id)||j(u.id);a&&(d==null||d(a))},toolbarChildren:_.jsxs(_.Fragment,{children:[typeof l=="function"&&_.jsxs("label",{className:"flex items-center gap-1 text-sm",htmlFor:"task-table-mine",children:[_.jsx("input",{id:"task-table-mine",name:"mineTasks",type:"checkbox",checked:m,onChange:i=>l(i.target.checked)}),"Мои"]}),n]})})})}export{G as T};
//# sourceMappingURL=TaskTable-O66hOfPf.js.map
