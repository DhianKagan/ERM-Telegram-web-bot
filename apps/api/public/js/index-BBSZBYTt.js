var Pt=Object.defineProperty;var St=(t,s,e)=>s in t?Pt(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var _=(t,s,e)=>St(t,typeof s!="symbol"?s+"":s,e);import{v as At,r as Dt,l as Wt}from"./vendor-bFQg9Mu4.js";import{r as jt}from"./index-Chjiymov.js";function Nt(t,s){for(var e=0;e<s.length;e++){const r=s[e];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const a=Object.getOwnPropertyDescriptor(r,i);a&&Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var G={exports:{}};class Z{constructor(s){_(this,"crashes",[]);_(this,"state","initializing");_(this,"_crashNumberLimit");_(this,"_now",Date.now);_(this,"_minimumNonErrorTimePeriod");_(this,"_boundErrorHandler");_(this,"_listeners");if(this.crashes=[],this._crashNumberLimit=typeof s.crashNumberLimit=="number"?s.crashNumberLimit:3,this._minimumNonErrorTimePeriod=typeof s.minimumNonErrorTimePeriod=="number"?s.minimumNonErrorTimePeriod:5e3,this._boundErrorHandler=e=>{const r="error"in e?e.error:e.reason;r instanceof Error&&this._handleError(r,e)},this._listeners={},!this._restart)throw new Error("The Watchdog class was split into the abstract `Watchdog` class and the `EditorWatchdog` class. Please, use `EditorWatchdog` if you have used the `Watchdog` class previously.")}destroy(){this._stopErrorHandling(),this._listeners={}}on(s,e){this._listeners[s]||(this._listeners[s]=[]),this._listeners[s].push(e)}off(s,e){this._listeners[s]=this._listeners[s].filter(r=>r!==e)}_fire(s,...e){const r=this._listeners[s]||[];for(const i of r)i.apply(this,[null,...e])}_startErrorHandling(){window.addEventListener("error",this._boundErrorHandler),window.addEventListener("unhandledrejection",this._boundErrorHandler)}_stopErrorHandling(){window.removeEventListener("error",this._boundErrorHandler),window.removeEventListener("unhandledrejection",this._boundErrorHandler)}_handleError(s,e){if(this._shouldReactToError(s)){this.crashes.push({message:s.message,stack:s.stack,filename:e instanceof ErrorEvent?e.filename:void 0,lineno:e instanceof ErrorEvent?e.lineno:void 0,colno:e instanceof ErrorEvent?e.colno:void 0,date:this._now()});const r=this._shouldRestart();this.state="crashed",this._fire("stateChange"),this._fire("error",{error:s,causesRestart:r}),r?this._restart():(this.state="crashedPermanently",this._fire("stateChange"))}}_shouldReactToError(s){return s.is&&s.is("CKEditorError")&&s.context!==void 0&&s.context!==null&&this.state==="ready"&&this._isErrorComingFromThisItem(s)}_shouldRestart(){if(this.crashes.length<=this._crashNumberLimit)return!0;const s=this.crashes[this.crashes.length-1].date,e=this.crashes[this.crashes.length-1-this._crashNumberLimit].date;return(s-e)/this._crashNumberLimit>this._minimumNonErrorTimePeriod}}function kt(t){return t==null||typeof t!="object"&&typeof t!="function"}function Ct(t){return Object.getOwnPropertySymbols(t).filter(s=>Object.prototype.propertyIsEnumerable.call(t,s))}function It(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Mt="[object RegExp]",ot="[object String]",at="[object Number]",ct="[object Boolean]",dt="[object Arguments]",vt="[object Symbol]",Lt="[object Date]",Ut="[object Map]",Bt="[object Set]",Ft="[object Array]",qt="[object ArrayBuffer]",Jt="[object Object]",zt="[object DataView]",Ht="[object Uint8Array]",Qt="[object Uint8ClampedArray]",Kt="[object Uint16Array]",$t="[object Uint32Array]",Tt="[object Int8Array]",Yt="[object Int16Array]",Gt="[object Int32Array]",Xt="[object Float32Array]",Zt="[object Float64Array]";function Vt(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function te(t,s){return z(t,void 0,t,new Map,s)}function z(t,s,e,r=new Map,i=void 0){const a=i==null?void 0:i(t,s,e,r);if(a!=null)return a;if(kt(t))return t;if(r.has(t))return r.get(t);if(Array.isArray(t)){const n=new Array(t.length);r.set(t,n);for(let o=0;o<t.length;o++)n[o]=z(t[o],o,e,r,i);return Object.hasOwn(t,"index")&&(n.index=t.index),Object.hasOwn(t,"input")&&(n.input=t.input),n}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const n=new RegExp(t.source,t.flags);return n.lastIndex=t.lastIndex,n}if(t instanceof Map){const n=new Map;r.set(t,n);for(const[o,u]of t)n.set(o,z(u,o,e,r,i));return n}if(t instanceof Set){const n=new Set;r.set(t,n);for(const o of t)n.add(z(o,void 0,e,r,i));return n}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(Vt(t)){const n=new(Object.getPrototypeOf(t)).constructor(t.length);r.set(t,n);for(let o=0;o<t.length;o++)n[o]=z(t[o],o,e,r,i);return n}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const n=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return r.set(t,n),F(n,t,e,r,i),n}if(typeof File<"u"&&t instanceof File){const n=new File([t],t.name,{type:t.type});return r.set(t,n),F(n,t,e,r,i),n}if(t instanceof Blob){const n=new Blob([t],{type:t.type});return r.set(t,n),F(n,t,e,r,i),n}if(t instanceof Error){const n=new t.constructor;return r.set(t,n),n.message=t.message,n.name=t.name,n.stack=t.stack,n.cause=t.cause,F(n,t,e,r,i),n}if(typeof t=="object"&&ee(t)){const n=Object.create(Object.getPrototypeOf(t));return r.set(t,n),F(n,t,e,r,i),n}return t}function F(t,s,e=t,r,i){const a=[...Object.keys(s),...Ct(s)];for(let n=0;n<a.length;n++){const o=a[n],u=Object.getOwnPropertyDescriptor(t,o);(u==null||u.writable)&&(t[o]=z(s[o],o,e,r,i))}}function ee(t){switch(It(t)){case dt:case Ft:case qt:case zt:case ct:case Lt:case Xt:case Zt:case Tt:case Yt:case Gt:case Ut:case at:case Jt:case Mt:case Bt:case ot:case vt:case Ht:case Qt:case Kt:case $t:return!0;default:return!1}}function re(t,s){return te(t,(e,r,i,a)=>{const n=s==null?void 0:s(e,r,i,a);if(n!=null)return n;if(typeof t=="object")switch(Object.prototype.toString.call(t)){case at:case ot:case ct:{const o=new t.constructor(t==null?void 0:t.valueOf());return F(o,t),o}case dt:{const o={};return F(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function se(t){return typeof t=="object"&&t!==null}function ie(t,s,{signal:e,edges:r}={}){let i,a=null;const n=r!=null&&r.includes("leading"),o=r==null||r.includes("trailing"),u=()=>{a!==null&&(t.apply(i,a),i=void 0,a=null)},d=()=>{o&&u(),x()};let h=null;const O=()=>{h!=null&&clearTimeout(h),h=setTimeout(()=>{h=null,d()},s)},y=()=>{h!==null&&(clearTimeout(h),h=null)},x=()=>{y(),i=void 0,a=null},L=()=>{y(),u()},M=function(...H){if(e!=null&&e.aborted)return;i=this,a=H;const Q=h==null;O(),n&&Q&&u()};return M.schedule=O,M.cancel=x,M.flush=L,e==null||e.addEventListener("abort",x,{once:!0}),M}function ne(t,s=0,e={}){typeof e!="object"&&(e={});const{leading:r=!1,trailing:i=!0,maxWait:a}=e,n=Array(2);r&&(n[0]="leading"),i&&(n[1]="trailing");let o,u=null;const d=ie(function(...y){o=t.apply(this,y),u=null},s,{edges:n}),h=function(...y){return a!=null&&(u===null&&(u=Date.now()),Date.now()-u>=a)?(o=t.apply(this,y),u=Date.now(),d.cancel(),d.schedule(),o):(d.apply(this,y),o)},O=()=>(d.flush(),o);return h.cancel=d.cancel,h.flush=O,h}function oe(t,s=0,e={}){typeof e!="object"&&(e={});const{leading:r=!0,trailing:i=!0}=e;return ne(t,s,{leading:r,trailing:i,maxWait:s})}function ae(t){var e;if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const r=t[Symbol.toStringTag];return r==null||!((e=Object.getOwnPropertyDescriptor(t,Symbol.toStringTag))!=null&&e.writable)?!1:t.toString()==="[object ".concat(r,"]")}let s=t;for(;Object.getPrototypeOf(s)!==null;)s=Object.getPrototypeOf(s);return Object.getPrototypeOf(t)===s}function st(t){return se(t)&&t.nodeType===1&&!ae(t)}function X(t,s=new Set){const e=[t],r=new Set;let i=0;for(;e.length>i;){const a=e[i++];if(!(r.has(a)||!ce(a)||s.has(a)))if(r.add(a),Symbol.iterator in a)try{for(const n of a)e.push(n)}catch(n){}else for(const n in a)n!=="defaultValue"&&e.push(a[n])}return r}function ce(t){const s=Object.prototype.toString.call(t),e=typeof t;return!(e==="number"||e==="boolean"||e==="string"||e==="symbol"||e==="function"||s==="[object Date]"||s==="[object RegExp]"||s==="[object Module]"||t===void 0||t===null||t._watchdogExcluded||t instanceof EventTarget||t instanceof Event)}function ht(t,s,e=new Set){if(t===s&&de(t))return!0;const r=X(t,e),i=X(s,e);for(const a of r)if(i.has(a))return!0;return!1}function de(t){return typeof t=="object"&&t!==null}class ut extends Z{constructor(e,r={}){super(r);_(this,"_editor",null);_(this,"_lifecyclePromise",null);_(this,"_throttledSave");_(this,"_data");_(this,"_lastDocumentVersion");_(this,"_elementOrData");_(this,"_initUsingData",!0);_(this,"_editables",{});_(this,"_config");_(this,"_excludedProps");this._throttledSave=oe(this._save.bind(this),typeof r.saveInterval=="number"?r.saveInterval:5e3),e&&(this._creator=((i,a)=>e.create(i,a))),this._destructor=i=>i.destroy()}get editor(){return this._editor}get _item(){return this._editor}setCreator(e){this._creator=e}setDestructor(e){this._destructor=e}_restart(){return Promise.resolve().then(()=>(this.state="initializing",this._fire("stateChange"),this._destroy())).catch(e=>{console.error("An error happened during the editor destroying.",e)}).then(()=>{const e={},r=[],i=this._config.rootsAttributes||{},a={};for(const[o,u]of Object.entries(this._data.roots))u.isLoaded?(e[o]="",a[o]=i[o]||{}):r.push(o);const n={...this._config,extraPlugins:this._config.extraPlugins||[],lazyRoots:r,rootsAttributes:a,_watchdogInitialData:this._data};return delete n.initialData,n.extraPlugins.push(he),this._initUsingData?this.create(e,n,n.context):st(this._elementOrData)?this.create(this._elementOrData,n,n.context):this.create(this._editables,n,n.context)}).then(()=>{this._fire("restart")})}create(e=this._elementOrData,r=this._config,i){return this._lifecyclePromise=Promise.resolve(this._lifecyclePromise).then(()=>(super._startErrorHandling(),this._elementOrData=e,this._initUsingData=typeof e=="string"||Object.keys(e).length>0&&typeof Object.values(e)[0]=="string",this._config=this._cloneEditorConfiguration(r)||{},this._config.context=i,this._creator(e,this._config))).then(a=>{this._editor=a,a.model.document.on("change:data",this._throttledSave),this._lastDocumentVersion=a.model.document.version,this._data=this._getData(),this._initUsingData||(this._editables=this._getEditables()),this.state="ready",this._fire("stateChange")}).finally(()=>{this._lifecyclePromise=null}),this._lifecyclePromise}destroy(){return this._lifecyclePromise=Promise.resolve(this._lifecyclePromise).then(()=>(this.state="destroyed",this._fire("stateChange"),super.destroy(),this._destroy())).finally(()=>{this._lifecyclePromise=null}),this._lifecyclePromise}_destroy(){return Promise.resolve().then(()=>{this._stopErrorHandling(),this._throttledSave.cancel();const e=this._editor;return this._editor=null,e.model.document.off("change:data",this._throttledSave),this._destructor(e)})}_save(){const e=this._editor.model.document.version;try{this._data=this._getData(),this._initUsingData||(this._editables=this._getEditables()),this._lastDocumentVersion=e}catch(r){console.error(r,"An error happened during restoring editor data. Editor will be restored from the previously saved data.")}}_setExcludedProperties(e){this._excludedProps=e}_getData(){const e=this._editor,r=e.model.document.roots.filter(u=>u.isAttached()&&u.rootName!="$graveyard"),{plugins:i}=e,a=i.has("CommentsRepository")&&i.get("CommentsRepository"),n=i.has("TrackChanges")&&i.get("TrackChanges"),o={roots:{},markers:{},commentThreads:JSON.stringify([]),suggestions:JSON.stringify([])};r.forEach(u=>{o.roots[u.rootName]={content:JSON.stringify(Array.from(u.getChildren())),attributes:JSON.stringify(Array.from(u.getAttributes())),isLoaded:u._isLoaded}});for(const u of e.model.markers)u._affectsData&&(o.markers[u.name]={rangeJSON:u.getRange().toJSON(),usingOperation:u._managedUsingOperations,affectsData:u._affectsData});return a&&(o.commentThreads=JSON.stringify(a.getCommentThreads({toJSON:!0,skipNotAttached:!0}))),n&&(o.suggestions=JSON.stringify(n.getSuggestions({toJSON:!0,skipNotAttached:!0}))),o}_getEditables(){const e={};for(const r of this.editor.model.document.getRootNames()){const i=this.editor.ui.getEditableElement(r);i&&(e[r]=i)}return e}_isErrorComingFromThisItem(e){return ht(this._editor,e.context,this._excludedProps)}_cloneEditorConfiguration(e){return re(e,(r,i)=>{if(st(r)||i==="context")return r})}}class he{constructor(s){_(this,"editor");_(this,"_data");this.editor=s,this._data=s.config.get("_watchdogInitialData")}init(){this.editor.data.on("init",s=>{s.stop(),this.editor.model.enqueueChange({isUndoable:!1},e=>{this._restoreCollaborationData(),this._restoreEditorData(e)}),this.editor.data.fire("ready")},{priority:999})}_createNode(s,e){if("name"in e){const r=s.createElement(e.name,e.attributes);if(e.children)for(const i of e.children)r._appendChild(this._createNode(s,i));return r}else return s.createText(e.data,e.attributes)}_restoreEditorData(s){const e=this.editor;Object.entries(this._data.roots).forEach(([r,{content:i,attributes:a}])=>{const n=JSON.parse(i),o=JSON.parse(a),u=e.model.document.getRoot(r);for(const[d,h]of o)s.setAttribute(d,h,u);for(const d of n){const h=this._createNode(s,d);s.insert(h,u,"end")}}),Object.entries(this._data.markers).forEach(([r,i])=>{const{document:a}=e.model,{rangeJSON:{start:n,end:o},...u}=i,d=a.getRoot(n.root),h=s.createPositionFromPath(d,n.path,n.stickiness),O=s.createPositionFromPath(d,o.path,o.stickiness),y=s.createRange(h,O);s.addMarker(r,{range:y,...u})})}_restoreCollaborationData(){const s=JSON.parse(this._data.commentThreads),e=JSON.parse(this._data.suggestions);s.forEach(r=>{const i=this.editor.config.get("collaboration.channelId"),a=this.editor.plugins.get("CommentsRepository");a.hasCommentThread(r.threadId)&&a.getCommentThread(r.threadId).remove(),a.addCommentThread({channelId:i,...r})}),e.forEach(r=>{const i=this.editor.plugins.get("TrackChangesEditing");if(i.hasSuggestion(r.id)){const a=i.getSuggestion(r.id);a.attributes=r.attributes}else i.addSuggestionData(r)})}}const K=Symbol("MainQueueId");class ue extends Z{constructor(e,r={}){super(r);_(this,"_watchdogs",new Map);_(this,"_watchdogConfig");_(this,"_context",null);_(this,"_contextProps",new Set);_(this,"_actionQueues",new le);_(this,"_contextConfig");_(this,"_item");this._watchdogConfig=r,this._creator=i=>e.create(i),this._destructor=i=>i.destroy(),this._actionQueues.onEmpty(()=>{this.state==="initializing"&&(this.state="ready",this._fire("stateChange"))})}setCreator(e){this._creator=e}setDestructor(e){this._destructor=e}get context(){return this._context}create(e={}){return this._actionQueues.enqueue(K,()=>(this._contextConfig=e,this._create()))}getItem(e){return this._getWatchdog(e)._item}getItemState(e){return this._getWatchdog(e).state}add(e){const r=it(e);return Promise.all(r.map(i=>this._actionQueues.enqueue(i.id,()=>{if(this.state==="destroyed")throw new Error("Cannot add items to destroyed watchdog.");if(!this._context)throw new Error("Context was not created yet. You should call the `ContextWatchdog#create()` method first.");let a;if(this._watchdogs.has(i.id))throw new Error("Item with the given id is already added: '".concat(i.id,"'."));if(i.type==="editor")return a=new ut(null,this._watchdogConfig),a.setCreator(i.creator),a._setExcludedProperties(this._contextProps),i.destructor&&a.setDestructor(i.destructor),this._watchdogs.set(i.id,a),a.on("error",(n,{error:o,causesRestart:u})=>{this._fire("itemError",{itemId:i.id,error:o}),u&&this._actionQueues.enqueue(i.id,()=>new Promise(d=>{const h=()=>{a.off("restart",h),this._fire("itemRestart",{itemId:i.id}),d()};a.on("restart",h)}))}),a.create(i.sourceElementOrData,i.config,this._context);throw new Error("Not supported item type: '".concat(i.type,"'."))})))}remove(e){const r=it(e);return Promise.all(r.map(i=>this._actionQueues.enqueue(i,()=>{const a=this._getWatchdog(i);return this._watchdogs.delete(i),a.destroy()})))}destroy(){return this._actionQueues.enqueue(K,()=>(this.state="destroyed",this._fire("stateChange"),super.destroy(),this._destroy()))}_restart(){return this._actionQueues.enqueue(K,()=>(this.state="initializing",this._fire("stateChange"),this._destroy().catch(e=>{console.error("An error happened during destroying the context or items.",e)}).then(()=>this._create()).then(()=>this._fire("restart"))))}_create(){return Promise.resolve().then(()=>(this._startErrorHandling(),this._creator(this._contextConfig))).then(e=>(this._context=e,this._contextProps=X(this._context),Promise.all(Array.from(this._watchdogs.values()).map(r=>(r._setExcludedProperties(this._contextProps),r.create(void 0,void 0,this._context))))))}_destroy(){return Promise.resolve().then(()=>{this._stopErrorHandling();const e=this._context;return this._context=null,this._contextProps=new Set,Promise.all(Array.from(this._watchdogs.values()).map(r=>r.destroy())).then(()=>this._destructor(e))})}_getWatchdog(e){const r=this._watchdogs.get(e);if(!r)throw new Error("Item with the given id was not registered: ".concat(e,"."));return r}_isErrorComingFromThisItem(e){for(const r of this._watchdogs.values())if(r._isErrorComingFromThisItem(e))return!1;return ht(this._context,e.context)}}class le{constructor(){_(this,"_onEmptyCallbacks",[]);_(this,"_queues",new Map);_(this,"_activeActions",0)}onEmpty(s){this._onEmptyCallbacks.push(s)}enqueue(s,e){const r=s===K;this._activeActions++,this._queues.get(s)||this._queues.set(s,Promise.resolve());const a=(r?Promise.all(this._queues.values()):Promise.all([this._queues.get(K),this._queues.get(s)])).then(e),n=a.catch(()=>{});return this._queues.set(s,n),a.finally(()=>{this._activeActions--,this._queues.get(s)===n&&this._activeActions===0&&this._onEmptyCallbacks.forEach(o=>o())})}}function it(t){return Array.isArray(t)?t:[t]}const fe=Object.freeze(Object.defineProperty({__proto__:null,ContextWatchdog:ue,EditorWatchdog:ut,Watchdog:Z},Symbol.toStringTag,{value:"Module"})),ge=At(fe);var nt;function pe(){return nt||(nt=1,(function(t,s){(function(e,r){t.exports=r(Dt(),jt(),ge)})(self,((e,r,i)=>(()=>{var a={546:d=>{d.exports=i},949:d=>{d.exports=r},155:d=>{d.exports=e}},n={};function o(d){var h=n[d];if(h!==void 0)return h.exports;var O=n[d]={exports:{}};return a[d](O,O.exports,o),O.exports}o.n=d=>{var h=d&&d.__esModule?()=>d.default:()=>d;return o.d(h,{a:h}),h},o.d=(d,h)=>{for(var O in h)o.o(h,O)&&!o.o(d,O)&&Object.defineProperty(d,O,{enumerable:!0,get:h[O]})},o.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),o.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})};var u={};return(()=>{o.r(u),o.d(u,{CKEditor:()=>q,CKEditorContext:()=>H,useMultiRootEditor:()=>gt});var d=o(155),h=o.n(d),O=o(949),y=o.n(O);const x=new Array(256).fill("").map(((l,c)=>("0"+c.toString(16)).slice(-2)));var L=o(546);const M=h().createContext("contextWatchdog");class H extends h().Component{constructor(c,g){super(c,g),this.contextWatchdog=null,this.props.isLayoutReady&&this._initializeContextWatchdog(this.props.config)}shouldComponentUpdate(c){return this._shouldComponentUpdate(c)}async _shouldComponentUpdate(c){return c.id!==this.props.id&&(this.contextWatchdog&&await this.contextWatchdog.destroy(),await this._initializeContextWatchdog(c.config)),c.isLayoutReady&&!this.contextWatchdog?(await this._initializeContextWatchdog(c.config),!0):this.props.children!==c.children}render(){return h().createElement(M.Provider,{value:this.contextWatchdog},this.props.children)}componentWillUnmount(){this._destroyContext()}async _initializeContextWatchdog(c){this.contextWatchdog=new L.ContextWatchdog(this.props.context,this.props.watchdogConfig),this.contextWatchdog.on("error",((g,b)=>{this.props.onError(b.error,{phase:"runtime",willContextRestart:b.causesRestart})})),this.contextWatchdog.on("stateChange",(()=>{this.contextWatchdog.state==="ready"&&this.props.onReady&&this.props.onReady(this.contextWatchdog.context)})),await this.contextWatchdog.create(c).catch((g=>{this.props.onError(g,{phase:"initialization",willContextRestart:!1})}))}async _destroyContext(){this.contextWatchdog&&(await this.contextWatchdog.destroy(),this.contextWatchdog=null)}}H.defaultProps={isLayoutReady:!0,onError:(l,c)=>console.error(l,c)},H.propTypes={id:y().string,isLayoutReady:y().bool,context:y().func,watchdogConfig:y().object,config:y().object,onReady:y().func,onError:y().func};const Q="Lock from React integration (@ckeditor/ckeditor5-react)";class q extends h().Component{constructor(c){super(c),this.editorDestructionInProgress=null,this.domContainer=h().createRef(),this.watchdog=null;const{CKEDITOR_VERSION:g}=window;if(g){const[b]=g.split(".").map(Number);b<37&&console.warn("The <CKEditor> component requires using CKEditor 5 in version 37 or higher.")}else console.warn('Cannot find the "CKEDITOR_VERSION" in the "window" scope.')}get editor(){return this.props.disableWatchdog?this.instance:this.watchdog?this.watchdog.editor:null}shouldComponentUpdate(c){return!!this.editor&&(c.id!==this.props.id||c.disableWatchdog!==this.props.disableWatchdog||(this._shouldUpdateEditor(c)&&this.editor.data.set(c.data),"disabled"in c&&(c.disabled?this.editor.enableReadOnlyMode(Q):this.editor.disableReadOnlyMode(Q)),!1))}async componentDidMount(){await this._initializeEditor()}async componentDidUpdate(){await this._destroyEditor(),await this._initializeEditor()}async componentWillUnmount(){await this._destroyEditor()}render(){return h().createElement("div",{ref:this.domContainer})}async _initializeEditor(){await this.editorDestructionInProgress,this.props.disableWatchdog?this.instance=await this._createEditor(this.domContainer.current,this._getConfig()):this.watchdog||(this.context instanceof L.ContextWatchdog?this.watchdog=new V(this.context):this.watchdog=new q._EditorWatchdog(this.props.editor,this.props.watchdogConfig),this.watchdog.setCreator(((c,g)=>this._createEditor(c,g))),this.watchdog.on("error",((c,{error:g,causesRestart:b})=>{(this.props.onError||console.error)(g,{phase:"runtime",willEditorRestart:b})})),await this.watchdog.create(this.domContainer.current,this._getConfig()).catch((c=>{(this.props.onError||console.error)(c,{phase:"initialization",willEditorRestart:!1})})))}_createEditor(c,g){return this.props.editor.create(c,g).then((b=>{"disabled"in this.props&&this.props.disabled&&b.enableReadOnlyMode(Q);const p=b.model.document,D=b.editing.view.document;return p.on("change:data",(S=>{this.props.onChange&&this.props.onChange(S,b)})),D.on("focus",(S=>{this.props.onFocus&&this.props.onFocus(S,b)})),D.on("blur",(S=>{this.props.onBlur&&this.props.onBlur(S,b)})),setTimeout((()=>{this.props.onReady&&this.props.onReady(b)})),b}))}async _destroyEditor(){this.editorDestructionInProgress=new Promise((c=>{setTimeout((async()=>this.watchdog?(await this.watchdog.destroy(),this.watchdog=null,c()):this.instance?(await this.instance.destroy(),this.instance=null,c()):void c()))}))}_shouldUpdateEditor(c){return this.props.data!==c.data&&this.editor.data.get()!==c.data}_getConfig(){const c=this.props.config||{};return this.props.data&&c.initialData&&console.warn("Editor data should be provided either using `config.initialData` or `content` property. The config value takes precedence over `content` property and will be used when both are specified."),{...c,initialData:c.initialData||this.props.data||""}}}q.contextType=M,q.propTypes={editor:y().func.isRequired,data:y().string,config:y().object,disableWatchdog:y().bool,watchdogConfig:y().object,onChange:y().func,onReady:y().func,onFocus:y().func,onBlur:y().func,onError:y().func,disabled:y().bool,id:y().any},q._EditorWatchdog=L.EditorWatchdog;class V{constructor(c){this._contextWatchdog=c,this._id=(function(){const g=4294967296*Math.random()>>>0,b=4294967296*Math.random()>>>0,p=4294967296*Math.random()>>>0,D=4294967296*Math.random()>>>0;return"e"+x[255&g]+x[g>>8&255]+x[g>>16&255]+x[g>>24&255]+x[255&b]+x[b>>8&255]+x[b>>16&255]+x[b>>24&255]+x[255&p]+x[p>>8&255]+x[p>>16&255]+x[p>>24&255]+x[255&D]+x[D>>8&255]+x[D>>16&255]+x[D>>24&255]})()}setCreator(c){this._creator=c}create(c,g){return this._contextWatchdog.add({sourceElementOrData:c,config:g,creator:this._creator,id:this._id,type:"editor"})}on(c,g){this._contextWatchdog.on("itemError",((b,{itemId:p,error:D})=>{p===this._id&&g(null,{error:D,causesRestart:void 0})}))}destroy(){return this._contextWatchdog.state==="ready"?this._contextWatchdog.remove(this._id):Promise.resolve()}get editor(){return this._contextWatchdog.getItem(this._id)}}const Y="Lock from React integration (@ckeditor/ckeditor5-react)",ft=({editor:l})=>{const c=(0,d.useRef)(null);return(0,d.useEffect)((()=>{const g=c.current;if(!l||!g)return;const b=l.ui.view.toolbar.element;return g&&g.appendChild(b),()=>{g&&g.removeChild(b)}}),[l&&l.id]),h().createElement("div",{ref:c})},gt=l=>{const c=(0,d.useRef)(null),g=(0,d.useRef)(null),b=(0,d.useContext)(M),[p,D]=(0,d.useState)(null),[S,U]=(0,d.useState)(l.data),[C,B]=(0,d.useState)(l.rootsAttributes||{}),[pt,$]=(0,d.useState)([]),T=(0,d.useRef)(!0);(0,d.useEffect)((()=>((async()=>(await g.current,l.isLayoutReady!==!1&&await _t()))(),()=>{mt().then((()=>{g.current=null}))})),[l.isLayoutReady]),(0,d.useEffect)((()=>{p&&(l.disabled?p.enableReadOnlyMode(Y):p.disableReadOnlyMode(Y))}),[l.disabled]),(0,d.useEffect)((()=>{if(p&&!g.current){const f=p.getFullData();U({...f}),B({...p.getRootsAttributes()}),$([...Object.keys(f).map((E=>et(p,E)))])}}),[p&&p.id]);const tt=()=>{const f=l.config||{};return l.data&&f.initialData&&console.warn("Editor data should be provided either using `config.initialData` or `data` property. The config value takes precedence over `data` property and will be used when both are specified."),{...f,rootsAttributes:C}},et=(f,E)=>h().createElement("div",{id:E,key:E,ref:m=>{if(m){const W=f.ui.view.createEditable(E,m);f.ui.addEditable(W),f.editing.view.forceRender()}}}),rt=(f,E)=>l.editor.create(f,E).then((m=>{l.disabled&&l.disabled&&m.enableReadOnlyMode(Y);const W=m.model.document,v=m.editing.view.document;return W.on("change:data",(I=>((j,N)=>{const P=j.model.document;if(!l.disableTwoWayDataBinding){const k={},A={};P.differ.getChanges().forEach((w=>{let R;if(R=w.type=="insert"||w.type=="remove"?w.position.root:w.range.root,!R.isAttached())return;const{rootName:J}=R;k[J]=j.getData({rootName:J})})),P.differ.getChangedRoots().forEach((w=>{if(w.state)return void(k[w.name]!==void 0&&delete k[w.name]);const R=w.name;A[R]=j.getRootAttributes(R)})),Object.keys(k).length&&U((w=>({...w,...k}))),Object.keys(A).length&&B((w=>({...w,...A})))}l.onChange&&l.onChange(N,j)})(m,I))),m.on("addRoot",((I,j)=>((N,P,k)=>{const A=k.rootName,w=et(N,A);l.disableTwoWayDataBinding||(U((R=>({...R,[A]:N.getData({rootName:A})}))),B((R=>({...R,[A]:N.getRootAttributes(A)})))),$((R=>[...R,w]))})(m,0,j))),m.on("detachRoot",((I,j)=>((N,P,k)=>{const A=k.rootName;$((w=>w.filter((R=>R.props.id!==A)))),l.disableTwoWayDataBinding||(U((w=>{const{[A]:R,...J}=w;return{...J}})),B((w=>{const{[A]:R,...J}=w;return{...J}}))),N.detachEditable(k)})(m,0,j))),v.on("focus",(I=>{l.onFocus&&l.onFocus(I,m)})),v.on("blur",(I=>{l.onBlur&&l.onBlur(I,m)})),D(m),l.onReady&&l.onReady(m),m})),mt=async()=>{D(null),U({}),B({}),$([]),g.current=new Promise((f=>{setTimeout((async()=>c.current?(await c.current.destroy(),c.current=null,f()):p?(await p.destroy(),f()):void f()))}))},_t=async()=>{if(l.disableWatchdog)return void await rt(l.data,tt());if(c.current)return;b instanceof L.ContextWatchdog?c.current=new V(b):c.current=new L.EditorWatchdog(l.editor,l.watchdogConfig);const f=c.current;f.setCreator(((E,m)=>rt(E,m))),f.on("error",((E,{error:m,causesRestart:W})=>{(l.onError||console.error)(m,{phase:"runtime",willEditorRestart:W})})),await f.create(S,tt()).catch((E=>{(l.onError||console.error)(E,{phase:"initialization",willEditorRestart:!1})}))};(0,d.useEffect)((()=>{if(p&&T.current){T.current=!1;const f=Object.keys(S),E=Object.keys(C);if(!f.every((P=>E.includes(P))))throw new Error("`data` and `attributes` objects must have the same keys (roots).");const m=p.getFullData(),W=p.getRootsAttributes(),{addedKeys:v,removedKeys:I}=yt(m,S||{}),j=f.some((P=>m[P]!==void 0&&JSON.stringify(m[P])!==JSON.stringify(S[P]))),N=E.filter((P=>JSON.stringify(W[P])!==JSON.stringify(C[P])));p.model.change((P=>{bt(v),Et(I),j&&wt(),N.length&&xt(P,N)}))}}),[S,C]);const yt=(f,E)=>{const m=Object.keys(f),W=Object.keys(E);return{addedKeys:W.filter((v=>!m.includes(v))),removedKeys:m.filter((v=>!W.includes(v)))}},bt=f=>{f.forEach((E=>{p.addRoot(E,{data:S[E]||"",attributes:(C==null?void 0:C[E])||{},isUndoable:!0})}))},Et=f=>{f.forEach((E=>{p.detachRoot(E,!0)}))},wt=()=>{p.data.set(S,{suppressErrorInCollaboration:!0})},xt=(f,E)=>{E.forEach((m=>{Object.keys(C[m]).forEach((W=>{p.registerRootAttribute(W)})),f.clearAttributes(p.model.document.getRoot(m)),f.setAttributes(C[m],p.model.document.getRoot(m))}))},Ot=(0,d.useCallback)((f=>{T.current=!0,U(f)}),[U]),Rt=(0,d.useCallback)((f=>{T.current=!0,B(f)}),[B]);return{editor:p,editableElements:pt,toolbarElement:h().createElement(ft,{editor:p}),data:S,setData:Ot,attributes:C,setAttributes:Rt}}})(),u})()))})(G)),G.exports}var lt=pe();const me=Wt(lt),Ee=Nt({__proto__:null,default:me},[lt]);export{Ee as i};
//# sourceMappingURL=index-BBSZBYTt.js.map
