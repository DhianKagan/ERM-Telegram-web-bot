{"version":3,"file":"CodeLogin-legacy-BQfTV2dr.js","sources":["../../../web/src/pages/CodeLogin.tsx"],"sourcesContent":["// Страница входа через код подтверждения\nimport React, { useState, useEffect } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport { useToast } from '../context/useToast';\nimport authFetch from '../utils/authFetch';\n\nexport default function CodeLogin() {\n  const [telegramId, setTelegramId] = useState('');\n  const [code, setCode] = useState('');\n  const [sent, setSent] = useState(false);\n  const { addToast } = useToast();\n  const [params] = useSearchParams();\n  const expired = params.get('expired');\n\n  useEffect(() => {\n    if (expired) {\n      addToast('Сессия истекла, войдите снова', 'error');\n    }\n  }, [expired, addToast]);\n\n  async function send(e?: React.FormEvent) {\n    e?.preventDefault();\n    const r = await authFetch('/api/v1/auth/send_code', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ telegramId: Number(telegramId) }),\n    });\n    if (r.ok) {\n      setSent(true);\n      addToast('Код отправлен');\n    } else {\n      addToast('Не удалось отправить код', 'error');\n    }\n  }\n\n  async function verify(e?: React.FormEvent) {\n    e?.preventDefault();\n    const res = await authFetch('/api/v1/auth/verify_code', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ telegramId: Number(telegramId), code }),\n    });\n    if (res.ok) {\n      window.location.href = '/';\n    } else {\n      addToast('Неверный код', 'error');\n    }\n  }\n\n  return (\n    <form className=\"flex flex-col gap-2 p-4\" onSubmit={sent ? verify : send}>\n      <input\n        id=\"code-login-telegram-id\"\n        name=\"telegramId\"\n        className=\"border p-2\"\n        placeholder=\"Telegram ID\"\n        value={telegramId}\n        onChange={(e) => setTelegramId(e.target.value)}\n      />\n      <a\n        className=\"text-primary underline\"\n        href=\"https://telegram.me/userinfobot\"\n        target=\"_blank\"\n        rel=\"noopener\"\n      >\n        Узнать свой ID через @userinfobot\n      </a>\n      {sent && (\n        <input\n          id=\"code-login-code\"\n          name=\"verificationCode\"\n          className=\"border p-2\"\n          placeholder=\"Код\"\n          value={code}\n          onChange={(e) => setCode(e.target.value)}\n        />\n      )}\n      <button type=\"submit\" className=\"bg-primary p-2 text-white\">\n        {sent ? 'Войти по коду' : 'Отправить код'}\n      </button>\n    </form>\n  );\n}\n"],"names":["_reactExports$useStat2","_slicedToArray","useState","telegramId","setTelegramId","_reactExports$useStat4","code","setCode","_reactExports$useStat6","sent","setSent","addToast","useToast","expired","useSearchParams","get","_callee","e","_regenerator","w","_context","n","preventDefault","authFetch","method","headers","body","JSON","stringify","Number","v","ok","a","apply","arguments","_callee2","_context2","window","location","href","this","useEffect","className","onSubmit","children","jsx","id","name","placeholder","value","onChange","target","rel","type"],"mappings":"6xHAMA,WACE,IAA+CA,EAAAC,EAAXC,EAAAA,SAAS,IAAE,GAAxCC,EAAAH,KAAYI,EAAaJ,EAAA,GACGK,EAAAJ,EAAXC,EAAAA,SAAS,IAAE,GAA5BI,EAAAD,EAAA,GAAME,EAAOF,KACkBG,EAAAP,EAAdC,EAAAA,UAAS,GAAK,GAA/BO,EAAAD,EAAA,GAAME,EAAOF,EAAA,GACZG,EAAaC,IAAbD,SAEFE,EAD2BZ,EAAhBa,IAAgB,GAApB,GACUC,IAAI,wBAqB3B,iBAbA,SAAAC,EAAoBC,UAAAC,IAAAC,EAAA,SAAAC,GAAA,cAAAA,EAAAC,GAAA,KAAA,EACA,OAAlBJ,SAAAA,EAAGK,iBAAeF,EAAAC,EAAA,EACFE,EAAU,yBAA0B,CAClDC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3BC,KAAMC,KAAKC,UAAU,CAAEzB,WAAY0B,OAAO1B,OAC3C,KAAA,EAJKiB,EAAAU,EAKAC,IACJrB,GAAQ,GACRC,EAAS,kBAETA,EAAS,2BAA4B,SACvC,KAAA,EAAA,OAAAS,EAAAY,OAAAhB,EAAA,KACFiB,WAAAC,UAAA,cAcA,iBAZA,SAAAC,EAAsBlB,GAAA,OAAAC,IAAAC,EAAA,SAAAiB,iBAAAA,EAAAf,GAAA,KAAA,EACF,OAAlBJ,SAAAA,EAAGK,iBAAec,EAAAf,EAAA,EACAE,EAAU,2BAA4B,CACtDC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3BC,KAAMC,KAAKC,UAAU,CAAEzB,WAAY0B,OAAO1B,GAAaG,KAAAA,MACxD,KAAA,EAJK8B,EAAAN,EAKEC,GACNM,OAAOC,SAASC,KAAO,IAEvB5B,EAAS,eAAgB,SAC3B,KAAA,EAAA,OAAAyB,EAAAJ,EAAA,GAAA,EAAAG,EAAA,KACFF,MAAAO,KAAAN,UAAA,CAEA,OAnCAO,EAAAA,UAAU,WACJ5B,GACFF,EAAS,gCAAiC,QAE9C,EAAG,CAACE,EAASF,WAgCV,OAAA,CAAK+B,UAAU,0BAA0BC,SAAUlC,EAjBtD,4CAfsB,4CAiClBmC,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACCC,GAAG,yBACHC,KAAK,aACLL,UAAU,aACVM,YAAY,cACZC,MAAO9C,EACP+C,SAAU,SAACjC,GAAA,OAAMb,EAAca,EAAEkC,OAAOF,MAAK,IAE/CJ,EAAAA,IAAC,IAAA,CACCH,UAAU,yBACVH,KAAK,kCACLY,OAAO,SACPC,IAAI,WACLR,SAAA,sCAGAnC,GACCoC,EAAAA,IAAC,QAAA,CACCC,GAAG,kBACHC,KAAK,mBACLL,UAAU,aACVM,YAAY,MACZC,MAAO3C,EACP4C,SAAU,SAACjC,GAAA,OAAMV,EAAQU,EAAEkC,OAAOF,MAAK,IAG3CJ,EAAAA,IAAC,UAAOQ,KAAK,SAASX,UAAU,4BAC7BE,SAAAnC,EAAO,gBAAkB,oBAIlC"}