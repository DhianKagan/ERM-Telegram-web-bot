{"version":3,"file":"CodeLogin-B7NGPKXF.js","sources":["../../../web/src/pages/CodeLogin.tsx"],"sourcesContent":["// Страница входа через код подтверждения\nimport React, { useState, useEffect } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport { useToast } from '../context/useToast';\nimport authFetch from '../utils/authFetch';\n\nexport default function CodeLogin() {\n  const [telegramId, setTelegramId] = useState('');\n  const [code, setCode] = useState('');\n  const [sent, setSent] = useState(false);\n  const { addToast } = useToast();\n  const [params] = useSearchParams();\n  const expired = params.get('expired');\n\n  useEffect(() => {\n    if (expired) {\n      addToast('Сессия истекла, войдите снова', 'error');\n    }\n  }, [expired, addToast]);\n\n  async function send(e?: React.FormEvent) {\n    e?.preventDefault();\n    const r = await authFetch('/api/v1/auth/send_code', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ telegramId: Number(telegramId) }),\n    });\n    if (r.ok) {\n      setSent(true);\n      addToast('Код отправлен');\n    } else {\n      addToast('Не удалось отправить код', 'error');\n    }\n  }\n\n  async function verify(e?: React.FormEvent) {\n    e?.preventDefault();\n    const res = await authFetch('/api/v1/auth/verify_code', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ telegramId: Number(telegramId), code }),\n    });\n    if (res.ok) {\n      window.location.href = '/';\n    } else {\n      addToast('Неверный код', 'error');\n    }\n  }\n\n  return (\n    <form className=\"flex flex-col gap-2 p-4\" onSubmit={sent ? verify : send}>\n      <input\n        id=\"code-login-telegram-id\"\n        name=\"telegramId\"\n        className=\"border p-2\"\n        placeholder=\"Telegram ID\"\n        value={telegramId}\n        onChange={(e) => setTelegramId(e.target.value)}\n      />\n      <a\n        className=\"text-primary underline\"\n        href=\"https://telegram.me/userinfobot\"\n        target=\"_blank\"\n        rel=\"noopener\"\n      >\n        Узнать свой ID через @userinfobot\n      </a>\n      {sent && (\n        <input\n          id=\"code-login-code\"\n          name=\"verificationCode\"\n          className=\"border p-2\"\n          placeholder=\"Код\"\n          value={code}\n          onChange={(e) => setCode(e.target.value)}\n        />\n      )}\n      <button type=\"submit\" className=\"bg-primary p-2 text-white\">\n        {sent ? 'Войти по коду' : 'Отправить код'}\n      </button>\n    </form>\n  );\n}\n"],"names":["CodeLogin","telegramId","setTelegramId","useState","code","setCode","sent","setSent","addToast","useToast","params","useSearchParams","expired","useEffect","send","authFetch","verify","jsx"],"mappings":"yKAMA,SAAwBA,GAAY,CAClC,KAAM,CAACC,EAAYC,CAAa,EAAIC,EAAAA,SAAS,EAAE,EACzC,CAACC,EAAMC,CAAO,EAAIF,EAAAA,SAAS,EAAE,EAC7B,CAACG,EAAMC,CAAO,EAAIJ,EAAAA,SAAS,EAAK,EAChC,CAAE,SAAAK,CAAA,EAAaC,EAAA,EACf,CAACC,CAAM,EAAIC,EAAA,EACXC,EAAUF,EAAO,IAAI,SAAS,EAEpCG,EAAAA,UAAU,IAAM,CACVD,GACFJ,EAAS,gCAAiC,OAAO,CAErD,EAAG,CAACI,EAASJ,CAAQ,CAAC,EAEtB,eAAeM,EAAK,EAAqB,CACvC,WAAG,kBACO,MAAMC,EAAU,yBAA0B,CAClD,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,WAAY,OAAOd,CAAU,EAAG,CAAA,CACxD,GACK,IACJM,EAAQ,EAAI,EACZC,EAAS,eAAe,GAExBA,EAAS,2BAA4B,OAAO,CAEhD,CAEA,eAAeQ,EAAO,EAAqB,CACzC,WAAG,kBACS,MAAMD,EAAU,2BAA4B,CACtD,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,WAAY,OAAOd,CAAU,EAAG,KAAAG,CAAA,CAAM,CAAA,CAC9D,GACO,GACN,OAAO,SAAS,KAAO,IAEvBI,EAAS,eAAgB,OAAO,CAEpC,CAEA,cACG,OAAA,CAAK,UAAU,0BAA0B,SAAUF,EAAOU,EAASF,EAClE,SAAA,CAAAG,EAAAA,IAAC,QAAA,CACC,GAAG,yBACH,KAAK,aACL,UAAU,aACV,YAAY,cACZ,MAAOhB,EACP,SAAW,GAAMC,EAAc,EAAE,OAAO,KAAK,CAAA,CAAA,EAE/Ce,EAAAA,IAAC,IAAA,CACC,UAAU,yBACV,KAAK,kCACL,OAAO,SACP,IAAI,WACL,SAAA,mCAAA,CAAA,EAGAX,GACCW,EAAAA,IAAC,QAAA,CACC,GAAG,kBACH,KAAK,mBACL,UAAU,aACV,YAAY,MACZ,MAAOb,EACP,SAAW,GAAMC,EAAQ,EAAE,OAAO,KAAK,CAAA,CAAA,EAG3CY,EAAAA,IAAC,UAAO,KAAK,SAAS,UAAU,4BAC7B,SAAAX,EAAO,gBAAkB,eAAA,CAC5B,CAAA,EACF,CAEJ"}