{"version":3,"file":"ThemeProvider-legacy-CZwbXzvn.js","sources":["../../../web/src/context/ThemeProvider.tsx"],"sourcesContent":["// Провайдер темы и токенов\n// Модули: React, next-themes, ThemeContext\nimport { useState, useEffect, useRef, type ReactNode } from 'react';\nimport { ThemeProvider as NextThemesProvider } from 'next-themes';\nimport { ThemeContext, type ThemeTokens } from './ThemeContext';\nimport presets from '../theme/presets.json';\n\nfunction getCookie(name: string): string | null {\n  const match = document.cookie.match(new RegExp(`(?:^|; )${name}=([^;]*)`));\n  return match ? decodeURIComponent(match[1]) : null;\n}\n\nfunction setCookie(name: string, value: string) {\n  document.cookie = `${name}=${encodeURIComponent(value)};path=/;max-age=31536000`;\n}\n\nconst presetMap = presets as Record<string, ThemeTokens>;\nconst defaultTheme = 'light';\n\nfunction sanitizeTokens(\n  source: unknown,\n  base: ThemeTokens,\n): Partial<ThemeTokens> | null {\n  if (!source || typeof source !== 'object') return null;\n  const sanitized: Partial<ThemeTokens> = {};\n  for (const [key, value] of Object.entries(\n    source as Record<string, unknown>,\n  )) {\n    if (typeof value === 'string' && key in base) {\n      sanitized[key as keyof ThemeTokens] = value;\n    }\n  }\n  return Object.keys(sanitized).length ? sanitized : null;\n}\n\nfunction readThemeCookie(): string {\n  const cookieTheme = getCookie('theme');\n  return cookieTheme && presetMap[cookieTheme] ? cookieTheme : defaultTheme;\n}\n\nfunction readTokensCookie(\n  theme: string,\n  base: ThemeTokens,\n): Partial<ThemeTokens> | null {\n  const raw = getCookie('theme-tokens');\n  if (!raw) return null;\n  try {\n    const parsed = JSON.parse(raw) as unknown;\n    if (!parsed || typeof parsed !== 'object') return null;\n    if ('theme' in parsed || 'tokens' in parsed) {\n      const cookieTheme = (parsed as { theme?: unknown }).theme;\n      if (typeof cookieTheme === 'string' && cookieTheme !== theme) {\n        return null;\n      }\n      const cookieTokens = sanitizeTokens(\n        (parsed as { tokens?: unknown }).tokens,\n        base,\n      );\n      return cookieTokens;\n    }\n    return sanitizeTokens(parsed, base);\n  } catch {\n    return null;\n  }\n}\n\nfunction mergeWithPreset(\n  base: ThemeTokens,\n  extra: Partial<ThemeTokens> | null,\n): ThemeTokens {\n  if (!extra) return base;\n  return { ...extra, ...base } as ThemeTokens;\n}\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const initialTheme = readThemeCookie();\n  const initialBase = presetMap[initialTheme] || presetMap[defaultTheme];\n  const [theme, setTheme] = useState(initialTheme);\n  const [tokens, setTokens] = useState<ThemeTokens>(() =>\n    mergeWithPreset(initialBase, readTokensCookie(initialTheme, initialBase)),\n  );\n\n  const appliedKeys = useRef<Set<string>>(new Set());\n\n  useEffect(() => {\n    if (!presetMap[theme]) {\n      setTheme(defaultTheme);\n      return;\n    }\n    const base = presetMap[theme] || presetMap[defaultTheme];\n    setTokens(mergeWithPreset(base, readTokensCookie(theme, base)));\n  }, [theme]);\n\n  useEffect(() => {\n    const root = document.documentElement;\n    const currentKeys = new Set<string>();\n    for (const [k, v] of Object.entries(tokens)) {\n      root.style.setProperty(`--${k}`, v);\n      currentKeys.add(k);\n    }\n    for (const key of appliedKeys.current) {\n      if (!currentKeys.has(key)) {\n        root.style.removeProperty(`--${key}`);\n      }\n    }\n    appliedKeys.current = currentKeys;\n    root.classList.toggle('dark', theme === 'dark');\n    setCookie('theme', theme);\n    setCookie('theme-tokens', JSON.stringify({ theme, tokens }));\n  }, [tokens, theme]);\n\n  return (\n    <NextThemesProvider\n      attribute=\"class\"\n      defaultTheme={theme}\n      enableSystem={false}\n    >\n      <ThemeContext.Provider value={{ theme, setTheme, tokens, setTokens }}>\n        {children}\n      </ThemeContext.Provider>\n    </NextThemesProvider>\n  );\n}\n"],"names":["_ref","children","initialTheme","cookieTheme","getCookie","presetMap","defaultTheme","initialBase","_reactExports$useStat2","_slicedToArray","useState","theme","setTheme","_reactExports$useStat4","mergeWithPreset","readTokensCookie","tokens","setTokens","appliedKeys","useRef","Set","useEffect","base","root","document","documentElement","currentKeys","_i2","_Object$entries2","Object","entries","length","_Object$entries2$_i","k","v","style","setProperty","concat","add","_step","_iterator","_createForOfIteratorHelper","current","s","n","done","key","value","has","removeProperty","err","e","f","classList","toggle","setCookie","JSON","stringify","jsx","NextThemesProvider","attribute","enableSystem","ThemeContext","Provider","name","match","cookie","RegExp","decodeURIComponent","encodeURIComponent","sanitizeTokens","source","_typeof","sanitized","_i","_Object$entries","_Object$entries$_i","keys","raw","parsed","parse","_unused","extra","_objectSpread"],"mappings":"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"}