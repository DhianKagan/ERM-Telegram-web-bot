{"version":3,"file":"AttachmentMenu-legacy-BeCuOCfW.js","sources":["../../../web/src/pages/AttachmentMenu.tsx"],"sourcesContent":["// Страница выбора задачи для Attachment Menu\r\n// Модули: React, useToast, authFetch, shared\r\nimport React, { useEffect, useState } from \"react\";\r\nimport type { Task } from \"shared\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { useToast } from \"../context/useToast\";\r\nimport authFetch from \"../utils/authFetch\";\r\n\r\ntype MenuTask = Task & { task_number: string; createdAt: string };\r\n\r\nexport default function AttachmentMenu() {\r\n  const [tasks, setTasks] = useState<MenuTask[]>([]);\r\n  const { addToast } = useToast();\r\n\r\n  useEffect(() => {\r\n    authFetch(\"/api/v1/tasks?limit=10\", { noRedirect: true })\r\n      .then((r) => {\r\n        if (r.status === 401) {\r\n          addToast(\"Сессия истекла, войдите снова\", \"error\");\r\n          return [];\r\n        }\r\n        return r.ok ? r.json() : [];\r\n      })\r\n      .then((data) =>\r\n        setTasks((Array.isArray(data) ? data : data.tasks || []) as MenuTask[]),\r\n      );\r\n  }, [addToast]);\r\n\r\n  function select(id: string) {\r\n    type TelegramApi = {\r\n      WebApp?: {\r\n        sendData?: (data: string) => void;\r\n      };\r\n    };\r\n    const telegram = (globalThis as typeof globalThis & { Telegram?: TelegramApi }).Telegram;\r\n    telegram?.WebApp?.sendData?.(`task_selected:${id}`);\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4\">\r\n      <h1 className=\"mb-4 text-lg\">Выберите задачу</h1>\r\n      <ul>\r\n        {tasks.map((t) => (\r\n          <li key={t._id} className=\"mb-2\">\r\n            <Button\r\n              onClick={() => select(t._id)}\r\n              variant=\"link\"\r\n              size=\"sm\"\r\n              className=\"px-0\"\r\n            >\r\n              {`${t.task_number} ${t.createdAt.slice(0, 10)} ${t.title}`}\r\n            </Button>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["_reactExports$useStat2","_slicedToArray","useState","tasks","setTasks","addToast","useToast","useEffect","authFetch","noRedirect","then","r","status","ok","json","data","Array","isArray","jsxs","className","children","jsx","map","t","Button","onClick","id","_id","telegram","globalThis","Telegram","_telegram$WebApp","WebApp","_telegram$WebApp$send","sendData","call","concat","variant","size","task_number","createdAt","slice","title"],"mappings":"+zCAWA,WACE,IAAiDA,EAAAC,EAAvBC,EAAAA,SAAqB,IAAE,GAA1CC,EAAAH,EAAA,GAAOI,EAAQJ,KACdK,EAAaC,IAAbD,SA0BR,OAxBAE,EAAAA,UAAU,WACRC,EAAU,yBAA0B,CAAEC,YAAY,IAC/CC,KAAK,SAACC,GACL,OAAiB,MAAbA,EAAEC,QACJP,EAAS,gCAAiC,SACnC,IAEFM,EAAEE,GAAKF,EAAEG,OAAS,EAC3B,GACCJ,KAAK,SAACK,UACLX,EAAUY,MAAMC,QAAQF,GAAQA,EAAOA,EAAKZ,OAAS,GAAiB,EAE5E,EAAG,CAACE,IAaFa,EAAAA,KAAC,MAAA,CAAIC,UAAU,MACbC,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAGF,UAAU,eAAeC,SAAA,oBAC7BC,EAAAA,IAAC,MACED,SAAAjB,EAAMmB,IAAI,SAACC,GAAA,OACVF,EAAAA,IAAC,KAAA,CAAeF,UAAU,OACxBC,SAAAC,EAAAA,IAACG,EAAA,CACCC,QAAS,WAAT,OAjBIC,EAiBkBH,EAAEI,SAVlCC,OADMA,EAAYC,WAA8DC,WACtE,QAAVC,EAAAH,EAAUI,cAAA,IAAAD,GAAQ,QAARE,EAAVF,EAAkBG,gBAAA,IAAAD,GAAlBA,EAAAE,KAAAJ,EAAA,iBAAAK,OAA8CV,KAPhD,IAAgBA,EAAYK,EAAAE,EAMpBL,GAYIS,QAAQ,OACRC,KAAK,KACLnB,UAAU,OAETC,YAAAgB,OAAGb,EAAEgB,YAAW,KAAAH,OAAIb,EAAEiB,UAAUC,MAAM,EAAG,IAAG,KAAAL,OAAIb,EAAEmB,UAP9CnB,EAAEI,IAUZ,OAIT"}