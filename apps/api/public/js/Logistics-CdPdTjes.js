import{j as k}from"./index-DAGCYRZX.js";import{R as P,l as Ja,f as Qa,u as eo,i as to}from"./vendor-DBLHOZWC.js";import{h as Wi,b as no,a as io,T as us,k as ro,B as Ze}from"./App-DjzPhsfn.js";import{I as mr}from"./input-D-Qc8kYd.js";import{T as so}from"./TaskTable-O66hOfPf.js";import{M as ls,m as yr,a as ao,b as oo,c as cs,d as uo,e as lo,f as co,g as ho,h as fo,i as go}from"./map-sKDTM6ec.js";import{M as mo}from"./map-Djfvydgf.js";import{u as yo}from"./AuthenticatedApp-DKm_nmXg.js";import{l as vo}from"./fleets-BNcOPkaS.js";import"./taskColumns-Ca4qs_dU.js";import"./EmployeeLink-BTtE5b3j.js";const hs=a=>{if(!a)return!1;const{lng:l,lat:g}=a;return Number.isFinite(l)&&Number.isFinite(g)},po=async(a,l)=>{var N,d,b;if(!hs(a)||!hs(l))return null;const h="".concat("https://router.project-osrm.org/route/v1/driving","/").concat(a.lng,",").concat(a.lat,";").concat(l.lng,",").concat(l.lat,"?overview=full&geometries=geojson"),c=await fetch(h);return c.ok&&((b=(d=(N=(await c.json()).routes)==null?void 0:N[0])==null?void 0:d.geometry)==null?void 0:b.coordinates)||null},_o=async(a,l,g)=>{var v;const h=await Wi("/api/v1/optimizer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:a,count:l,method:g})});if(!h.ok)return null;const c=await h.json();return(v=c==null?void 0:c.plan)!=null?v:null},xo=(a,l,g={})=>{const{enabled:h=!0,immediate:c=!1,pauseOnHidden:v=!0,deps:N=[],document:d}=g,b=P.useRef(a);P.useEffect(()=>{b.current=a},[a]),P.useEffect(()=>{if(!h)return;const I=d!=null?d:typeof document<"u"?document:void 0,_=()=>!!(v&&(I!=null&&I.hidden));if(!Number.isFinite(l)||l<=0){!_()&&c&&b.current();return}let p=!1,S=null;const O=()=>{S!==null&&(clearInterval(S),S=null)},w=()=>{b.current()},z=()=>{p||_()||(O(),S=setInterval(()=>{_()||w()},l))};!_()&&c&&w(),z();let A=null;return I&&v&&typeof I.addEventListener=="function"&&(A=()=>{p||(I.hidden?O():(w(),z()))},I.addEventListener("visibilitychange",A)),()=>{p=!0,O(),A&&I&&typeof I.removeEventListener=="function"&&I.removeEventListener("visibilitychange",A)}},[d,l,h,c,v,...N])},ko=a=>{const l=P.useRef(a);return P.useEffect(()=>{l.current=a},[a]),l};function Eo(a,l){if(typeof window>"u"||typeof EventSource>"u")return()=>{};const g="/api/v1/logistics/events";let h=null,c=!1;const v=_=>typeof Event=="function"?new Event(_):{type:_},N=_=>{try{const p=JSON.parse(_.data);p&&typeof p.type=="string"&&a(p)}catch(p){console.error("Не удалось распарсить событие логистики",p)}},d=_=>{l&&l(_)},b=()=>{c||(h=new EventSource(g,{withCredentials:!0}),h.addEventListener("message",N),h.addEventListener("error",d))};return(async()=>{var O;if(typeof fetch!="function"){b();return}const _=new AbortController;let p=!1;const S=globalThis.setTimeout?globalThis.setTimeout(()=>{_.signal.aborted||_.abort()},4e3):null;try{const w=await fetch(g,{method:"GET",headers:{Accept:"text/event-stream"},credentials:"include",signal:_.signal}),z=(O=w.headers.get("content-type"))!=null?O:"",A=w.ok&&z.toLowerCase().includes("text/event-stream");if(_.signal.aborted||(p=!0,_.abort()),!A){console.warn("Сервер логистики не вернул поток событий (text/event-stream), подписка отключена."),l&&l(v("logistics:eventstream-unavailable"));return}b()}catch(w){w instanceof Error&&w.name==="AbortError"&&_.signal.aborted&&!p?console.warn("Проверка доступности событий логистики завершилась по таймауту."):console.warn("Не удалось подключиться к событиям логистики",w),l&&l(v("logistics:eventstream-error")),b()}finally{S!==null&&clearTimeout(S)}})(),()=>{c=!0,h&&(h.removeEventListener("message",N),h.removeEventListener("error",d),h.close(),h=null)}}const fs="logistics-3d-buildings",No=a=>{var _,p;const l=a.getStyle(),g=l==null?void 0:l.sources;if(!(g&&typeof g=="object"?Object.prototype.hasOwnProperty.call(g,ls):!1))return null;const v=((_=l==null?void 0:l.layers)!=null?_:[]).find(S=>{if(!S||S.type!=="symbol")return!1;const O=S.layout;if(!O)return!1;const w=O["text-field"];return typeof w=="string"||Array.isArray(w)}),N=()=>({id:fs,type:"fill-extrusion",source:ls,"source-layer":"building",filter:["==",["get","extrude"],"true"],minzoom:15,paint:{"fill-extrusion-color":"#94a3b8","fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["coalesce",["get","height"],0]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],15,0,15.05,["coalesce",["get","min_height"],0]],"fill-extrusion-opacity":.6}}),d=fs,b=(p=v==null?void 0:v.id)!=null?p:null;if(a.getLayer(d))b&&a.moveLayer(d,b);else{const S=N();try{a.addLayer(S,b!=null?b:void 0)}catch(O){return b}}return b},vr="#3bb2d0",ni="#fbb03b",gs="#fff",ds=["any",["==","$type","LineString"],["==","$type","Polygon"]],ms={"line-cap":"round","line-join":"round"},Io=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],ni,vr],"fill-opacity":.1}},{id:"gl-draw-lines-inactive",type:"line",filter:["all",["!=","active","true"],ds],layout:ms,paint:{"line-color":vr,"line-dasharray":[2,0],"line-width":2}},{id:"gl-draw-lines-active",type:"line",filter:["all",["==","active","true"],ds],layout:ms,paint:{"line-color":ni,"line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":gs}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],ni,vr]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":gs}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":ni}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":ni}}];async function ys(a,l,g){const h=new URLSearchParams;a&&h.set("status",a),l&&h.set("limit",String(l)),g&&h.set("page",String(g));const c=await Wi("/api/v1/route-plans?".concat(h.toString()));if(!c.ok)throw new Error("Не удалось загрузить маршрутные планы");return await c.json()}async function So(a,l){const g=await Wi("/api/v1/route-plans/".concat(a),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!g.ok)throw new Error("Не удалось сохранить маршрутный план");return(await g.json()).plan}async function vs(a,l){const g=await Wi("/api/v1/route-plans/".concat(a,"/status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:l})});if(!g.ok)throw new Error("Не удалось обновить статус маршрутного плана");return(await g.json()).plan}var at=63710088e-1,ia={centimeters:at*100,centimetres:at*100,degrees:360/(2*Math.PI),feet:at*3.28084,inches:at*39.37,kilometers:at/1e3,kilometres:at/1e3,meters:at,metres:at,miles:at/1609.344,millimeters:at*1e3,millimetres:at*1e3,nauticalmiles:at/1852,radians:1,yards:at*1.0936};function En(a,l,g={}){const h={type:"Feature"};return(g.id===0||g.id)&&(h.id=g.id),g.bbox&&(h.bbox=g.bbox),h.properties=l||{},h.geometry=a,h}function ra(a,l,g={}){if(!a)throw new Error("coordinates is required");if(!Array.isArray(a))throw new Error("coordinates must be an Array");if(a.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ps(a[0])||!ps(a[1]))throw new Error("coordinates must contain numbers");return En({type:"Point",coordinates:a},l,g)}function sa(a,l,g={}){if(a.length<2)throw new Error("coordinates must be an array of two or more positions");return En({type:"LineString",coordinates:a},l,g)}function Bi(a,l={}){const g={type:"FeatureCollection"};return l.id&&(g.id=l.id),l.bbox&&(g.bbox=l.bbox),g.features=a,g}function wo(a,l,g={}){return En({type:"MultiLineString",coordinates:a},l,g)}function aa(a,l="kilometers"){const g=ia[l];if(!g)throw new Error(l+" units is invalid");return a*g}function bo(a,l="kilometers"){const g=ia[l];if(!g)throw new Error(l+" units is invalid");return a/g}function Ti(a){return a%360*Math.PI/180}function ps(a){return!isNaN(a)&&a!==null&&!Array.isArray(a)}function Or(a){if(!a)throw new Error("coord is required");if(!Array.isArray(a)){if(a.type==="Feature"&&a.geometry!==null&&a.geometry.type==="Point")return[...a.geometry.coordinates];if(a.type==="Point")return[...a.coordinates]}if(Array.isArray(a)&&a.length>=2&&!Array.isArray(a[0])&&!Array.isArray(a[1]))return[...a];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function qi(a){if(Array.isArray(a))return a;if(a.type==="Feature"){if(a.geometry!==null)return a.geometry.coordinates}else if(a.coordinates)return a.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function $i(a){return a.type==="Feature"?a.geometry:a}function To(a,l){return a.type==="FeatureCollection"?"FeatureCollection":a.type==="GeometryCollection"?"GeometryCollection":a.type==="Feature"&&a.geometry!==null?a.geometry.type:a.type}function Co(a,l,g={}){var h=Or(a),c=Or(l),v=Ti(c[1]-h[1]),N=Ti(c[0]-h[0]),d=Ti(h[1]),b=Ti(c[1]),I=Math.pow(Math.sin(v/2),2)+Math.pow(Math.sin(N/2),2)*Math.cos(d)*Math.cos(b);return aa(2*Math.atan2(Math.sqrt(I),Math.sqrt(1-I)),g.units)}function jr(a,l,g){if(a!==null)for(var h,c,v,N,d,b,I,_=0,p=0,S,O=a.type,w=O==="FeatureCollection",z=O==="Feature",A=w?a.features.length:1,U=0;U<A;U++){I=w?a.features[U].geometry:z?a.geometry:a,S=I?I.type==="GeometryCollection":!1,d=S?I.geometries.length:1;for(var X=0;X<d;X++){var F=0,K=0;if(N=S?I.geometries[X]:I,N!==null){b=N.coordinates;var Y=N.type;switch(_=0,Y){case null:break;case"Point":if(l(b,p,U,F,K)===!1)return!1;p++,F++;break;case"LineString":case"MultiPoint":for(h=0;h<b.length;h++){if(l(b[h],p,U,F,K)===!1)return!1;p++,Y==="MultiPoint"&&F++}Y==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(h=0;h<b.length;h++){for(c=0;c<b[h].length-_;c++){if(l(b[h][c],p,U,F,K)===!1)return!1;p++}Y==="MultiLineString"&&F++,Y==="Polygon"&&K++}Y==="Polygon"&&F++;break;case"MultiPolygon":for(h=0;h<b.length;h++){for(K=0,c=0;c<b[h].length;c++){for(v=0;v<b[h][c].length-_;v++){if(l(b[h][c][v],p,U,F,K)===!1)return!1;p++}K++}F++}break;case"GeometryCollection":for(h=0;h<N.geometries.length;h++)if(jr(N.geometries[h],l)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function _s(a,l){if(a.type==="Feature")l(a,0);else if(a.type==="FeatureCollection")for(var g=0;g<a.features.length&&l(a.features[g],g)!==!1;g++);}function Ji(a,l){var g,h,c,v,N,d,b,I,_,p,S=0,O=a.type==="FeatureCollection",w=a.type==="Feature",z=O?a.features.length:1;for(g=0;g<z;g++){for(d=O?a.features[g].geometry:w?a.geometry:a,I=O?a.features[g].properties:w?a.properties:{},_=O?a.features[g].bbox:w?a.bbox:void 0,p=O?a.features[g].id:w?a.id:void 0,b=d?d.type==="GeometryCollection":!1,N=b?d.geometries.length:1,c=0;c<N;c++){if(v=b?d.geometries[c]:d,v===null){if(l(null,S,I,_,p)===!1)return!1;continue}switch(v.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(l(v,S,I,_,p)===!1)return!1;break}case"GeometryCollection":{for(h=0;h<v.geometries.length;h++)if(l(v.geometries[h],S,I,_,p)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}S++}}function Lo(a,l,g){var h=g;return Ji(a,function(c,v,N,d,b){h=l(h,c,v,N,d,b)}),h}function Ro(a,l){Ji(a,function(g,h,c,v,N){var d=g===null?null:g.type;switch(d){case null:case"Point":case"LineString":case"Polygon":return l(En(g,c,{bbox:v,id:N}),h,0)===!1?!1:void 0}var b;switch(d){case"MultiPoint":b="Point";break;case"MultiLineString":b="LineString";break;case"MultiPolygon":b="Polygon";break}for(var I=0;I<g.coordinates.length;I++){var _=g.coordinates[I],p={type:b,coordinates:_};if(l(En(p,c),h,I)===!1)return!1}})}function Oo(a,l){Ro(a,function(g,h,c){var v=0;if(g.geometry){var N=g.geometry.type;if(!(N==="Point"||N==="MultiPoint")){var d,b=0,I=0,_=0;if(jr(g,function(p,S,O,w,z){if(d===void 0||h>b||w>I||z>_){d=p,b=h,I=w,_=z,v=0;return}var A=sa([d,p],g.properties);if(l(A,h,c,z,v)===!1)return!1;v++,d=p})===!1)return!1}}})}function Mo(a,l,g){var h=g,c=!1;return Oo(a,function(v,N,d,b,I){c===!1&&g===void 0?h=v:h=l(h,v,N,d,b,I),c=!0}),h}function Ao(a){return Lo(a,(l,g)=>l+Po(g),0)}function Po(a){let l=0,g;switch(a.type){case"Polygon":return xs(a.coordinates);case"MultiPolygon":for(g=0;g<a.coordinates.length;g++)l+=xs(a.coordinates[g]);return l;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function xs(a){let l=0;if(a&&a.length>0){l+=Math.abs(ks(a[0]));for(let g=1;g<a.length;g++)l-=Math.abs(ks(a[g]))}return l}var Do=at*at/2,pr=Math.PI/180;function ks(a){const l=a.length-1;if(l<=2)return 0;let g=0,h=0;for(;h<l;){const c=a[h],v=a[h+1===l?0:h+1],N=a[h+2>=l?(h+2)%l:h+2],d=c[0]*pr,b=v[1]*pr,I=N[0]*pr;g+=(I-d)*Math.sin(b),h++}return g*Do}function Fo(a,l={}){if(a.bbox!=null&&l.recompute!==!0)return a.bbox;const g=[1/0,1/0,-1/0,-1/0];return jr(a,h=>{g[0]>h[0]&&(g[0]=h[0]),g[1]>h[1]&&(g[1]=h[1]),g[2]<h[0]&&(g[2]=h[0]),g[3]<h[1]&&(g[3]=h[1])}),g}const Yt=11102230246251565e-32,st=134217729,Go=(3+8*Yt)*Yt;function _r(a,l,g,h,c){let v,N,d,b,I=l[0],_=h[0],p=0,S=0;_>I==_>-I?(v=I,I=l[++p]):(v=_,_=h[++S]);let O=0;if(p<a&&S<g)for(_>I==_>-I?(N=I+v,d=v-(N-I),I=l[++p]):(N=_+v,d=v-(N-_),_=h[++S]),v=N,d!==0&&(c[O++]=d);p<a&&S<g;)_>I==_>-I?(N=v+I,b=N-v,d=v-(N-b)+(I-b),I=l[++p]):(N=v+_,b=N-v,d=v-(N-b)+(_-b),_=h[++S]),v=N,d!==0&&(c[O++]=d);for(;p<a;)N=v+I,b=N-v,d=v-(N-b)+(I-b),I=l[++p],v=N,d!==0&&(c[O++]=d);for(;S<g;)N=v+_,b=N-v,d=v-(N-b)+(_-b),_=h[++S],v=N,d!==0&&(c[O++]=d);return(v!==0||O===0)&&(c[O++]=v),O}function jo(a,l){let g=l[0];for(let h=1;h<a;h++)g+=l[h];return g}function ci(a){return new Float64Array(a)}const qo=(3+16*Yt)*Yt,zo=(2+12*Yt)*Yt,Yo=(9+64*Yt)*Yt*Yt,Mn=ci(4),Es=ci(8),Ns=ci(12),Is=ci(16),ht=ci(4);function Uo(a,l,g,h,c,v,N){let d,b,I,_,p,S,O,w,z,A,U,X,F,K,Y,B,W,$;const Q=a-c,pe=g-c,_e=l-v,me=h-v;K=Q*me,S=st*Q,O=S-(S-Q),w=Q-O,S=st*me,z=S-(S-me),A=me-z,Y=w*A-(K-O*z-w*z-O*A),B=_e*pe,S=st*_e,O=S-(S-_e),w=_e-O,S=st*pe,z=S-(S-pe),A=pe-z,W=w*A-(B-O*z-w*z-O*A),U=Y-W,p=Y-U,Mn[0]=Y-(U+p)+(p-W),X=K+U,p=X-K,F=K-(X-p)+(U-p),U=F-B,p=F-U,Mn[1]=F-(U+p)+(p-B),$=X+U,p=$-X,Mn[2]=X-($-p)+(U-p),Mn[3]=$;let xe=jo(4,Mn),H=zo*N;if(xe>=H||-xe>=H||(p=a-Q,d=a-(Q+p)+(p-c),p=g-pe,I=g-(pe+p)+(p-c),p=l-_e,b=l-(_e+p)+(p-v),p=h-me,_=h-(me+p)+(p-v),d===0&&b===0&&I===0&&_===0)||(H=Yo*N+Go*Math.abs(xe),xe+=Q*_+me*d-(_e*I+pe*b),xe>=H||-xe>=H))return xe;K=d*me,S=st*d,O=S-(S-d),w=d-O,S=st*me,z=S-(S-me),A=me-z,Y=w*A-(K-O*z-w*z-O*A),B=b*pe,S=st*b,O=S-(S-b),w=b-O,S=st*pe,z=S-(S-pe),A=pe-z,W=w*A-(B-O*z-w*z-O*A),U=Y-W,p=Y-U,ht[0]=Y-(U+p)+(p-W),X=K+U,p=X-K,F=K-(X-p)+(U-p),U=F-B,p=F-U,ht[1]=F-(U+p)+(p-B),$=X+U,p=$-X,ht[2]=X-($-p)+(U-p),ht[3]=$;const de=_r(4,Mn,4,ht,Es);K=Q*_,S=st*Q,O=S-(S-Q),w=Q-O,S=st*_,z=S-(S-_),A=_-z,Y=w*A-(K-O*z-w*z-O*A),B=_e*I,S=st*_e,O=S-(S-_e),w=_e-O,S=st*I,z=S-(S-I),A=I-z,W=w*A-(B-O*z-w*z-O*A),U=Y-W,p=Y-U,ht[0]=Y-(U+p)+(p-W),X=K+U,p=X-K,F=K-(X-p)+(U-p),U=F-B,p=F-U,ht[1]=F-(U+p)+(p-B),$=X+U,p=$-X,ht[2]=X-($-p)+(U-p),ht[3]=$;const Ie=_r(de,Es,4,ht,Ns);K=d*_,S=st*d,O=S-(S-d),w=d-O,S=st*_,z=S-(S-_),A=_-z,Y=w*A-(K-O*z-w*z-O*A),B=b*I,S=st*b,O=S-(S-b),w=b-O,S=st*I,z=S-(S-I),A=I-z,W=w*A-(B-O*z-w*z-O*A),U=Y-W,p=Y-U,ht[0]=Y-(U+p)+(p-W),X=K+U,p=X-K,F=K-(X-p)+(U-p),U=F-B,p=F-U,ht[1]=F-(U+p)+(p-B),$=X+U,p=$-X,ht[2]=X-($-p)+(U-p),ht[3]=$;const Re=_r(Ie,Ns,4,ht,Is);return Is[Re-1]}function Bo(a,l,g,h,c,v){const N=(l-v)*(g-c),d=(a-c)*(h-v),b=N-d,I=Math.abs(N+d);return Math.abs(b)>=qo*I?b:-Uo(a,l,g,h,c,v,I)}function Vo(a,l){var g,h,c=0,v,N,d,b,I,_,p,S=a[0],O=a[1],w=l.length;for(g=0;g<w;g++){h=0;var z=l[g],A=z.length-1;if(_=z[0],_[0]!==z[A][0]&&_[1]!==z[A][1])throw new Error("First and last coordinates in a ring must be the same");for(N=_[0]-S,d=_[1]-O,h;h<A;h++){if(p=z[h+1],b=p[0]-S,I=p[1]-O,d===0&&I===0){if(b<=0&&N>=0||N<=0&&b>=0)return 0}else if(I>=0&&d<=0||I<=0&&d>=0){if(v=Bo(N,b,d,I,0,0),v===0)return 0;(v>0&&I>0&&d<=0||v<0&&I<=0&&d>0)&&c++}_=p,d=I,N=b}}return c%2!==0}function Xo(a,l,g={}){if(!a)throw new Error("point is required");if(!l)throw new Error("polygon is required");const h=Or(a),c=$i(l),v=c.type,N=l.bbox;let d=c.coordinates;if(N&&Ho(h,N)===!1)return!1;v==="Polygon"&&(d=[d]);let b=!1;for(var I=0;I<d.length;++I){const _=Vo(h,d[I]);if(_===0)return!g.ignoreBoundary;_&&(b=!0)}return b}function Ho(a,l){return l[0]<=a[0]&&l[1]<=a[1]&&l[2]>=a[0]&&l[3]>=a[1]}function Zo(a,l={}){const g=$i(a);switch(!l.properties&&a.type==="Feature"&&(l.properties=a.properties),g.type){case"Polygon":return Ko(g,l);case"MultiPolygon":return Wo(g,l);default:throw new Error("invalid poly")}}function Ko(a,l={}){const h=$i(a).coordinates,c=l.properties?l.properties:a.type==="Feature"?a.properties:{};return oa(h,c)}function Wo(a,l={}){const h=$i(a).coordinates,c=l.properties?l.properties:a.type==="Feature"?a.properties:{},v=[];return h.forEach(N=>{v.push(oa(N,c))}),Bi(v)}function oa(a,l){return a.length>1?wo(a,l):sa(a[0],l)}function $o(a,l={}){var g=typeof l=="object"?l.mutate:l;if(!a)throw new Error("geojson is required");var h=To(a),c=[];switch(h){case"LineString":c=xr(a,h);break;case"MultiLineString":case"Polygon":qi(a).forEach(function(N){c.push(xr(N,h))});break;case"MultiPolygon":qi(a).forEach(function(N){var d=[];N.forEach(function(b){d.push(xr(b,h))}),c.push(d)});break;case"Point":return a;case"MultiPoint":var v={};qi(a).forEach(function(N){var d=N.join("-");Object.prototype.hasOwnProperty.call(v,d)||(c.push(N),v[d]=!0)});break;default:throw new Error(h+" geometry not supported")}return a.coordinates?g===!0?(a.coordinates=c,a):{type:h,coordinates:c}:g===!0?(a.geometry.coordinates=c,a):En({type:h,coordinates:c},a.properties,{bbox:a.bbox,id:a.id})}function xr(a,l){var g=qi(a);if(g.length===2&&!Ss(g[0],g[1]))return g;var h=[],c=g.length-1,v=h.length;h.push(g[0]);for(var N=1;N<c;N++){var d=h[h.length-1];g[N][0]===d[0]&&g[N][1]===d[1]||(h.push(g[N]),v=h.length,v>2&&ws(h[v-3],h[v-1],h[v-2])&&h.splice(h.length-2,1))}if(h.push(g[g.length-1]),v=h.length,(l==="Polygon"||l==="MultiPolygon")&&Ss(g[0],g[g.length-1])&&v<4)throw new Error("invalid polygon");return l==="LineString"&&v<3||ws(h[v-3],h[v-1],h[v-2])&&h.splice(h.length-2,1),h}function Ss(a,l){return a[0]===l[0]&&a[1]===l[1]}function ws(a,l,g){var h=g[0],c=g[1],v=a[0],N=a[1],d=l[0],b=l[1],I=h-v,_=c-N,p=d-v,S=b-N,O=I*S-_*p;return O!==0?!1:Math.abs(p)>=Math.abs(S)?p>0?v<=h&&h<=d:d<=h&&h<=v:S>0?N<=c&&c<=b:b<=c&&c<=N}function Jo(a,l={}){const g=Fo(a),h=(g[0]+g[2])/2,c=(g[1]+g[3])/2;return ra([h,c],l.properties,l)}var zi={exports:{}},Qo=zi.exports,bs;function eu(){return bs||(bs=1,(function(a,l){(function(g,h){a.exports=h()})(Qo,(function(){function g(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function h(i,e,t){return e=_(e),(function(n,r){if(r&&(typeof r=="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s})(n)})(i,S()?Reflect.construct(e,t||[],_(i).constructor):e.apply(i,t))}function c(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function v(i,e,t){if(S())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var r=new(i.bind.apply(i,n));return t&&O(r,t.prototype),r}function N(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,A(n.key),n)}}function d(i,e,t){return e&&N(i.prototype,e),t&&N(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}function b(i,e){var t=typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(!t){if(Array.isArray(i)||(t=U(i))||e){t&&(i=t);var n=0,r=function(){};return{s:r,n:function(){return n>=i.length?{done:!0}:{done:!1,value:i[n++]}},e:function(m){throw m},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){t=t.call(i)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,s=m},f:function(){try{o||t.return==null||t.return()}finally{if(u)throw s}}}}function I(){return I=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(i,e,t){var n=(function(s,o){for(;!{}.hasOwnProperty.call(s,o)&&(s=_(s))!==null;);return s})(i,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?i:t):r.value}},I.apply(null,arguments)}function _(i){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_(i)}function p(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&O(i,e)}function S(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(S=function(){return!!i})()}function O(i,e){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},O(i,e)}function w(i,e,t,n){var r=I(_(1&n?i.prototype:i),e,t);return 2&n&&typeof r=="function"?function(s){return r.apply(t,s)}:r}function z(i){return(function(e){if(Array.isArray(e))return g(e)})(i)||(function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)})(i)||U(i)||(function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function A(i){var e=(function(t,n){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,n);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)})(i,"string");return typeof e=="symbol"?e:e+""}function U(i,e){if(i){if(typeof i=="string")return g(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?g(i,e):void 0}}function X(i){var e=typeof Map=="function"?new Map:void 0;return X=function(t){if(t===null||!(function(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch(s){return typeof r=="function"}})(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return v(t,arguments,_(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),O(n,t)},X(i)}var F=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=i.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=i.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==i.JOIN_ROUND&&(this._quadrantSegments=i.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(e){this._joinStyle=e}},{key:"setSimplifyFactor",value:function(e){this._simplifyFactor=e<0?0:e}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(e){this._endCapStyle=e}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(e){this._mitreLimit=e}},{key:"setSingleSided",value:function(e){this._isSingleSided=e}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=i.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=i.CAP_ROUND,this._joinStyle=i.JOIN_ROUND,this._mitreLimit=i.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=i.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setQuadrantSegments(e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.setQuadrantSegments(t),this.setEndCapStyle(n)}else if(arguments.length===4){var r=arguments[0],s=arguments[1],o=arguments[2],u=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(s),this.setJoinStyle(o),this.setMitreLimit(u)}}}},{key:"bufferDistanceError",value:function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)}}])})();F.CAP_ROUND=1,F.CAP_FLAT=2,F.CAP_SQUARE=3,F.JOIN_ROUND=1,F.JOIN_MITRE=2,F.JOIN_BEVEL=3,F.DEFAULT_QUADRANT_SEGMENTS=8,F.DEFAULT_MITRE_LIMIT=5,F.DEFAULT_SIMPLIFY_FACTOR=.01;var K=(function(i){function e(t){var n;return c(this,e),(n=h(this,e,[t])).name=Object.keys({Exception:e})[0],n}return p(e,i),d(e,[{key:"toString",value:function(){return this.message}}])})(X(Error)),Y=(function(i){function e(t){var n;return c(this,e),(n=h(this,e,[t])).name=Object.keys({IllegalArgumentException:e})[0],n}return p(e,i),d(e)})(K),B=(function(){return d((function i(){c(this,i)}),[{key:"filter",value:function(i){}}])})();function W(){}function $(){}function Q(){}var pe,_e,me,xe,H,de,Ie,Re,Fe=(function(){return d((function i(){c(this,i)}),null,[{key:"equalsWithTolerance",value:function(i,e,t){return Math.abs(i-e)<=t}}])})(),qe=(function(){return d((function i(e,t){c(this,i),this.low=t||0,this.high=e||0}),null,[{key:"toBinaryString",value:function(i){var e,t="";for(e=2147483648;e>0;e>>>=1)t+=(i.high&e)===e?"1":"0";for(e=2147483648;e>0;e>>>=1)t+=(i.low&e)===e?"1":"0";return t}}])})();function ne(){}function Ge(){}ne.NaN=NaN,ne.isNaN=function(i){return Number.isNaN(i)},ne.isInfinite=function(i){return!Number.isFinite(i)},ne.MAX_VALUE=Number.MAX_VALUE,ne.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,ne.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(de=2146435072,Ie=new Float64Array(1),Re=new Int32Array(Ie.buffer),ne.doubleToLongBits=function(i){Ie[0]=i;var e=0|Re[0],t=0|Re[1];return(t&de)===de&&1048575&t&&e!==0&&(e=0,t=2146959360),new qe(t,e)},ne.longBitsToDouble=function(i){return Re[0]=i.low,Re[1]=i.high,Ie[0]}):(pe=1023,_e=Math.log2,me=Math.floor,xe=Math.pow,H=(function(){for(var i=53;i>0;i--){var e=xe(2,i)-1;if(me(_e(e))+1===i)return e}return 0})(),ne.doubleToLongBits=function(i){var e,t,n,r,s,o,u,m,y;if(i<0||1/i===Number.NEGATIVE_INFINITY?(o=1<<31,i=-i):o=0,i===0)return new qe(m=o,y=0);if(i===1/0)return new qe(m=2146435072|o,y=0);if(i!=i)return new qe(m=2146959360,y=0);if(r=0,y=0,(e=me(i))>1)if(e<=H)(r=me(_e(e)))<=20?(y=0,m=e<<20-r&1048575):(y=e%(t=xe(2,n=r-20))<<32-n,m=e/t&1048575);else for(n=e,y=0;(n=me(t=n/2))!==0;)r++,y>>>=1,y|=(1&m)<<31,m>>>=1,t!==n&&(m|=524288);if(u=r+pe,s=e===0,e=i-e,r<52&&e!==0)for(n=0;;){if((t=2*e)>=1?(e=t-1,s?(u--,s=!1):(n<<=1,n|=1,r++)):(e=t,s?--u==0&&(r++,s=!1):(n<<=1,r++)),r===20)m|=n,n=0;else if(r===52){y|=n;break}if(t===1){r<20?m|=n<<20-r:r<52&&(y|=n<<52-r);break}}return m|=u<<20,new qe(m|=o,y)},ne.longBitsToDouble=function(i){var e,t,n,r,s=i.high,o=i.low,u=s&1<<31?-1:1;for(n=((2146435072&s)>>20)-pe,r=0,t=1<<19,e=1;e<=20;e++)s&t&&(r+=xe(2,-e)),t>>>=1;for(t=1<<31,e=21;e<=52;e++)o&t&&(r+=xe(2,-e)),t>>>=1;if(n===-1023){if(r===0)return 0*u;n=-1022}else{if(n===1024)return r===0?u/0:NaN;r+=1}return u*r*xe(2,n)});var Be=(function(i){function e(t){var n;return c(this,e),(n=h(this,e,[t])).name=Object.keys({RuntimeException:e})[0],n}return p(e,i),d(e)})(K),Le=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,null,[{key:"constructor_",value:function(){if(arguments.length===0)Be.constructor_.call(this);else if(arguments.length===1){var t=arguments[0];Be.constructor_.call(this,t)}}}])})(Be),ke=(function(){function i(){c(this,i)}return d(i,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)i.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new Le("Should never reach here"+(e!==null?": "+e:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var e=arguments[0];i.isTrue(e,null)}else if(arguments.length===2){var t=arguments[1];if(!arguments[0])throw t===null?new Le:new Le(t)}}},{key:"equals",value:function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];i.equals(e,t,null)}else if(arguments.length===3){var n=arguments[0],r=arguments[1],s=arguments[2];if(!r.equals(n))throw new Le("Expected "+n+" but encountered "+r+(s!==null?": "+s:""))}}}])})(),Te=new ArrayBuffer(8),hi=new Float64Array(Te),Yn=new Int32Array(Te),M=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"getM",value:function(){return ne.NaN}},{key:"setOrdinate",value:function(e,t){switch(e){case i.X:this.x=t;break;case i.Y:this.y=t;break;case i.Z:this.setZ(t);break;default:throw new Y("Invalid ordinate index: "+e)}}},{key:"equals2D",value:function(){if(arguments.length===1){var e=arguments[0];return this.x===e.x&&this.y===e.y}if(arguments.length===2){var t=arguments[0],n=arguments[1];return!!Fe.equalsWithTolerance(this.x,t.x,n)&&!!Fe.equalsWithTolerance(this.y,t.y,n)}}},{key:"setM",value:function(e){throw new Y("Invalid ordinate index: "+i.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(e){switch(e){case i.X:return this.x;case i.Y:return this.y;case i.Z:return this.getZ()}throw new Y("Invalid ordinate index: "+e)}},{key:"equals3D",value:function(e){return this.x===e.x&&this.y===e.y&&(this.getZ()===e.getZ()||ne.isNaN(this.getZ())&&ne.isNaN(e.getZ()))}},{key:"equals",value:function(e){return e instanceof i&&this.equals2D(e)}},{key:"equalInZ",value:function(e,t){return Fe.equalsWithTolerance(this.getZ(),e.getZ(),t)}},{key:"setX",value:function(e){this.x=e}},{key:"compareTo",value:function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(e){this.z=e}},{key:"clone",value:function(){try{return null}catch(e){if(e instanceof CloneNotSupportedException)return ke.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw e}}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.getZ()-e.getZ();return Math.sqrt(t*t+n*n+r*r)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(e){this.y=e}},{key:"distance",value:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)}},{key:"hashCode",value:function(){var e=17;return e=37*(e=37*e+i.hashCode(this.x))+i.hashCode(this.y)}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ()}},{key:"interfaces_",get:function(){return[W,$,Q]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)i.constructor_.call(this,0,0);else if(arguments.length===1){var e=arguments[0];i.constructor_.call(this,e.x,e.y,e.getZ())}else if(arguments.length===2){var t=arguments[0],n=arguments[1];i.constructor_.call(this,t,n,i.NULL_ORDINATE)}else if(arguments.length===3){var r=arguments[0],s=arguments[1],o=arguments[2];this.x=r,this.y=s,this.z=o}}},{key:"hashCode",value:function(e){return hi[0]=e,Yn[0]^Yn[1]}}])})(),fi=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"compare",value:function(e,t){var n=i.compare(e.x,t.x);if(n!==0)return n;var r=i.compare(e.y,t.y);return r!==0?r:this._dimensionsToTest<=2?0:i.compare(e.getZ(),t.getZ())}},{key:"interfaces_",get:function(){return[Ge]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)i.constructor_.call(this,2);else if(arguments.length===1){var e=arguments[0];if(e!==2&&e!==3)throw new Y("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}}},{key:"compare",value:function(e,t){return e<t?-1:e>t?1:ne.isNaN(e)?ne.isNaN(t)?0:-1:ne.isNaN(t)?1:0}}])})();M.DimensionalComparator=fi,M.NULL_ORDINATE=ne.NaN,M.X=0,M.Y=1,M.Z=2,M.M=3;var Me=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(e){if(!(e instanceof i))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()}},{key:"intersection",value:function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new i;var t=this._minx>e._minx?this._minx:e._minx,n=this._miny>e._miny?this._miny:e._miny;return new i(t,this._maxx<e._maxx?this._maxx:e._maxx,n,this._maxy<e._maxy?this._maxy:e._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof M){var e=arguments[0];return this.covers(e.x,e.y)}if(arguments[0]instanceof i){var t=arguments[0];return!this.isNull()&&!t.isNull()&&t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return!this.isNull()&&n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof i){var e=arguments[0];return!this.isNull()&&!e.isNull()&&!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}if(arguments[0]instanceof M){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){if(arguments[0]instanceof M&&arguments[1]instanceof M){var n=arguments[0],r=arguments[1];return!this.isNull()&&!((n.x<r.x?n.x:r.x)>this._maxx)&&!((n.x>r.x?n.x:r.x)<this._minx)&&!((n.y<r.y?n.y:r.y)>this._maxy)&&!((n.y>r.y?n.y:r.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],o=arguments[1];return!this.isNull()&&!(s>this._maxx||s<this._minx||o>this._maxy||o<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return Math.sqrt(e*e+t*t)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof M){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof i){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0}},{key:"translate",value:function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(e){return!(!this.isNull()&&!e.isNull())||e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t}},{key:"expandBy",value:function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof i){var e=arguments[0];return this.covers(e)}if(arguments[0]instanceof M){var t=arguments[0];return this.covers(t)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.covers(n,r)}}},{key:"centre",value:function(){return this.isNull()?null:new M((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof M){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof i){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(arguments.length===4){var s=arguments[0],o=arguments[1],u=arguments[2],m=arguments[3];s<o?(this._minx=s,this._maxx=o):(this._minx=o,this._maxx=s),u<m?(this._miny=u,this._maxy=m):(this._miny=m,this._maxy=u)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),t===0?n:n===0?t:Math.sqrt(t*t+n*n)}},{key:"hashCode",value:function(){var e=17;return e=37*(e=37*(e=37*(e=37*e+M.hashCode(this._minx))+M.hashCode(this._maxx))+M.hashCode(this._miny))+M.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[W,Q]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof M){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof i){var t=arguments[0];this.init(t)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(arguments.length===4){var s=arguments[0],o=arguments[1],u=arguments[2],m=arguments[3];this.init(s,o,u,m)}}},{key:"intersects",value:function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(e.x<t.x?e.x:t.x)&&n.x<=(e.x>t.x?e.x:t.x)&&n.y>=(e.y<t.y?e.y:t.y)&&n.y<=(e.y>t.y?e.y:t.y)}if(arguments.length===4){var r=arguments[0],s=arguments[1],o=arguments[2],u=arguments[3],m=Math.min(o.x,u.x),y=Math.max(o.x,u.x),T=Math.min(r.x,s.x),R=Math.max(r.x,s.x);return!(T>y)&&!(R<m)&&(m=Math.min(o.y,u.y),y=Math.max(o.y,u.y),T=Math.min(r.y,s.y),R=Math.max(r.y,s.y),!(T>y)&&!(R<m))}}}])})(),oe=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===i.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(e){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(e){return this===e||this.equalsExact(e,0)}},{key:"geometryChanged",value:function(){this.apply(i.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(e){return e!==null&&this.norm().equalsExact(e.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var e;if(arguments.length===1){var t=arguments[0];return e=t,this.getTypeCode()!==e.getTypeCode()?this.getTypeCode()-e.getTypeCode():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(arguments.length===2){var n=arguments[0],r=arguments[1];return e=n,this.getTypeCode()!==e.getTypeCode()?this.getTypeCode()-e.getTypeCode():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(n,r)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(e){if(e.getTypeCode()===i.TYPECODE_GEOMETRYCOLLECTION)throw new Y("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(e,t,n){return n===0?e.equals(t):e.distance(t)<=n}},{key:"norm",value:function(){var e=this.copy();return e.normalize(),e}},{key:"reverse",value:function(){var e=this.reverseInternal();return this.envelope!=null&&(e.envelope=this.envelope.copy()),e.setSRID(this.getSRID()),e}},{key:"copy",value:function(){var e=this.copyInternal();return e.envelope=this._envelope==null?null:this._envelope.copy(),e._SRID=this._SRID,e._userData=this._userData,e}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Me(this._envelope)}},{key:"setSRID",value:function(e){this._SRID=e}},{key:"setUserData",value:function(e){this._userData=e}},{key:"compare",value:function(e,t){for(var n=e.iterator(),r=t.iterator();n.hasNext()&&r.hasNext();){var s=n.next(),o=r.next(),u=s.compareTo(o);if(u!==0)return u}return n.hasNext()?1:r.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(e){return this.getClass()===e.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===i.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===i.TYPECODE_MULTIPOINT||this.getTypeCode()===i.TYPECODE_MULTILINESTRING||this.getTypeCode()===i.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[$,W,Q]}},{key:"getClass",value:function(){return i}}],[{key:"hasNonEmptyElements",value:function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(e){for(var t=0;t<e.length;t++)if(e[t]===null)return!0;return!1}}])})();oe.constructor_=function(i){i&&(this._envelope=null,this._userData=null,this._factory=i,this._SRID=i.getSRID())},oe.TYPECODE_POINT=0,oe.TYPECODE_MULTIPOINT=1,oe.TYPECODE_LINESTRING=2,oe.TYPECODE_LINEARRING=3,oe.TYPECODE_MULTILINESTRING=4,oe.TYPECODE_POLYGON=5,oe.TYPECODE_MULTIPOLYGON=6,oe.TYPECODE_GEOMETRYCOLLECTION=7,oe.TYPENAME_POINT="Point",oe.TYPENAME_MULTIPOINT="MultiPoint",oe.TYPENAME_LINESTRING="LineString",oe.TYPENAME_LINEARRING="LinearRing",oe.TYPENAME_MULTILINESTRING="MultiLineString",oe.TYPENAME_POLYGON="Polygon",oe.TYPENAME_MULTIPOLYGON="MultiPolygon",oe.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",oe.geometryChangedFilter={get interfaces_(){return[B]},filter:function(i){i.geometryChangedAction()}};var x=(function(){function i(){c(this,i)}return d(i,null,[{key:"toLocationSymbol",value:function(e){switch(e){case i.EXTERIOR:return"e";case i.BOUNDARY:return"b";case i.INTERIOR:return"i";case i.NONE:return"-"}throw new Y("Unknown location value: "+e)}}])})();x.INTERIOR=0,x.BOUNDARY=1,x.EXTERIOR=2,x.NONE=-1;var ze=(function(){return d((function i(){c(this,i)}),[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])})(),Ut=(function(i){function e(t){var n;return c(this,e),(n=h(this,e,[t])).name=Object.keys({NoSuchElementException:e})[0],n}return p(e,i),d(e)})(K),ot=(function(i){function e(t){var n;return c(this,e),(n=h(this,e,[t])).name=Object.keys({UnsupportedOperationException:e})[0],n}return p(e,i),d(e)})(K),an=(function(i){function e(){return c(this,e),h(this,e,arguments)}return p(e,i),d(e,[{key:"contains",value:function(){}}])})(ze),wt=(function(i){function e(t){var n;return c(this,e),(n=h(this,e)).map=new Map,t instanceof ze&&n.addAll(t),n}return p(e,i),d(e,[{key:"contains",value:function(t){var n=t.hashCode?t.hashCode():t;return!!this.map.has(n)}},{key:"add",value:function(t){var n=t.hashCode?t.hashCode():t;return!this.map.has(n)&&!!this.map.set(n,t)}},{key:"addAll",value:function(t){var n,r=b(t);try{for(r.s();!(n=r.n()).done;){var s=n.value;this.add(s)}}catch(o){r.e(o)}finally{r.f()}return!0}},{key:"remove",value:function(){throw new ot}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new In(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])})(an),In=(function(){return d((function i(e){c(this,i),this.iterator=e.values();var t=this.iterator.next(),n=t.done,r=t.value;this.done=n,this.value=r}),[{key:"next",value:function(){if(this.done)throw new Ut;var i=this.value,e=this.iterator.next(),t=e.done,n=e.value;return this.done=t,this.value=n,i}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new ot}}])})(),q=(function(){function i(){c(this,i)}return d(i,null,[{key:"opposite",value:function(e){return e===i.LEFT?i.RIGHT:e===i.RIGHT?i.LEFT:e}}])})();q.ON=0,q.LEFT=1,q.RIGHT=2;var gi=(function(i){function e(t){var n;return c(this,e),(n=h(this,e,[t])).name=Object.keys({EmptyStackException:e})[0],n}return p(e,i),d(e)})(K),di=(function(i){function e(t){var n;return c(this,e),(n=h(this,e,[t])).name=Object.keys({IndexOutOfBoundsException:e})[0],n}return p(e,i),d(e)})(K),Ct=(function(i){function e(){return c(this,e),h(this,e,arguments)}return p(e,i),d(e,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])})(ze),mi=(function(i){function e(){var t;return c(this,e),(t=h(this,e)).array=[],t}return p(e,i),d(e,[{key:"add",value:function(t){return this.array.push(t),!0}},{key:"get",value:function(t){if(t<0||t>=this.size())throw new di;return this.array[t]}},{key:"push",value:function(t){return this.array.push(t),t}},{key:"pop",value:function(){if(this.array.length===0)throw new gi;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new gi;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(t){return this.array.indexOf(t)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])})(Ct);function ye(i,e){return i.interfaces_&&i.interfaces_.indexOf(e)>-1}var on=(function(){return d((function i(e){c(this,i),this.str=e}),[{key:"append",value:function(i){this.str+=i}},{key:"setCharAt",value:function(i,e){this.str=this.str.substr(0,i)+e+this.str.substr(i+1)}},{key:"toString",value:function(){return this.str}}])})(),un=(function(){function i(e){c(this,i),this.value=e}return d(i,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(e){return this.value<e?-1:this.value>e?1:0}}],[{key:"compare",value:function(e,t){return e<t?-1:e>t?1:0}},{key:"isNan",value:function(e){return Number.isNaN(e)}},{key:"valueOf",value:function(e){return new i(e)}}])})(),ln=(function(){return d((function i(){c(this,i)}),null,[{key:"isWhitespace",value:function(i){return i<=32&&i>=0||i===127}},{key:"toUpperCase",value:function(i){return i.toUpperCase()}}])})(),fe=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"le",value:function(e){return this._hi<e._hi||this._hi===e._hi&&this._lo<=e._lo}},{key:"extractSignificantDigits",value:function(e,t){var n=this.abs(),r=i.magnitude(n._hi),s=i.TEN.pow(r);(n=n.divide(s)).gt(i.TEN)?(n=n.divide(i.TEN),r+=1):n.lt(i.ONE)&&(n=n.multiply(i.TEN),r-=1);for(var o=r+1,u=new on,m=i.MAX_PRINT_DIGITS-1,y=0;y<=m;y++){e&&y===o&&u.append(".");var T=Math.trunc(n._hi);if(T<0)break;var R=!1,G=0;T>9?(R=!0,G="9"):G="0"+T,u.append(G),n=n.subtract(i.valueOf(T)).multiply(i.TEN),R&&n.selfAdd(i.TEN);var J=!0,se=i.magnitude(n._hi);if(se<0&&Math.abs(se)>=m-y&&(J=!1),!J)break}return t[0]=r,u.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof i){var e=arguments[0];return this.add(e.negate())}if(typeof arguments[0]=="number"){var t=arguments[0];return this.add(-t)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof i){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof i){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}if(typeof arguments[0]=="number"){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(e){return this.le(e)?this:e}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof i){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){var n,r,s,o,u=arguments[0],m=arguments[1],y=null,T=null,R=null,G=null;return s=this._hi/u,G=(y=(R=i.SPLIT*s)-(y=R-s))*(T=(G=i.SPLIT*u)-(T=G-u))-(o=s*u)+y*(r=u-T)+(n=s-y)*T+n*r,G=s+(R=(this._hi-o-G+this._lo-s*m)/u),this._hi=G,this._lo=s-G+R,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof i){var e,t,n,r,s=arguments[0],o=null,u=null,m=null,y=null;return e=(n=this._hi/s._hi)-(o=(m=i.SPLIT*n)-(o=m-n)),y=o*(u=(y=i.SPLIT*s._hi)-(u=y-s._hi))-(r=n*s._hi)+o*(t=s._hi-u)+e*u+e*t,new i(y=n+(m=(this._hi-r-y+this._lo-n*s._lo)/s._hi),n-y+m)}if(typeof arguments[0]=="number"){var T=arguments[0];return ne.isNaN(T)?i.createNaN():i.copy(this).selfDivide(T,0)}}},{key:"ge",value:function(e){return this._hi>e._hi||this._hi===e._hi&&this._lo>=e._lo}},{key:"pow",value:function(e){if(e===0)return i.valueOf(1);var t=new i(this),n=i.valueOf(1),r=Math.abs(e);if(r>1)for(;r>0;)r%2==1&&n.selfMultiply(t),(r/=2)>0&&(t=t.sqr());else n=t;return e<0?n.reciprocal():n}},{key:"ceil",value:function(){if(this.isNaN())return i.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new i(e,t)}},{key:"compareTo",value:function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof i){var e=arguments[0];return this.init(e),this}if(typeof arguments[0]=="number"){var t=arguments[0];return this.init(t),this}}},{key:"max",value:function(e){return this.ge(e)?this:e}},{key:"sqrt",value:function(){if(this.isZero())return i.valueOf(0);if(this.isNegative())return i.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,n=i.valueOf(t),r=this.subtract(n.sqr())._hi*(.5*e);return n.add(r)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof i){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}if(typeof arguments[0]=="number"){var t,n,r,s,o,u=arguments[0],m=null;return m=(r=this._hi+u)-(s=r-this._hi),n=(o=(m=u-s+(this._hi-m))+this._lo)+(r-(t=r+o)),this._hi=t+n,this._lo=n+(t-this._hi),this}}else if(arguments.length===2){var y,T,R,G,J=arguments[0],se=arguments[1],ce=null,be=null,Se=null;R=this._hi+J,T=this._lo+se,be=R-(Se=R-this._hi),ce=T-(G=T-this._lo);var Ae=(y=R+(Se=(be=J-Se+(this._hi-be))+T))+(Se=(ce=se-G+(this._lo-ce))+(Se+(R-y))),Qe=Se+(y-Ae);return this._hi=Ae,this._lo=Qe,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof i){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){var n,r,s=arguments[0],o=arguments[1],u=null,m=null,y=null,T=null;u=(y=i.SPLIT*this._hi)-this._hi,T=i.SPLIT*s,u=y-u,n=this._hi-u,m=T-s;var R=(y=this._hi*s)+(T=u*(m=T-m)-y+u*(r=s-m)+n*m+n*r+(this._hi*o+this._lo*s)),G=T+(u=y-R);return this._hi=R,this._lo=G,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return i.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new i(e,t)}},{key:"negate",value:function(){return this.isNaN()?this:new i(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(e){if(e instanceof CloneNotSupportedException)return null;throw e}}},{key:"multiply",value:function(){if(arguments[0]instanceof i){var e=arguments[0];return e.isNaN()?i.createNaN():i.copy(this).selfMultiply(e)}if(typeof arguments[0]=="number"){var t=arguments[0];return ne.isNaN(t)?i.createNaN():i.copy(this).selfMultiply(t,0)}}},{key:"isNaN",value:function(){return ne.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var e=i.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!0,t),r=t[0]+1,s=n;if(n.charAt(0)===".")s="0"+n;else if(r<0)s="0."+i.stringOfChar("0",-r)+n;else if(n.indexOf(".")===-1){var o=r-n.length;s=n+i.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+s:s}},{key:"reciprocal",value:function(){var e,t,n,r,s=null,o=null,u=null,m=null;e=(n=1/this._hi)-(s=(u=i.SPLIT*n)-(s=u-n)),o=(m=i.SPLIT*this._hi)-this._hi;var y=n+(u=(1-(r=n*this._hi)-(m=s*(o=m-o)-r+s*(t=this._hi-o)+e*o+e*t)-n*this._lo)/this._hi);return new i(y,n-y+u)}},{key:"toSciNotation",value:function(){if(this.isZero())return i.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!1,t),r=i.SCI_NOT_EXPONENT_CHAR+t[0];if(n.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+n);var s="";n.length>1&&(s=n.substring(1));var o=n.charAt(0)+"."+s;return this.isNegative()?"-"+o+r:o+r}},{key:"abs",value:function(){return this.isNaN()?i.NaN:this.isNegative()?this.negate():new i(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(e){return this._hi<e._hi||this._hi===e._hi&&this._lo<e._lo}},{key:"add",value:function(){if(arguments[0]instanceof i){var e=arguments[0];return i.copy(this).selfAdd(e)}if(typeof arguments[0]=="number"){var t=arguments[0];return i.copy(this).selfAdd(t)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof i){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}}},{key:"gt",value:function(e){return this._hi>e._hi||this._hi===e._hi&&this._lo>e._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?i.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[Q,W,$]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof i){var t=arguments[0];this.init(t)}else if(typeof arguments[0]=="string"){var n=arguments[0];i.constructor_.call(this,i.parse(n))}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];this.init(r,s)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];return i.determinant(i.valueOf(e),i.valueOf(t),i.valueOf(n),i.valueOf(r))}if(arguments[3]instanceof i&&arguments[2]instanceof i&&arguments[0]instanceof i&&arguments[1]instanceof i){var s=arguments[1],o=arguments[2],u=arguments[3];return arguments[0].multiply(u).selfSubtract(s.multiply(o))}}},{key:"sqr",value:function(e){return i.valueOf(e).selfMultiply(e)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var e=arguments[0];return i.parse(e)}if(typeof arguments[0]=="number")return new i(arguments[0])}},{key:"sqrt",value:function(e){return i.valueOf(e).sqrt()}},{key:"parse",value:function(e){for(var t=0,n=e.length;ln.isWhitespace(e.charAt(t));)t++;var r=!1;if(t<n){var s=e.charAt(t);s!=="-"&&s!=="+"||(t++,s==="-"&&(r=!0))}for(var o=new i,u=0,m=0,y=0,T=!1;!(t>=n);){var R=e.charAt(t);if(t++,ln.isDigit(R)){var G=R-"0";o.selfMultiply(i.TEN),o.selfAdd(G),u++}else{if(R!=="."){if(R==="e"||R==="E"){var J=e.substring(t);try{y=un.parseInt(J)}catch(Ae){throw Ae instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+J+" in string "+e):Ae}break}throw new NumberFormatException("Unexpected character '"+R+"' at position "+t+" in string "+e)}m=u,T=!0}}var se=o;T||(m=u);var ce=u-m-y;if(ce===0)se=o;else if(ce>0){var be=i.TEN.pow(ce);se=o.divide(be)}else if(ce<0){var Se=i.TEN.pow(-ce);se=o.multiply(Se)}return r?se.negate():se}},{key:"createNaN",value:function(){return new i(ne.NaN,ne.NaN)}},{key:"copy",value:function(e){return new i(e)}},{key:"magnitude",value:function(e){var t=Math.abs(e),n=Math.log(t)/Math.log(10),r=Math.trunc(Math.floor(n));return 10*Math.pow(10,r)<=t&&(r+=1),r}},{key:"stringOfChar",value:function(e,t){for(var n=new on,r=0;r<t;r++)n.append(e);return n.toString()}}])})();fe.PI=new fe(3.141592653589793,12246467991473532e-32),fe.TWO_PI=new fe(6.283185307179586,24492935982947064e-32),fe.PI_2=new fe(1.5707963267948966,6123233995736766e-32),fe.E=new fe(2.718281828459045,14456468917292502e-32),fe.NaN=new fe(ne.NaN,ne.NaN),fe.EPS=123259516440783e-46,fe.SPLIT=134217729,fe.MAX_PRINT_DIGITS=32,fe.TEN=fe.valueOf(10),fe.ONE=fe.valueOf(1),fe.SCI_NOT_EXPONENT_CHAR="E",fe.SCI_NOT_ZERO="0.0E0";var Sn=(function(){function i(){c(this,i)}return d(i,null,[{key:"orientationIndex",value:function(e,t,n){var r=i.orientationIndexFilter(e,t,n);if(r<=1)return r;var s=fe.valueOf(t.x).selfAdd(-e.x),o=fe.valueOf(t.y).selfAdd(-e.y),u=fe.valueOf(n.x).selfAdd(-t.x),m=fe.valueOf(n.y).selfAdd(-t.y);return s.selfMultiply(m).selfSubtract(o.selfMultiply(u)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof fe&&arguments[2]instanceof fe&&arguments[0]instanceof fe&&arguments[1]instanceof fe){var e=arguments[1],t=arguments[2],n=arguments[3];return arguments[0].multiply(n).selfSubtract(e.multiply(t)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],s=arguments[1],o=arguments[2],u=arguments[3],m=fe.valueOf(r),y=fe.valueOf(s),T=fe.valueOf(o),R=fe.valueOf(u);return m.multiply(R).selfSubtract(y.multiply(T)).signum()}}},{key:"intersection",value:function(e,t,n,r){var s=new fe(e.y).selfSubtract(t.y),o=new fe(t.x).selfSubtract(e.x),u=new fe(e.x).selfMultiply(t.y).selfSubtract(new fe(t.x).selfMultiply(e.y)),m=new fe(n.y).selfSubtract(r.y),y=new fe(r.x).selfSubtract(n.x),T=new fe(n.x).selfMultiply(r.y).selfSubtract(new fe(r.x).selfMultiply(n.y)),R=o.multiply(T).selfSubtract(y.multiply(u)),G=m.multiply(u).selfSubtract(s.multiply(T)),J=s.multiply(y).selfSubtract(m.multiply(o)),se=R.selfDivide(J).doubleValue(),ce=G.selfDivide(J).doubleValue();return ne.isNaN(se)||ne.isInfinite(se)||ne.isNaN(ce)||ne.isInfinite(ce)?null:new M(se,ce)}},{key:"orientationIndexFilter",value:function(e,t,n){var r=null,s=(e.x-n.x)*(t.y-n.y),o=(e.y-n.y)*(t.x-n.x),u=s-o;if(s>0){if(o<=0)return i.signum(u);r=s+o}else{if(!(s<0)||o>=0)return i.signum(u);r=-s-o}var m=i.DP_SAFE_EPSILON*r;return u>=m||-u>=m?i.signum(u):2}},{key:"signum",value:function(e){return e>0?1:e<0?-1:0}}])})();Sn.DP_SAFE_EPSILON=1e-15;var Ne=(function(){return d((function i(){c(this,i)}),[{key:"getM",value:function(i){if(this.hasM()){var e=this.getDimension()-this.getMeasures();return this.getOrdinate(i,e)}return ne.NaN}},{key:"setOrdinate",value:function(i,e,t){}},{key:"getZ",value:function(i){return this.hasZ()?this.getOrdinate(i,2):ne.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(i,e){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(i){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(i){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(i){}},{key:"copy",value:function(){}},{key:"getY",value:function(i){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[$]}}])})();Ne.X=0,Ne.Y=1,Ne.Z=2,Ne.M=3;var ge=(function(){function i(){c(this,i)}return d(i,null,[{key:"index",value:function(e,t,n){return Sn.orientationIndex(e,t,n)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var e=arguments[0],t=e.length-1;if(t<3)throw new Y("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=e[0],r=0,s=1;s<=t;s++){var o=e[s];o.y>n.y&&(n=o,r=s)}var u=r;do(u-=1)<0&&(u=t);while(e[u].equals2D(n)&&u!==r);var m=r;do m=(m+1)%t;while(e[m].equals2D(n)&&m!==r);var y=e[u],T=e[m];if(y.equals2D(n)||T.equals2D(n)||y.equals2D(T))return!1;var R=i.index(y,n,T);return R===0?y.x>T.x:R>0}if(ye(arguments[0],Ne)){var G=arguments[0],J=G.size()-1;if(J<3)throw new Y("Ring has fewer than 4 points, so orientation cannot be determined");for(var se=G.getCoordinate(0),ce=0,be=1;be<=J;be++){var Se=G.getCoordinate(be);Se.y>se.y&&(se=Se,ce=be)}var Ae=null,Qe=ce;do(Qe-=1)<0&&(Qe=J),Ae=G.getCoordinate(Qe);while(Ae.equals2D(se)&&Qe!==ce);var rt=null,kn=ce;do kn=(kn+1)%J,rt=G.getCoordinate(kn);while(rt.equals2D(se)&&kn!==ce);if(Ae.equals2D(se)||rt.equals2D(se)||Ae.equals2D(rt))return!1;var ti=i.index(Ae,se,rt);return ti===0?Ae.x>rt.x:ti>0}}}])})();ge.CLOCKWISE=-1,ge.RIGHT=ge.CLOCKWISE,ge.COUNTERCLOCKWISE=1,ge.LEFT=ge.COUNTERCLOCKWISE,ge.COLLINEAR=0,ge.STRAIGHT=ge.COLLINEAR;var yi=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(i,e){var t=this.getRightmostSideOfSegment(i,e);return t<0&&(t=this.getRightmostSideOfSegment(i,e-1)),t<0&&(this._minCoord=null,this.checkForRightmostCoordinate(i)),t}},{key:"findRightmostEdgeAtVertex",value:function(){var i=this._minDe.getEdge().getCoordinates();ke.isTrue(this._minIndex>0&&this._minIndex<i.length,"rightmost point expected to be interior vertex of edge");var e=i[this._minIndex-1],t=i[this._minIndex+1],n=ge.index(this._minCoord,t,e),r=!1;(e.y<this._minCoord.y&&t.y<this._minCoord.y&&n===ge.COUNTERCLOCKWISE||e.y>this._minCoord.y&&t.y>this._minCoord.y&&n===ge.CLOCKWISE)&&(r=!0),r&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(i,e){var t=i.getEdge().getCoordinates();if(e<0||e+1>=t.length||t[e].y===t[e+1].y)return-1;var n=q.LEFT;return t[e].y<t[e+1].y&&(n=q.RIGHT),n}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(i){for(var e=i.getEdge().getCoordinates(),t=0;t<e.length-1;t++)(this._minCoord===null||e[t].x>this._minCoord.x)&&(this._minDe=i,this._minIndex=t,this._minCoord=e[t])}},{key:"findRightmostEdgeAtNode",value:function(){var i=this._minDe.getNode().getEdges();this._minDe=i.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(i){for(var e=i.iterator();e.hasNext();){var t=e.next();t.isForward()&&this.checkForRightmostCoordinate(t)}ke.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===q.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])})(),ut=(function(i){function e(t,n){var r;return c(this,e),(r=h(this,e,[n?t+" [ "+n+" ]":t])).pt=n?new M(n):void 0,r.name=Object.keys({TopologyException:e})[0],r}return p(e,i),d(e,[{key:"getCoordinate",value:function(){return this.pt}}])})(Be),dt=(function(){return d((function i(){c(this,i),this.array=[]}),[{key:"addLast",value:function(i){this.array.push(i)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])})(),he=(function(i){function e(t){var n;return c(this,e),(n=h(this,e)).array=[],t instanceof ze&&n.addAll(t),n}return p(e,i),d(e,[{key:"interfaces_",get:function(){return[Ct,ze]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(t){return arguments.length===1?this.array.push(t):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(t){var n,r=b(t);try{for(r.s();!(n=r.n()).done;){var s=n.value;this.array.push(s)}}catch(o){r.e(o)}finally{r.f()}}},{key:"set",value:function(t,n){var r=this.array[t];return this.array[t]=n,r}},{key:"iterator",value:function(){return new He(this)}},{key:"get",value:function(t){if(t<0||t>=this.size())throw new di;return this.array[t]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(t){t?this.array.sort((function(n,r){return t.compare(n,r)})):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(t){for(var n=0,r=this.array.length;n<r;n++)if(this.array[n]===t)return!!this.array.splice(n,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])})(Ct),He=(function(){return d((function i(e){c(this,i),this.arrayList=e,this.position=0}),[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Ut;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(i){return this.arrayList.set(this.position-1,i)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])})(),wn=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"clearVisitedEdges",value:function(){for(var i=this._dirEdgeList.iterator();i.hasNext();)i.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(i){for(var e=null,t=i.getEdges().iterator();t.hasNext();){var n=t.next();if(n.isVisited()||n.getSym().isVisited()){e=n;break}}if(e===null)throw new ut("unable to find edge to compute depths at "+i.getCoordinate());i.getEdges().computeDepths(e);for(var r=i.getEdges().iterator();r.hasNext();){var s=r.next();s.setVisited(!0),this.copySymDepths(s)}}},{key:"computeDepth",value:function(i){this.clearVisitedEdges();var e=this._finder.getEdge();e.getNode(),e.getLabel(),e.setEdgeDepths(q.RIGHT,i),this.copySymDepths(e),this.computeDepths(e)}},{key:"create",value:function(i){this.addReachable(i),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var i=this._dirEdgeList.iterator();i.hasNext();){var e=i.next();e.getDepth(q.RIGHT)>=1&&e.getDepth(q.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}}},{key:"computeDepths",value:function(i){var e=new wt,t=new dt,n=i.getNode();for(t.addLast(n),e.add(n),i.setVisited(!0);!t.isEmpty();){var r=t.removeFirst();e.add(r),this.computeNodeDepth(r);for(var s=r.getEdges().iterator();s.hasNext();){var o=s.next().getSym();if(!o.isVisited()){var u=o.getNode();e.contains(u)||(t.addLast(u),e.add(u))}}}}},{key:"compareTo",value:function(i){var e=i;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var i=new Me,e=this._dirEdgeList.iterator();e.hasNext();)for(var t=e.next().getEdge().getCoordinates(),n=0;n<t.length-1;n++)i.expandToInclude(t[n]);this._env=i}return this._env}},{key:"addReachable",value:function(i){var e=new mi;for(e.add(i);!e.empty();){var t=e.pop();this.add(t,e)}}},{key:"copySymDepths",value:function(i){var e=i.getSym();e.setDepth(q.LEFT,i.getDepth(q.RIGHT)),e.setDepth(q.RIGHT,i.getDepth(q.LEFT))}},{key:"add",value:function(i,e){i.setVisited(!0),this._nodes.add(i);for(var t=i.getEdges().iterator();t.hasNext();){var n=t.next();this._dirEdgeList.add(n);var r=n.getSym().getNode();r.isVisited()||e.push(r)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new he,this._nodes=new he,this._rightMostCoord=null,this._env=null,this._finder=new yi}}])})(),cn=(function(){return d((function i(){c(this,i)}),null,[{key:"intersection",value:function(i,e,t,n){var r=i.x<e.x?i.x:e.x,s=i.y<e.y?i.y:e.y,o=i.x>e.x?i.x:e.x,u=i.y>e.y?i.y:e.y,m=t.x<n.x?t.x:n.x,y=t.y<n.y?t.y:n.y,T=t.x>n.x?t.x:n.x,R=t.y>n.y?t.y:n.y,G=((r>m?r:m)+(o<T?o:T))/2,J=((s>y?s:y)+(u<R?u:R))/2,se=i.x-G,ce=i.y-J,be=e.x-G,Se=e.y-J,Ae=t.x-G,Qe=t.y-J,rt=n.x-G,kn=n.y-J,ti=ce-Se,ns=be-se,is=se*Se-be*ce,rs=Qe-kn,ss=rt-Ae,as=Ae*kn-rt*Qe,os=ti*ss-rs*ns,gr=(ns*as-ss*is)/os,dr=(rs*is-ti*as)/os;return ne.isNaN(gr)||ne.isInfinite(gr)||ne.isNaN(dr)||ne.isInfinite(dr)?null:new M(gr+G,dr+J)}}])})(),et=(function(){return d((function i(){c(this,i)}),null,[{key:"arraycopy",value:function(i,e,t,n,r){for(var s=0,o=e;o<e+r;o++)t[n+s]=i[o],s++}},{key:"getProperty",value:function(i){return{"line.separator":"\n"}[i]}}])})(),We=(function(){function i(){c(this,i)}return d(i,null,[{key:"log10",value:function(e){var t=Math.log(e);return ne.isInfinite(t)||ne.isNaN(t)?t:t/i.LOG_10}},{key:"min",value:function(e,t,n,r){var s=e;return t<s&&(s=t),n<s&&(s=n),r<s&&(s=r),s}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1],n=arguments[2];return e<t?t:e>n?n:e}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],s=arguments[1],o=arguments[2];return r<s?s:r>o?o:r}}},{key:"wrap",value:function(e,t){return e<0?t- -e%t:e%t}},{key:"max",value:function(){if(arguments.length===3){var e=arguments[1],t=arguments[2],n=arguments[0];return e>n&&(n=e),t>n&&(n=t),n}if(arguments.length===4){var r=arguments[1],s=arguments[2],o=arguments[3],u=arguments[0];return r>u&&(u=r),s>u&&(u=s),o>u&&(u=o),u}}},{key:"average",value:function(e,t){return(e+t)/2}}])})();We.LOG_10=Math.log(10);var mt=(function(){function i(){c(this,i)}return d(i,null,[{key:"segmentToSegment",value:function(e,t,n,r){if(e.equals(t))return i.pointToSegment(e,n,r);if(n.equals(r))return i.pointToSegment(r,e,t);var s=!1;if(Me.intersects(e,t,n,r)){var o=(t.x-e.x)*(r.y-n.y)-(t.y-e.y)*(r.x-n.x);if(o===0)s=!0;else{var u=(e.y-n.y)*(r.x-n.x)-(e.x-n.x)*(r.y-n.y),m=((e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y))/o,y=u/o;(y<0||y>1||m<0||m>1)&&(s=!0)}}else s=!0;return s?We.min(i.pointToSegment(e,n,r),i.pointToSegment(t,n,r),i.pointToSegment(n,e,t),i.pointToSegment(r,e,t)):0}},{key:"pointToSegment",value:function(e,t,n){if(t.x===n.x&&t.y===n.y)return e.distance(t);var r=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),s=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/r;if(s<=0)return e.distance(t);if(s>=1)return e.distance(n);var o=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/r;return Math.abs(o)*Math.sqrt(r)}},{key:"pointToLinePerpendicular",value:function(e,t,n){var r=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),s=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/r;return Math.abs(s)*Math.sqrt(r)}},{key:"pointToSegmentString",value:function(e,t){if(t.length===0)throw new Y("Line array must contain at least one vertex");for(var n=e.distance(t[0]),r=0;r<t.length-1;r++){var s=i.pointToSegment(e,t[r],t[r+1]);s<n&&(n=s)}return n}}])})(),Bt=(function(){return d((function i(){c(this,i)}),[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||ye(arguments[0],Ne);else if(arguments.length!==2){if(arguments.length===3){var i=arguments[0],e=arguments[1];return this.create(i,e)}}}}])})(),Lt=(function(){return d((function i(){c(this,i)}),[{key:"filter",value:function(i){}}])})(),hn=(function(){return d((function i(){c(this,i)}),null,[{key:"ofLine",value:function(i){var e=i.size();if(e<=1)return 0;var t=0,n=new M;i.getCoordinate(0,n);for(var r=n.x,s=n.y,o=1;o<e;o++){i.getCoordinate(o,n);var u=n.x,m=n.y,y=u-r,T=m-s;t+=Math.sqrt(y*y+T*T),r=u,s=m}return t}}])})(),Vt=d((function i(){c(this,i)})),tt=(function(){function i(){c(this,i)}return d(i,null,[{key:"copyCoord",value:function(e,t,n,r){for(var s=Math.min(e.getDimension(),n.getDimension()),o=0;o<s;o++)n.setOrdinate(r,o,e.getOrdinate(t,o))}},{key:"isRing",value:function(e){var t=e.size();return t===0||!(t<=3)&&e.getOrdinate(0,Ne.X)===e.getOrdinate(t-1,Ne.X)&&e.getOrdinate(0,Ne.Y)===e.getOrdinate(t-1,Ne.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(ye(arguments[0],Ne)&&Number.isInteger(arguments[1])){var e=arguments[0],t=arguments[1];i.scroll(e,t,i.isRing(e))}else if(ye(arguments[0],Ne)&&arguments[1]instanceof M){var n=arguments[0],r=arguments[1],s=i.indexOf(r,n);if(s<=0)return null;i.scroll(n,s)}}else if(arguments.length===3){var o=arguments[0],u=arguments[1],m=arguments[2];if(u<=0)return null;for(var y=o.copy(),T=m?o.size()-1:o.size(),R=0;R<T;R++)for(var G=0;G<o.getDimension();G++)o.setOrdinate(R,G,y.getOrdinate((u+R)%T,G));if(m)for(var J=0;J<o.getDimension();J++)o.setOrdinate(T,J,o.getOrdinate(0,J))}}},{key:"isEqual",value:function(e,t){var n=e.size();if(n!==t.size())return!1;for(var r=Math.min(e.getDimension(),t.getDimension()),s=0;s<n;s++)for(var o=0;o<r;o++){var u=e.getOrdinate(s,o),m=t.getOrdinate(s,o);if(e.getOrdinate(s,o)!==t.getOrdinate(s,o)&&(!ne.isNaN(u)||!ne.isNaN(m)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var e=arguments[0];return i.minCoordinateIndex(e,0,e.size()-1)}if(arguments.length===3){for(var t=arguments[0],n=arguments[2],r=-1,s=null,o=arguments[1];o<=n;o++){var u=t.getCoordinate(o);(s===null||s.compareTo(u)>0)&&(s=u,r=o)}return r}}},{key:"extend",value:function(e,t,n){var r=e.create(n,t.getDimension()),s=t.size();if(i.copy(t,0,r,0,s),s>0)for(var o=s;o<n;o++)i.copy(t,s-1,r,o,1);return r}},{key:"reverse",value:function(e){for(var t=e.size()-1,n=Math.trunc(t/2),r=0;r<=n;r++)i.swap(e,r,t-r)}},{key:"swap",value:function(e,t,n){if(t===n)return null;for(var r=0;r<e.getDimension();r++){var s=e.getOrdinate(t,r);e.setOrdinate(t,r,e.getOrdinate(n,r)),e.setOrdinate(n,r,s)}}},{key:"copy",value:function(e,t,n,r,s){for(var o=0;o<s;o++)i.copyCoord(e,t+o,n,r+o)}},{key:"ensureValidRing",value:function(e,t){var n=t.size();return n===0?t:n<=3?i.createClosedRing(e,t,4):t.getOrdinate(0,Ne.X)===t.getOrdinate(n-1,Ne.X)&&t.getOrdinate(0,Ne.Y)===t.getOrdinate(n-1,Ne.Y)?t:i.createClosedRing(e,t,n+1)}},{key:"indexOf",value:function(e,t){for(var n=0;n<t.size();n++)if(e.x===t.getOrdinate(n,Ne.X)&&e.y===t.getOrdinate(n,Ne.Y))return n;return-1}},{key:"createClosedRing",value:function(e,t,n){var r=e.create(n,t.getDimension()),s=t.size();i.copy(t,0,r,0,s);for(var o=s;o<n;o++)i.copy(t,0,r,o,1);return r}},{key:"minCoordinate",value:function(e){for(var t=null,n=0;n<e.size();n++){var r=e.getCoordinate(n);(t===null||t.compareTo(r)>0)&&(t=r)}return t}}])})(),V=(function(){function i(){c(this,i)}return d(i,null,[{key:"toDimensionSymbol",value:function(e){switch(e){case i.FALSE:return i.SYM_FALSE;case i.TRUE:return i.SYM_TRUE;case i.DONTCARE:return i.SYM_DONTCARE;case i.P:return i.SYM_P;case i.L:return i.SYM_L;case i.A:return i.SYM_A}throw new Y("Unknown dimension value: "+e)}},{key:"toDimensionValue",value:function(e){switch(ln.toUpperCase(e)){case i.SYM_FALSE:return i.FALSE;case i.SYM_TRUE:return i.TRUE;case i.SYM_DONTCARE:return i.DONTCARE;case i.SYM_P:return i.P;case i.SYM_L:return i.L;case i.SYM_A:return i.A}throw new Y("Unknown dimension symbol: "+e)}}])})();V.P=0,V.L=1,V.A=2,V.FALSE=-1,V.TRUE=-2,V.DONTCARE=-3,V.SYM_FALSE="F",V.SYM_TRUE="T",V.SYM_DONTCARE="*",V.SYM_P="0",V.SYM_L="1",V.SYM_A="2";var ft=(function(){return d((function i(){c(this,i)}),[{key:"filter",value:function(i){}}])})(),Gt=(function(){return d((function i(){c(this,i)}),[{key:"filter",value:function(i,e){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])})(),Xt=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new Me:this._points.expandEnvelope(new Me)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new e(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof oe){var t=arguments[0],n=arguments[1];if(!this.isEquivalentClass(t))return!1;var r=t;if(this._points.size()!==r._points.size())return!1;for(var s=0;s<this._points.size();s++)if(!this.equal(this._points.getCoordinate(s),r._points.getCoordinate(s),n))return!1;return!0}return w(e,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var t=0;t<Math.trunc(this._points.size()/2);t++){var n=this._points.size()-1-t;if(!this._points.getCoordinate(t).equals(this._points.getCoordinate(n))){if(this._points.getCoordinate(t).compareTo(this._points.getCoordinate(n))>0){var r=this._points.copy();tt.reverse(r),this._points=r}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?V.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var t=this._points.copy();return tt.reverse(t),this.getFactory().createLineString(t)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return oe.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return hn.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var t=arguments[0],n=0,r=0;n<this._points.size()&&r<t._points.size();){var s=this._points.getCoordinate(n).compareTo(t._points.getCoordinate(r));if(s!==0)return s;n++,r++}return n<this._points.size()?1:r<t._points.size()?-1:0}if(arguments.length===2){var o=arguments[0];return arguments[1].compare(this._points,o._points)}}},{key:"apply",value:function(){if(ye(arguments[0],Lt))for(var t=arguments[0],n=0;n<this._points.size();n++)t.filter(this._points.getCoordinate(n));else if(ye(arguments[0],Gt)){var r=arguments[0];if(this._points.size()===0)return null;for(var s=0;s<this._points.size()&&(r.filter(this._points,s),!r.isDone());s++);r.isGeometryChanged()&&this.geometryChanged()}else ye(arguments[0],ft)?arguments[0].filter(this):ye(arguments[0],B)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new ot}},{key:"isEquivalentClass",value:function(t){return t instanceof e}},{key:"getCoordinateN",value:function(t){return this._points.getCoordinate(t)}},{key:"getGeometryType",value:function(){return oe.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(t){if(t===null&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),t.size()===1)throw new Y("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t}},{key:"isCoordinate",value:function(t){for(var n=0;n<this._points.size();n++)if(this._points.getCoordinate(n).equals(t))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))}},{key:"interfaces_",get:function(){return[Vt]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var t=arguments[0],n=arguments[1];oe.constructor_.call(this,n),this.init(t)}}}}])})(oe),Un=d((function i(){c(this,i)})),jt=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new Me;var t=new Me;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new e(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof oe){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&(!(!this.isEmpty()||!t.isEmpty())||this.isEmpty()===t.isEmpty()&&this.equal(t.getCoordinate(),this.getCoordinate(),n))}return w(e,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return V.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return oe.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var t=arguments[0];return this.getCoordinate().compareTo(t.getCoordinate())}if(arguments.length===2){var n=arguments[0];return arguments[1].compare(this._coordinates,n._coordinates)}}},{key:"apply",value:function(){if(ye(arguments[0],Lt)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(ye(arguments[0],Gt)){var n=arguments[0];if(this.isEmpty())return null;n.filter(this._coordinates,0),n.isGeometryChanged()&&this.geometryChanged()}else ye(arguments[0],ft)?arguments[0].filter(this):ye(arguments[0],B)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return oe.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(t){t===null&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),ke.isTrue(t.size()<=1),this._coordinates=t}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Un]}}],[{key:"constructor_",value:function(){this._coordinates=null;var t=arguments[0],n=arguments[1];oe.constructor_.call(this,n),this.init(t)}}])})(oe),vi=(function(){function i(){c(this,i)}return d(i,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var e=arguments[0];return Math.abs(i.ofRingSigned(e))}if(ye(arguments[0],Ne)){var t=arguments[0];return Math.abs(i.ofRingSigned(t))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,n=e[0].x,r=1;r<e.length-1;r++){var s=e[r].x-n,o=e[r+1].y;t+=s*(e[r-1].y-o)}return t/2}if(ye(arguments[0],Ne)){var u=arguments[0],m=u.size();if(m<3)return 0;var y=new M,T=new M,R=new M;u.getCoordinate(0,T),u.getCoordinate(1,R);var G=T.x;R.x-=G;for(var J=0,se=1;se<m-1;se++)y.y=T.y,T.x=R.x,T.y=R.y,u.getCoordinate(se+1,R),R.x-=G,J+=T.x*(y.y-R.y);return J/2}}}])})(),qt=(function(){return d((function i(){c(this,i)}),null,[{key:"sort",value:function(){var i=arguments,e=arguments[0];if(arguments.length===1)e.sort((function(G,J){return G.compareTo(J)}));else if(arguments.length===2)e.sort((function(G,J){return i[1].compare(G,J)}));else if(arguments.length===3){var t=e.slice(arguments[1],arguments[2]);t.sort();var n=e.slice(0,arguments[1]).concat(t,e.slice(arguments[2],e.length));e.splice(0,e.length);var r,s=b(n);try{for(s.s();!(r=s.n()).done;){var o=r.value;e.push(o)}}catch(G){s.e(G)}finally{s.f()}}else if(arguments.length===4){var u=e.slice(arguments[1],arguments[2]);u.sort((function(G,J){return i[3].compare(G,J)}));var m=e.slice(0,arguments[1]).concat(u,e.slice(arguments[2],e.length));e.splice(0,e.length);var y,T=b(m);try{for(T.s();!(y=T.n()).done;){var R=y.value;e.push(R)}}catch(G){T.e(G)}finally{T.f()}}}},{key:"asList",value:function(i){var e,t=new he,n=b(i);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.add(r)}}catch(s){n.e(s)}finally{n.f()}return t}},{key:"copyOf",value:function(i,e){return i.slice(0,e)}}])})(),pi=d((function i(){c(this,i)})),Ht=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),n=-1,r=this._shell.getCoordinates(),s=0;s<r.length;s++)t[++n]=r[s];for(var o=0;o<this._holes.length;o++)for(var u=this._holes[o].getCoordinates(),m=0;m<u.length;m++)t[++n]=u[m];return t}},{key:"getArea",value:function(){var t=0;t+=vi.ofRing(this._shell.getCoordinateSequence());for(var n=0;n<this._holes.length;n++)t-=vi.ofRing(this._holes[n].getCoordinateSequence());return t}},{key:"copyInternal",value:function(){for(var t=this._shell.copy(),n=new Array(this._holes.length).fill(null),r=0;r<this._holes.length;r++)n[r]=this._holes[r].copy();return new e(t,n,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var t=this._shell.getCoordinateSequence(),n=this.getEnvelopeInternal(),r=0;r<5;r++){var s=t.getX(r);if(s!==n.getMinX()&&s!==n.getMaxX())return!1;var o=t.getY(r);if(o!==n.getMinY()&&o!==n.getMaxY())return!1}for(var u=t.getX(0),m=t.getY(0),y=1;y<=4;y++){var T=t.getX(y),R=t.getY(y);if(T!==u==(R!==m))return!1;u=T,m=R}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof oe){var t=arguments[0],n=arguments[1];if(!this.isEquivalentClass(t))return!1;var r=t,s=this._shell,o=r._shell;if(!s.equalsExact(o,n)||this._holes.length!==r._holes.length)return!1;for(var u=0;u<this._holes.length;u++)if(!this._holes[u].equalsExact(r._holes[u],n))return!1;return!0}return w(e,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var t=0;t<this._holes.length;t++)this._holes[t]=this.normalized(this._holes[t],!1);qt.sort(this._holes)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(n.isEmpty())return null;var s=n.getCoordinateSequence(),o=tt.minCoordinateIndex(s,0,s.size()-2);tt.scroll(s,o,!0),ge.isCCW(s)===r&&tt.reverse(s)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var t=this.getExteriorRing().reverse(),n=new Array(this.getNumInteriorRing()).fill(null),r=0;r<n.length;r++)n[r]=this.getInteriorRingN(r).reverse();return this.getFactory().createPolygon(t,n)}},{key:"getTypeCode",value:function(){return oe.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var t=0;t+=this._shell.getLength();for(var n=0;n<this._holes.length;n++)t+=this._holes[n].getLength();return t}},{key:"getNumPoints",value:function(){for(var t=this._shell.getNumPoints(),n=0;n<this._holes.length;n++)t+=this._holes[n].getNumPoints();return t}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(t,n){var r=t.copy();return this.normalize(r,n),r}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var t=arguments[0],n=this._shell,r=t._shell;return n.compareToSameClass(r)}if(arguments.length===2){var s=arguments[1],o=arguments[0],u=this._shell,m=o._shell,y=u.compareToSameClass(m,s);if(y!==0)return y;for(var T=this.getNumInteriorRing(),R=o.getNumInteriorRing(),G=0;G<T&&G<R;){var J=this.getInteriorRingN(G),se=o.getInteriorRingN(G),ce=J.compareToSameClass(se,s);if(ce!==0)return ce;G++}return G<T?1:G<R?-1:0}}},{key:"apply",value:function(){if(ye(arguments[0],Lt)){var t=arguments[0];this._shell.apply(t);for(var n=0;n<this._holes.length;n++)this._holes[n].apply(t)}else if(ye(arguments[0],Gt)){var r=arguments[0];if(this._shell.apply(r),!r.isDone())for(var s=0;s<this._holes.length&&(this._holes[s].apply(r),!r.isDone());s++);r.isGeometryChanged()&&this.geometryChanged()}else if(ye(arguments[0],ft))arguments[0].filter(this);else if(ye(arguments[0],B)){var o=arguments[0];o.filter(this),this._shell.apply(o);for(var u=0;u<this._holes.length;u++)this._holes[u].apply(o)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var n=0;n<this._holes.length;n++)t[n+1]=this._holes[n];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)}},{key:"getGeometryType",value:function(){return oe.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(t){return this._holes[t]}},{key:"interfaces_",get:function(){return[pi]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var t=arguments[0],n=arguments[1],r=arguments[2];if(oe.constructor_.call(this,r),t===null&&(t=this.getFactory().createLinearRing()),n===null&&(n=[]),oe.hasNullElements(n))throw new Y("holes must not contain null elements");if(t.isEmpty()&&oe.hasNonEmptyElements(n))throw new Y("shell is empty but holes are not");this._shell=t,this._holes=n}}])})(oe),Qi=(function(i){function e(){return c(this,e),h(this,e,arguments)}return p(e,i),d(e)})(an),yt=(function(i){function e(t){var n;return c(this,e),(n=h(this,e)).array=[],t instanceof ze&&n.addAll(t),n}return p(e,i),d(e,[{key:"contains",value:function(t){var n,r=b(this.array);try{for(r.s();!(n=r.n()).done;)if(n.value.compareTo(t)===0)return!0}catch(s){r.e(s)}finally{r.f()}return!1}},{key:"add",value:function(t){if(this.contains(t))return!1;for(var n=0,r=this.array.length;n<r;n++)if(this.array[n].compareTo(t)===1)return!!this.array.splice(n,0,t);return this.array.push(t),!0}},{key:"addAll",value:function(t){var n,r=b(t);try{for(r.s();!(n=r.n()).done;){var s=n.value;this.add(s)}}catch(o){r.e(o)}finally{r.f()}return!0}},{key:"remove",value:function(){throw new ot}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new bn(this.array)}}])})(Qi),bn=(function(){return d((function i(e){c(this,i),this.array=e,this.position=0}),[{key:"next",value:function(){if(this.position===this.array.length)throw new Ut;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new ot}}])})(),nt=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"computeEnvelopeInternal",value:function(){for(var t=new Me,n=0;n<this._geometries.length;n++)t.expandToInclude(this._geometries[n].getEnvelopeInternal());return t}},{key:"getGeometryN",value:function(t){return this._geometries[t]}},{key:"getCoordinates",value:function(){for(var t=new Array(this.getNumPoints()).fill(null),n=-1,r=0;r<this._geometries.length;r++)for(var s=this._geometries[r].getCoordinates(),o=0;o<s.length;o++)t[++n]=s[o];return t}},{key:"getArea",value:function(){for(var t=0,n=0;n<this._geometries.length;n++)t+=this._geometries[n].getArea();return t}},{key:"copyInternal",value:function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof oe){var t=arguments[0],n=arguments[1];if(!this.isEquivalentClass(t))return!1;var r=t;if(this._geometries.length!==r._geometries.length)return!1;for(var s=0;s<this._geometries.length;s++)if(!this._geometries[s].equalsExact(r._geometries[s],n))return!1;return!0}return w(e,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();qt.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var t=V.FALSE,n=0;n<this._geometries.length;n++)t=Math.max(t,this._geometries[n].getBoundaryDimension());return t}},{key:"reverseInternal",value:function(){for(var t=this._geometries.length,n=new he(t),r=0;r<t;r++)n.add(this._geometries[r].reverse());return this.getFactory().buildGeometry(n)}},{key:"getTypeCode",value:function(){return oe.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var t=V.FALSE,n=0;n<this._geometries.length;n++)t=Math.max(t,this._geometries[n].getDimension());return t}},{key:"getLength",value:function(){for(var t=0,n=0;n<this._geometries.length;n++)t+=this._geometries[n].getLength();return t}},{key:"getNumPoints",value:function(){for(var t=0,n=0;n<this._geometries.length;n++)t+=this._geometries[n].getNumPoints();return t}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var t=arguments[0],n=new yt(qt.asList(this._geometries)),r=new yt(qt.asList(t._geometries));return this.compare(n,r)}if(arguments.length===2){for(var s=arguments[1],o=arguments[0],u=this.getNumGeometries(),m=o.getNumGeometries(),y=0;y<u&&y<m;){var T=this.getGeometryN(y),R=o.getGeometryN(y),G=T.compareToSameClass(R,s);if(G!==0)return G;y++}return y<u?1:y<m?-1:0}}},{key:"apply",value:function(){if(ye(arguments[0],Lt))for(var t=arguments[0],n=0;n<this._geometries.length;n++)this._geometries[n].apply(t);else if(ye(arguments[0],Gt)){var r=arguments[0];if(this._geometries.length===0)return null;for(var s=0;s<this._geometries.length&&(this._geometries[s].apply(r),!r.isDone());s++);r.isGeometryChanged()&&this.geometryChanged()}else if(ye(arguments[0],ft)){var o=arguments[0];o.filter(this);for(var u=0;u<this._geometries.length;u++)this._geometries[u].apply(o)}else if(ye(arguments[0],B)){var m=arguments[0];m.filter(this);for(var y=0;y<this._geometries.length;y++)this._geometries[y].apply(m)}}},{key:"getBoundary",value:function(){return oe.checkNotGeometryCollection(this),ke.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return oe.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var t=arguments[0],n=arguments[1];if(oe.constructor_.call(this,n),t===null&&(t=[]),oe.hasNullElements(t))throw new Y("geometries must not contain null elements");this._geometries=t}}}}])})(oe),gt=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"copyInternal",value:function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof oe){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&w(e,"equalsExact",this,1).call(this,t,n)}return w(e,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var t=arguments[0];return this._geometries[t].getCoordinate()}return w(e,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return V.FALSE}},{key:"getTypeCode",value:function(){return oe.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return oe.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Un]}}],[{key:"constructor_",value:function(){var t=arguments[0],n=arguments[1];nt.constructor_.call(this,t,n)}}])})(nt),Zt=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"copyInternal",value:function(){return new e(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return V.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||w(e,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var t=this._points.copy();return tt.reverse(t),this.getFactory().createLinearRing(t)}},{key:"getTypeCode",value:function(){return oe.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!w(e,"isClosed",this,1).call(this))throw new Y("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new Y("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return oe.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var t=arguments[0],n=arguments[1];Xt.constructor_.call(this,t,n),this.validateConstruction()}}])})(Xt);Zt.MINIMUM_VALID_SIZE=4;var Rt=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"setOrdinate",value:function(t,n){switch(t){case e.X:this.x=n;break;case e.Y:this.y=n;break;default:throw new Y("Invalid ordinate index: "+t)}}},{key:"getZ",value:function(){return M.NULL_ORDINATE}},{key:"getOrdinate",value:function(t){switch(t){case e.X:return this.x;case e.Y:return this.y}throw new Y("Invalid ordinate index: "+t)}},{key:"setZ",value:function(t){throw new Y("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new e(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(t){this.x=t.x,this.y=t.y,this.z=t.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)M.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof e){var t=arguments[0];M.constructor_.call(this,t.x,t.y)}else if(arguments[0]instanceof M){var n=arguments[0];M.constructor_.call(this,n.x,n.y)}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];M.constructor_.call(this,r,s,M.NULL_ORDINATE)}}}])})(M);Rt.X=0,Rt.Y=1,Rt.Z=-1,Rt.M=-1;var je=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(t,n){switch(t){case e.X:this.x=n;break;case e.Y:this.y=n;break;case e.M:this._m=n;break;default:throw new Y("Invalid ordinate index: "+t)}}},{key:"setM",value:function(t){this._m=t}},{key:"getZ",value:function(){return M.NULL_ORDINATE}},{key:"getOrdinate",value:function(t){switch(t){case e.X:return this.x;case e.Y:return this.y;case e.M:return this._m}throw new Y("Invalid ordinate index: "+t)}},{key:"setZ",value:function(t){throw new Y("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new e(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(t){this.x=t.x,this.y=t.y,this.z=t.getZ(),this._m=t.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)M.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof e){var t=arguments[0];M.constructor_.call(this,t.x,t.y),this._m=t._m}else if(arguments[0]instanceof M){var n=arguments[0];M.constructor_.call(this,n.x,n.y),this._m=this.getM()}}else if(arguments.length===3){var r=arguments[0],s=arguments[1],o=arguments[2];M.constructor_.call(this,r,s,M.NULL_ORDINATE),this._m=o}}}])})(M);je.X=0,je.Y=1,je.Z=-1,je.M=2;var Ot=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(t,n){switch(t){case M.X:this.x=n;break;case M.Y:this.y=n;break;case M.Z:this.z=n;break;case M.M:this._m=n;break;default:throw new Y("Invalid ordinate index: "+t)}}},{key:"setM",value:function(t){this._m=t}},{key:"getOrdinate",value:function(t){switch(t){case M.X:return this.x;case M.Y:return this.y;case M.Z:return this.getZ();case M.M:return this.getM()}throw new Y("Invalid ordinate index: "+t)}},{key:"copy",value:function(){return new e(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(t){this.x=t.x,this.y=t.y,this.z=t.getZ(),this._m=t.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)M.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof e){var t=arguments[0];M.constructor_.call(this,t),this._m=t._m}else if(arguments[0]instanceof M){var n=arguments[0];M.constructor_.call(this,n),this._m=this.getM()}}else if(arguments.length===4){var r=arguments[0],s=arguments[1],o=arguments[2],u=arguments[3];M.constructor_.call(this,r,s,o),this._m=u}}}])})(M),fn=(function(){function i(){c(this,i)}return d(i,null,[{key:"measures",value:function(e){return e instanceof Rt?0:e instanceof je||e instanceof Ot?1:0}},{key:"dimension",value:function(e){return e instanceof Rt?2:e instanceof je?3:e instanceof Ot?4:3}},{key:"create",value:function(){if(arguments.length===1){var e=arguments[0];return i.create(e,0)}if(arguments.length===2){var t=arguments[0],n=arguments[1];return t===2?new Rt:t===3&&n===0?new M:t===3&&n===1?new je:t===4&&n===1?new Ot:new M}}}])})(),kt=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"getCoordinate",value:function(t){return this.get(t)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&ye(arguments[0],ze)){for(var t=arguments[1],n=!1,r=arguments[0].iterator();r.hasNext();)this.add(r.next(),t),n=!0;return n}return w(e,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var t=w(e,"clone",this,1).call(this),n=0;n<this.size();n++)t.add(n,this.get(n).clone());return t}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(e.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(e.coordArrayType);for(var t=this.size(),n=new Array(t).fill(null),r=0;r<t;r++)n[r]=this.get(t-r-1);return n}}},{key:"add",value:function(){if(arguments.length===1){var t=arguments[0];return w(e,"add",this,1).call(this,t)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var n=arguments[0],r=arguments[1];return this.add(n,r,!0),!0}if(arguments[0]instanceof M&&typeof arguments[1]=="boolean"){var s=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(s))return null;w(e,"add",this,1).call(this,s)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var o=arguments[0],u=arguments[1];return this.add(o,u),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var m=arguments[0],y=arguments[1];if(arguments[2])for(var T=0;T<m.length;T++)this.add(m[T],y);else for(var R=m.length-1;R>=0;R--)this.add(m[R],y);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof M){var G=arguments[0],J=arguments[1];if(!arguments[2]){var se=this.size();if(se>0&&(G>0&&this.get(G-1).equals2D(J)||G<se&&this.get(G).equals2D(J)))return null}w(e,"add",this,1).call(this,G,J)}}else if(arguments.length===4){var ce=arguments[0],be=arguments[1],Se=arguments[2],Ae=arguments[3],Qe=1;Se>Ae&&(Qe=-1);for(var rt=Se;rt!==Ae;rt+=Qe)this.add(ce[rt],be);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var t=this.get(0).copy();this.add(t,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.ensureCapacity(n.length),this.add(n,r)}}}}])})(he);kt.coordArrayType=new Array(0).fill(null);var Ve=(function(){function i(){c(this,i)}return d(i,null,[{key:"isRing",value:function(e){return!(e.length<4)&&!!e[0].equals2D(e[e.length-1])}},{key:"ptNotInList",value:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(i.indexOf(r,t)<0)return r}return null}},{key:"scroll",value:function(e,t){var n=i.indexOf(t,e);if(n<0)return null;var r=new Array(e.length).fill(null);et.arraycopy(e,n,r,0,e.length-n),et.arraycopy(e,0,r,e.length-n,n),et.arraycopy(r,0,e,0,e.length)}},{key:"equals",value:function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(e===null||t===null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].equals(t[n]))return!1;return!0}if(arguments.length===3){var r=arguments[0],s=arguments[1],o=arguments[2];if(r===s)return!0;if(r===null||s===null||r.length!==s.length)return!1;for(var u=0;u<r.length;u++)if(o.compare(r[u],s[u])!==0)return!1;return!0}}},{key:"intersection",value:function(e,t){for(var n=new kt,r=0;r<e.length;r++)t.intersects(e[r])&&n.add(e[r],!0);return n.toCoordinateArray()}},{key:"measures",value:function(e){if(e===null||e.length===0)return 0;var t,n=0,r=b(e);try{for(r.s();!(t=r.n()).done;){var s=t.value;n=Math.max(n,fn.measures(s))}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"hasRepeatedPoints",value:function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(e){return i.hasRepeatedPoints(e)?new kt(e,!1).toCoordinateArray():e}},{key:"reverse",value:function(e){for(var t=e.length-1,n=Math.trunc(t/2),r=0;r<=n;r++){var s=e[r];e[r]=e[t-r],e[t-r]=s}}},{key:"removeNull",value:function(e){for(var t=0,n=0;n<e.length;n++)e[n]!==null&&t++;var r=new Array(t).fill(null);if(t===0)return r;for(var s=0,o=0;o<e.length;o++)e[o]!==null&&(r[s++]=e[o]);return r}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var e=arguments[0],t=new Array(e.length).fill(null),n=0;n<e.length;n++)t[n]=e[n].copy();return t}if(arguments.length===5)for(var r=arguments[0],s=arguments[1],o=arguments[2],u=arguments[3],m=arguments[4],y=0;y<m;y++)o[u+y]=r[s+y].copy()}},{key:"isEqualReversed",value:function(e,t){for(var n=0;n<e.length;n++){var r=e[n],s=t[e.length-n-1];if(r.compareTo(s)!==0)return!1}return!0}},{key:"envelope",value:function(e){for(var t=new Me,n=0;n<e.length;n++)t.expandToInclude(e[n]);return t}},{key:"toCoordinateArray",value:function(e){return e.toArray(i.coordArrayType)}},{key:"dimension",value:function(e){if(e===null||e.length===0)return 3;var t,n=0,r=b(e);try{for(r.s();!(t=r.n()).done;){var s=t.value;n=Math.max(n,fn.dimension(s))}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"atLeastNCoordinatesOrNothing",value:function(e,t){return t.length>=e?t:[]}},{key:"indexOf",value:function(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return n;return-1}},{key:"increasingDirection",value:function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var n=e.length-1-t,r=e[t].compareTo(e[n]);if(r!==0)return r}return 1}},{key:"compare",value:function(e,t){for(var n=0;n<e.length&&n<t.length;){var r=e[n].compareTo(t[n]);if(r!==0)return r;n++}return n<t.length?-1:n<e.length?1:0}},{key:"minCoordinate",value:function(e){for(var t=null,n=0;n<e.length;n++)(t===null||t.compareTo(e[n])>0)&&(t=e[n]);return t}},{key:"extract",value:function(e,t,n){t=We.clamp(t,0,e.length);var r=(n=We.clamp(n,-1,e.length))-t+1;n<0&&(r=0),t>=e.length&&(r=0),n<t&&(r=0);var s=new Array(r).fill(null);if(r===0)return s;for(var o=0,u=t;u<=n;u++)s[o++]=e[u];return s}}])})(),er=(function(){return d((function i(){c(this,i)}),[{key:"compare",value:function(i,e){var t=i,n=e;return Ve.compare(t,n)}},{key:"interfaces_",get:function(){return[Ge]}}])})(),tr=(function(){return d((function i(){c(this,i)}),[{key:"compare",value:function(i,e){var t=i,n=e;if(t.length<n.length)return-1;if(t.length>n.length)return 1;if(t.length===0)return 0;var r=Ve.compare(t,n);return Ve.isEqualReversed(t,n)?0:r}},{key:"OLDcompare",value:function(i,e){var t=i,n=e;if(t.length<n.length)return-1;if(t.length>n.length)return 1;if(t.length===0)return 0;for(var r=Ve.increasingDirection(t),s=Ve.increasingDirection(n),o=r>0?0:t.length-1,u=s>0?0:t.length-1,m=0;m<t.length;m++){var y=t[o].compareTo(n[u]);if(y!==0)return y;o+=r,u+=s}return 0}},{key:"interfaces_",get:function(){return[Ge]}}])})();Ve.ForwardComparator=er,Ve.BidirectionalComparator=tr,Ve.coordArrayType=new Array(0).fill(null);var Tn=(function(){return d((function i(e){c(this,i),this.str=e}),[{key:"append",value:function(i){this.str+=i}},{key:"setCharAt",value:function(i,e){this.str=this.str.substr(0,i)+e+this.str.substr(i+1)}},{key:"toString",value:function(){return this.str}}])})(),gn=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"getM",value:function(e){return this.hasM()?this._coordinates[e].getM():ne.NaN}},{key:"setOrdinate",value:function(e,t,n){switch(t){case Ne.X:this._coordinates[e].x=n;break;case Ne.Y:this._coordinates[e].y=n;break;default:this._coordinates[e].setOrdinate(t,n)}}},{key:"getZ",value:function(e){return this.hasZ()?this._coordinates[e].getZ():ne.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(e,t){switch(t){case Ne.X:return this._coordinates[e].x;case Ne.Y:return this._coordinates[e].y;default:return this._coordinates[e].getOrdinate(t)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}if(arguments.length===2){var t=arguments[0];arguments[1].setCoordinate(this._coordinates[t])}}},{key:"getCoordinateCopy",value:function(e){var t=this.createCoordinate();return t.setCoordinate(this._coordinates[e]),t}},{key:"createCoordinate",value:function(){return fn.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(e){return this._coordinates[e].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(e){for(var t=0;t<this._coordinates.length;t++)e.expandToInclude(this._coordinates[t]);return e}},{key:"copy",value:function(){for(var e=new Array(this.size()).fill(null),t=0;t<this._coordinates.length;t++){var n=this.createCoordinate();n.setCoordinate(this._coordinates[t]),e[t]=n}return new i(e,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var e=new Tn(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var t=1;t<this._coordinates.length;t++)e.append(", "),e.append(this._coordinates[t]);return e.append(")"),e.toString()}return"()"}},{key:"getY",value:function(e){return this._coordinates[e].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[Ne,Q]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];i.constructor_.call(this,e,Ve.dimension(e),Ve.measures(e))}else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var n=0;n<t;n++)this._coordinates[n]=new M}else if(ye(arguments[0],Ne)){var r=arguments[0];if(r===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._measures=r.getMeasures(),this._coordinates=new Array(r.size()).fill(null);for(var s=0;s<this._coordinates.length;s++)this._coordinates[s]=r.getCoordinateCopy(s)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var o=arguments[0],u=arguments[1];i.constructor_.call(this,o,u,Ve.measures(o))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var m=arguments[0],y=arguments[1];this._coordinates=new Array(m).fill(null),this._dimension=y;for(var T=0;T<m;T++)this._coordinates[T]=fn.create(y)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var R=arguments[0],G=arguments[1],J=arguments[2];this._dimension=G,this._measures=J,this._coordinates=R===null?new Array(0).fill(null):R}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var se=arguments[0],ce=arguments[1],be=arguments[2];this._coordinates=new Array(se).fill(null),this._dimension=ce,this._measures=be;for(var Se=0;Se<se;Se++)this._coordinates[Se]=this.createCoordinate()}}}}])})(),Cn=(function(){function i(){c(this,i)}return d(i,[{key:"readResolve",value:function(){return i.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new gn(arguments[0]);if(ye(arguments[0],Ne))return new gn(arguments[0])}else{if(arguments.length===2){var e=arguments[1];return e>3&&(e=3),e<2&&(e=2),new gn(arguments[0],e)}if(arguments.length===3){var t=arguments[2],n=arguments[1]-t;return t>1&&(t=1),n>3&&(n=3),n<2&&(n=2),new gn(arguments[0],n+t,t)}}}},{key:"interfaces_",get:function(){return[Bt,Q]}}],[{key:"instance",value:function(){return i.instanceObject}}])})();Cn.instanceObject=new Cn;var Bn=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"copyInternal",value:function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof oe){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&w(e,"equalsExact",this,1).call(this,t,n)}return w(e,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return oe.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new he,n=0;n<this._geometries.length;n++)for(var r=this._geometries[n].getBoundary(),s=0;s<r.getNumGeometries();s++)t.add(r.getGeometryN(s));var o=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(o))}},{key:"getGeometryType",value:function(){return oe.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[pi]}}],[{key:"constructor_",value:function(){var t=arguments[0],n=arguments[1];nt.constructor_.call(this,t,n)}}])})(nt),_i=(function(){return d((function i(){c(this,i)}),[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])})(),nr=(function(i){function e(){var t;return c(this,e),(t=h(this,e)).map=new Map,t}return p(e,i),d(e,[{key:"get",value:function(t){return this.map.get(t)||null}},{key:"put",value:function(t,n){return this.map.set(t,n),n}},{key:"values",value:function(){for(var t=new he,n=this.map.values(),r=n.next();!r.done;)t.add(r.value),r=n.next();return t}},{key:"entrySet",value:function(){var t=new wt;return this.map.entries().forEach((function(n){return t.add(n)})),t}},{key:"size",value:function(){return this.map.size()}}])})(_i),vt=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"equals",value:function(e){if(!(e instanceof i))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale}},{key:"compareTo",value:function(e){var t=e,n=this.getMaximumSignificantDigits(),r=t.getMaximumSignificantDigits();return un.compare(n,r)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===i.FLOATING||this._modelType===i.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var e="UNKNOWN";return this._modelType===i.FLOATING?e="Floating":this._modelType===i.FLOATING_SINGLE?e="Floating-Single":this._modelType===i.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var e=arguments[0];return ne.isNaN(e)||this._modelType===i.FLOATING_SINGLE?e:this._modelType===i.FIXED?Math.round(e*this._scale)/this._scale:e}if(arguments[0]instanceof M){var t=arguments[0];if(this._modelType===i.FLOATING)return null;t.x=this.makePrecise(t.x),t.y=this.makePrecise(t.y)}}},{key:"getMaximumSignificantDigits",value:function(){var e=16;return this._modelType===i.FLOATING?e=16:this._modelType===i.FLOATING_SINGLE?e=6:this._modelType===i.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e}},{key:"setScale",value:function(e){this._scale=Math.abs(e)}},{key:"interfaces_",get:function(){return[Q,W]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=i.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Kt){var e=arguments[0];this._modelType=e,e===i.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var t=arguments[0];this._modelType=i.FIXED,this.setScale(t)}else if(arguments[0]instanceof i){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}}}},{key:"mostPrecise",value:function(e,t){return e.compareTo(t)>=0?e:t}}])})(),Kt=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"readResolve",value:function(){return i.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[Q]}}],[{key:"constructor_",value:function(){this._name=null;var e=arguments[0];this._name=e,i.nameToTypeMap.put(e,this)}}])})();Kt.nameToTypeMap=new nr,vt.Type=Kt,vt.FIXED=new Kt("FIXED"),vt.FLOATING=new Kt("FLOATING"),vt.FLOATING_SINGLE=new Kt("FLOATING SINGLE"),vt.maximumPreciseValue=9007199254740992;var Vn=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"copyInternal",value:function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof oe){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&w(e,"equalsExact",this,1).call(this,t,n)}return w(e,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?V.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return oe.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new ot}},{key:"getGeometryType",value:function(){return oe.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[Vt]}}],[{key:"constructor_",value:function(){var t=arguments[0],n=arguments[1];nt.constructor_.call(this,t,n)}}])})(nt),Wt=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"createEmpty",value:function(e){switch(e){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new Y("Invalid dimension: "+e)}}},{key:"toGeometry",value:function(e){return e.isNull()?this.createPoint():e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new M(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new M(e.getMinX(),e.getMinY()),new M(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new M(e.getMinX(),e.getMinY()),new M(e.getMinX(),e.getMaxY()),new M(e.getMaxX(),e.getMaxY()),new M(e.getMaxX(),e.getMinY()),new M(e.getMinX(),e.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLineString(e!==null?this.getCoordinateSequenceFactory().create(e):null)}if(ye(arguments[0],Ne))return new Xt(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new Vn(null,this):arguments.length===1?new Vn(arguments[0],this):void 0}},{key:"buildGeometry",value:function(e){for(var t=null,n=!1,r=!1,s=e.iterator();s.hasNext();){var o=s.next(),u=o.getTypeCode();t===null&&(t=u),u!==t&&(n=!0),o instanceof nt&&(r=!0)}if(t===null)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(i.toGeometryArray(e));var m=e.iterator().next();if(e.size()>1){if(m instanceof Ht)return this.createMultiPolygon(i.toPolygonArray(e));if(m instanceof Xt)return this.createMultiLineString(i.toLineStringArray(e));if(m instanceof jt)return this.createMultiPoint(i.toPointArray(e));ke.shouldNeverReachHere("Unhandled geometry type: "+m.getGeometryType())}return m}},{key:"createMultiPointFromCoords",value:function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof M){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}if(ye(arguments[0],Ne))return new jt(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(ye(arguments[0],Ne)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Zt){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2)return new Ht(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new nt(null,this):arguments.length===1?new nt(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}if(ye(arguments[0],Ne))return new Zt(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new Bn(null,this):arguments.length===1?new Bn(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new gt(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new gt(arguments[0],this);if(ye(arguments[0],Ne)){var e=arguments[0];if(e===null)return this.createMultiPoint(new Array(0).fill(null));for(var t=new Array(e.size()).fill(null),n=0;n<e.size();n++){var r=this.getCoordinateSequenceFactory().create(1,e.getDimension(),e.getMeasures());tt.copy(e,n,r,0,1),t[n]=this.createPoint(r)}return this.createMultiPoint(t)}}}},{key:"interfaces_",get:function(){return[Q]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)i.constructor_.call(this,new vt,0);else if(arguments.length===1){if(ye(arguments[0],Bt)){var e=arguments[0];i.constructor_.call(this,new vt,0,e)}else if(arguments[0]instanceof vt){var t=arguments[0];i.constructor_.call(this,t,0,i.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];i.constructor_.call(this,n,r,i.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var s=arguments[0],o=arguments[1],u=arguments[2];this._precisionModel=s,this._coordinateSequenceFactory=u,this._SRID=o}}},{key:"toMultiPolygonArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toGeometryArray",value:function(e){if(e===null)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return Cn.instance()}},{key:"toMultiLineStringArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toLineStringArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toMultiPointArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toLinearRingArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toPointArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toPolygonArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"createPointFromInternalCoord",value:function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)}}])})(),Xn="XY",ir="XYZ",rr="XYM",xi="XYZM",ki={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},dn="EMPTY",mn=1,it=2,$e=3,Hn=4,Mt=5,sr=6;for(var Zn in ki)ki[Zn].toUpperCase();var ar=(function(){return d((function i(e){c(this,i),this.wkt=e,this.index_=-1}),[{key:"isAlpha_",value:function(i){return i>="a"&&i<="z"||i>="A"&&i<="Z"}},{key:"isNumeric_",value:function(i,e){return i>="0"&&i<="9"||i=="."&&!(e!==void 0&&e)}},{key:"isWhiteSpace_",value:function(i){return i==" "||i=="	"||i=="\r"||i=="\n"}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var i,e=this.nextChar_(),t=this.index_,n=e;if(e=="(")i=it;else if(e==",")i=Mt;else if(e==")")i=$e;else if(this.isNumeric_(e)||e=="-")i=Hn,n=this.readNumber_();else if(this.isAlpha_(e))i=mn,n=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(e!=="")throw new Error("Unexpected character: "+e);i=sr}return{position:t,value:n,type:i}}},{key:"readNumber_",value:function(){var i,e=this.index_,t=!1,n=!1;do i=="."?t=!0:i!="e"&&i!="E"||(n=!0),i=this.nextChar_();while(this.isNumeric_(i,t)||!n&&(i=="e"||i=="E")||n&&(i=="-"||i=="+"));return parseFloat(this.wkt.substring(e,this.index_--))}},{key:"readText_",value:function(){var i,e=this.index_;do i=this.nextChar_();while(this.isAlpha_(i));return this.wkt.substring(e,this.index_--).toUpperCase()}}])})(),or=(function(){return d((function i(e,t){c(this,i),this.lexer_=e,this.token_,this.layout_=Xn,this.factory=t}),[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(i){return this.token_.type==i}},{key:"match",value:function(i){var e=this.isTokenType(i);return e&&this.consume_(),e}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var i=Xn,e=this.token_;if(this.isTokenType(mn)){var t=e.value;t==="Z"?i=ir:t==="M"?i=rr:t==="ZM"&&(i=xi),i!==Xn&&this.consume_()}return i}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(it)){var i=[];do i.push(this.parseGeometry_());while(this.match(Mt));if(this.match($e))return i}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(it)){var i=this.parsePoint_();if(this.match($e))return i}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(it)){var i=this.parsePointList_();if(this.match($e))return i}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(it)){var i=this.parseLineStringTextList_();if(this.match($e))return i}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var i;if(this.match(it)){if(i=this.token_.type==it?this.parsePointTextList_():this.parsePointList_(),this.match($e))return i}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(it)){var i=this.parseLineStringTextList_();if(this.match($e))return i}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(it)){var i=this.parsePolygonTextList_();if(this.match($e))return i}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var i=[],e=this.layout_.length,t=0;t<e;++t){var n=this.token_;if(!this.match(Hn))break;i.push(n.value)}if(i.length==e)return i;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var i=[this.parsePoint_()];this.match(Mt);)i.push(this.parsePoint_());return i}},{key:"parsePointTextList_",value:function(){for(var i=[this.parsePointText_()];this.match(Mt);)i.push(this.parsePointText_());return i}},{key:"parseLineStringTextList_",value:function(){for(var i=[this.parseLineStringText_()];this.match(Mt);)i.push(this.parseLineStringText_());return i}},{key:"parsePolygonTextList_",value:function(){for(var i=[this.parsePolygonText_()];this.match(Mt);)i.push(this.parsePolygonText_());return i}},{key:"isEmptyGeometry_",value:function(){var i=this.isTokenType(mn)&&this.token_.value==dn;return i&&this.consume_(),i}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var i=this.factory,e=function(ce){return v(M,z(ce))},t=function(ce){var be=ce.map((function(Se){return i.createLinearRing(Se.map(e))}));return be.length>1?i.createPolygon(be[0],be.slice(1)):i.createPolygon(be[0])},n=this.token_;if(this.match(mn)){var r=n.value;if(this.layout_=this.parseGeometryLayout_(),r=="GEOMETRYCOLLECTION"){var s=this.parseGeometryCollectionText_();return i.createGeometryCollection(s)}switch(r){case"POINT":var o=this.parsePointText_();return o?i.createPoint(v(M,z(o))):i.createPoint();case"LINESTRING":var u=this.parseLineStringText_().map(e);return i.createLineString(u);case"LINEARRING":var m=this.parseLineStringText_().map(e);return i.createLinearRing(m);case"POLYGON":var y=this.parsePolygonText_();return y&&y.length!==0?t(y):i.createPolygon();case"MULTIPOINT":var T=this.parseMultiPointText_();if(!T||T.length===0)return i.createMultiPoint();var R=T.map(e).map((function(ce){return i.createPoint(ce)}));return i.createMultiPoint(R);case"MULTILINESTRING":var G=this.parseMultiLineStringText_().map((function(ce){return i.createLineString(ce.map(e))}));return i.createMultiLineString(G);case"MULTIPOLYGON":var J=this.parseMultiPolygonText_();if(!J||J.length===0)return i.createMultiPolygon();var se=J.map(t);return i.createMultiPolygon(se);default:throw new Error("Invalid geometry type: "+r)}}throw new Error(this.formatErrorMessage_())}}])})();function Ei(i){if(i.isEmpty())return"";var e=i.getCoordinate(),t=[e.x,e.y];return e.z===void 0||Number.isNaN(e.z)||t.push(e.z),e.m===void 0||Number.isNaN(e.m)||t.push(e.m),t.join(" ")}function yn(i){for(var e=i.getCoordinates().map((function(s){var o=[s.x,s.y];return s.z===void 0||Number.isNaN(s.z)||o.push(s.z),s.m===void 0||Number.isNaN(s.m)||o.push(s.m),o})),t=[],n=0,r=e.length;n<r;++n)t.push(e[n].join(" "));return t.join(", ")}function Kn(i){var e=[];e.push("("+yn(i.getExteriorRing())+")");for(var t=0,n=i.getNumInteriorRing();t<n;++t)e.push("("+yn(i.getInteriorRingN(t))+")");return e.join(", ")}var Ni={Point:Ei,LineString:yn,LinearRing:yn,Polygon:Kn,MultiPoint:function(i){for(var e=[],t=0,n=i.getNumGeometries();t<n;++t)e.push("("+Ei(i.getGeometryN(t))+")");return e.join(", ")},MultiLineString:function(i){for(var e=[],t=0,n=i.getNumGeometries();t<n;++t)e.push("("+yn(i.getGeometryN(t))+")");return e.join(", ")},MultiPolygon:function(i){for(var e=[],t=0,n=i.getNumGeometries();t<n;++t)e.push("("+Kn(i.getGeometryN(t))+")");return e.join(", ")},GeometryCollection:function(i){for(var e=[],t=0,n=i.getNumGeometries();t<n;++t)e.push(Ii(i.getGeometryN(t)));return e.join(", ")}};function Ii(i){var e=i.getGeometryType(),t=Ni[e];e=e.toUpperCase();var n=(function(r){var s="";if(r.isEmpty())return s;var o=r.getCoordinate();return o.z===void 0||Number.isNaN(o.z)||(s+="Z"),o.m===void 0||Number.isNaN(o.m)||(s+="M"),s})(i);return n.length>0&&(e+=" "+n),i.isEmpty()?e+" "+dn:e+" ("+t(i)+")"}var $t=(function(){return d((function i(e){c(this,i),this.geometryFactory=e||new Wt,this.precisionModel=this.geometryFactory.getPrecisionModel()}),[{key:"read",value:function(i){var e=new ar(i);return new or(e,this.geometryFactory).parse()}},{key:"write",value:function(i){return Ii(i)}}])})(),Ln=(function(){return d((function i(e){c(this,i),this.parser=new $t(e)}),[{key:"write",value:function(i){return this.parser.write(i)}}],[{key:"toLineString",value:function(i,e){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+i.x+" "+i.y+", "+e.x+" "+e.y+" )"}}])})(),Pe=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"getIndexAlongSegment",value:function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]}},{key:"getTopologySummary",value:function(){var e=new Tn;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()}},{key:"computeIntersection",value:function(e,t,n,r){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(e,t,n,r)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0];this.getEdgeDistance(e,0)>this.getEdgeDistance(e,1)?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(e){this._precisionModel=e}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var e=arguments[0],t=0;t<this._result;t++)if(!this._intPt[t].equals2D(this._inputLines[e][0])&&!this._intPt[t].equals2D(this._inputLines[e][1]))return!0;return!1}}},{key:"getIntersection",value:function(e){return this._intPt[e]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==i.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(e,t){return i.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1])}},{key:"isCollinear",value:function(){return this._result===i.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return Ln.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Ln.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(e,t){return this._inputLines[e][t]}},{key:"isIntersection",value:function(e){for(var t=0;t<this._result;t++)if(this._intPt[t].equals2D(e))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new M,this._intPt[1]=new M,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(e,t,n){var r=Math.abs(n.x-t.x),s=Math.abs(n.y-t.y),o=-1;if(e.equals(t))o=0;else if(e.equals(n))o=r>s?r:s;else{var u=Math.abs(e.x-t.x),m=Math.abs(e.y-t.y);(o=r>s?u:m)!==0||e.equals(t)||(o=Math.max(u,m))}return ke.isTrue(!(o===0&&!e.equals(t)),"Bad distance calculation"),o}},{key:"nonRobustComputeEdgeDistance",value:function(e,t,n){var r=e.x-t.x,s=e.y-t.y,o=Math.sqrt(r*r+s*s);return ke.isTrue(!(o===0&&!e.equals(t)),"Invalid distance calculation"),o}}])})();Pe.DONT_INTERSECT=0,Pe.DO_INTERSECT=1,Pe.COLLINEAR=2,Pe.NO_INTERSECTION=0,Pe.POINT_INTERSECTION=1,Pe.COLLINEAR_INTERSECTION=2;var zt=(function(i){function e(){return c(this,e),h(this,e)}return p(e,i),d(e,[{key:"isInSegmentEnvelopes",value:function(t){var n=new Me(this._inputLines[0][0],this._inputLines[0][1]),r=new Me(this._inputLines[1][0],this._inputLines[1][1]);return n.contains(t)&&r.contains(t)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return w(e,"computeIntersection",this,1).apply(this,arguments);var t=arguments[0],n=arguments[1],r=arguments[2];if(this._isProper=!1,Me.intersects(n,r,t)&&ge.index(n,r,t)===0&&ge.index(r,n,t)===0)return this._isProper=!0,(t.equals(n)||t.equals(r))&&(this._isProper=!1),this._result=Pe.POINT_INTERSECTION,null;this._result=Pe.NO_INTERSECTION}},{key:"intersection",value:function(t,n,r,s){var o=this.intersectionSafe(t,n,r,s);return this.isInSegmentEnvelopes(o)||(o=new M(e.nearestEndpoint(t,n,r,s))),this._precisionModel!==null&&this._precisionModel.makePrecise(o),o}},{key:"checkDD",value:function(t,n,r,s,o){var u=Sn.intersection(t,n,r,s),m=this.isInSegmentEnvelopes(u);et.out.println("DD in env = "+m+"  --------------------- "+u),o.distance(u)>1e-4&&et.out.println("Distance = "+o.distance(u))}},{key:"intersectionSafe",value:function(t,n,r,s){var o=cn.intersection(t,n,r,s);return o===null&&(o=e.nearestEndpoint(t,n,r,s)),o}},{key:"computeCollinearIntersection",value:function(t,n,r,s){var o=Me.intersects(t,n,r),u=Me.intersects(t,n,s),m=Me.intersects(r,s,t),y=Me.intersects(r,s,n);return o&&u?(this._intPt[0]=r,this._intPt[1]=s,Pe.COLLINEAR_INTERSECTION):m&&y?(this._intPt[0]=t,this._intPt[1]=n,Pe.COLLINEAR_INTERSECTION):o&&m?(this._intPt[0]=r,this._intPt[1]=t,!r.equals(t)||u||y?Pe.COLLINEAR_INTERSECTION:Pe.POINT_INTERSECTION):o&&y?(this._intPt[0]=r,this._intPt[1]=n,!r.equals(n)||u||m?Pe.COLLINEAR_INTERSECTION:Pe.POINT_INTERSECTION):u&&m?(this._intPt[0]=s,this._intPt[1]=t,!s.equals(t)||o||y?Pe.COLLINEAR_INTERSECTION:Pe.POINT_INTERSECTION):u&&y?(this._intPt[0]=s,this._intPt[1]=n,!s.equals(n)||o||m?Pe.COLLINEAR_INTERSECTION:Pe.POINT_INTERSECTION):Pe.NO_INTERSECTION}},{key:"computeIntersect",value:function(t,n,r,s){if(this._isProper=!1,!Me.intersects(t,n,r,s))return Pe.NO_INTERSECTION;var o=ge.index(t,n,r),u=ge.index(t,n,s);if(o>0&&u>0||o<0&&u<0)return Pe.NO_INTERSECTION;var m=ge.index(r,s,t),y=ge.index(r,s,n);return m>0&&y>0||m<0&&y<0?Pe.NO_INTERSECTION:o===0&&u===0&&m===0&&y===0?this.computeCollinearIntersection(t,n,r,s):(o===0||u===0||m===0||y===0?(this._isProper=!1,t.equals2D(r)||t.equals2D(s)?this._intPt[0]=t:n.equals2D(r)||n.equals2D(s)?this._intPt[0]=n:o===0?this._intPt[0]=new M(r):u===0?this._intPt[0]=new M(s):m===0?this._intPt[0]=new M(t):y===0&&(this._intPt[0]=new M(n))):(this._isProper=!0,this._intPt[0]=this.intersection(t,n,r,s)),Pe.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(t,n,r,s){var o=t,u=mt.pointToSegment(t,r,s),m=mt.pointToSegment(n,r,s);return m<u&&(u=m,o=n),(m=mt.pointToSegment(r,t,n))<u&&(u=m,o=r),(m=mt.pointToSegment(s,t,n))<u&&(u=m,o=s),o}}])})(Pe),ur=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"countSegment",value:function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var n=e.x,r=t.x;return n>r&&(n=t.x,r=e.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var s=ge.index(e,t,this._p);if(s===ge.COLLINEAR)return this._isPointOnSegment=!0,null;t.y<e.y&&(s=-s),s===ge.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==x.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?x.BOUNDARY:this._crossingCount%2==1?x.INTERIOR:x.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof M&&ye(arguments[1],Ne)){for(var e=arguments[1],t=new i(arguments[0]),n=new M,r=new M,s=1;s<e.size();s++)if(e.getCoordinate(s,n),e.getCoordinate(s-1,r),t.countSegment(n,r),t.isOnSegment())return t.getLocation();return t.getLocation()}if(arguments[0]instanceof M&&arguments[1]instanceof Array){for(var o=arguments[1],u=new i(arguments[0]),m=1;m<o.length;m++){var y=o[m],T=o[m-1];if(u.countSegment(y,T),u.isOnSegment())return u.getLocation()}return u.getLocation()}}}])})(),Wn=(function(){function i(){c(this,i)}return d(i,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof M&&ye(arguments[1],Ne)){for(var e=arguments[0],t=arguments[1],n=new zt,r=new M,s=new M,o=t.size(),u=1;u<o;u++)if(t.getCoordinate(u-1,r),t.getCoordinate(u,s),n.computeIntersection(e,r,s),n.hasIntersection())return!0;return!1}if(arguments[0]instanceof M&&arguments[1]instanceof Array){for(var m=arguments[0],y=arguments[1],T=new zt,R=1;R<y.length;R++){var G=y[R-1],J=y[R];if(T.computeIntersection(m,G,J),T.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(e,t){return ur.locatePointInRing(e,t)}},{key:"isInRing",value:function(e,t){return i.locateInRing(e,t)!==x.EXTERIOR}}])})(),lt=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"setAllLocations",value:function(e){for(var t=0;t<this.location.length;t++)this.location[t]=e}},{key:"isNull",value:function(){for(var e=0;e<this.location.length;e++)if(this.location[e]!==x.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(e){for(var t=0;t<this.location.length;t++)this.location[t]===x.NONE&&(this.location[t]=e)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(e){if(e.location.length>this.location.length){var t=new Array(3).fill(null);t[q.ON]=this.location[q.ON],t[q.LEFT]=x.NONE,t[q.RIGHT]=x.NONE,this.location=t}for(var n=0;n<this.location.length;n++)this.location[n]===x.NONE&&n<e.location.length&&(this.location[n]=e.location[n])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var e=this.location[q.LEFT];this.location[q.LEFT]=this.location[q.RIGHT],this.location[q.RIGHT]=e}},{key:"toString",value:function(){var e=new on;return this.location.length>1&&e.append(x.toLocationSymbol(this.location[q.LEFT])),e.append(x.toLocationSymbol(this.location[q.ON])),this.location.length>1&&e.append(x.toLocationSymbol(this.location[q.RIGHT])),e.toString()}},{key:"setLocations",value:function(e,t,n){this.location[q.ON]=e,this.location[q.LEFT]=t,this.location[q.RIGHT]=n}},{key:"get",value:function(e){return e<this.location.length?this.location[e]:x.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var e=0;e<this.location.length;e++)if(this.location[e]===x.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var e=arguments[0];this.setLocation(q.ON,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.location[t]=n}}},{key:"init",value:function(e){this.location=new Array(e).fill(null),this.setAllLocations(x.NONE)}},{key:"isEqualOnSide",value:function(e,t){return this.location[t]===e.location[t]}},{key:"allPositionsEqual",value:function(e){for(var t=0;t<this.location.length;t++)if(this.location[t]!==e)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];this.init(e.length)}else if(Number.isInteger(arguments[0])){var t=arguments[0];this.init(1),this.location[q.ON]=t}else if(arguments[0]instanceof i){var n=arguments[0];if(this.init(n.location.length),n!==null)for(var r=0;r<this.location.length;r++)this.location[r]=n.location[r]}}else if(arguments.length===3){var s=arguments[0],o=arguments[1],u=arguments[2];this.init(3),this.location[q.ON]=s,this.location[q.LEFT]=o,this.location[q.RIGHT]=u}}}])})(),ct=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"getGeometryCount",value:function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e}},{key:"setAllLocations",value:function(e,t){this.elt[e].setAllLocations(t)}},{key:"isNull",value:function(e){return this.elt[e].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}}},{key:"isLine",value:function(e){return this.elt[e].isLine()}},{key:"merge",value:function(e){for(var t=0;t<2;t++)this.elt[t]===null&&e.elt[t]!==null?this.elt[t]=new lt(e.elt[t]):this.elt[t].merge(e.elt[t])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(q.ON)}if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}}},{key:"toString",value:function(){var e=new on;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}}},{key:"isAnyNull",value:function(e){return this.elt[e].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(q.ON,t)}else if(arguments.length===3){var n=arguments[0],r=arguments[1],s=arguments[2];this.elt[n].setLocation(r,s)}}},{key:"isEqualOnSide",value:function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)}},{key:"allPositionsEqual",value:function(e,t){return this.elt[e].allPositionsEqual(t)}},{key:"toLine",value:function(e){this.elt[e].isArea()&&(this.elt[e]=new lt(this.elt[e].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new lt(e),this.elt[1]=new lt(e)}else if(arguments[0]instanceof i){var t=arguments[0];this.elt[0]=new lt(t.elt[0]),this.elt[1]=new lt(t.elt[1])}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.elt[0]=new lt(x.NONE),this.elt[1]=new lt(x.NONE),this.elt[n].setLocation(r)}else if(arguments.length===3){var s=arguments[0],o=arguments[1],u=arguments[2];this.elt[0]=new lt(s,o,u),this.elt[1]=new lt(s,o,u)}else if(arguments.length===4){var m=arguments[0],y=arguments[1],T=arguments[2],R=arguments[3];this.elt[0]=new lt(x.NONE,x.NONE,x.NONE),this.elt[1]=new lt(x.NONE,x.NONE,x.NONE),this.elt[m].setLocations(y,T,R)}}},{key:"toLineLabel",value:function(e){for(var t=new i(x.NONE),n=0;n<2;n++)t.setLocation(n,e.getLocation(n));return t}}])})(),vn=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var i=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)i[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(i),this._isHole=ge.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(i){this._startDe=i;var e=i,t=!0;do{if(e===null)throw new ut("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new ut("Directed Edge visited twice during ring-building at "+e.getCoordinate());this._edges.add(e);var n=e.getLabel();ke.isTrue(n.isArea()),this.mergeLabel(n),this.addPoints(e.getEdge(),e.isForward(),t),t=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(i){return this._pts.get(i)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var i=this._startDe;do{var e=i.getNode().getEdges().getOutgoingDegree(this);e>this._maxNodeDegree&&(this._maxNodeDegree=e),i=this.getNext(i)}while(i!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(i,e,t){var n=i.getCoordinates();if(e){var r=1;t&&(r=0);for(var s=r;s<n.length;s++)this._pts.add(n[s])}else{var o=n.length-2;t&&(o=n.length-1);for(var u=o;u>=0;u--)this._pts.add(n[u])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var i=this._startDe;do i.getEdge().setInResult(!0),i=i.getNext();while(i!==this._startDe)}},{key:"containsPoint",value:function(i){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(i)||!Wn.isInRing(i,e.getCoordinates()))return!1;for(var t=this._holes.iterator();t.hasNext();)if(t.next().containsPoint(i))return!1;return!0}},{key:"addHole",value:function(i){this._holes.add(i)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var i=arguments[0];this.mergeLabel(i,0),this.mergeLabel(i,1)}else if(arguments.length===2){var e=arguments[1],t=arguments[0].getLocation(e,q.RIGHT);if(t===x.NONE)return null;if(this._label.getLocation(e)===x.NONE)return this._label.setLocation(e,t),null}}},{key:"setShell",value:function(i){this._shell=i,i!==null&&i.addHole(this)}},{key:"toPolygon",value:function(i){for(var e=new Array(this._holes.size()).fill(null),t=0;t<this._holes.size();t++)e[t]=this._holes.get(t).getLinearRing();return i.createPolygon(this.getLinearRing(),e)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new he,this._pts=new he,this._label=new ct(x.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new he,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var i=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(i),this.computeRing()}}}}])})(),Si=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"setEdgeRing",value:function(t,n){t.setMinEdgeRing(n)}},{key:"getNext",value:function(t){return t.getNextMin()}}],[{key:"constructor_",value:function(){var t=arguments[0],n=arguments[1];vn.constructor_.call(this,t,n)}}])})(vn),wi=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"buildMinimalRings",value:function(){var t=new he,n=this._startDe;do{if(n.getMinEdgeRing()===null){var r=new Si(n,this._geometryFactory);t.add(r)}n=n.getNext()}while(n!==this._startDe);return t}},{key:"setEdgeRing",value:function(t,n){t.setEdgeRing(n)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var t=this._startDe;do t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext();while(t!==this._startDe)}},{key:"getNext",value:function(t){return t.getNext()}}],[{key:"constructor_",value:function(){var t=arguments[0],n=arguments[1];vn.constructor_.call(this,t,n)}}])})(vn),$n=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"setVisited",value:function(i){this._isVisited=i}},{key:"setInResult",value:function(i){this._isInResult=i}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(i){this._label=i}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(i){this._isCovered=i,this._isCoveredSet=!0}},{key:"updateIM",value:function(i){ke.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(i)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var i=arguments[0];this._label=i}}}}])})(),pn=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"isIncidentEdgeInResult",value:function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(t){t.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(t){}},{key:"computeMergedLocation",value:function(t,n){var r=x.NONE;if(r=this._label.getLocation(n),!t.isNull(n)){var s=t.getLocation(n);r!==x.BOUNDARY&&(r=s)}return r}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return w(e,"setLabel",this,1).apply(this,arguments);var t=arguments[0],n=arguments[1];this._label===null?this._label=new ct(t,n):this._label.setLocation(t,n)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof e){var t=arguments[0];this.mergeLabel(t._label)}else if(arguments[0]instanceof ct)for(var n=arguments[0],r=0;r<2;r++){var s=this.computeMergedLocation(n,r);this._label.getLocation(r)===x.NONE&&this._label.setLocation(r,s)}}},{key:"add",value:function(t){this._edges.insert(t),t.setNode(this)}},{key:"setLabelBoundary",value:function(t){if(this._label===null)return null;var n=x.NONE;this._label!==null&&(n=this._label.getLocation(t));var r=null;switch(n){case x.BOUNDARY:r=x.INTERIOR;break;case x.INTERIOR:default:r=x.BOUNDARY}this._label.setLocation(t,r)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var t=arguments[0],n=arguments[1];this._coord=t,this._edges=n,this._label=new ct(0,x.NONE)}}])})($n),bi=(function(i){function e(){return c(this,e),h(this,e,arguments)}return p(e,i),d(e)})(_i);function Jn(i){return i==null?0:i.color}function we(i){return i==null?null:i.parent}function pt(i,e){i!==null&&(i.color=e)}function Rn(i){return i==null?null:i.left}function f(i){return i==null?null:i.right}var E=(function(i){function e(){var t;return c(this,e),(t=h(this,e)).root_=null,t.size_=0,t}return p(e,i),d(e,[{key:"get",value:function(t){for(var n=this.root_;n!==null;){var r=t.compareTo(n.key);if(r<0)n=n.left;else{if(!(r>0))return n.value;n=n.right}}return null}},{key:"put",value:function(t,n){if(this.root_===null)return this.root_={key:t,value:n,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var r,s,o=this.root_;do if(r=o,(s=t.compareTo(o.key))<0)o=o.left;else{if(!(s>0)){var u=o.value;return o.value=n,u}o=o.right}while(o!==null);var m={key:t,left:null,right:null,value:n,parent:r,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return s<0?r.left=m:r.right=m,this.fixAfterInsertion(m),this.size_++,null}},{key:"fixAfterInsertion",value:function(t){var n;for(t.color=1;t!=null&&t!==this.root_&&t.parent.color===1;)we(t)===Rn(we(we(t)))?Jn(n=f(we(we(t))))===1?(pt(we(t),0),pt(n,0),pt(we(we(t)),1),t=we(we(t))):(t===f(we(t))&&(t=we(t),this.rotateLeft(t)),pt(we(t),0),pt(we(we(t)),1),this.rotateRight(we(we(t)))):Jn(n=Rn(we(we(t))))===1?(pt(we(t),0),pt(n,0),pt(we(we(t)),1),t=we(we(t))):(t===Rn(we(t))&&(t=we(t),this.rotateRight(t)),pt(we(t),0),pt(we(we(t)),1),this.rotateLeft(we(we(t))));this.root_.color=0}},{key:"values",value:function(){var t=new he,n=this.getFirstEntry();if(n!==null)for(t.add(n.value);(n=e.successor(n))!==null;)t.add(n.value);return t}},{key:"entrySet",value:function(){var t=new wt,n=this.getFirstEntry();if(n!==null)for(t.add(n);(n=e.successor(n))!==null;)t.add(n);return t}},{key:"rotateLeft",value:function(t){if(t!=null){var n=t.right;t.right=n.left,n.left!=null&&(n.left.parent=t),n.parent=t.parent,t.parent==null?this.root_=n:t.parent.left===t?t.parent.left=n:t.parent.right=n,n.left=t,t.parent=n}}},{key:"rotateRight",value:function(t){if(t!=null){var n=t.left;t.left=n.right,n.right!=null&&(n.right.parent=t),n.parent=t.parent,t.parent==null?this.root_=n:t.parent.right===t?t.parent.right=n:t.parent.left=n,n.right=t,t.parent=n}}},{key:"getFirstEntry",value:function(){var t=this.root_;if(t!=null)for(;t.left!=null;)t=t.left;return t}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(t){for(var n=this.root_;n!==null;){var r=t.compareTo(n.key);if(r<0)n=n.left;else{if(!(r>0))return!0;n=n.right}}return!1}}],[{key:"successor",value:function(t){var n;if(t===null)return null;if(t.right!==null){for(n=t.right;n.left!==null;)n=n.left;return n}n=t.parent;for(var r=t;n!==null&&r===n.right;)r=n,n=n.parent;return n}}])})(bi),C=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"find",value:function(i){return this.nodeMap.get(i)}},{key:"addNode",value:function(){if(arguments[0]instanceof M){var i=arguments[0],e=this.nodeMap.get(i);return e===null&&(e=this.nodeFact.createNode(i),this.nodeMap.put(i,e)),e}if(arguments[0]instanceof pn){var t=arguments[0],n=this.nodeMap.get(t.getCoordinate());return n===null?(this.nodeMap.put(t.getCoordinate(),t),t):(n.mergeLabel(t),n)}}},{key:"print",value:function(i){for(var e=this.iterator();e.hasNext();)e.next().print(i)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(i){for(var e=new he,t=this.iterator();t.hasNext();){var n=t.next();n.getLabel().getLocation(i)===x.BOUNDARY&&e.add(n)}return e}},{key:"add",value:function(i){var e=i.getCoordinate();this.addNode(e).add(i)}}],[{key:"constructor_",value:function(){this.nodeMap=new E,this.nodeFact=null;var i=arguments[0];this.nodeFact=i}}])})(),L=(function(){function i(){c(this,i)}return d(i,null,[{key:"isNorthern",value:function(e){return e===i.NE||e===i.NW}},{key:"isOpposite",value:function(e,t){return e!==t&&(e-t+4)%4===2}},{key:"commonHalfPlane",value:function(e,t){if(e===t)return e;if((e-t+4)%4===2)return-1;var n=e<t?e:t;return n===0&&(e>t?e:t)===3?3:n}},{key:"isInHalfPlane",value:function(e,t){return t===i.SE?e===i.SE||e===i.SW:e===t||e===t+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new Y("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?i.NE:i.SE:t>=0?i.NW:i.SW}if(arguments[0]instanceof M&&arguments[1]instanceof M){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new Y("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?i.NE:i.SE:r.y>=n.y?i.NW:i.SW}}}])})();L.NE=0,L.NW=1,L.SW=2,L.SE=3;var D=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"compareDirection",value:function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:ge.index(e._p0,e._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(e){this._node=e}},{key:"print",value:function(e){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),s=n.substring(r+1);e.print("  "+s+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)}},{key:"compareTo",value:function(e){var t=e;return this.compareDirection(t)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf(".");return"  "+t.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label}},{key:"computeLabel",value:function(e){}},{key:"init",value:function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=L.quadrant(this._dx,this._dy),ke.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var t=arguments[0],n=arguments[1],r=arguments[2];i.constructor_.call(this,t,n,r,null)}else if(arguments.length===4){var s=arguments[0],o=arguments[1],u=arguments[2],m=arguments[3];i.constructor_.call(this,s),this.init(o,u),this._label=m}}}])})(),j=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(t){return this._depth[t]}},{key:"setVisited",value:function(t){this._isVisited=t}},{key:"computeDirectedLabel",value:function(){this._label=new ct(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(t,n){if(this._depth[t]!==-999&&this._depth[t]!==n)throw new ut("assigned depths do not match",this.getCoordinate());this._depth[t]=n}},{key:"isInteriorAreaEdge",value:function(){for(var t=!0,n=0;n<2;n++)this._label.isArea(n)&&this._label.getLocation(n,q.LEFT)===x.INTERIOR&&this._label.getLocation(n,q.RIGHT)===x.INTERIOR||(t=!1);return t}},{key:"setNextMin",value:function(t){this._nextMin=t}},{key:"print",value:function(t){w(e,"print",this,1).call(this,t),t.print(" "+this._depth[q.LEFT]+"/"+this._depth[q.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this._isInResult&&t.print(" inResult")}},{key:"setMinEdgeRing",value:function(t){this._minEdgeRing=t}},{key:"isLineEdge",value:function(){var t=this._label.isLine(0)||this._label.isLine(1),n=!this._label.isArea(0)||this._label.allPositionsEqual(0,x.EXTERIOR),r=!this._label.isArea(1)||this._label.allPositionsEqual(1,x.EXTERIOR);return t&&n&&r}},{key:"setEdgeRing",value:function(t){this._edgeRing=t}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t}},{key:"setInResult",value:function(t){this._isInResult=t}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)}},{key:"setSym",value:function(t){this._sym=t}},{key:"setVisitedEdge",value:function(t){this.setVisited(t),this._sym.setVisited(t)}},{key:"setEdgeDepths",value:function(t,n){var r=this.getEdge().getDepthDelta();this._isForward||(r=-r);var s=1;t===q.LEFT&&(s=-1);var o=q.opposite(t),u=n+r*s;this.setDepth(t,n),this.setDepth(o,u)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(t){this._next=t}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var t=arguments[0],n=arguments[1];if(D.constructor_.call(this,t),this._isForward=n,n)this.init(t.getCoordinate(0),t.getCoordinate(1));else{var r=t.getNumPoints()-1;this.init(t.getCoordinate(r),t.getCoordinate(r-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(t,n){return t===x.EXTERIOR&&n===x.INTERIOR?1:t===x.INTERIOR&&n===x.EXTERIOR?-1:0}}])})(D),Z=(function(){return d((function i(){c(this,i)}),[{key:"createNode",value:function(i){return new pn(i,null)}}])})(),re=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"printEdges",value:function(i){i.println("Edges:");for(var e=0;e<this._edges.size();e++){i.println("edge "+e+":");var t=this._edges.get(e);t.print(i),t.eiList.print(i)}}},{key:"find",value:function(i){return this._nodes.find(i)}},{key:"addNode",value:function(){if(arguments[0]instanceof pn){var i=arguments[0];return this._nodes.addNode(i)}if(arguments[0]instanceof M){var e=arguments[0];return this._nodes.addNode(e)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var i=this._nodes.iterator();i.hasNext();)i.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(i){et.out.println(i)}},{key:"isBoundaryNode",value:function(i,e){var t=this._nodes.find(e);if(t===null)return!1;var n=t.getLabel();return n!==null&&n.getLocation(i)===x.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var i=this._nodes.iterator();i.hasNext();)i.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(i,e,t,n){return!!i.equals(t)&&ge.index(i,e,n)===ge.COLLINEAR&&L.quadrant(i,e)===L.quadrant(t,n)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(i){et.out.print(i)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(i,e){for(var t=0;t<this._edges.size();t++){var n=this._edges.get(t),r=n.getCoordinates();if(this.matchInSameDirection(i,e,r[0],r[1])||this.matchInSameDirection(i,e,r[r.length-1],r[r.length-2]))return n}return null}},{key:"insertEdge",value:function(i){this._edges.add(i)}},{key:"findEdgeEnd",value:function(i){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var t=e.next();if(t.getEdge()===i)return t}return null}},{key:"addEdges",value:function(i){for(var e=i.iterator();e.hasNext();){var t=e.next();this._edges.add(t);var n=new j(t,!0),r=new j(t,!1);n.setSym(r),r.setSym(n),this.add(n),this.add(r)}}},{key:"add",value:function(i){this._nodes.add(i),this._edgeEndList.add(i)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(i,e){for(var t=0;t<this._edges.size();t++){var n=this._edges.get(t),r=n.getCoordinates();if(i.equals(r[0])&&e.equals(r[1]))return n}return null}}],[{key:"constructor_",value:function(){if(this._edges=new he,this._nodes=null,this._edgeEndList=new he,arguments.length===0)this._nodes=new C(new Z);else if(arguments.length===1){var i=arguments[0];this._nodes=new C(i)}}},{key:"linkResultDirectedEdges",value:function(i){for(var e=i.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()}}])})(),te=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"sortShellsAndHoles",value:function(e,t,n){for(var r=e.iterator();r.hasNext();){var s=r.next();s.isHole()?n.add(s):t.add(s)}}},{key:"computePolygons",value:function(e){for(var t=new he,n=e.iterator();n.hasNext();){var r=n.next().toPolygon(this._geometryFactory);t.add(r)}return t}},{key:"placeFreeHoles",value:function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next();if(r.getShell()===null){var s=i.findEdgeRingContaining(r,e);if(s===null)throw new ut("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(s)}}}},{key:"buildMinimalEdgeRings",value:function(e,t,n){for(var r=new he,s=e.iterator();s.hasNext();){var o=s.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var u=o.buildMinimalRings(),m=this.findShell(u);m!==null?(this.placePolygonHoles(m,u),t.add(m)):n.addAll(u)}else r.add(o)}return r}},{key:"buildMaximalEdgeRings",value:function(e){for(var t=new he,n=e.iterator();n.hasNext();){var r=n.next();if(r.isInResult()&&r.getLabel().isArea()&&r.getEdgeRing()===null){var s=new wi(r,this._geometryFactory);t.add(s),s.setInResult()}}return t}},{key:"placePolygonHoles",value:function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(e)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(e){for(var t=0,n=null,r=e.iterator();r.hasNext();){var s=r.next();s.isHole()||(n=s,t++)}return ke.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n}},{key:"add",value:function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var t=arguments[0],n=arguments[1];re.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(t),s=new he,o=this.buildMinimalEdgeRings(r,this._shellList,s);this.sortShellsAndHoles(o,this._shellList,s),this.placeFreeHoles(this._shellList,s)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new he;var e=arguments[0];this._geometryFactory=e}},{key:"findEdgeRingContaining",value:function(e,t){for(var n=e.getLinearRing(),r=n.getEnvelopeInternal(),s=n.getCoordinateN(0),o=null,u=null,m=t.iterator();m.hasNext();){var y=m.next(),T=y.getLinearRing(),R=T.getEnvelopeInternal();if(!R.equals(r)&&R.contains(r)){s=Ve.ptNotInList(n.getCoordinates(),T.getCoordinates());var G=!1;Wn.isInRing(s,T.getCoordinates())&&(G=!0),G&&(o===null||u.contains(R))&&(u=(o=y).getLinearRing().getEnvelopeInternal())}}return o}}])})(),ue=(function(){return d((function i(){c(this,i)}),[{key:"getBounds",value:function(){}}])})(),le=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[ue,Q]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var i=arguments[0],e=arguments[1];this._bounds=i,this._item=e}}])})(),ie=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"poll",value:function(){if(this.isEmpty())return null;var i=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),i}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(i){for(var e=null,t=this._items.get(i);2*i<=this._size&&((e=2*i)!==this._size&&this._items.get(e+1).compareTo(this._items.get(e))<0&&e++,this._items.get(e).compareTo(t)<0);i=e)this._items.set(i,this._items.get(e));this._items.set(i,t)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(i){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,i);i.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,i)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new he,this._items.add(null)}}])})(),ee=(function(){return d((function i(){c(this,i)}),[{key:"insert",value:function(i,e){}},{key:"remove",value:function(i,e){}},{key:"query",value:function(){}}])})(),ae=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(i){ke.isTrue(this._bounds===null),this._childBoundables.add(i)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[ue,Q]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new he,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var i=arguments[0];this._level=i}}}}])})(),ve={reverseOrder:function(){return{compare:function(i,e){return e.compareTo(i)}}},min:function(i){return ve.sort(i),i.get(0)},sort:function(i,e){var t=i.toArray();e?qt.sort(t,e):qt.sort(t);for(var n=i.iterator(),r=0,s=t.length;r<s;r++)n.next(),n.set(t[r])},singletonList:function(i){var e=new he;return e.add(i),e}},Ee=(function(){function i(){c(this,i)}return d(i,null,[{key:"maxDistance",value:function(e,t,n,r,s,o,u,m){var y=i.distance(e,t,s,o);return y=Math.max(y,i.distance(e,t,u,m)),y=Math.max(y,i.distance(n,r,s,o)),y=Math.max(y,i.distance(n,r,u,m))}},{key:"distance",value:function(e,t,n,r){var s=n-e,o=r-t;return Math.sqrt(s*s+o*o)}},{key:"maximumDistance",value:function(e,t){var n=Math.min(e.getMinX(),t.getMinX()),r=Math.min(e.getMinY(),t.getMinY()),s=Math.max(e.getMaxX(),t.getMaxX()),o=Math.max(e.getMaxY(),t.getMaxY());return i.distance(n,r,s,o)}},{key:"minMaxDistance",value:function(e,t){var n=e.getMinX(),r=e.getMinY(),s=e.getMaxX(),o=e.getMaxY(),u=t.getMinX(),m=t.getMinY(),y=t.getMaxX(),T=t.getMaxY(),R=i.maxDistance(n,r,n,o,u,m,u,T);return R=Math.min(R,i.maxDistance(n,r,n,o,u,m,y,m)),R=Math.min(R,i.maxDistance(n,r,n,o,y,T,u,T)),R=Math.min(R,i.maxDistance(n,r,n,o,y,T,y,m)),R=Math.min(R,i.maxDistance(n,r,s,r,u,m,u,T)),R=Math.min(R,i.maxDistance(n,r,s,r,u,m,y,m)),R=Math.min(R,i.maxDistance(n,r,s,r,y,T,u,T)),R=Math.min(R,i.maxDistance(n,r,s,r,y,T,y,m)),R=Math.min(R,i.maxDistance(s,o,n,o,u,m,u,T)),R=Math.min(R,i.maxDistance(s,o,n,o,u,m,y,m)),R=Math.min(R,i.maxDistance(s,o,n,o,y,T,u,T)),R=Math.min(R,i.maxDistance(s,o,n,o,y,T,y,m)),R=Math.min(R,i.maxDistance(s,o,s,r,u,m,u,T)),R=Math.min(R,i.maxDistance(s,o,s,r,u,m,y,m)),R=Math.min(R,i.maxDistance(s,o,s,r,y,T,u,T)),R=Math.min(R,i.maxDistance(s,o,s,r,y,T,y,m))}}])})(),Oe=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"maximumDistance",value:function(){return Ee.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(e,t){var n=i.isComposite(this._boundable1),r=i.isComposite(this._boundable2);if(n&&r)return i.area(this._boundable1)>i.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,e,t),null):(this.expand(this._boundable2,this._boundable1,!0,e,t),null);if(n)return this.expand(this._boundable1,this._boundable2,!1,e,t),null;if(r)return this.expand(this._boundable2,this._boundable1,!0,e,t),null;throw new Y("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(i.isComposite(this._boundable1)||i.isComposite(this._boundable2))}},{key:"compareTo",value:function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0}},{key:"expand",value:function(e,t,n,r,s){for(var o=e.getChildBoundables().iterator();o.hasNext();){var u=o.next(),m=null;(m=n?new i(t,u,this._itemDistance):new i(u,t,this._itemDistance)).getDistance()<s&&r.add(m)}}},{key:"getBoundable",value:function(e){return e===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=n,this._distance=this.distance()}},{key:"area",value:function(e){return e.getBounds().getArea()}},{key:"isComposite",value:function(e){return e instanceof ae}}])})(),At=(function(){return d((function i(){c(this,i)}),[{key:"visitItem",value:function(i){}}])})(),Je=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"queryInternal",value:function(){if(ye(arguments[2],At)&&arguments[0]instanceof Object&&arguments[1]instanceof ae)for(var e=arguments[0],t=arguments[2],n=arguments[1].getChildBoundables(),r=0;r<n.size();r++){var s=n.get(r);this.getIntersectsOp().intersects(s.getBounds(),e)&&(s instanceof ae?this.queryInternal(e,s,t):s instanceof le?t.visitItem(s.getItem()):ke.shouldNeverReachHere())}else if(ye(arguments[2],Ct)&&arguments[0]instanceof Object&&arguments[1]instanceof ae)for(var o=arguments[0],u=arguments[2],m=arguments[1].getChildBoundables(),y=0;y<m.size();y++){var T=m.get(y);this.getIntersectsOp().intersects(T.getBounds(),o)&&(T instanceof ae?this.queryInternal(o,T,u):T instanceof le?u.add(T.getItem()):ke.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(e){return e.get(e.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var n=t.next();n instanceof ae?e+=this.size(n):n instanceof le&&(e+=1)}return e}}},{key:"removeItem",value:function(e,t){for(var n=null,r=e.getChildBoundables().iterator();r.hasNext();){var s=r.next();s instanceof le&&s.getItem()===t&&(n=s)}return n!==null&&(e.getChildBoundables().remove(n),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var e=this.itemsTree(this._root);return e===null?new he:e}if(arguments.length===1){for(var t=arguments[0],n=new he,r=t.getChildBoundables().iterator();r.hasNext();){var s=r.next();if(s instanceof ae){var o=this.itemsTree(s);o!==null&&n.add(o)}else s instanceof le?n.add(s.getItem()):ke.shouldNeverReachHere()}return n.size()<=0?null:n}}},{key:"insert",value:function(e,t){ke.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new le(e,t))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var e=arguments[0],t=new he;return this.boundablesAtLevel(e,this._root,t),t}if(arguments.length===3){var n=arguments[0],r=arguments[1],s=arguments[2];if(ke.isTrue(n>-2),r.getLevel()===n)return s.add(r),null;for(var o=r.getChildBoundables().iterator();o.hasNext();){var u=o.next();u instanceof ae?this.boundablesAtLevel(n,u,s):(ke.isTrue(u instanceof le),n===-1&&s.add(u))}return null}}},{key:"query",value:function(){if(arguments.length===1){var e=arguments[0];this.build();var t=new he;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.queryInternal(e,this._root,t),t}if(arguments.length===2){var n=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.queryInternal(n,this._root,r)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,t)}if(arguments.length===3){var n=arguments[0],r=arguments[1],s=arguments[2],o=this.removeItem(r,s);if(o)return!0;for(var u=null,m=r.getChildBoundables().iterator();m.hasNext();){var y=m.next();if(this.getIntersectsOp().intersects(y.getBounds(),n)&&y instanceof ae&&(o=this.remove(n,y,s))){u=y;break}}return u!==null&&u.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(u),o}}},{key:"createHigherLevels",value:function(e,t){ke.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,t+1);return n.size()===1?n.get(0):this.createHigherLevels(n,t+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var n=t.next();if(n instanceof ae){var r=this.depth(n);r>e&&(e=r)}}return e+1}}},{key:"createParentBoundables",value:function(e,t){ke.isTrue(!e.isEmpty());var n=new he;n.add(this.createNode(t));var r=new he(e);ve.sort(r,this.getComparator());for(var s=r.iterator();s.hasNext();){var o=s.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(t)),this.lastNode(n).addChildBoundable(o)}return n}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[Q]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new he,this._nodeCapacity=null,arguments.length===0)i.constructor_.call(this,i.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var e=arguments[0];ke.isTrue(e>1,"Node capacity must be greater than 1"),this._nodeCapacity=e}}},{key:"compareDoubles",value:function(e,t){return e>t?1:e<t?-1:0}}])})();Je.IntersectsOp=function(){},Je.DEFAULT_NODE_CAPACITY=10;var Et=(function(){return d((function i(){c(this,i)}),[{key:"distance",value:function(i,e){}}])})(),Xe=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"createParentBoundablesFromVerticalSlices",value:function(t,n){ke.isTrue(t.length>0);for(var r=new he,s=0;s<t.length;s++)r.addAll(this.createParentBoundablesFromVerticalSlice(t[s],n));return r}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.nearestNeighbourK(t,ne.POSITIVE_INFINITY,n)}if(arguments.length===3){var r=arguments[0],s=arguments[2],o=arguments[1],u=new ie;u.add(r);for(var m=new ie;!u.isEmpty()&&o>=0;){var y=u.poll(),T=y.getDistance();if(T>=o)break;y.isLeaves()?m.size()<s?m.add(y):(m.peek().getDistance()>T&&(m.poll(),m.add(y)),o=m.peek().getDistance()):y.expandToQueue(u,o)}return e.getItems(m)}}},{key:"createNode",value:function(t){return new bt(t)}},{key:"size",value:function(){return arguments.length===0?w(e,"size",this,1).call(this):w(e,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Me))return w(e,"insert",this,1).apply(this,arguments);var t=arguments[0],n=arguments[1];if(t.isNull())return null;w(e,"insert",this,1).call(this,t,n)}},{key:"getIntersectsOp",value:function(){return e.intersectsOp}},{key:"verticalSlices",value:function(t,n){for(var r=Math.trunc(Math.ceil(t.size()/n)),s=new Array(n).fill(null),o=t.iterator(),u=0;u<n;u++){s[u]=new he;for(var m=0;o.hasNext()&&m<r;){var y=o.next();s[u].add(y),m++}}return s}},{key:"query",value:function(){if(arguments.length===1){var t=arguments[0];return w(e,"query",this,1).call(this,t)}if(arguments.length===2){var n=arguments[0],r=arguments[1];w(e,"query",this,1).call(this,n,r)}}},{key:"getComparator",value:function(){return e.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(t,n){return w(e,"createParentBoundables",this,1).call(this,t,n)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Me){var t=arguments[0],n=arguments[1];return w(e,"remove",this,1).call(this,t,n)}return w(e,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?w(e,"depth",this,1).call(this):w(e,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(t,n){ke.isTrue(!t.isEmpty());var r=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),s=new he(t);ve.sort(s,e.xComparator);var o=this.verticalSlices(s,Math.trunc(Math.ceil(Math.sqrt(r))));return this.createParentBoundablesFromVerticalSlices(o,n)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(ye(arguments[0],Et)){var t=arguments[0];if(this.isEmpty())return null;var n=new Oe(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(n)}if(arguments[0]instanceof Oe){var r=arguments[0],s=ne.POSITIVE_INFINITY,o=null,u=new ie;for(u.add(r);!u.isEmpty()&&s>0;){var m=u.poll(),y=m.getDistance();if(y>=s)break;m.isLeaves()?(s=y,o=m):m.expandToQueue(u,s)}return o===null?null:[o.getBoundable(0).getItem(),o.getBoundable(1).getItem()]}}else{if(arguments.length===2){var T=arguments[0],R=arguments[1];if(this.isEmpty()||T.isEmpty())return null;var G=new Oe(this.getRoot(),T.getRoot(),R);return this.nearestNeighbour(G)}if(arguments.length===3){var J=arguments[2],se=new le(arguments[0],arguments[1]),ce=new Oe(this.getRoot(),se,J);return this.nearestNeighbour(ce)[0]}if(arguments.length===4){var be=arguments[2],Se=arguments[3],Ae=new le(arguments[0],arguments[1]),Qe=new Oe(this.getRoot(),Ae,be);return this.nearestNeighbourK(Qe,Se)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var t=arguments[0],n=arguments[1],r=ne.POSITIVE_INFINITY,s=new ie;for(s.add(t);!s.isEmpty();){var o=s.poll(),u=o.getDistance();if(u>n)return!1;if(o.maximumDistance()<=n)return!0;if(o.isLeaves()){if((r=u)<=n)return!0}else o.expandToQueue(s,r)}return!1}if(arguments.length===3){var m=arguments[0],y=arguments[1],T=arguments[2],R=new Oe(this.getRoot(),m.getRoot(),y);return this.isWithinDistance(R,T)}}},{key:"interfaces_",get:function(){return[ee,Q]}}],[{key:"constructor_",value:function(){if(arguments.length===0)e.constructor_.call(this,e.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var t=arguments[0];Je.constructor_.call(this,t)}}},{key:"centreX",value:function(t){return e.avg(t.getMinX(),t.getMaxX())}},{key:"avg",value:function(t,n){return(t+n)/2}},{key:"getItems",value:function(t){for(var n=new Array(t.size()).fill(null),r=0;!t.isEmpty();){var s=t.poll();n[r]=s.getBoundable(0).getItem(),r++}return n}},{key:"centreY",value:function(t){return e.avg(t.getMinY(),t.getMaxY())}}])})(Je),bt=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"computeBounds",value:function(){for(var t=null,n=this.getChildBoundables().iterator();n.hasNext();){var r=n.next();t===null?t=new Me(r.getBounds()):t.expandToInclude(r.getBounds())}return t}}],[{key:"constructor_",value:function(){var t=arguments[0];ae.constructor_.call(this,t)}}])})(ae);Xe.STRtreeNode=bt,Xe.xComparator=new((function(){return d((function i(){c(this,i)}),[{key:"interfaces_",get:function(){return[Ge]}},{key:"compare",value:function(i,e){return Je.compareDoubles(Xe.centreX(i.getBounds()),Xe.centreX(e.getBounds()))}}])})()),Xe.yComparator=new((function(){return d((function i(){c(this,i)}),[{key:"interfaces_",get:function(){return[Ge]}},{key:"compare",value:function(i,e){return Je.compareDoubles(Xe.centreY(i.getBounds()),Xe.centreY(e.getBounds()))}}])})()),Xe.intersectsOp=new((function(){return d((function i(){c(this,i)}),[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(i,e){return i.intersects(e)}}])})()),Xe.DEFAULT_NODE_CAPACITY=10;var _n=(function(){function i(){c(this,i)}return d(i,null,[{key:"relativeSign",value:function(e,t){return e<t?-1:e>t?1:0}},{key:"compare",value:function(e,t,n){if(t.equals2D(n))return 0;var r=i.relativeSign(t.x,n.x),s=i.relativeSign(t.y,n.y);switch(e){case 0:return i.compareValue(r,s);case 1:return i.compareValue(s,r);case 2:return i.compareValue(s,-r);case 3:return i.compareValue(-r,s);case 4:return i.compareValue(-r,-s);case 5:return i.compareValue(-s,-r);case 6:return i.compareValue(-s,r);case 7:return i.compareValue(r,-s)}return ke.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0}}])})(),Jt=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(i){i.print(this.coord),i.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(i){var e=i;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:this._isInterior?e._isInterior?_n.compare(this._segmentOctant,this.coord,e.coord):1:-1}},{key:"isEndPoint",value:function(i){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===i}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var i=arguments[0],e=arguments[1],t=arguments[2],n=arguments[3];this._segString=i,this.coord=new M(e),this.segmentIndex=t,this._segmentOctant=n,this._isInterior=!e.equals2D(i.getCoordinate(t))}}])})(),Qn=(function(){return d((function i(){c(this,i)}),[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])})(),Ia=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"getSplitCoordinates",value:function(){var i=new kt;this.addEndpoints();for(var e=this.iterator(),t=e.next();e.hasNext();){var n=e.next();this.addEdgeCoordinates(t,n,i),t=n}return i.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var i=new he;this.findCollapsesFromInsertedNodes(i),this.findCollapsesFromExistingVertices(i);for(var e=i.iterator();e.hasNext();){var t=e.next().intValue();this.add(this._edge.getCoordinate(t),t)}}},{key:"createSplitEdgePts",value:function(i,e){var t=e.segmentIndex-i.segmentIndex+2;if(t===2)return[new M(i.coord),new M(e.coord)];var n=this._edge.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(n);r||t--;var s=new Array(t).fill(null),o=0;s[o++]=new M(i.coord);for(var u=i.segmentIndex+1;u<=e.segmentIndex;u++)s[o++]=this._edge.getCoordinate(u);return r&&(s[o]=new M(e.coord)),s}},{key:"print",value:function(i){i.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(i)}},{key:"findCollapsesFromExistingVertices",value:function(i){for(var e=0;e<this._edge.size()-2;e++){var t=this._edge.getCoordinate(e);this._edge.getCoordinate(e+1);var n=this._edge.getCoordinate(e+2);t.equals2D(n)&&i.add(un.valueOf(e+1))}}},{key:"addEdgeCoordinates",value:function(i,e,t){var n=this.createSplitEdgePts(i,e);t.add(n,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(i){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),t=e.next();e.hasNext();){var n=e.next(),r=this.createSplitEdge(t,n);i.add(r),t=n}}},{key:"findCollapseIndex",value:function(i,e,t){if(!i.coord.equals2D(e.coord))return!1;var n=e.segmentIndex-i.segmentIndex;return e.isInterior()||n--,n===1&&(t[0]=i.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(i){for(var e=new Array(1).fill(null),t=this.iterator(),n=t.next();t.hasNext();){var r=t.next();this.findCollapseIndex(n,r,e)&&i.add(un.valueOf(e[0])),n=r}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var i=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(i),i)}},{key:"createSplitEdge",value:function(i,e){var t=this.createSplitEdgePts(i,e);return new xn(t,this._edge.getData())}},{key:"add",value:function(i,e){var t=new Jt(this._edge,i,e,this._edge.getSegmentOctant(e)),n=this._nodeMap.get(t);return n!==null?(ke.isTrue(n.coord.equals2D(i),"Found equal nodes with different coordinates"),n):(this._nodeMap.put(t,t),t)}},{key:"checkSplitEdgesCorrectness",value:function(i){var e=this._edge.getCoordinates(),t=i.get(0).getCoordinate(0);if(!t.equals2D(e[0]))throw new Be("bad split edge start point at "+t);var n=i.get(i.size()-1).getCoordinates(),r=n[n.length-1];if(!r.equals2D(e[e.length-1]))throw new Be("bad split edge end point at "+r)}}],[{key:"constructor_",value:function(){this._nodeMap=new E,this._edge=null;var i=arguments[0];this._edge=i}}])})(),Sa=(function(){function i(){c(this,i)}return d(i,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new Y("Cannot compute the octant for point ( "+e+", "+t+" )");var n=Math.abs(e),r=Math.abs(t);return e>=0?t>=0?n>=r?0:1:n>=r?7:6:t>=0?n>=r?3:2:n>=r?4:5}if(arguments[0]instanceof M&&arguments[1]instanceof M){var s=arguments[0],o=arguments[1],u=o.x-s.x,m=o.y-s.y;if(u===0&&m===0)throw new Y("Cannot compute the octant for two identical points "+s);return i.octant(u,m)}}}])})(),wa=(function(){return d((function i(){c(this,i)}),[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(i){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(i){}},{key:"getData",value:function(){}}])})(),ba=(function(){return d((function i(){c(this,i)}),[{key:"addIntersection",value:function(i,e){}},{key:"interfaces_",get:function(){return[wa]}}])})(),xn=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(e){return this._pts[e]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))}},{key:"setData",value:function(e){this._data=e}},{key:"safeOctant",value:function(e,t){return e.equals2D(t)?0:Sa.octant(e,t)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(arguments.length===4){var n=arguments[1],r=arguments[3],s=new M(arguments[0].getIntersection(r));this.addIntersection(s,n)}}},{key:"toString",value:function(){return Ln.toLineString(new gn(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(e,t){var n=t,r=n+1;if(r<this._pts.length){var s=this._pts[r];e.equals2D(s)&&(n=r)}return this._nodeList.add(e,n)}},{key:"addIntersections",value:function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++)this.addIntersection(e,t,n,r)}},{key:"interfaces_",get:function(){return[ba]}}],[{key:"constructor_",value:function(){this._nodeList=new Ia(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var e=arguments[0],t=new he;return i.getNodedSubstrings(e,t),t}if(arguments.length===2)for(var n=arguments[1],r=arguments[0].iterator();r.hasNext();)r.next().getNodeList().addSplitEdges(n)}}])})(),_t=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof i){var e=arguments[0],t=ge.index(this.p0,this.p1,e.p0),n=ge.index(this.p0,this.p1,e.p1);return t>=0&&n>=0||t<=0&&n<=0?Math.max(t,n):0}if(arguments[0]instanceof M){var r=arguments[0];return ge.index(this.p0,this.p1,r)}}},{key:"toGeometry",value:function(e){return e.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(e){if(!(e instanceof i))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)}},{key:"intersection",value:function(e){var t=new zt;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof M){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new M(e);var t=this.projectionFactor(e),n=new M;return n.x=this.p0.x+t*(this.p1.x-this.p0.x),n.y=this.p0.y+t*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof i){var r=arguments[0],s=this.projectionFactor(r.p0),o=this.projectionFactor(r.p1);if(s>=1&&o>=1||s<=0&&o<=0)return null;var u=this.project(r.p0);s<0&&(u=this.p0),s>1&&(u=this.p1);var m=this.project(r.p1);return o<0&&(m=this.p0),o>1&&(m=this.p1),new i(u,m)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(e){return e===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(e){return mt.pointToLinePerpendicular(e,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return i.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=t*t+n*n;return r<=0?ne.NaN:((e.x-this.p0.x)*t+(e.y-this.p0.y)*n)/r}},{key:"closestPoints",value:function(e){var t=this.intersection(e);if(t!==null)return[t,t];var n=new Array(2).fill(null),r=ne.MAX_VALUE,s=null,o=this.closestPoint(e.p0);r=o.distance(e.p0),n[0]=o,n[1]=e.p0;var u=this.closestPoint(e.p1);(s=u.distance(e.p1))<r&&(r=s,n[0]=u,n[1]=e.p1);var m=e.closestPoint(this.p0);(s=m.distance(this.p0))<r&&(r=s,n[0]=this.p0,n[1]=m);var y=e.closestPoint(this.p1);return(s=y.distance(this.p1))<r&&(r=s,n[0]=this.p1,n[1]=y),n}},{key:"closestPoint",value:function(e){var t=this.projectionFactor(e);return t>0&&t<1?this.project(e):this.p0.distance(e)<this.p1.distance(e)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(e){var t=e,n=this.p0.compareTo(t.p0);return n!==0?n:this.p1.compareTo(t.p1)}},{key:"reverse",value:function(){var e=this.p0;this.p0=this.p1,this.p1=e}},{key:"equalsTopo",value:function(e){return this.p0.equals(e.p0)&&this.p1.equals(e.p1)||this.p0.equals(e.p1)&&this.p1.equals(e.p0)}},{key:"lineIntersection",value:function(e){return cn.intersection(this.p0,this.p1,e.p0,e.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(e,t){var n=this.p0.x+e*(this.p1.x-this.p0.x),r=this.p0.y+e*(this.p1.y-this.p0.y),s=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,u=Math.sqrt(s*s+o*o),m=0,y=0;if(t!==0){if(u<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");m=t*s/u,y=t*o/u}return new M(n-y,r+m)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}}},{key:"segmentFraction",value:function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||ne.isNaN(t))&&(t=1),t}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(e){var t=this.p1.getY()-this.p0.getY(),n=this.p0.getX()-this.p1.getX(),r=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),s=t*t+n*n,o=t*t-n*n,u=e.getX(),m=e.getY();return new M((-o*u-2*t*n*m-2*t*r)/s,(o*m-2*t*n*u-2*n*r)/s)}},{key:"distance",value:function(){if(arguments[0]instanceof i){var e=arguments[0];return mt.segmentToSegment(this.p0,this.p1,e.p0,e.p1)}if(arguments[0]instanceof M){var t=arguments[0];return mt.pointToSegment(t,this.p0,this.p1)}}},{key:"pointAlong",value:function(e){var t=new M;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t}},{key:"hashCode",value:function(){var e=ne.doubleToLongBits(this.p0.x);e^=31*ne.doubleToLongBits(this.p0.y);var t=Math.trunc(e)^Math.trunc(e>>32),n=ne.doubleToLongBits(this.p1.x);return n^=31*ne.doubleToLongBits(this.p1.y),t^(Math.trunc(n)^Math.trunc(n>>32))}},{key:"interfaces_",get:function(){return[W,Q]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)i.constructor_.call(this,new M,new M);else if(arguments.length===1){var e=arguments[0];i.constructor_.call(this,e.p0,e.p1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.p0=t,this.p1=n}else if(arguments.length===4){var r=arguments[0],s=arguments[1],o=arguments[2],u=arguments[3];i.constructor_.call(this,new M(r,s),new M(o,u))}}},{key:"midPoint",value:function(e,t){return new M((e.x+t.x)/2,(e.y+t.y)/2)}}])})(),Ta=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var i=arguments[1],e=arguments[2],t=arguments[3];arguments[0].getLineSegment(i,this._overlapSeg1),e.getLineSegment(t,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new _t,this._overlapSeg2=new _t}}])})(),qr=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"getLineSegment",value:function(i,e){e.p0=this._pts[i],e.p1=this._pts[i+1]}},{key:"computeSelect",value:function(i,e,t,n){var r=this._pts[e],s=this._pts[t];if(t-e==1)return n.select(this,e),null;if(!i.intersects(r,s))return null;var o=Math.trunc((e+t)/2);e<o&&this.computeSelect(i,e,o,n),o<t&&this.computeSelect(i,o,t,n)}},{key:"getCoordinates",value:function(){for(var i=new Array(this._end-this._start+1).fill(null),e=0,t=this._start;t<=this._end;t++)i[e++]=this._pts[t];return i}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var i=arguments[0],e=arguments[1];this.computeOverlaps(this._start,this._end,i,i._start,i._end,e)}else if(arguments.length===6){var t=arguments[0],n=arguments[1],r=arguments[2],s=arguments[3],o=arguments[4],u=arguments[5];if(n-t==1&&o-s==1)return u.overlap(this,t,r,s),null;if(!this.overlaps(t,n,r,s,o))return null;var m=Math.trunc((t+n)/2),y=Math.trunc((s+o)/2);t<m&&(s<y&&this.computeOverlaps(t,m,r,s,y,u),y<o&&this.computeOverlaps(t,m,r,y,o,u)),m<n&&(s<y&&this.computeOverlaps(m,n,r,s,y,u),y<o&&this.computeOverlaps(m,n,r,y,o,u))}}},{key:"setId",value:function(i){this._id=i}},{key:"select",value:function(i,e){this.computeSelect(i,this._start,this._end,e)}},{key:"getEnvelope",value:function(){if(this._env===null){var i=this._pts[this._start],e=this._pts[this._end];this._env=new Me(i,e)}return this._env}},{key:"overlaps",value:function(i,e,t,n,r){return Me.intersects(this._pts[i],this._pts[e],t._pts[n],t._pts[r])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var i=arguments[0],e=arguments[1],t=arguments[2],n=arguments[3];this._pts=i,this._start=e,this._end=t,this._context=n}}])})(),Ca=(function(){function i(){c(this,i)}return d(i,null,[{key:"findChainEnd",value:function(e,t){for(var n=t;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var r=L.quadrant(e[n],e[n+1]),s=t+1;s<e.length&&!(!e[s-1].equals2D(e[s])&&L.quadrant(e[s-1],e[s])!==r);)s++;return s-1}},{key:"getChains",value:function(){if(arguments.length===1){var e=arguments[0];return i.getChains(e,null)}if(arguments.length===2){var t=arguments[0],n=arguments[1],r=new he,s=0;do{var o=i.findChainEnd(t,s),u=new qr(t,s,o,n);r.add(u),s=o}while(s<t.length-1);return r}}}])})(),lr=(function(){return d((function i(){c(this,i)}),[{key:"computeNodes",value:function(i){}},{key:"getNodedSubstrings",value:function(){}}])})(),zr=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"setSegmentIntersector",value:function(i){this._segInt=i}},{key:"interfaces_",get:function(){return[lr]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var i=arguments[0];this.setSegmentIntersector(i)}}}}])})(),cr=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return xn.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(t){for(var n=Ca.getChains(t.getCoordinates(),t).iterator();n.hasNext();){var r=n.next();r.setId(this._idCounter++),this._index.insert(r.getEnvelope(),r),this._monoChains.add(r)}}},{key:"computeNodes",value:function(t){this._nodedSegStrings=t;for(var n=t.iterator();n.hasNext();)this.add(n.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var t=new Yr(this._segInt),n=this._monoChains.iterator();n.hasNext();)for(var r=n.next(),s=this._index.query(r.getEnvelope()).iterator();s.hasNext();){var o=s.next();if(o.getId()>r.getId()&&(r.computeOverlaps(o,t),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new he,this._index=new Xe,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var t=arguments[0];zr.constructor_.call(this,t)}}}}])})(zr),Yr=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"overlap",value:function(){if(arguments.length!==4)return w(e,"overlap",this,1).apply(this,arguments);var t=arguments[1],n=arguments[2],r=arguments[3],s=arguments[0].getContext(),o=n.getContext();this._si.processIntersections(s,t,o,r)}}],[{key:"constructor_",value:function(){this._si=null;var t=arguments[0];this._si=t}}])})(Ta);cr.SegmentOverlapAction=Yr;var Tt=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"isDeletable",value:function(e,t,n,r){var s=this._inputLine[e],o=this._inputLine[t],u=this._inputLine[n];return!!this.isConcave(s,o,u)&&!!this.isShallow(s,o,u,r)&&this.isShallowSampled(s,o,e,n,r)}},{key:"deleteShallowConcavities",value:function(){for(var e=1,t=this.findNextNonDeletedIndex(e),n=this.findNextNonDeletedIndex(t),r=!1;n<this._inputLine.length;){var s=!1;this.isDeletable(e,t,n,this._distanceTol)&&(this._isDeleted[t]=i.DELETE,s=!0,r=!0),e=s?n:t,t=this.findNextNonDeletedIndex(e),n=this.findNextNonDeletedIndex(t)}return r}},{key:"isShallowConcavity",value:function(e,t,n,r){return ge.index(e,t,n)===this._angleOrientation&&mt.pointToSegment(t,e,n)<r}},{key:"isShallowSampled",value:function(e,t,n,r,s){var o=Math.trunc((r-n)/i.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var u=n;u<r;u+=o)if(!this.isShallow(e,t,this._inputLine[u],s))return!1;return!0}},{key:"isConcave",value:function(e,t,n){var r=ge.index(e,t,n)===this._angleOrientation;return r}},{key:"simplify",value:function(e){this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=ge.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var t=!1;do t=this.deleteShallowConcavities();while(t);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===i.DELETE;)t++;return t}},{key:"isShallow",value:function(e,t,n,r){return mt.pointToSegment(t,e,n)<r}},{key:"collapseLine",value:function(){for(var e=new kt,t=0;t<this._inputLine.length;t++)this._isDeleted[t]!==i.DELETE&&e.add(this._inputLine[t]);return e.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=ge.COUNTERCLOCKWISE;var e=arguments[0];this._inputLine=e}},{key:"simplify",value:function(e,t){return new i(e).simplify(t)}}])})();Tt.INIT=0,Tt.DELETE=1,Tt.KEEP=1,Tt.NUM_PTS_TO_CHECK=10;var Ur=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"getCoordinates",value:function(){return this._ptList.toArray(i.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(e){this._precisionModel=e}},{key:"addPt",value:function(e){var t=new M(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(e,t){if(t)for(var n=0;n<e.length;n++)this.addPt(e[n]);else for(var r=e.length-1;r>=0;r--)this.addPt(e[r])}},{key:"isRedundant",value:function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1);return e.distance(t)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Wt().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var e=new M(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)}},{key:"setMinimumVertexDistance",value:function(e){this._minimimVertexDistance=e}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new he}}])})();Ur.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var xt=(function(){function i(){c(this,i)}return d(i,null,[{key:"toDegrees",value:function(e){return 180*e/Math.PI}},{key:"normalize",value:function(e){for(;e>Math.PI;)e-=i.PI_TIMES_2;for(;e<=-Math.PI;)e+=i.PI_TIMES_2;return e}},{key:"angle",value:function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}if(arguments.length===2){var t=arguments[0],n=arguments[1],r=n.x-t.x,s=n.y-t.y;return Math.atan2(s,r)}}},{key:"isAcute",value:function(e,t,n){var r=e.x-t.x,s=e.y-t.y;return r*(n.x-t.x)+s*(n.y-t.y)>0}},{key:"isObtuse",value:function(e,t,n){var r=e.x-t.x,s=e.y-t.y;return r*(n.x-t.x)+s*(n.y-t.y)<0}},{key:"interiorAngle",value:function(e,t,n){var r=i.angle(t,e),s=i.angle(t,n);return Math.abs(s-r)}},{key:"normalizePositive",value:function(e){if(e<0){for(;e<0;)e+=i.PI_TIMES_2;e>=i.PI_TIMES_2&&(e=0)}else{for(;e>=i.PI_TIMES_2;)e-=i.PI_TIMES_2;e<0&&(e=0)}return e}},{key:"angleBetween",value:function(e,t,n){var r=i.angle(t,e),s=i.angle(t,n);return i.diff(r,s)}},{key:"diff",value:function(e,t){var n=null;return(n=e<t?t-e:e-t)>Math.PI&&(n=2*Math.PI-n),n}},{key:"toRadians",value:function(e){return e*Math.PI/180}},{key:"getTurn",value:function(e,t){var n=Math.sin(t-e);return n>0?i.COUNTERCLOCKWISE:n<0?i.CLOCKWISE:i.NONE}},{key:"angleBetweenOriented",value:function(e,t,n){var r=i.angle(t,e),s=i.angle(t,n)-r;return s<=-Math.PI?s+i.PI_TIMES_2:s>Math.PI?s-i.PI_TIMES_2:s}}])})();xt.PI_TIMES_2=2*Math.PI,xt.PI_OVER_2=Math.PI/2,xt.PI_OVER_4=Math.PI/4,xt.COUNTERCLOCKWISE=ge.COUNTERCLOCKWISE,xt.CLOCKWISE=ge.CLOCKWISE,xt.NONE=ge.COLLINEAR;var ei=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"addNextSegment",value:function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=ge.index(this._s0,this._s1,this._s2),r=n===ge.CLOCKWISE&&this._side===q.LEFT||n===ge.COUNTERCLOCKWISE&&this._side===q.RIGHT;n===0?this.addCollinear(t):r?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)}},{key:"addLineEndCap",value:function(e,t){var n=new _t(e,t),r=new _t;this.computeOffsetSegment(n,q.LEFT,this._distance,r);var s=new _t;this.computeOffsetSegment(n,q.RIGHT,this._distance,s);var o=t.x-e.x,u=t.y-e.y,m=Math.atan2(u,o);switch(this._bufParams.getEndCapStyle()){case F.CAP_ROUND:this._segList.addPt(r.p1),this.addDirectedFillet(t,m+Math.PI/2,m-Math.PI/2,ge.CLOCKWISE,this._distance),this._segList.addPt(s.p1);break;case F.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(s.p1);break;case F.CAP_SQUARE:var y=new M;y.x=Math.abs(this._distance)*Math.cos(m),y.y=Math.abs(this._distance)*Math.sin(m);var T=new M(r.p1.x+y.x,r.p1.y+y.y),R=new M(s.p1.x+y.x,s.p1.y+y.y);this._segList.addPt(T),this._segList.addPt(R)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(e,t,n,r){var s=cn.intersection(t.p0,t.p1,n.p0,n.p1);if(s!==null&&(r<=0?1:s.distance(e)/Math.abs(r))<=this._bufParams.getMitreLimit())return this._segList.addPt(s),null;this.addLimitedMitreJoin(t,n,r,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*i.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===F.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===F.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(e){this._segList.addPt(new M(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new M(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new M(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new M(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(e,t){this._segList.addPts(e,t)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(e,t,n,r,s){var o=t.x-e.x,u=t.y-e.y,m=Math.atan2(u,o),y=n.x-e.x,T=n.y-e.y,R=Math.atan2(T,y);r===ge.CLOCKWISE?m<=R&&(m+=2*Math.PI):m>=R&&(m-=2*Math.PI),this._segList.addPt(t),this.addDirectedFillet(e,m,R,r,s),this._segList.addPt(n)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(e,t,n){this._s1=e,this._s2=t,this._side=n,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(e,t,n,r){var s=this._seg0.p1,o=xt.angle(s,this._seg0.p0),u=xt.angleBetweenOriented(this._seg0.p0,s,this._seg1.p1)/2,m=xt.normalize(o+u),y=xt.normalize(m+Math.PI),T=r*n,R=n-T*Math.abs(Math.sin(u)),G=s.x+T*Math.cos(y),J=s.y+T*Math.sin(y),se=new M(G,J),ce=new _t(s,se),be=ce.pointAlongOffset(1,R),Se=ce.pointAlongOffset(1,-R);this._side===q.LEFT?(this._segList.addPt(be),this._segList.addPt(Se)):(this._segList.addPt(Se),this._segList.addPt(be))}},{key:"addDirectedFillet",value:function(e,t,n,r,s){var o=r===ge.CLOCKWISE?-1:1,u=Math.abs(t-n),m=Math.trunc(u/this._filletAngleQuantum+.5);if(m<1)return null;for(var y=u/m,T=new M,R=0;R<m;R++){var G=t+o*R*y;T.x=e.x+s*Math.cos(G),T.y=e.y+s*Math.sin(G),this._segList.addPt(T)}}},{key:"computeOffsetSegment",value:function(e,t,n,r){var s=t===q.LEFT?1:-1,o=e.p1.x-e.p0.x,u=e.p1.y-e.p0.y,m=Math.sqrt(o*o+u*u),y=s*n*o/m,T=s*n*u/m;r.p0.x=e.p0.x-T,r.p0.y=e.p0.y+y,r.p1.x=e.p1.x-T,r.p1.y=e.p1.y+y}},{key:"addInsideTurn",value:function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*i.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new M((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new M((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(e){var t=new M(e.x+this._distance,e.y);this._segList.addPt(t),this.addDirectedFillet(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)}},{key:"init",value:function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Ur,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*i.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===F.JOIN_BEVEL||this._bufParams.getJoinStyle()===F.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,ge.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new _t,this._seg1=new _t,this._offset0=new _t,this._offset1=new _t,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._precisionModel=e,this._bufParams=t,this._li=new zt,this._filletAngleQuantum=Math.PI/2/t.getQuadrantSegments(),t.getQuadrantSegments()>=8&&t.getJoinStyle()===F.JOIN_ROUND&&(this._closingSegLengthFactor=i.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)}}])})();ei.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,ei.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,ei.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,ei.MAX_CLOSING_SEG_LEN_FACTOR=80;var La=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"getOffsetCurve",value:function(e,t){if(this._distance=t,t===0)return null;var n=t<0,r=Math.abs(t),s=this.getSegGen(r);e.length<=1?this.computePointCurve(e[0],s):this.computeOffsetCurve(e,n,s);var o=s.getCoordinates();return n&&Ve.reverse(o),o}},{key:"computeSingleSidedBufferCurve",value:function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){n.addSegments(e,!0);var s=Tt.simplify(e,-r),o=s.length-1;n.initSideSegments(s[o],s[o-1],q.LEFT),n.addFirstSegment();for(var u=o-2;u>=0;u--)n.addNextSegment(s[u],!0)}else{n.addSegments(e,!1);var m=Tt.simplify(e,r),y=m.length-1;n.initSideSegments(m[0],m[1],q.LEFT),n.addFirstSegment();for(var T=2;T<=y;T++)n.addNextSegment(m[T],!0)}n.addLastSegment(),n.closeRing()}},{key:"computeRingBufferCurve",value:function(e,t,n){var r=this.simplifyTolerance(this._distance);t===q.RIGHT&&(r=-r);var s=Tt.simplify(e,r),o=s.length-1;n.initSideSegments(s[o-1],s[0],t);for(var u=1;u<=o;u++){var m=u!==1;n.addNextSegment(s[u],m)}n.closeRing()}},{key:"computeLineBufferCurve",value:function(e,t){var n=this.simplifyTolerance(this._distance),r=Tt.simplify(e,n),s=r.length-1;t.initSideSegments(r[0],r[1],q.LEFT);for(var o=2;o<=s;o++)t.addNextSegment(r[o],!0);t.addLastSegment(),t.addLineEndCap(r[s-1],r[s]);var u=Tt.simplify(e,-n),m=u.length-1;t.initSideSegments(u[m],u[m-1],q.LEFT);for(var y=m-2;y>=0;y--)t.addNextSegment(u[y],!0);t.addLastSegment(),t.addLineEndCap(u[1],u[0]),t.closeRing()}},{key:"computePointCurve",value:function(e,t){switch(this._bufParams.getEndCapStyle()){case F.CAP_ROUND:t.createCircle(e);break;case F.CAP_SQUARE:t.createSquare(e)}}},{key:"getLineCurve",value:function(e,t){if(this._distance=t,this.isLineOffsetEmpty(t))return null;var n=Math.abs(t),r=this.getSegGen(n);if(e.length<=1)this.computePointCurve(e[0],r);else if(this._bufParams.isSingleSided()){var s=t<0;this.computeSingleSidedBufferCurve(e,s,r)}else this.computeLineBufferCurve(e,r);return r.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(e){return e*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(e,t,n){if(this._distance=n,e.length<=2)return this.getLineCurve(e,n);if(n===0)return i.copyCoordinates(e);var r=this.getSegGen(n);return this.computeRingBufferCurve(e,t,r),r.getCoordinates()}},{key:"computeOffsetCurve",value:function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){var s=Tt.simplify(e,-r),o=s.length-1;n.initSideSegments(s[o],s[o-1],q.LEFT),n.addFirstSegment();for(var u=o-2;u>=0;u--)n.addNextSegment(s[u],!0)}else{var m=Tt.simplify(e,r),y=m.length-1;n.initSideSegments(m[0],m[1],q.LEFT),n.addFirstSegment();for(var T=2;T<=y;T++)n.addNextSegment(m[T],!0)}n.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(e){return e===0||e<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(e){return new ei(this._precisionModel,this._bufParams,e)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t}},{key:"copyCoordinates",value:function(e){for(var t=new Array(e.length).fill(null),n=0;n<t.length;n++)t[n]=new M(e[n]);return t}}])})(),Br=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var i=arguments[0],e=new he,t=this._subgraphs.iterator();t.hasNext();){var n=t.next(),r=n.getEnvelope();i.y<r.getMinY()||i.y>r.getMaxY()||this.findStabbedSegments(i,n.getDirectedEdges(),e)}return e}if(arguments.length===3){if(ye(arguments[2],Ct)&&arguments[0]instanceof M&&arguments[1]instanceof j){for(var s=arguments[0],o=arguments[1],u=arguments[2],m=o.getEdge().getCoordinates(),y=0;y<m.length-1;y++)if(this._seg.p0=m[y],this._seg.p1=m[y+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<s.x||this._seg.isHorizontal()||s.y<this._seg.p0.y||s.y>this._seg.p1.y||ge.index(this._seg.p0,this._seg.p1,s)===ge.RIGHT)){var T=o.getDepth(q.LEFT);this._seg.p0.equals(m[y])||(T=o.getDepth(q.RIGHT));var R=new Vr(this._seg,T);u.add(R)}}else if(ye(arguments[2],Ct)&&arguments[0]instanceof M&&ye(arguments[1],Ct))for(var G=arguments[0],J=arguments[2],se=arguments[1].iterator();se.hasNext();){var ce=se.next();ce.isForward()&&this.findStabbedSegments(G,ce,J)}}}},{key:"getDepth",value:function(i){var e=this.findStabbedSegments(i);return e.size()===0?0:ve.min(e)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new _t;var i=arguments[0];this._subgraphs=i}}])})(),Vr=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"compareTo",value:function(i){var e=i;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var t=this._upwardSeg.orientationIndex(e._upwardSeg);return t!==0||(t=-1*e._upwardSeg.orientationIndex(this._upwardSeg))!==0?t:this._upwardSeg.compareTo(e._upwardSeg)}},{key:"compareX",value:function(i,e){var t=i.p0.compareTo(e.p0);return t!==0?t:i.p1.compareTo(e.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var i=arguments[0],e=arguments[1];this._upwardSeg=new _t(i),this._leftDepth=e}}])})();Br.DepthSegment=Vr;var Xr=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,null,[{key:"constructor_",value:function(){K.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])})(K),hr=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"getY",value:function(){var e=this.y/this.w;if(ne.isNaN(e)||ne.isInfinite(e))throw new Xr;return e}},{key:"getX",value:function(){var e=this.x/this.w;if(ne.isNaN(e)||ne.isInfinite(e))throw new Xr;return e}},{key:"getCoordinate",value:function(){var e=new M;return e.x=this.getX(),e.y=this.getY(),e}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],n=arguments[1];this.x=t,this.y=n,this.w=1}else if(arguments[0]instanceof i&&arguments[1]instanceof i){var r=arguments[0],s=arguments[1];this.x=r.y*s.w-s.y*r.w,this.y=s.x*r.w-r.x*s.w,this.w=r.x*s.y-s.x*r.y}else if(arguments[0]instanceof M&&arguments[1]instanceof M){var o=arguments[0],u=arguments[1];this.x=o.y-u.y,this.y=u.x-o.x,this.w=o.x*u.y-u.x*o.y}}else if(arguments.length===3){var m=arguments[0],y=arguments[1],T=arguments[2];this.x=m,this.y=y,this.w=T}else if(arguments.length===4){var R=arguments[0],G=arguments[1],J=arguments[2],se=arguments[3],ce=R.y-G.y,be=G.x-R.x,Se=R.x*G.y-G.x*R.y,Ae=J.y-se.y,Qe=se.x-J.x,rt=J.x*se.y-se.x*J.y;this.x=be*rt-Qe*Se,this.y=Ae*Se-ce*rt,this.w=ce*Qe-Ae*be}}}])})(),Ra=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"area",value:function(){return i.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return i.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(e){if(e===null)throw new Y("Supplied point is null.");return i.interpolateZ(e,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return i.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return i.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return i.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return i.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return i.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return i.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.p0=e,this.p1=t,this.p2=n}},{key:"area",value:function(e,t,n){return Math.abs(((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2)}},{key:"signedArea",value:function(e,t,n){return((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2}},{key:"det",value:function(e,t,n,r){return e*r-t*n}},{key:"interpolateZ",value:function(e,t,n,r){var s=t.x,o=t.y,u=n.x-s,m=r.x-s,y=n.y-o,T=r.y-o,R=u*T-m*y,G=e.x-s,J=e.y-o,se=(T*G-m*J)/R,ce=(-y*G+u*J)/R;return t.getZ()+se*(n.getZ()-t.getZ())+ce*(r.getZ()-t.getZ())}},{key:"longestSideLength",value:function(e,t,n){var r=e.distance(t),s=t.distance(n),o=n.distance(e),u=r;return s>u&&(u=s),o>u&&(u=o),u}},{key:"circumcentreDD",value:function(e,t,n){var r=fe.valueOf(e.x).subtract(n.x),s=fe.valueOf(e.y).subtract(n.y),o=fe.valueOf(t.x).subtract(n.x),u=fe.valueOf(t.y).subtract(n.y),m=fe.determinant(r,s,o,u).multiply(2),y=r.sqr().add(s.sqr()),T=o.sqr().add(u.sqr()),R=fe.determinant(s,y,u,T),G=fe.determinant(r,y,o,T),J=fe.valueOf(n.x).subtract(R.divide(m)).doubleValue(),se=fe.valueOf(n.y).add(G.divide(m)).doubleValue();return new M(J,se)}},{key:"isAcute",value:function(e,t,n){return!!xt.isAcute(e,t,n)&&!!xt.isAcute(t,n,e)&&!!xt.isAcute(n,e,t)}},{key:"circumcentre",value:function(e,t,n){var r=n.x,s=n.y,o=e.x-r,u=e.y-s,m=t.x-r,y=t.y-s,T=2*i.det(o,u,m,y),R=i.det(u,o*o+u*u,y,m*m+y*y),G=i.det(o,o*o+u*u,m,m*m+y*y);return new M(r-R/T,s+G/T)}},{key:"perpendicularBisector",value:function(e,t){var n=t.x-e.x,r=t.y-e.y,s=new hr(e.x+n/2,e.y+r/2,1),o=new hr(e.x-r+n/2,e.y+n+r/2,1);return new hr(s,o)}},{key:"angleBisector",value:function(e,t,n){var r=t.distance(e),s=r/(r+t.distance(n)),o=n.x-e.x,u=n.y-e.y;return new M(e.x+s*o,e.y+s*u)}},{key:"area3D",value:function(e,t,n){var r=t.x-e.x,s=t.y-e.y,o=t.getZ()-e.getZ(),u=n.x-e.x,m=n.y-e.y,y=n.getZ()-e.getZ(),T=s*y-o*m,R=o*u-r*y,G=r*m-s*u,J=T*T+R*R+G*G,se=Math.sqrt(J)/2;return se}},{key:"centroid",value:function(e,t,n){var r=(e.x+t.x+n.x)/3,s=(e.y+t.y+n.y)/3;return new M(r,s)}},{key:"inCentre",value:function(e,t,n){var r=t.distance(n),s=e.distance(n),o=e.distance(t),u=r+s+o,m=(r*e.x+s*t.x+o*n.x)/u,y=(r*e.y+s*t.y+o*n.y)/u;return new M(m,y)}}])})(),Oa=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"addRingSide",value:function(i,e,t,n,r){if(e===0&&i.length<Zt.MINIMUM_VALID_SIZE)return null;var s=n,o=r;i.length>=Zt.MINIMUM_VALID_SIZE&&ge.isCCW(i)&&(s=r,o=n,t=q.opposite(t));var u=this._curveBuilder.getRingCurve(i,t,e);this.addCurve(u,s,o)}},{key:"addRingBothSides",value:function(i,e){this.addRingSide(i,e,q.LEFT,x.EXTERIOR,x.INTERIOR),this.addRingSide(i,e,q.RIGHT,x.INTERIOR,x.EXTERIOR)}},{key:"addPoint",value:function(i){if(this._distance<=0)return null;var e=i.getCoordinates(),t=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(t,x.EXTERIOR,x.INTERIOR)}},{key:"addPolygon",value:function(i){var e=this._distance,t=q.LEFT;this._distance<0&&(e=-this._distance,t=q.RIGHT);var n=i.getExteriorRing(),r=Ve.removeRepeatedPoints(n.getCoordinates());if(this._distance<0&&this.isErodedCompletely(n,this._distance)||this._distance<=0&&r.length<3)return null;this.addRingSide(r,e,t,x.EXTERIOR,x.INTERIOR);for(var s=0;s<i.getNumInteriorRing();s++){var o=i.getInteriorRingN(s),u=Ve.removeRepeatedPoints(o.getCoordinates());this._distance>0&&this.isErodedCompletely(o,-this._distance)||this.addRingSide(u,e,q.opposite(t),x.INTERIOR,x.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(i,e){var t=new Ra(i[0],i[1],i[2]),n=t.inCentre();return mt.pointToSegment(n,t.p0,t.p1)<Math.abs(e)}},{key:"addLineString",value:function(i){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var e=Ve.removeRepeatedPoints(i.getCoordinates());if(Ve.isRing(e)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(e,this._distance);else{var t=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(t,x.EXTERIOR,x.INTERIOR)}}},{key:"addCurve",value:function(i,e,t){if(i===null||i.length<2)return null;var n=new xn(i,new ct(0,x.BOUNDARY,e,t));this._curveList.add(n)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(i){if(i.isEmpty())return null;if(i instanceof Ht)this.addPolygon(i);else if(i instanceof Xt)this.addLineString(i);else if(i instanceof jt)this.addPoint(i);else if(i instanceof gt)this.addCollection(i);else if(i instanceof Vn)this.addCollection(i);else if(i instanceof Bn)this.addCollection(i);else{if(!(i instanceof nt))throw new ot(i.getGeometryType());this.addCollection(i)}}},{key:"isErodedCompletely",value:function(i,e){var t=i.getCoordinates();if(t.length<4)return e<0;if(t.length===4)return this.isTriangleErodedCompletely(t,e);var n=i.getEnvelopeInternal(),r=Math.min(n.getHeight(),n.getWidth());return e<0&&2*Math.abs(e)>r}},{key:"addCollection",value:function(i){for(var e=0;e<i.getNumGeometries();e++){var t=i.getGeometryN(e);this.add(t)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new he;var i=arguments[0],e=arguments[1],t=arguments[2];this._inputGeom=i,this._distance=e,this._curveBuilder=t}}])})(),Ma=(function(){return d((function i(){c(this,i)}),[{key:"locate",value:function(i){}}])})(),Aa=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,i.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Ut;var e=this._parent.getGeometryN(this._index++);return e instanceof nt?(this._subcollectionIterator=new i(e),this._subcollectionIterator.next()):e}},{key:"remove",value:function(){throw new ot(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[Qn]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()}},{key:"isAtomic",value:function(e){return!(e instanceof nt)}}])})(),Pa=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"locate",value:function(e){return i.locate(e,this._geom)}},{key:"interfaces_",get:function(){return[Ma]}}],[{key:"constructor_",value:function(){this._geom=null;var e=arguments[0];this._geom=e}},{key:"locatePointInPolygon",value:function(e,t){if(t.isEmpty())return x.EXTERIOR;var n=t.getExteriorRing(),r=i.locatePointInRing(e,n);if(r!==x.INTERIOR)return r;for(var s=0;s<t.getNumInteriorRing();s++){var o=t.getInteriorRingN(s),u=i.locatePointInRing(e,o);if(u===x.BOUNDARY)return x.BOUNDARY;if(u===x.INTERIOR)return x.EXTERIOR}return x.INTERIOR}},{key:"locatePointInRing",value:function(e,t){return t.getEnvelopeInternal().intersects(e)?Wn.locateInRing(e,t.getCoordinates()):x.EXTERIOR}},{key:"containsPointInPolygon",value:function(e,t){return x.EXTERIOR!==i.locatePointInPolygon(e,t)}},{key:"locateInGeometry",value:function(e,t){if(t instanceof Ht)return i.locatePointInPolygon(e,t);if(t instanceof nt)for(var n=new Aa(t);n.hasNext();){var r=n.next();if(r!==t){var s=i.locateInGeometry(e,r);if(s!==x.EXTERIOR)return s}}return x.EXTERIOR}},{key:"isContained",value:function(e,t){return x.EXTERIOR!==i.locate(e,t)}},{key:"locate",value:function(e,t){return t.isEmpty()?x.EXTERIOR:t.getEnvelopeInternal().intersects(e)?i.locateInGeometry(e,t):x.EXTERIOR}}])})(),Da=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"getNextCW",value:function(i){this.getEdges();var e=this._edgeList.indexOf(i),t=e-1;return e===0&&(t=this._edgeList.size()-1),this._edgeList.get(t)}},{key:"propagateSideLabels",value:function(i){for(var e=x.NONE,t=this.iterator();t.hasNext();){var n=t.next().getLabel();n.isArea(i)&&n.getLocation(i,q.LEFT)!==x.NONE&&(e=n.getLocation(i,q.LEFT))}if(e===x.NONE)return null;for(var r=e,s=this.iterator();s.hasNext();){var o=s.next(),u=o.getLabel();if(u.getLocation(i,q.ON)===x.NONE&&u.setLocation(i,q.ON,r),u.isArea(i)){var m=u.getLocation(i,q.LEFT),y=u.getLocation(i,q.RIGHT);if(y!==x.NONE){if(y!==r)throw new ut("side location conflict",o.getCoordinate());m===x.NONE&&ke.shouldNeverReachHere("found single null side (at "+o.getCoordinate()+")"),r=m}else ke.isTrue(u.getLocation(i,q.LEFT)===x.NONE,"found single null side"),u.setLocation(i,q.RIGHT,r),u.setLocation(i,q.LEFT,r)}}}},{key:"getCoordinate",value:function(){var i=this.iterator();return i.hasNext()?i.next().getCoordinate():null}},{key:"print",value:function(i){et.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(i)}},{key:"isAreaLabelsConsistent",value:function(i){return this.computeEdgeEndLabels(i.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(i){var e=this.getEdges();if(e.size()<=0)return!0;var t=e.size()-1,n=e.get(t).getLabel().getLocation(i,q.LEFT);ke.isTrue(n!==x.NONE,"Found unlabelled area edge");for(var r=n,s=this.iterator();s.hasNext();){var o=s.next().getLabel();ke.isTrue(o.isArea(i),"Found non-area edge");var u=o.getLocation(i,q.LEFT),m=o.getLocation(i,q.RIGHT);if(u===m||m!==r)return!1;r=u}return!0}},{key:"findIndex",value:function(i){this.iterator();for(var e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===i)return e;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new he(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(i,e,t){return this._ptInAreaLocation[i]===x.NONE&&(this._ptInAreaLocation[i]=Pa.locate(e,t[i].getGeometry())),this._ptInAreaLocation[i]}},{key:"toString",value:function(){var i=new on;i.append("EdgeEndStar:   "+this.getCoordinate()),i.append("\n");for(var e=this.iterator();e.hasNext();){var t=e.next();i.append(t),i.append("\n")}return i.toString()}},{key:"computeEdgeEndLabels",value:function(i){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(i)}},{key:"computeLabelling",value:function(i){this.computeEdgeEndLabels(i[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],t=this.iterator();t.hasNext();)for(var n=t.next().getLabel(),r=0;r<2;r++)n.isLine(r)&&n.getLocation(r)===x.BOUNDARY&&(e[r]=!0);for(var s=this.iterator();s.hasNext();)for(var o=s.next(),u=o.getLabel(),m=0;m<2;m++)if(u.isAnyNull(m)){var y=x.NONE;if(e[m])y=x.EXTERIOR;else{var T=o.getCoordinate();y=this.getLocation(m,T,i)}u.setAllLocationsIfNull(m,y)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(i,e){this._edgeMap.put(i,e),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new E,this._edgeList=null,this._ptInAreaLocation=[x.NONE,x.NONE]}}])})(),Fa=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var t=null,n=null,r=this._SCANNING_FOR_INCOMING,s=0;s<this._resultAreaEdgeList.size();s++){var o=this._resultAreaEdgeList.get(s),u=o.getSym();if(o.getLabel().isArea())switch(t===null&&o.isInResult()&&(t=o),r){case this._SCANNING_FOR_INCOMING:if(!u.isInResult())continue;n=u,r=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!o.isInResult())continue;n.setNext(o),r=this._SCANNING_FOR_INCOMING}}if(r===this._LINKING_TO_OUTGOING){if(t===null)throw new ut("no outgoing dirEdge found",this.getCoordinate());ke.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),n.setNext(t)}}},{key:"insert",value:function(t){var n=t;this.insertEdgeEnd(n,n)}},{key:"getRightmostEdge",value:function(){var t=this.getEdges(),n=t.size();if(n<1)return null;var r=t.get(0);if(n===1)return r;var s=t.get(n-1),o=r.getQuadrant(),u=s.getQuadrant();return L.isNorthern(o)&&L.isNorthern(u)?r:L.isNorthern(o)||L.isNorthern(u)?r.getDy()!==0?r:s.getDy()!==0?s:(ke.shouldNeverReachHere("found two horizontal edges incident on node"),null):s}},{key:"print",value:function(t){et.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var n=this.iterator();n.hasNext();){var r=n.next();t.print("out "),r.print(t),t.println(),t.print("in "),r.getSym().print(t),t.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new he;for(var t=this.iterator();t.hasNext();){var n=t.next();(n.isInResult()||n.getSym().isInResult())&&this._resultAreaEdgeList.add(n)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(t){for(var n=this.iterator();n.hasNext();){var r=n.next().getLabel();r.setAllLocationsIfNull(0,t.getLocation(0)),r.setAllLocationsIfNull(1,t.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var t=null,n=null,r=this._edgeList.size()-1;r>=0;r--){var s=this._edgeList.get(r),o=s.getSym();n===null&&(n=o),t!==null&&o.setNext(t),t=s}n.setNext(t)}},{key:"computeDepths",value:function(){if(arguments.length===1){var t=arguments[0],n=this.findIndex(t),r=t.getDepth(q.LEFT),s=t.getDepth(q.RIGHT),o=this.computeDepths(n+1,this._edgeList.size(),r);if(this.computeDepths(0,n,o)!==s)throw new ut("depth mismatch at "+t.getCoordinate())}else if(arguments.length===3){for(var u=arguments[1],m=arguments[2],y=arguments[0];y<u;y++){var T=this._edgeList.get(y);T.setEdgeDepths(q.RIGHT,m),m=T.getDepth(q.LEFT)}return m}}},{key:"mergeSymLabels",value:function(){for(var t=this.iterator();t.hasNext();){var n=t.next();n.getLabel().merge(n.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(t){for(var n=null,r=null,s=this._SCANNING_FOR_INCOMING,o=this._resultAreaEdgeList.size()-1;o>=0;o--){var u=this._resultAreaEdgeList.get(o),m=u.getSym();switch(n===null&&u.getEdgeRing()===t&&(n=u),s){case this._SCANNING_FOR_INCOMING:if(m.getEdgeRing()!==t)continue;r=m,s=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(u.getEdgeRing()!==t)continue;r.setNextMin(u),s=this._SCANNING_FOR_INCOMING}}s===this._LINKING_TO_OUTGOING&&(ke.isTrue(n!==null,"found null for first outgoing dirEdge"),ke.isTrue(n.getEdgeRing()===t,"unable to link last incoming dirEdge"),r.setNextMin(n))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var t=0,n=this.iterator();n.hasNext();)n.next().isInResult()&&t++;return t}if(arguments.length===1){for(var r=arguments[0],s=0,o=this.iterator();o.hasNext();)o.next().getEdgeRing()===r&&s++;return s}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var t=x.NONE,n=this.iterator();n.hasNext();){var r=n.next(),s=r.getSym();if(!r.isLineEdge()){if(r.isInResult()){t=x.INTERIOR;break}if(s.isInResult()){t=x.EXTERIOR;break}}}if(t===x.NONE)return null;for(var o=t,u=this.iterator();u.hasNext();){var m=u.next(),y=m.getSym();m.isLineEdge()?m.getEdge().setCovered(o===x.INTERIOR):(m.isInResult()&&(o=x.EXTERIOR),y.isInResult()&&(o=x.INTERIOR))}}},{key:"computeLabelling",value:function(t){w(e,"computeLabelling",this,1).call(this,t),this._label=new ct(x.NONE);for(var n=this.iterator();n.hasNext();)for(var r=n.next().getEdge().getLabel(),s=0;s<2;s++){var o=r.getLocation(s);o!==x.INTERIOR&&o!==x.BOUNDARY||this._label.setLocation(s,x.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])})(Da),Ga=(function(i){function e(){return c(this,e),h(this,e)}return p(e,i),d(e,[{key:"createNode",value:function(t){return new pn(t,new Fa)}}])})(Z),Hr=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"compareTo",value:function(e){var t=e;return i.compareOriented(this._pts,this._orientation,t._pts,t._orientation)}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=i.orientation(e)}},{key:"orientation",value:function(e){return Ve.increasingDirection(e)===1}},{key:"compareOriented",value:function(e,t,n,r){for(var s=t?1:-1,o=r?1:-1,u=t?e.length:-1,m=r?n.length:-1,y=t?0:e.length-1,T=r?0:n.length-1;;){var R=e[y].compareTo(n[T]);if(R!==0)return R;var G=(y+=s)===u,J=(T+=o)===m;if(G&&!J)return-1;if(!G&&J)return 1;if(G&&J)return 0}}}])})(),ja=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"print",value:function(i){i.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var t=this._edges.get(e);e>0&&i.print(","),i.print("(");for(var n=t.getCoordinates(),r=0;r<n.length;r++)r>0&&i.print(","),i.print(n[r].x+" "+n[r].y);i.println(")")}i.print(")  ")}},{key:"addAll",value:function(i){for(var e=i.iterator();e.hasNext();)this.add(e.next())}},{key:"findEdgeIndex",value:function(i){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(i))return e;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(i){return this._edges.get(i)}},{key:"findEqualEdge",value:function(i){var e=new Hr(i.getCoordinates());return this._ocaMap.get(e)}},{key:"add",value:function(i){this._edges.add(i);var e=new Hr(i.getCoordinates());this._ocaMap.put(e,i)}}],[{key:"constructor_",value:function(){this._edges=new he,this._ocaMap=new E}}])})(),Zr=(function(){return d((function i(){c(this,i)}),[{key:"processIntersections",value:function(i,e,t,n){}},{key:"isDone",value:function(){}}])})(),qa=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"isTrivialIntersection",value:function(e,t,n,r){if(e===n&&this._li.getIntersectionNum()===1){if(i.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var s=e.size()-1;if(t===0&&r===s||r===0&&t===s)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(e,t,n,r){if(e===n&&t===r)return null;this.numTests++;var s=e.getCoordinates()[t],o=e.getCoordinates()[t+1],u=n.getCoordinates()[r],m=n.getCoordinates()[r+1];this._li.computeIntersection(s,o,u,m),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,n,r)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Zr]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e}},{key:"isAdjacentSegments",value:function(e,t){return Math.abs(e-t)===1}}])})(),za=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(i){i.print(this.coord),i.print(" seg # = "+this.segmentIndex),i.println(" dist = "+this.dist)}},{key:"compareTo",value:function(i){var e=i;return this.compare(e.segmentIndex,e.dist)}},{key:"isEndPoint",value:function(i){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===i}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(i,e){return this.segmentIndex<i?-1:this.segmentIndex>i?1:this.dist<e?-1:this.dist>e?1:0}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var i=arguments[0],e=arguments[1],t=arguments[2];this.coord=new M(i),this.segmentIndex=e,this.dist=t}}])})(),Ya=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"print",value:function(i){i.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(i)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(i){this.addEndpoints();for(var e=this.iterator(),t=e.next();e.hasNext();){var n=e.next(),r=this.createSplitEdge(t,n);i.add(r),t=n}}},{key:"addEndpoints",value:function(){var i=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[i],i,0)}},{key:"createSplitEdge",value:function(i,e){var t=e.segmentIndex-i.segmentIndex+2,n=this.edge.pts[e.segmentIndex],r=e.dist>0||!e.coord.equals2D(n);r||t--;var s=new Array(t).fill(null),o=0;s[o++]=new M(i.coord);for(var u=i.segmentIndex+1;u<=e.segmentIndex;u++)s[o++]=this.edge.pts[u];return r&&(s[o]=e.coord),new Wr(s,new ct(this.edge._label))}},{key:"add",value:function(i,e,t){var n=new za(i,e,t),r=this._nodeMap.get(n);return r!==null?r:(this._nodeMap.put(n,n),n)}},{key:"isIntersection",value:function(i){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(i))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new E,this.edge=null;var i=arguments[0];this.edge=i}}])})(),Ua=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(i.isTrue(this._matrix[x.INTERIOR][x.INTERIOR])||i.isTrue(this._matrix[x.INTERIOR][x.BOUNDARY])||i.isTrue(this._matrix[x.BOUNDARY][x.INTERIOR])||i.isTrue(this._matrix[x.BOUNDARY][x.BOUNDARY]))&&this._matrix[x.EXTERIOR][x.INTERIOR]===V.FALSE&&this._matrix[x.EXTERIOR][x.BOUNDARY]===V.FALSE}},{key:"isCoveredBy",value:function(){return(i.isTrue(this._matrix[x.INTERIOR][x.INTERIOR])||i.isTrue(this._matrix[x.INTERIOR][x.BOUNDARY])||i.isTrue(this._matrix[x.BOUNDARY][x.INTERIOR])||i.isTrue(this._matrix[x.BOUNDARY][x.BOUNDARY]))&&this._matrix[x.INTERIOR][x.EXTERIOR]===V.FALSE&&this._matrix[x.BOUNDARY][x.EXTERIOR]===V.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var e=arguments[0],t=0;t<e.length;t++){var n=Math.trunc(t/3),r=t%3;this._matrix[n][r]=V.toDimensionValue(e.charAt(t))}else if(arguments.length===3){var s=arguments[0],o=arguments[1],u=arguments[2];this._matrix[s][o]=u}}},{key:"isContains",value:function(){return i.isTrue(this._matrix[x.INTERIOR][x.INTERIOR])&&this._matrix[x.EXTERIOR][x.INTERIOR]===V.FALSE&&this._matrix[x.EXTERIOR][x.BOUNDARY]===V.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var e=arguments[0],t=0;t<e.length;t++){var n=Math.trunc(t/3),r=t%3;this.setAtLeast(n,r,V.toDimensionValue(e.charAt(t)))}else if(arguments.length===3){var s=arguments[0],o=arguments[1],u=arguments[2];this._matrix[s][o]<u&&(this._matrix[s][o]=u)}}},{key:"setAtLeastIfValid",value:function(e,t,n){e>=0&&t>=0&&this.setAtLeast(e,t,n)}},{key:"isWithin",value:function(){return i.isTrue(this._matrix[x.INTERIOR][x.INTERIOR])&&this._matrix[x.INTERIOR][x.EXTERIOR]===V.FALSE&&this._matrix[x.BOUNDARY][x.EXTERIOR]===V.FALSE}},{key:"isTouches",value:function(e,t){return e>t?this.isTouches(t,e):(e===V.A&&t===V.A||e===V.L&&t===V.L||e===V.L&&t===V.A||e===V.P&&t===V.A||e===V.P&&t===V.L)&&this._matrix[x.INTERIOR][x.INTERIOR]===V.FALSE&&(i.isTrue(this._matrix[x.INTERIOR][x.BOUNDARY])||i.isTrue(this._matrix[x.BOUNDARY][x.INTERIOR])||i.isTrue(this._matrix[x.BOUNDARY][x.BOUNDARY]))}},{key:"isOverlaps",value:function(e,t){return e===V.P&&t===V.P||e===V.A&&t===V.A?i.isTrue(this._matrix[x.INTERIOR][x.INTERIOR])&&i.isTrue(this._matrix[x.INTERIOR][x.EXTERIOR])&&i.isTrue(this._matrix[x.EXTERIOR][x.INTERIOR]):e===V.L&&t===V.L&&this._matrix[x.INTERIOR][x.INTERIOR]===1&&i.isTrue(this._matrix[x.INTERIOR][x.EXTERIOR])&&i.isTrue(this._matrix[x.EXTERIOR][x.INTERIOR])}},{key:"isEquals",value:function(e,t){return e===t&&i.isTrue(this._matrix[x.INTERIOR][x.INTERIOR])&&this._matrix[x.INTERIOR][x.EXTERIOR]===V.FALSE&&this._matrix[x.BOUNDARY][x.EXTERIOR]===V.FALSE&&this._matrix[x.EXTERIOR][x.INTERIOR]===V.FALSE&&this._matrix[x.EXTERIOR][x.BOUNDARY]===V.FALSE}},{key:"toString",value:function(){for(var e=new Tn("123456789"),t=0;t<3;t++)for(var n=0;n<3;n++)e.setCharAt(3*t+n,V.toDimensionSymbol(this._matrix[t][n]));return e.toString()}},{key:"setAll",value:function(e){for(var t=0;t<3;t++)for(var n=0;n<3;n++)this._matrix[t][n]=e}},{key:"get",value:function(e,t){return this._matrix[e][t]}},{key:"transpose",value:function(){var e=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=e,e=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=e,e=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=e,this}},{key:"matches",value:function(e){if(e.length!==9)throw new Y("Should be length 9: "+e);for(var t=0;t<3;t++)for(var n=0;n<3;n++)if(!i.matches(this._matrix[t][n],e.charAt(3*t+n)))return!1;return!0}},{key:"add",value:function(e){for(var t=0;t<3;t++)for(var n=0;n<3;n++)this.setAtLeast(t,n,e.get(t,n))}},{key:"isDisjoint",value:function(){return this._matrix[x.INTERIOR][x.INTERIOR]===V.FALSE&&this._matrix[x.INTERIOR][x.BOUNDARY]===V.FALSE&&this._matrix[x.BOUNDARY][x.INTERIOR]===V.FALSE&&this._matrix[x.BOUNDARY][x.BOUNDARY]===V.FALSE}},{key:"isCrosses",value:function(e,t){return e===V.P&&t===V.L||e===V.P&&t===V.A||e===V.L&&t===V.A?i.isTrue(this._matrix[x.INTERIOR][x.INTERIOR])&&i.isTrue(this._matrix[x.INTERIOR][x.EXTERIOR]):e===V.L&&t===V.P||e===V.A&&t===V.P||e===V.A&&t===V.L?i.isTrue(this._matrix[x.INTERIOR][x.INTERIOR])&&i.isTrue(this._matrix[x.EXTERIOR][x.INTERIOR]):e===V.L&&t===V.L&&this._matrix[x.INTERIOR][x.INTERIOR]===0}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map((function(){return Array(3)})),this.setAll(V.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var e=arguments[0];i.constructor_.call(this),this.set(e)}else if(arguments[0]instanceof i){var t=arguments[0];i.constructor_.call(this),this._matrix[x.INTERIOR][x.INTERIOR]=t._matrix[x.INTERIOR][x.INTERIOR],this._matrix[x.INTERIOR][x.BOUNDARY]=t._matrix[x.INTERIOR][x.BOUNDARY],this._matrix[x.INTERIOR][x.EXTERIOR]=t._matrix[x.INTERIOR][x.EXTERIOR],this._matrix[x.BOUNDARY][x.INTERIOR]=t._matrix[x.BOUNDARY][x.INTERIOR],this._matrix[x.BOUNDARY][x.BOUNDARY]=t._matrix[x.BOUNDARY][x.BOUNDARY],this._matrix[x.BOUNDARY][x.EXTERIOR]=t._matrix[x.BOUNDARY][x.EXTERIOR],this._matrix[x.EXTERIOR][x.INTERIOR]=t._matrix[x.EXTERIOR][x.INTERIOR],this._matrix[x.EXTERIOR][x.BOUNDARY]=t._matrix[x.EXTERIOR][x.BOUNDARY],this._matrix[x.EXTERIOR][x.EXTERIOR]=t._matrix[x.EXTERIOR][x.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var e=arguments[0],t=arguments[1];return t===V.SYM_DONTCARE||t===V.SYM_TRUE&&(e>=0||e===V.TRUE)||t===V.SYM_FALSE&&e===V.FALSE||t===V.SYM_P&&e===V.P||t===V.SYM_L&&e===V.L||t===V.SYM_A&&e===V.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var n=arguments[1];return new i(arguments[0]).matches(n)}}},{key:"isTrue",value:function(e){return e>=0||e===V.TRUE}}])})(),Ba=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(e){return e===null||e.length===0?null:(this.ensureCapacity(this._size+e.length),et.arraycopy(e,0,this._data,this._size,e.length),void(this._size+=e.length))}},{key:"ensureCapacity",value:function(e){if(e<=this._data.length)return null;var t=Math.max(e,2*this._data.length);this._data=qt.copyOf(this._data,t)}},{key:"toArray",value:function(){var e=new Array(this._size).fill(null);return et.arraycopy(this._data,0,e,0,this._size),e}},{key:"add",value:function(e){this.ensureCapacity(this._size+1),this._data[this._size]=e,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)i.constructor_.call(this,10);else if(arguments.length===1){var e=arguments[0];this._data=new Array(e).fill(null)}}}])})(),Va=(function(){function i(){c(this,i)}return d(i,[{key:"getChainStartIndices",value:function(e){var t=0,n=new Ba(Math.trunc(e.length/2));n.add(t);do{var r=this.findChainEnd(e,t);n.add(r),t=r}while(t<e.length-1);return n.toArray()}},{key:"findChainEnd",value:function(e,t){for(var n=L.quadrant(e[t],e[t+1]),r=t+1;r<e.length&&L.quadrant(e[r-1],e[r])===n;)r++;return r-1}},{key:"OLDgetChainStartIndices",value:function(e){var t=0,n=new he;n.add(t);do{var r=this.findChainEnd(e,t);n.add(r),t=r}while(t<e.length-1);return i.toIntArray(n)}}],[{key:"toIntArray",value:function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t}}])})(),Xa=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(i){var e=this.pts[this.startIndex[i]].x,t=this.pts[this.startIndex[i+1]].x;return e>t?e:t}},{key:"getMinX",value:function(i){var e=this.pts[this.startIndex[i]].x,t=this.pts[this.startIndex[i+1]].x;return e<t?e:t}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var i=arguments[0],e=arguments[1],t=arguments[2],n=arguments[3];this.computeIntersectsForChain(this.startIndex[i],this.startIndex[i+1],e,e.startIndex[t],e.startIndex[t+1],n)}else if(arguments.length===6){var r=arguments[0],s=arguments[1],o=arguments[2],u=arguments[3],m=arguments[4],y=arguments[5];if(s-r==1&&m-u==1)return y.addIntersections(this.e,r,o.e,u),null;if(!this.overlaps(r,s,o,u,m))return null;var T=Math.trunc((r+s)/2),R=Math.trunc((u+m)/2);r<T&&(u<R&&this.computeIntersectsForChain(r,T,o,u,R,y),R<m&&this.computeIntersectsForChain(r,T,o,R,m,y)),T<s&&(u<R&&this.computeIntersectsForChain(T,s,o,u,R,y),R<m&&this.computeIntersectsForChain(T,s,o,R,m,y))}}},{key:"overlaps",value:function(i,e,t,n,r){return Me.intersects(this.pts[i],this.pts[e],t.pts[n],t.pts[r])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(i,e){for(var t=0;t<this.startIndex.length-1;t++)for(var n=0;n<i.startIndex.length-1;n++)this.computeIntersectsForChain(t,i,n,e)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var i=arguments[0];this.e=i,this.pts=i.getCoordinates();var e=new Va;this.startIndex=e.getChainStartIndices(this.pts)}}])})(),Kr=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"getDepth",value:function(e,t){return this._depth[e][t]}},{key:"setDepth",value:function(e,t,n){this._depth[e][t]=n}},{key:"isNull",value:function(){if(arguments.length===0){for(var e=0;e<2;e++)for(var t=0;t<3;t++)if(this._depth[e][t]!==i.NULL_VALUE)return!1;return!0}if(arguments.length===1){var n=arguments[0];return this._depth[n][1]===i.NULL_VALUE}if(arguments.length===2){var r=arguments[0],s=arguments[1];return this._depth[r][s]===i.NULL_VALUE}}},{key:"normalize",value:function(){for(var e=0;e<2;e++)if(!this.isNull(e)){var t=this._depth[e][1];this._depth[e][2]<t&&(t=this._depth[e][2]),t<0&&(t=0);for(var n=1;n<3;n++){var r=0;this._depth[e][n]>t&&(r=1),this._depth[e][n]=r}}}},{key:"getDelta",value:function(e){return this._depth[e][q.RIGHT]-this._depth[e][q.LEFT]}},{key:"getLocation",value:function(e,t){return this._depth[e][t]<=0?x.EXTERIOR:x.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var e=arguments[0],t=0;t<2;t++)for(var n=1;n<3;n++){var r=e.getLocation(t,n);r!==x.EXTERIOR&&r!==x.INTERIOR||(this.isNull(t,n)?this._depth[t][n]=i.depthAtLocation(r):this._depth[t][n]+=i.depthAtLocation(r))}else if(arguments.length===3){var s=arguments[0],o=arguments[1];arguments[2]===x.INTERIOR&&this._depth[s][o]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var e=0;e<2;e++)for(var t=0;t<3;t++)this._depth[e][t]=i.NULL_VALUE}},{key:"depthAtLocation",value:function(e){return e===x.EXTERIOR?0:e===x.INTERIOR?1:i.NULL_VALUE}}])})();Kr.NULL_VALUE=-1;var Wr=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new e(t,ct.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(t){this._isIsolated=t}},{key:"setName",value:function(t){this._name=t}},{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;if(this.pts.length!==n.pts.length)return!1;for(var r=!0,s=!0,o=this.pts.length,u=0;u<this.pts.length;u++)if(this.pts[u].equals2D(n.pts[u])||(r=!1),this.pts[u].equals2D(n.pts[--o])||(s=!1),!r&&!s)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var t=arguments[0];return this.pts[t]}}},{key:"print",value:function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var n=0;n<this.pts.length;n++)n>0&&t.print(","),t.print(this.pts[n].x+" "+this.pts[n].y);t.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(t){e.updateIM(this._label,t)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(t){t.print("edge "+this._name+": ");for(var n=this.pts.length-1;n>=0;n--)t.print(this.pts[n]+" ");t.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new Xa(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new Me;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env}},{key:"addIntersection",value:function(t,n,r,s){var o=new M(t.getIntersection(s)),u=n,m=t.getEdgeDistance(r,s),y=u+1;if(y<this.pts.length){var T=this.pts[y];o.equals2D(T)&&(u=y,m=0)}this.eiList.add(o,u,m)}},{key:"toString",value:function(){var t=new Tn;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var n=0;n<this.pts.length;n++)n>0&&t.append(","),t.append(this.pts[n].x+" "+this.pts[n].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()}},{key:"isPointwiseEqual",value:function(t){if(this.pts.length!==t.pts.length)return!1;for(var n=0;n<this.pts.length;n++)if(!this.pts[n].equals2D(t.pts[n]))return!1;return!0}},{key:"setDepthDelta",value:function(t){this._depthDelta=t}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(t,n,r){for(var s=0;s<t.getIntersectionNum();s++)this.addIntersection(t,n,r,s)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Ya(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Kr,this._depthDelta=0,arguments.length===1){var t=arguments[0];e.constructor_.call(this,t,null)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.pts=n,this._label=r}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Ua&&arguments[0]instanceof ct))return w(e,"updateIM",this).apply(this,arguments);var t=arguments[0],n=arguments[1];n.setAtLeastIfValid(t.getLocation(0,q.ON),t.getLocation(1,q.ON),1),t.isArea()&&(n.setAtLeastIfValid(t.getLocation(0,q.LEFT),t.getLocation(1,q.LEFT),2),n.setAtLeastIfValid(t.getLocation(0,q.RIGHT),t.getLocation(1,q.RIGHT),2))}}])})($n),$r=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"setWorkingPrecisionModel",value:function(e){this._workingPrecisionModel=e}},{key:"insertUniqueEdge",value:function(e){var t=this._edgeList.findEqualEdge(e);if(t!==null){var n=t.getLabel(),r=e.getLabel();t.isPointwiseEqual(e)||(r=new ct(e.getLabel())).flip(),n.merge(r);var s=i.depthDelta(r),o=t.getDepthDelta()+s;t.setDepthDelta(o)}else this._edgeList.add(e),e.setDepthDelta(i.depthDelta(e.getLabel()))}},{key:"buildSubgraphs",value:function(e,t){for(var n=new he,r=e.iterator();r.hasNext();){var s=r.next(),o=s.getRightmostCoordinate(),u=new Br(n).getDepth(o);s.computeDepth(u),s.findResultEdges(),n.add(s),t.add(s.getDirectedEdges(),s.getNodes())}}},{key:"createSubgraphs",value:function(e){for(var t=new he,n=e.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var s=new wn;s.create(r),t.add(s)}}return ve.sort(t,ve.reverseOrder()),t}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(e){if(this._workingNoder!==null)return this._workingNoder;var t=new cr,n=new zt;return n.setPrecisionModel(e),t.setSegmentIntersector(new qa(n)),t}},{key:"buffer",value:function(e,t){var n=this._workingPrecisionModel;n===null&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var r=new La(n,this._bufParams),s=new Oa(e,t,r).getCurves();if(s.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(s,n),this._graph=new re(new Ga),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),u=new te(this._geomFact);this.buildSubgraphs(o,u);var m=u.getPolygons();return m.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(m)}},{key:"computeNodedEdges",value:function(e,t){var n=this.getNoder(t);n.computeNodes(e);for(var r=n.getNodedSubstrings().iterator();r.hasNext();){var s=r.next(),o=s.getCoordinates();if(o.length!==2||!o[0].equals2D(o[1])){var u=s.getData(),m=new Wr(s.getCoordinates(),new ct(u));this.insertUniqueEdge(m)}}}},{key:"setNoder",value:function(e){this._workingNoder=e}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ja;var e=arguments[0];this._bufParams=e}},{key:"depthDelta",value:function(e){var t=e.getLocation(0,q.LEFT),n=e.getLocation(0,q.RIGHT);return t===x.INTERIOR&&n===x.EXTERIOR?1:t===x.EXTERIOR&&n===x.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(e){for(var t=new Wt,n=new he;e.hasNext();){var r=e.next(),s=t.createLineString(r.getCoordinates());n.add(s)}return t.buildGeometry(n)}}])})(),Ha=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"rescale",value:function(){if(ye(arguments[0],ze))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.rescale(t.getCoordinates())}else if(arguments[0]instanceof Array){for(var n=arguments[0],r=0;r<n.length;r++)n[r].x=n[r].x/this._scaleFactor+this._offsetX,n[r].y=n[r].y/this._scaleFactor+this._offsetY;n.length===2&&n[0].equals2D(n[1])&&et.out.println(n)}}},{key:"scale",value:function(){if(ye(arguments[0],ze)){for(var e=arguments[0],t=new he(e.size()),n=e.iterator();n.hasNext();){var r=n.next();t.add(new xn(this.scale(r.getCoordinates()),r.getData()))}return t}if(arguments[0]instanceof Array){for(var s=arguments[0],o=new Array(s.length).fill(null),u=0;u<s.length;u++)o[u]=new M(Math.round((s[u].x-this._offsetX)*this._scaleFactor),Math.round((s[u].y-this._offsetY)*this._scaleFactor),s[u].getZ());return Ve.removeRepeatedPoints(o)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e}},{key:"computeNodes",value:function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)}},{key:"interfaces_",get:function(){return[lr]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],t=arguments[1];i.constructor_.call(this,e,t,0,0)}else if(arguments.length===4){var n=arguments[0],r=arguments[1];this._noder=n,this._scaleFactor=r,this._isScaled=!this.isIntegerPrecision()}}}])})(),Jr=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next().getCoordinates();this.checkEndPtVertexIntersections(t[0],this._segStrings),this.checkEndPtVertexIntersections(t[t.length-1],this._segStrings)}else if(arguments.length===2){for(var n=arguments[0],r=arguments[1].iterator();r.hasNext();)for(var s=r.next().getCoordinates(),o=1;o<s.length-1;o++)if(s[o].equals(n))throw new Be("found endpt/interior pt intersection at index "+o+" :pt "+n)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();)for(var t=e.next(),n=this._segStrings.iterator();n.hasNext();){var r=n.next();this.checkInteriorIntersections(t,r)}else if(arguments.length===2)for(var s=arguments[0],o=arguments[1],u=s.getCoordinates(),m=o.getCoordinates(),y=0;y<u.length-1;y++)for(var T=0;T<m.length-1;T++)this.checkInteriorIntersections(s,y,o,T);else if(arguments.length===4){var R=arguments[0],G=arguments[1],J=arguments[2],se=arguments[3];if(R===J&&G===se)return null;var ce=R.getCoordinates()[G],be=R.getCoordinates()[G+1],Se=J.getCoordinates()[se],Ae=J.getCoordinates()[se+1];if(this._li.computeIntersection(ce,be,Se,Ae),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,ce,be)||this.hasInteriorIntersection(this._li,Se,Ae)))throw new Be("found non-noded intersection at "+ce+"-"+be+" and "+Se+"-"+Ae)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next();this.checkCollapses(t)}else if(arguments.length===1)for(var n=arguments[0].getCoordinates(),r=0;r<n.length-2;r++)this.checkCollapse(n[r],n[r+1],n[r+2])}},{key:"hasInteriorIntersection",value:function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++){var s=e.getIntersection(r);if(!s.equals(t)&&!s.equals(n))return!0}return!1}},{key:"checkCollapse",value:function(e,t,n){if(e.equals(n))throw new Be("found non-noded collapse at "+i.fact.createLineString([e,t,n]))}}],[{key:"constructor_",value:function(){this._li=new zt,this._segStrings=null;var e=arguments[0];this._segStrings=e}}])})();Jr.fact=new Wt;var fr=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"intersectsScaled",value:function(e,t){var n=Math.min(e.x,t.x),r=Math.max(e.x,t.x),s=Math.min(e.y,t.y),o=Math.max(e.y,t.y),u=this._maxx<n||this._minx>r||this._maxy<s||this._miny>o;if(u)return!1;var m=this.intersectsToleranceSquare(e,t);return ke.isTrue(!(u&&m),"Found bad envelope test"),m}},{key:"initCorners",value:function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new M(this._maxx,this._maxy),this._corner[1]=new M(this._minx,this._maxy),this._corner[2]=new M(this._minx,this._miny),this._corner[3]=new M(this._maxx,this._miny)}},{key:"intersects",value:function(e,t){return this._scaleFactor===1?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(e){return Math.round(e*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var e=i.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Me(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(e,t){var n=!1,r=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!n||!r)||!!e.equals(this._pt)||!!t.equals(this._pt))))}},{key:"addSnappedNode",value:function(e,t){var n=e.getCoordinate(t),r=e.getCoordinate(t+1);return!!this.intersects(n,r)&&(e.addIntersection(this.getCoordinate(),t),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=n,t<=0)throw new Y("Scale factor must be non-zero");t!==1&&(this._pt=new M(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new M,this._p1Scaled=new M),this.initCorners(this._pt)}}])})();fr.SAFE_ENV_EXPANSION_FACTOR=.75;var Za=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var i=arguments[1];arguments[0].getLineSegment(i,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new _t}}])})(),Qr=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"snap",value:function(){if(arguments.length===1){var i=arguments[0];return this.snap(i,null,-1)}if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2],r=e.getSafeEnvelope(),s=new es(e,t,n);return this._index.query(r,new((function(){return d((function o(){c(this,o)}),[{key:"interfaces_",get:function(){return[At]}},{key:"visitItem",value:function(o){o.select(r,s)}}])})())),s.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var i=arguments[0];this._index=i}}])})(),es=(function(i){function e(){var t;return c(this,e),t=h(this,e),e.constructor_.apply(t,arguments),t}return p(e,i),d(e,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof qr))return w(e,"select",this,1).apply(this,arguments);var t=arguments[1],n=arguments[0].getContext();if(this._parentEdge===n&&(t===this._hotPixelVertexIndex||t+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(n,t)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var t=arguments[0],n=arguments[1],r=arguments[2];this._hotPixel=t,this._parentEdge=n,this._hotPixelVertexIndex=r}}])})(Za);Qr.HotPixelSnapAction=es;var Ka=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"processIntersections",value:function(i,e,t,n){if(i===t&&e===n)return null;var r=i.getCoordinates()[e],s=i.getCoordinates()[e+1],o=t.getCoordinates()[n],u=t.getCoordinates()[n+1];if(this._li.computeIntersection(r,s,o,u),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var m=0;m<this._li.getIntersectionNum();m++)this._interiorIntersections.add(this._li.getIntersection(m));i.addIntersections(this._li,e,0),t.addIntersections(this._li,n,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Zr]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var i=arguments[0];this._li=i,this._interiorIntersections=new he}}])})(),Wa=(function(){return d((function i(){c(this,i),i.constructor_.apply(this,arguments)}),[{key:"checkCorrectness",value:function(i){var e=xn.getNodedSubstrings(i),t=new Jr(e);try{t.checkValid()}catch(n){if(!(n instanceof K))throw n;n.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return xn.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(i,e){var t=this.findInteriorIntersections(i,e);this.computeIntersectionSnaps(t),this.computeVertexSnaps(i)}},{key:"findInteriorIntersections",value:function(i,e){var t=new Ka(e);return this._noder.setSegmentIntersector(t),this._noder.computeNodes(i),t.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(ye(arguments[0],ze))for(var i=arguments[0].iterator();i.hasNext();){var e=i.next();this.computeVertexSnaps(e)}else if(arguments[0]instanceof xn)for(var t=arguments[0],n=t.getCoordinates(),r=0;r<n.length;r++){var s=new fr(n[r],this._scaleFactor,this._li);this._pointSnapper.snap(s,t,r)&&t.addIntersection(n[r],r)}}},{key:"computeNodes",value:function(i){this._nodedSegStrings=i,this._noder=new cr,this._pointSnapper=new Qr(this._noder.getIndex()),this.snapRound(i,this._li)}},{key:"computeIntersectionSnaps",value:function(i){for(var e=i.iterator();e.hasNext();){var t=e.next(),n=new fr(t,this._scaleFactor,this._li);this._pointSnapper.snap(n)}}},{key:"interfaces_",get:function(){return[lr]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var i=arguments[0];this._pm=i,this._li=new zt,this._li.setPrecisionModel(i),this._scaleFactor=i.getScale()}}])})(),On=(function(){function i(){c(this,i),i.constructor_.apply(this,arguments)}return d(i,[{key:"bufferFixedPrecision",value:function(e){var t=new Ha(new Wa(new vt(1)),e.getScale()),n=new $r(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(t),this._resultGeometry=n.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var e=i.MAX_PRECISION_DIGITS;e>=0;e--){try{this.bufferReducedPrecision(e)}catch(s){if(!(s instanceof ut))throw s;this._saveException=s}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var t=arguments[0],n=i.precisionScaleFactor(this._argGeom,this._distance,t),r=new vt(n);this.bufferFixedPrecision(r)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===vt.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(e){this._bufParams.setQuadrantSegments(e)}},{key:"bufferOriginalPrecision",value:function(){try{var e=new $r(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof Be))throw t;this._saveException=t}}},{key:"getResultGeometry",value:function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(e){this._bufParams.setEndCapStyle(e)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new F,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._argGeom=t,this._bufParams=n}}},{key:"bufferOp",value:function(){if(arguments.length===2){var e=arguments[1];return new i(arguments[0]).getResultGeometry(e)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof oe&&typeof arguments[1]=="number"){var t=arguments[1],n=arguments[2],r=new i(arguments[0]);return r.setQuadrantSegments(n),r.getResultGeometry(t)}if(arguments[2]instanceof F&&arguments[0]instanceof oe&&typeof arguments[1]=="number"){var s=arguments[1];return new i(arguments[0],arguments[2]).getResultGeometry(s)}}else if(arguments.length===4){var o=arguments[1],u=arguments[2],m=arguments[3],y=new i(arguments[0]);return y.setQuadrantSegments(u),y.setEndCapStyle(m),y.getResultGeometry(o)}}},{key:"precisionScaleFactor",value:function(e,t,n){var r=e.getEnvelopeInternal(),s=We.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY()))+2*(t>0?t:0),o=n-Math.trunc(Math.log(s)/Math.log(10)+1);return Math.pow(10,o)}}])})();On.CAP_ROUND=F.CAP_ROUND,On.CAP_BUTT=F.CAP_FLAT,On.CAP_FLAT=F.CAP_FLAT,On.CAP_SQUARE=F.CAP_SQUARE,On.MAX_PRECISION_DIGITS=12;var $a=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],ts=(function(){return d((function i(e){c(this,i),this.geometryFactory=e||new Wt}),[{key:"read",value:function(i){var e,t=(e=typeof i=="string"?JSON.parse(i):i).type;if(!Nt[t])throw new Error("Unknown GeoJSON type: "+e.type);return $a.indexOf(t)!==-1?Nt[t].call(this,e.coordinates):t==="GeometryCollection"?Nt[t].call(this,e.geometries):Nt[t].call(this,e)}},{key:"write",value:function(i){var e=i.getGeometryType();if(!Pt[e])throw new Error("Geometry is not supported");return Pt[e].call(this,i)}}])})(),Nt={Feature:function(i){var e={};for(var t in i)e[t]=i[t];if(i.geometry){var n=i.geometry.type;if(!Nt[n])throw new Error("Unknown GeoJSON type: "+i.type);e.geometry=this.read(i.geometry)}return i.bbox&&(e.bbox=Nt.bbox.call(this,i.bbox)),e},FeatureCollection:function(i){var e={};if(i.features){e.features=[];for(var t=0;t<i.features.length;++t)e.features.push(this.read(i.features[t]))}return i.bbox&&(e.bbox=this.parse.bbox.call(this,i.bbox)),e},coordinates:function(i){for(var e=[],t=0;t<i.length;++t){var n=i[t];e.push(v(M,z(n)))}return e},bbox:function(i){return this.geometryFactory.createLinearRing([new M(i[0],i[1]),new M(i[2],i[1]),new M(i[2],i[3]),new M(i[0],i[3]),new M(i[0],i[1])])},Point:function(i){var e=v(M,z(i));return this.geometryFactory.createPoint(e)},MultiPoint:function(i){for(var e=[],t=0;t<i.length;++t)e.push(Nt.Point.call(this,i[t]));return this.geometryFactory.createMultiPoint(e)},LineString:function(i){var e=Nt.coordinates.call(this,i);return this.geometryFactory.createLineString(e)},MultiLineString:function(i){for(var e=[],t=0;t<i.length;++t)e.push(Nt.LineString.call(this,i[t]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(i){for(var e=Nt.coordinates.call(this,i[0]),t=this.geometryFactory.createLinearRing(e),n=[],r=1;r<i.length;++r){var s=i[r],o=Nt.coordinates.call(this,s),u=this.geometryFactory.createLinearRing(o);n.push(u)}return this.geometryFactory.createPolygon(t,n)},MultiPolygon:function(i){for(var e=[],t=0;t<i.length;++t){var n=i[t];e.push(Nt.Polygon.call(this,n))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(i){for(var e=[],t=0;t<i.length;++t){var n=i[t];e.push(this.read(n))}return this.geometryFactory.createGeometryCollection(e)}},Pt={coordinate:function(i){var e=[i.x,i.y];return i.z&&e.push(i.z),i.m&&e.push(i.m),e},Point:function(i){return{type:"Point",coordinates:Pt.coordinate.call(this,i.getCoordinate())}},MultiPoint:function(i){for(var e=[],t=0;t<i._geometries.length;++t){var n=i._geometries[t],r=Pt.Point.call(this,n);e.push(r.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(i){for(var e=[],t=i.getCoordinates(),n=0;n<t.length;++n){var r=t[n];e.push(Pt.coordinate.call(this,r))}return{type:"LineString",coordinates:e}},MultiLineString:function(i){for(var e=[],t=0;t<i._geometries.length;++t){var n=i._geometries[t],r=Pt.LineString.call(this,n);e.push(r.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(i){var e=[],t=Pt.LineString.call(this,i._shell);e.push(t.coordinates);for(var n=0;n<i._holes.length;++n){var r=i._holes[n],s=Pt.LineString.call(this,r);e.push(s.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(i){for(var e=[],t=0;t<i._geometries.length;++t){var n=i._geometries[t],r=Pt.Polygon.call(this,n);e.push(r.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(i){for(var e=[],t=0;t<i._geometries.length;++t){var n=i._geometries[t],r=n.getGeometryType();e.push(Pt[r].call(this,n))}return{type:"GeometryCollection",geometries:e}}};return{BufferOp:On,GeoJSONReader:(function(){return d((function i(e){c(this,i),this.parser=new ts(e||new Wt)}),[{key:"read",value:function(i){return this.parser.read(i)}}])})(),GeoJSONWriter:(function(){return d((function i(){c(this,i),this.parser=new ts(this.geometryFactory)}),[{key:"write",value:function(i){return this.parser.write(i)}}])})()}}))})(zi)),zi.exports}var tu=eu();const nu=Ja(tu);function sn(){return new Vi}function Vi(){this.reset()}Vi.prototype={constructor:Vi,reset:function(){this.s=this.t=0},add:function(a){Ts(Ci,a,this.t),Ts(this,Ci.s,this.s),this.s?this.t+=Ci.t:this.s=Ci.t},valueOf:function(){return this.s}};var Ci=new Vi;function Ts(a,l,g){var h=a.s=l+g,c=h-l,v=h-c;a.t=l-v+(g-c)}var De=1e-6,Ce=Math.PI,Dt=Ce/2,Cs=Ce/4,Ft=Ce*2,Qt=180/Ce,St=Ce/180,Ke=Math.abs,iu=Math.atan,Gn=Math.atan2,Ye=Math.cos,Ue=Math.sin,zn=Math.sqrt;function ua(a){return a>1?0:a<-1?Ce:Math.acos(a)}function Nn(a){return a>1?Dt:a<-1?-Dt:Math.asin(a)}function si(){}function Xi(a,l){a&&Rs.hasOwnProperty(a.type)&&Rs[a.type](a,l)}var Ls={Feature:function(a,l){Xi(a.geometry,l)},FeatureCollection:function(a,l){for(var g=a.features,h=-1,c=g.length;++h<c;)Xi(g[h].geometry,l)}},Rs={Sphere:function(a,l){l.sphere()},Point:function(a,l){a=a.coordinates,l.point(a[0],a[1],a[2])},MultiPoint:function(a,l){for(var g=a.coordinates,h=-1,c=g.length;++h<c;)a=g[h],l.point(a[0],a[1],a[2])},LineString:function(a,l){Mr(a.coordinates,l,0)},MultiLineString:function(a,l){for(var g=a.coordinates,h=-1,c=g.length;++h<c;)Mr(g[h],l,0)},Polygon:function(a,l){Os(a.coordinates,l)},MultiPolygon:function(a,l){for(var g=a.coordinates,h=-1,c=g.length;++h<c;)Os(g[h],l)},GeometryCollection:function(a,l){for(var g=a.geometries,h=-1,c=g.length;++h<c;)Xi(g[h],l)}};function Mr(a,l,g){var h=-1,c=a.length-g,v;for(l.lineStart();++h<c;)v=a[h],l.point(v[0],v[1],v[2]);l.lineEnd()}function Os(a,l){var g=-1,h=a.length;for(l.polygonStart();++g<h;)Mr(a[g],l,1);l.polygonEnd()}function ru(a,l){a&&Ls.hasOwnProperty(a.type)?Ls[a.type](a,l):Xi(a,l)}sn();sn();function Ar(a){return[Gn(a[1],a[0]),Nn(a[2])]}function jn(a){var l=a[0],g=a[1],h=Ye(g);return[h*Ye(l),h*Ue(l),Ue(g)]}function Li(a,l){return a[0]*l[0]+a[1]*l[1]+a[2]*l[2]}function Hi(a,l){return[a[1]*l[2]-a[2]*l[1],a[2]*l[0]-a[0]*l[2],a[0]*l[1]-a[1]*l[0]]}function kr(a,l){a[0]+=l[0],a[1]+=l[1],a[2]+=l[2]}function Ri(a,l){return[a[0]*l,a[1]*l,a[2]*l]}function Pr(a){var l=zn(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]/=l,a[1]/=l,a[2]/=l}sn();function la(a,l){function g(h,c){return h=a(h,c),l(h[0],h[1])}return a.invert&&l.invert&&(g.invert=function(h,c){return h=l.invert(h,c),h&&a.invert(h[0],h[1])}),g}function Dr(a,l){return[a>Ce?a-Ft:a<-Ce?a+Ft:a,l]}Dr.invert=Dr;function su(a,l,g){return(a%=Ft)?l||g?la(As(a),Ps(l,g)):As(a):l||g?Ps(l,g):Dr}function Ms(a){return function(l,g){return l+=a,[l>Ce?l-Ft:l<-Ce?l+Ft:l,g]}}function As(a){var l=Ms(a);return l.invert=Ms(-a),l}function Ps(a,l){var g=Ye(a),h=Ue(a),c=Ye(l),v=Ue(l);function N(d,b){var I=Ye(b),_=Ye(d)*I,p=Ue(d)*I,S=Ue(b),O=S*g+_*h;return[Gn(p*c-O*v,_*g-S*h),Nn(O*c+p*v)]}return N.invert=function(d,b){var I=Ye(b),_=Ye(d)*I,p=Ue(d)*I,S=Ue(b),O=S*c-p*v;return[Gn(p*c+S*v,_*g+O*h),Nn(O*g-_*h)]},N}function au(a,l,g,h,c,v){if(g){var N=Ye(l),d=Ue(l),b=h*g;c==null?(c=l+h*Ft,v=l-b/2):(c=Ds(N,c),v=Ds(N,v),(h>0?c<v:c>v)&&(c+=h*Ft));for(var I,_=c;h>0?_>v:_<v;_-=b)I=Ar([N,-d*Ye(_),-d*Ue(_)]),a.point(I[0],I[1])}}function Ds(a,l){l=jn(l),l[0]-=a,Pr(l);var g=ua(-l[1]);return((-l[2]<0?-g:g)+Ft-De)%Ft}function ca(){var a=[],l;return{point:function(g,h){l.push([g,h])},lineStart:function(){a.push(l=[])},lineEnd:si,rejoin:function(){a.length>1&&a.push(a.pop().concat(a.shift()))},result:function(){var g=a;return a=[],l=null,g}}}function ou(a,l,g,h,c,v){var N=a[0],d=a[1],b=l[0],I=l[1],_=0,p=1,S=b-N,O=I-d,w;if(w=g-N,!(!S&&w>0)){if(w/=S,S<0){if(w<_)return;w<p&&(p=w)}else if(S>0){if(w>p)return;w>_&&(_=w)}if(w=c-N,!(!S&&w<0)){if(w/=S,S<0){if(w>p)return;w>_&&(_=w)}else if(S>0){if(w<_)return;w<p&&(p=w)}if(w=h-d,!(!O&&w>0)){if(w/=O,O<0){if(w<_)return;w<p&&(p=w)}else if(O>0){if(w>p)return;w>_&&(_=w)}if(w=v-d,!(!O&&w<0)){if(w/=O,O<0){if(w>p)return;w>_&&(_=w)}else if(O>0){if(w<_)return;w<p&&(p=w)}return _>0&&(a[0]=N+_*S,a[1]=d+_*O),p<1&&(l[0]=N+p*S,l[1]=d+p*O),!0}}}}}function Yi(a,l){return Ke(a[0]-l[0])<De&&Ke(a[1]-l[1])<De}function Oi(a,l,g,h){this.x=a,this.z=l,this.o=g,this.e=h,this.v=!1,this.n=this.p=null}function ha(a,l,g,h,c){var v=[],N=[],d,b;if(a.forEach(function(w){if(!((z=w.length-1)<=0)){var z,A=w[0],U=w[z],X;if(Yi(A,U)){for(c.lineStart(),d=0;d<z;++d)c.point((A=w[d])[0],A[1]);c.lineEnd();return}v.push(X=new Oi(A,w,null,!0)),N.push(X.o=new Oi(A,null,X,!1)),v.push(X=new Oi(U,w,null,!1)),N.push(X.o=new Oi(U,null,X,!0))}}),!!v.length){for(N.sort(l),Fs(v),Fs(N),d=0,b=N.length;d<b;++d)N[d].e=g=!g;for(var I=v[0],_,p;;){for(var S=I,O=!0;S.v;)if((S=S.n)===I)return;_=S.z,c.lineStart();do{if(S.v=S.o.v=!0,S.e){if(O)for(d=0,b=_.length;d<b;++d)c.point((p=_[d])[0],p[1]);else h(S.x,S.n.x,1,c);S=S.n}else{if(O)for(_=S.p.z,d=_.length-1;d>=0;--d)c.point((p=_[d])[0],p[1]);else h(S.x,S.p.x,-1,c);S=S.p}S=S.o,_=S.z,O=!O}while(!S.v);c.lineEnd()}}}function Fs(a){if(l=a.length){for(var l,g=0,h=a[0],c;++g<l;)h.n=c=a[g],c.p=h,h=c;h.n=c=a[0],c.p=h}}function fa(a,l){return a<l?-1:a>l?1:a>=l?0:NaN}function uu(a){return a.length===1&&(a=lu(a)),{left:function(l,g,h,c){for(h==null&&(h=0),c==null&&(c=l.length);h<c;){var v=h+c>>>1;a(l[v],g)<0?h=v+1:c=v}return h},right:function(l,g,h,c){for(h==null&&(h=0),c==null&&(c=l.length);h<c;){var v=h+c>>>1;a(l[v],g)>0?c=v:h=v+1}return h}}}function lu(a){return function(l,g){return fa(a(l),g)}}uu(fa);function ga(a){for(var l=a.length,g,h=-1,c=0,v,N;++h<l;)c+=a[h].length;for(v=new Array(c);--l>=0;)for(N=a[l],g=N.length;--g>=0;)v[--c]=N[g];return v}var ai=1e9,Mi=-ai;function cu(a,l,g,h){function c(I,_){return a<=I&&I<=g&&l<=_&&_<=h}function v(I,_,p,S){var O=0,w=0;if(I==null||(O=N(I,p))!==(w=N(_,p))||b(I,_)<0^p>0)do S.point(O===0||O===3?a:g,O>1?h:l);while((O=(O+p+4)%4)!==w);else S.point(_[0],_[1])}function N(I,_){return Ke(I[0]-a)<De?_>0?0:3:Ke(I[0]-g)<De?_>0?2:1:Ke(I[1]-l)<De?_>0?1:0:_>0?3:2}function d(I,_){return b(I.x,_.x)}function b(I,_){var p=N(I,1),S=N(_,1);return p!==S?p-S:p===0?_[1]-I[1]:p===1?I[0]-_[0]:p===2?I[1]-_[1]:_[0]-I[0]}return function(I){var _=I,p=ca(),S,O,w,z,A,U,X,F,K,Y,B,W={point:$,lineStart:me,lineEnd:xe,polygonStart:pe,polygonEnd:_e};function $(de,Ie){c(de,Ie)&&_.point(de,Ie)}function Q(){for(var de=0,Ie=0,Re=O.length;Ie<Re;++Ie)for(var Fe=O[Ie],qe=1,ne=Fe.length,Ge=Fe[0],Be,Le,ke=Ge[0],Te=Ge[1];qe<ne;++qe)Be=ke,Le=Te,Ge=Fe[qe],ke=Ge[0],Te=Ge[1],Le<=h?Te>h&&(ke-Be)*(h-Le)>(Te-Le)*(a-Be)&&++de:Te<=h&&(ke-Be)*(h-Le)<(Te-Le)*(a-Be)&&--de;return de}function pe(){_=p,S=[],O=[],B=!0}function _e(){var de=Q(),Ie=B&&de,Re=(S=ga(S)).length;(Ie||Re)&&(I.polygonStart(),Ie&&(I.lineStart(),v(null,null,1,I),I.lineEnd()),Re&&ha(S,d,de,v,I),I.polygonEnd()),_=I,S=O=w=null}function me(){W.point=H,O&&O.push(w=[]),Y=!0,K=!1,X=F=NaN}function xe(){S&&(H(z,A),U&&K&&p.rejoin(),S.push(p.result())),W.point=$,K&&_.lineEnd()}function H(de,Ie){var Re=c(de,Ie);if(O&&w.push([de,Ie]),Y)z=de,A=Ie,U=Re,Y=!1,Re&&(_.lineStart(),_.point(de,Ie));else if(Re&&K)_.point(de,Ie);else{var Fe=[X=Math.max(Mi,Math.min(ai,X)),F=Math.max(Mi,Math.min(ai,F))],qe=[de=Math.max(Mi,Math.min(ai,de)),Ie=Math.max(Mi,Math.min(ai,Ie))];ou(Fe,qe,a,l,g,h)?(K||(_.lineStart(),_.point(Fe[0],Fe[1])),_.point(qe[0],qe[1]),Re||_.lineEnd(),B=!1):Re&&(_.lineStart(),_.point(de,Ie),B=!1)}X=de,F=Ie,K=Re}return W}}var Er=sn();function hu(a,l){var g=l[0],h=l[1],c=[Ue(g),-Ye(g),0],v=0,N=0;Er.reset();for(var d=0,b=a.length;d<b;++d)if(_=(I=a[d]).length)for(var I,_,p=I[_-1],S=p[0],O=p[1]/2+Cs,w=Ue(O),z=Ye(O),A=0;A<_;++A,S=X,w=K,z=Y,p=U){var U=I[A],X=U[0],F=U[1]/2+Cs,K=Ue(F),Y=Ye(F),B=X-S,W=B>=0?1:-1,$=W*B,Q=$>Ce,pe=w*K;if(Er.add(Gn(pe*W*Ue($),z*Y+pe*Ye($))),v+=Q?B+W*Ft:B,Q^S>=g^X>=g){var _e=Hi(jn(p),jn(U));Pr(_e);var me=Hi(c,_e);Pr(me);var xe=(Q^B>=0?-1:1)*Nn(me[2]);(h>xe||h===xe&&(_e[0]||_e[1]))&&(N+=Q^B>=0?1:-1)}}return(v<-De||v<De&&Er<-De)^N&1}sn();function Gs(a){return a}sn();sn();var qn=1/0,Zi=qn,li=-qn,Ki=li,js={point:fu,lineStart:si,lineEnd:si,polygonStart:si,polygonEnd:si,result:function(){var a=[[qn,Zi],[li,Ki]];return li=Ki=-(Zi=qn=1/0),a}};function fu(a,l){a<qn&&(qn=a),a>li&&(li=a),l<Zi&&(Zi=l),l>Ki&&(Ki=l)}sn();function da(a,l,g,h){return function(c,v){var N=l(v),d=c.invert(h[0],h[1]),b=ca(),I=l(b),_=!1,p,S,O,w={point:z,lineStart:U,lineEnd:X,polygonStart:function(){w.point=F,w.lineStart=K,w.lineEnd=Y,S=[],p=[]},polygonEnd:function(){w.point=z,w.lineStart=U,w.lineEnd=X,S=ga(S);var B=hu(p,d);S.length?(_||(v.polygonStart(),_=!0),ha(S,du,B,g,v)):B&&(_||(v.polygonStart(),_=!0),v.lineStart(),g(null,null,1,v),v.lineEnd()),_&&(v.polygonEnd(),_=!1),S=p=null},sphere:function(){v.polygonStart(),v.lineStart(),g(null,null,1,v),v.lineEnd(),v.polygonEnd()}};function z(B,W){var $=c(B,W);a(B=$[0],W=$[1])&&v.point(B,W)}function A(B,W){var $=c(B,W);N.point($[0],$[1])}function U(){w.point=A,N.lineStart()}function X(){w.point=z,N.lineEnd()}function F(B,W){O.push([B,W]);var $=c(B,W);I.point($[0],$[1])}function K(){I.lineStart(),O=[]}function Y(){F(O[0][0],O[0][1]),I.lineEnd();var B=I.clean(),W=b.result(),$,Q=W.length,pe,_e,me;if(O.pop(),p.push(O),O=null,!!Q){if(B&1){if(_e=W[0],(pe=_e.length-1)>0){for(_||(v.polygonStart(),_=!0),v.lineStart(),$=0;$<pe;++$)v.point((me=_e[$])[0],me[1]);v.lineEnd()}return}Q>1&&B&2&&W.push(W.pop().concat(W.shift())),S.push(W.filter(gu))}}return w}}function gu(a){return a.length>1}function du(a,l){return((a=a.x)[0]<0?a[1]-Dt-De:Dt-a[1])-((l=l.x)[0]<0?l[1]-Dt-De:Dt-l[1])}const qs=da(function(){return!0},mu,vu,[-Ce,-Dt]);function mu(a){var l=NaN,g=NaN,h=NaN,c;return{lineStart:function(){a.lineStart(),c=1},point:function(v,N){var d=v>0?Ce:-Ce,b=Ke(v-l);Ke(b-Ce)<De?(a.point(l,g=(g+N)/2>0?Dt:-Dt),a.point(h,g),a.lineEnd(),a.lineStart(),a.point(d,g),a.point(v,g),c=0):h!==d&&b>=Ce&&(Ke(l-h)<De&&(l-=h*De),Ke(v-d)<De&&(v-=d*De),g=yu(l,g,v,N),a.point(h,g),a.lineEnd(),a.lineStart(),a.point(d,g),c=0),a.point(l=v,g=N),h=d},lineEnd:function(){a.lineEnd(),l=g=NaN},clean:function(){return 2-c}}}function yu(a,l,g,h){var c,v,N=Ue(a-g);return Ke(N)>De?iu((Ue(l)*(v=Ye(h))*Ue(g)-Ue(h)*(c=Ye(l))*Ue(a))/(c*v*N)):(l+h)/2}function vu(a,l,g,h){var c;if(a==null)c=g*Dt,h.point(-Ce,c),h.point(0,c),h.point(Ce,c),h.point(Ce,0),h.point(Ce,-c),h.point(0,-c),h.point(-Ce,-c),h.point(-Ce,0),h.point(-Ce,c);else if(Ke(a[0]-l[0])>De){var v=a[0]<l[0]?Ce:-Ce;c=g*v/2,h.point(-v,c),h.point(0,c),h.point(v,c)}else h.point(l[0],l[1])}function pu(a,l){var g=Ye(a),h=g>0,c=Ke(g)>De;function v(_,p,S,O){au(O,a,l,S,_,p)}function N(_,p){return Ye(_)*Ye(p)>g}function d(_){var p,S,O,w,z;return{lineStart:function(){w=O=!1,z=1},point:function(A,U){var X=[A,U],F,K=N(A,U),Y=h?K?0:I(A,U):K?I(A+(A<0?Ce:-Ce),U):0;if(!p&&(w=O=K)&&_.lineStart(),K!==O&&(F=b(p,X),(!F||Yi(p,F)||Yi(X,F))&&(X[0]+=De,X[1]+=De,K=N(X[0],X[1]))),K!==O)z=0,K?(_.lineStart(),F=b(X,p),_.point(F[0],F[1])):(F=b(p,X),_.point(F[0],F[1]),_.lineEnd()),p=F;else if(c&&p&&h^K){var B;!(Y&S)&&(B=b(X,p,!0))&&(z=0,h?(_.lineStart(),_.point(B[0][0],B[0][1]),_.point(B[1][0],B[1][1]),_.lineEnd()):(_.point(B[1][0],B[1][1]),_.lineEnd(),_.lineStart(),_.point(B[0][0],B[0][1])))}K&&(!p||!Yi(p,X))&&_.point(X[0],X[1]),p=X,O=K,S=Y},lineEnd:function(){O&&_.lineEnd(),p=null},clean:function(){return z|(w&&O)<<1}}}function b(_,p,S){var O=jn(_),w=jn(p),z=[1,0,0],A=Hi(O,w),U=Li(A,A),X=A[0],F=U-X*X;if(!F)return!S&&_;var K=g*U/F,Y=-g*X/F,B=Hi(z,A),W=Ri(z,K),$=Ri(A,Y);kr(W,$);var Q=B,pe=Li(W,Q),_e=Li(Q,Q),me=pe*pe-_e*(Li(W,W)-1);if(!(me<0)){var xe=zn(me),H=Ri(Q,(-pe-xe)/_e);if(kr(H,W),H=Ar(H),!S)return H;var de=_[0],Ie=p[0],Re=_[1],Fe=p[1],qe;Ie<de&&(qe=de,de=Ie,Ie=qe);var ne=Ie-de,Ge=Ke(ne-Ce)<De,Be=Ge||ne<De;if(!Ge&&Fe<Re&&(qe=Re,Re=Fe,Fe=qe),Be?Ge?Re+Fe>0^H[1]<(Ke(H[0]-de)<De?Re:Fe):Re<=H[1]&&H[1]<=Fe:ne>Ce^(de<=H[0]&&H[0]<=Ie)){var Le=Ri(Q,(-pe+xe)/_e);return kr(Le,W),[H,Ar(Le)]}}}function I(_,p){var S=h?a:Ce-a,O=0;return _<-S?O|=1:_>S&&(O|=2),p<-S?O|=4:p>S&&(O|=8),O}return da(N,d,v,h?[0,-a]:[-Ce,a-Ce])}function ma(a){return function(l){var g=new Fr;for(var h in a)g[h]=a[h];return g.stream=l,g}}function Fr(){}Fr.prototype={constructor:Fr,point:function(a,l){this.stream.point(a,l)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function ya(a,l,g){var h=l[1][0]-l[0][0],c=l[1][1]-l[0][1],v=a.clipExtent&&a.clipExtent();a.scale(150).translate([0,0]),v!=null&&a.clipExtent(null),ru(g,a.stream(js));var N=js.result(),d=Math.min(h/(N[1][0]-N[0][0]),c/(N[1][1]-N[0][1])),b=+l[0][0]+(h-d*(N[1][0]+N[0][0]))/2,I=+l[0][1]+(c-d*(N[1][1]+N[0][1]))/2;return v!=null&&a.clipExtent(v),a.scale(d*150).translate([b,I])}function _u(a,l,g){return ya(a,[[0,0],l],g)}var zs=16,xu=Ye(30*St);function Ys(a,l){return+l?Eu(a,l):ku(a)}function ku(a){return ma({point:function(l,g){l=a(l,g),this.stream.point(l[0],l[1])}})}function Eu(a,l){function g(h,c,v,N,d,b,I,_,p,S,O,w,z,A){var U=I-h,X=_-c,F=U*U+X*X;if(F>4*l&&z--){var K=N+S,Y=d+O,B=b+w,W=zn(K*K+Y*Y+B*B),$=Nn(B/=W),Q=Ke(Ke(B)-1)<De||Ke(v-p)<De?(v+p)/2:Gn(Y,K),pe=a(Q,$),_e=pe[0],me=pe[1],xe=_e-h,H=me-c,de=X*xe-U*H;(de*de/F>l||Ke((U*xe+X*H)/F-.5)>.3||N*S+d*O+b*w<xu)&&(g(h,c,v,N,d,b,_e,me,Q,K/=W,Y/=W,B,z,A),A.point(_e,me),g(_e,me,Q,K,Y,B,I,_,p,S,O,w,z,A))}}return function(h){var c,v,N,d,b,I,_,p,S,O,w,z,A={point:U,lineStart:X,lineEnd:K,polygonStart:function(){h.polygonStart(),A.lineStart=Y},polygonEnd:function(){h.polygonEnd(),A.lineStart=X}};function U($,Q){$=a($,Q),h.point($[0],$[1])}function X(){p=NaN,A.point=F,h.lineStart()}function F($,Q){var pe=jn([$,Q]),_e=a($,Q);g(p,S,_,O,w,z,p=_e[0],S=_e[1],_=$,O=pe[0],w=pe[1],z=pe[2],zs,h),h.point(p,S)}function K(){A.point=U,h.lineEnd()}function Y(){X(),A.point=B,A.lineEnd=W}function B($,Q){F(c=$,Q),v=p,N=S,d=O,b=w,I=z,A.point=F}function W(){g(p,S,_,O,w,z,v,N,c,d,b,I,zs,h),A.lineEnd=K,K()}return A}}var Nu=ma({point:function(a,l){this.stream.point(a*St,l*St)}});function Iu(a){return Su(function(){return a})()}function Su(a){var l,g=150,h=480,c=250,v,N,d=0,b=0,I=0,_=0,p=0,S,O,w=null,z=qs,A=null,U,X,F,K=Gs,Y=.5,B=Ys(_e,Y),W,$;function Q(H){return H=O(H[0]*St,H[1]*St),[H[0]*g+v,N-H[1]*g]}function pe(H){return H=O.invert((H[0]-v)/g,(N-H[1])/g),H&&[H[0]*Qt,H[1]*Qt]}function _e(H,de){return H=l(H,de),[H[0]*g+v,N-H[1]*g]}Q.stream=function(H){return W&&$===H?W:W=Nu(z(S,B(K($=H))))},Q.clipAngle=function(H){return arguments.length?(z=+H?pu(w=H*St,6*St):(w=null,qs),xe()):w*Qt},Q.clipExtent=function(H){return arguments.length?(K=H==null?(A=U=X=F=null,Gs):cu(A=+H[0][0],U=+H[0][1],X=+H[1][0],F=+H[1][1]),xe()):A==null?null:[[A,U],[X,F]]},Q.scale=function(H){return arguments.length?(g=+H,me()):g},Q.translate=function(H){return arguments.length?(h=+H[0],c=+H[1],me()):[h,c]},Q.center=function(H){return arguments.length?(d=H[0]%360*St,b=H[1]%360*St,me()):[d*Qt,b*Qt]},Q.rotate=function(H){return arguments.length?(I=H[0]%360*St,_=H[1]%360*St,p=H.length>2?H[2]%360*St:0,me()):[I*Qt,_*Qt,p*Qt]},Q.precision=function(H){return arguments.length?(B=Ys(_e,Y=H*H),xe()):zn(Y)},Q.fitExtent=function(H,de){return ya(Q,H,de)},Q.fitSize=function(H,de){return _u(Q,H,de)};function me(){O=la(S=su(I,_,p),l);var H=l(d,b);return v=h-H[0]*g,N=c+H[1]*g,xe()}function xe(){return W=$=null,Q}return function(){return l=a.apply(this,arguments),Q.invert=l.invert&&pe,me()}}function va(a){return function(l,g){var h=Ye(l),c=Ye(g),v=a(h*c);return[v*c*Ue(l),v*Ue(g)]}}function pa(a){return function(l,g){var h=zn(l*l+g*g),c=a(h),v=Ue(c),N=Ye(c);return[Gn(l*v,h*N),Nn(h&&g*v/h)]}}var wu=va(function(a){return zn(2/(1+a))});wu.invert=pa(function(a){return 2*Nn(a/2)});var _a=va(function(a){return(a=ua(a))&&a/Ue(a)});_a.invert=pa(function(a){return a});function bu(){return Iu(_a).scale(79.4188).clipAngle(180-.001)}function Us(a,l){return[a,l]}Us.invert=Us;var{BufferOp:Tu,GeoJSONReader:Cu,GeoJSONWriter:Lu}=nu;function Ru(a,l,g){g=g||{};var h=g.units||"kilometers",c=g.steps||8;if(!a)throw new Error("geojson is required");if(typeof g!="object")throw new Error("options must be an object");if(typeof c!="number")throw new Error("steps must be an number");if(l===void 0)throw new Error("radius is required");if(c<=0)throw new Error("steps must be greater than 0");var v=[];switch(a.type){case"GeometryCollection":return Ji(a,function(N){var d=Ui(N,l,h,c);d&&v.push(d)}),Bi(v);case"FeatureCollection":return _s(a,function(N){var d=Ui(N,l,h,c);d&&_s(d,function(b){b&&v.push(b)})}),Bi(v)}return Ui(a,l,h,c)}function Ui(a,l,g,h){var c=a.properties||{},v=a.type==="Feature"?a.geometry:a;if(v.type==="GeometryCollection"){var N=[];return Ji(a,function(z){var A=Ui(z,l,g,h);A&&N.push(A)}),Bi(N)}var d=Ou(v),b={type:v.type,coordinates:ka(v.coordinates,d)},I=new Cu,_=I.read(b),p=aa(bo(l,g),"meters"),S=Tu.bufferOp(_,p,h),O=new Lu;if(S=O.write(S),!xa(S.coordinates)){var w={type:S.type,coordinates:Ea(S.coordinates,d)};return En(w,c)}}function xa(a){return Array.isArray(a[0])?xa(a[0]):isNaN(a[0])}function ka(a,l){return typeof a[0]!="object"?l(a):a.map(function(g){return ka(g,l)})}function Ea(a,l){return typeof a[0]!="object"?l.invert(a):a.map(function(g){return Ea(g,l)})}function Ou(a){var l=Jo(a).geometry.coordinates,g=[-l[0],-l[1]];return bu().rotate(g).scale(at)}function Mu(a,l={}){return Mo(a,(g,h)=>{const c=h.geometry.coordinates;return g+Co(c[0],c[1],l)},0)}const Au=1e6,Pu=150,Fn=a=>a?a.type==="Polygon"||a.type==="MultiPolygon":!1,Bs=a=>Mu(a,{units:"kilometers"}),Du=(a,l=Pu)=>{const g={areaKm2:null,perimeterKm:null,bufferMeters:l,bufferedGeometry:a.geometry};try{const h=$o(a);g.bufferedGeometry=h.geometry;const c=Ao(h);Number.isFinite(c)&&(g.areaKm2=c/Au);const v=Zo(h);if(v.type==="FeatureCollection"){let d=0;for(const b of v.features)!b||!b.geometry||(d+=Bs(b));Number.isFinite(d)&&(g.perimeterKm=d)}else if(v.type==="Feature"&&v.geometry){const d=Bs(v);Number.isFinite(d)&&(g.perimeterKm=d)}const N=Ru(h,l,{units:"meters"});N&&Fn(N.geometry)&&(g.bufferedGeometry=N.geometry)}catch(h){}return g},Fu=(a,l)=>{try{return Xo(ra(a),{type:"Feature",geometry:l,properties:{}})}catch(g){return!1}},Nr={Новая:"#0ea5e9","В работе":"#f97316",Выполнена:"#22c55e",Отменена:"#ef4444"},Gu={tasks:!0,optimized:!0},ju=400,qu=15e3,Vs=["draft","approved","completed","unassigned","vehicle"],oi={draft:"#6366f1",approved:"#22c55e",completed:"#0f172a",unassigned:"#f97316",vehicle:"#0891b2"},zu={draft:"Черновик",approved:"Утверждён",completed:"Завершён",unassigned:"Без маршрута",vehicle:"Транспорт"},An=a=>{var l;return(l=oi[a])!=null?l:"#0f172a"},Ai=a=>["+",["case",["all",["==",["get","entity"],"task"],["==",["get","routeStatus"],a]],1,0],0],Pi={draft:Ai("draft"),approved:Ai("approved"),completed:Ai("completed"),unassigned:Ai("unassigned")},Xs={Легковой:"#0ea5e9",Грузовой:"#f97316",Спецтехника:"#7c3aed",Пеший:"#22c55e","Без транспорта":"#9ca3af",default:"#475569"},Hs=["#7c3aed","#f97316","#06b6d4","#16a34a","#ec4899","#facc15","#9333ea","#0ea5e9"],Di="vehicle",Ir="Транспорт",Fi="logistics-geozones",Yu="logistics-geozones-fill",Uu="logistics-geozones-outline",Sr="logistics-task-routes",Zs="logistics-task-routes-line",Pn="logistics-task-markers",en="logistics-task-clusters",Ks="logistics-task-cluster-count",tn="logistics-task-points",ii="logistics-task-animation",Ws="logistics-task-animation-symbol",wr="logistics-optimized-routes",$s="logistics-optimized-routes-line",br="logistics-addresses",Dn="logistics-addresses-labels",Bu=co,Vu="addresses",Na=["settlement-subdivision-label","settlement-major-label","settlement-neighbourhood-label","airport-label","poi-label","transit-label"],Xu=["road-label","road-number-shield","bridge-street-minor-label","street-label"],Hu="⬤",Zu="⦿",Tr="▶",Ku=go/3600,Gr=(a,l)=>{var c;const g=typeof a.getStyle=="function"?a.getStyle():void 0,h=(c=g==null?void 0:g.layers)!=null?c:[];return l.find(v=>h.some(N=>N.id===v))},Wu=a=>{var N,d;if(typeof a.getStyle!="function")return;const l=a.getStyle();if(((N=l==null?void 0:l.layers)!=null?N:[]).findIndex(b=>b.id===Dn)===-1)return;const c=Gr(a,Xu);if(c&&typeof a.moveLayer=="function"){const b=a.getStyle(),I=(d=b==null?void 0:b.layers)!=null?d:[],_=I.findIndex(p=>p.id===c);if(_!==-1){const p=I.slice(_+1).find(S=>S.id!==Dn);p!=null&&p.id?a.moveLayer(Dn,p.id):a.moveLayer(Dn)}}const v=Gr(a,Na);v&&typeof a.moveLayer=="function"&&a.moveLayer(Dn,v)},$u=.01,It=()=>({type:"FeatureCollection",features:[]}),nn=a=>a.trim().toLowerCase(),ui=a=>{const l=a.trim();if(!l)return"Без транспорта";const g=l.toLowerCase();return g.startsWith("лег")?"Легковой":g.startsWith("груз")?"Грузовой":g.includes("спец")?"Спецтехника":g.includes("пеш")?"Пеший":l},Ju=a=>{const l=a.trim();if(!l)return"Задача";if(l.length===1)return l.toUpperCase();const g=l.toLowerCase();return g.charAt(0).toUpperCase()+g.slice(1)},Gi=a=>{var g;const l=ui(a);return(g=Xs[l])!=null?g:Xs.default},Qu=a=>{const l=a.startsWith("#")?a.slice(1):a;if(l.length===3){const[g,h,c]=l.split("");return{r:parseInt(g+g,16),g:parseInt(h+h,16),b:parseInt(c+c,16)}}return l.length===6?{r:parseInt(l.slice(0,2),16),g:parseInt(l.slice(2,4),16),b:parseInt(l.slice(4,6),16)}:null},Cr=a=>{const l=Qu(a);return l&&.299*l.r+.587*l.g+.114*l.b>186?"#0f172a":"#ffffff"},el=(a,l,g,h,c)=>{if(typeof document>"u")return null;const v=96,d=(typeof window<"u"&&window.devicePixelRatio?window.devicePixelRatio:1)>1?2:1,b=document.createElement("canvas");b.width=v*d,b.height=v*d;const I=b.getContext("2d");if(!I)return null;I.scale(d,d);const _=v/2,p=_-4;return I.clearRect(0,0,v,v),I.beginPath(),I.arc(_,_,p,0,Math.PI*2),I.fillStyle=a,I.fill(),I.lineWidth=6,I.strokeStyle=l,I.stroke(),c&&(I.beginPath(),I.arc(_,_,p*.55,0,Math.PI*2),I.lineWidth=4,I.strokeStyle=c,I.stroke()),g&&(I.fillStyle=h,I.font="bold 32px 'Open Sans', 'Arial Unicode MS', sans-serif",I.textAlign="center",I.textBaseline="middle",I.fillText(g.slice(0,2),_,_)),I.getImageData(0,0,v*d,v*d)},Lr=(a,l,g,h)=>["marker",a,l,g,h].map(c=>c.replace(/\s+/g,"-").toLowerCase()).join("-"),tl=(a,l,g,h,c,v,N,d)=>{if(!g||l.has(g)||a.hasImage(g)){l.add(g);return}const b=el(h,c,v,N,d);b&&(a.addImage(g,b,{pixelRatio:2}),l.add(g))},rn=a=>{if(!a)return null;const{lat:l,lng:g}=a;return!Number.isFinite(l)||!Number.isFinite(g)?null:[g,l]},ji=a=>{const l=a.logistics_details,g=typeof(l==null?void 0:l.transport_type)=="string"?l.transport_type.trim():"",h=typeof a.transport_type=="string"?a.transport_type.trim():"";return ui(g||h)},Rr=a=>{const l=typeof a.task_type=="string"?a.task_type:typeof a.type=="string"?a.type:"";return Ju(l)},Js=a=>{if(!a)return"З";const l=a.trim();return l?l.charAt(0).toUpperCase():"З"},Qs=a=>{const l=a.position;if(!l)return null;const g=typeof l.lat=="number"?l.lat:typeof l.latitude=="number"?l.latitude:null,h=typeof l.lon=="number"?l.lon:typeof l.lng=="number"?l.lng:typeof l.long=="number"?l.long:typeof l.longitude=="number"?l.longitude:null;return g===null||h===null||!Number.isFinite(g)||!Number.isFinite(h)?null:[h,g]},nl=(a,l,g)=>{if(!l.length||!g.length)return a;const h=l.filter(c=>g.includes(c.id));return h.length?a.filter(c=>{const v=[],N=rn(c.startCoordinates),d=rn(c.finishCoordinates);return N&&v.push(N),d&&v.push(d),v.length?v.some(b=>h.some(I=>{const _=Fn(I.bufferedFeature.geometry)?I.bufferedFeature.geometry:Fn(I.feature.geometry)?I.feature.geometry:null;return _?Fu(b,_):!1})):!1}):a},ea=a=>({lng:a[0],lat:a[1]}),il=(a,l)=>{const g=a[1]*Math.PI/180,h=l[1]*Math.PI/180,c=(l[0]-a[0])*Math.PI/180,v=Math.sin(c)*Math.cos(h),N=Math.cos(g)*Math.sin(h)-Math.sin(g)*Math.cos(h)*Math.cos(c);return(Math.atan2(v,N)*180/Math.PI+360)%360},rl=(a,l,g,h)=>{if(a.length<2)return null;const c=[0];let v=0;for(let N=1;N<a.length;N+=1){const d=a[N-1],b=a[N],I=fo(ea(d),ea(b));v+=I,c.push(v)}return v<$u?null:{taskId:g,title:h,color:l,coordinates:a,cumulative:c,total:v,progress:0}},ta=(a,l)=>{var w,z;const g=Math.max(0,Math.min(l,a.total)),{cumulative:h,coordinates:c}=a;let v=0;for(let A=0;A<h.length-1;A+=1)if(g>=h[A]&&g<=h[A+1]){v=A;break}const N=c[v],d=(w=c[v+1])!=null?w:c[v],b=h[v],_=((z=h[v+1])!=null?z:a.total)-b,p=_>0?(g-b)/_:0,S=N[0]+(d[0]-N[0])*p,O=N[1]+(d[1]-N[1])*p;return{position:[S,O],bearing:il(N,d)}},na=({id:a,drawId:l,name:g,createdAt:h,geometry:c,properties:v={},active:N,bufferMeters:d})=>{var w,z;const b={...v,zoneId:a,active:N},_=Du({type:"Feature",geometry:c,properties:b},d),p={...b,areaKm2:(w=_.areaKm2)!=null?w:void 0,perimeterKm:(z=_.perimeterKm)!=null?z:void 0,bufferMeters:_.bufferMeters},S={type:"Feature",geometry:c,properties:p},O={type:"Feature",geometry:_.bufferedGeometry,properties:p};return{id:a,drawId:l,name:g,createdAt:h,feature:S,bufferedFeature:O,metrics:{areaKm2:_.areaKm2,perimeterKm:_.perimeterKm,bufferMeters:_.bufferMeters}}},sl=[cs[1],cs[0]],al=ao,ri=ho!=="pmtiles";function pl(){var lt,ct,vn,Si,wi,$n,pn,bi,Jn,we,pt,Rn;const{t:a,i18n:l}=no(),g=ko(a),h=l.language,[c,v]=P.useState([]),[N,d]=P.useState([]),[b,I]=P.useState(1),[_,p]=P.useState("angle"),[S,O]=P.useState([]),[w,z]=P.useState(null),[A,U]=P.useState(null),[X,F]=P.useState(""),[K,Y]=P.useState("neutral"),[B,W]=P.useState(!1),$=P.useRef(null),Q=P.useRef(null);P.useEffect(()=>{ri&&console.warn("Используется временный растровый слой OpenStreetMap. Подключите локальные PMTiles, чтобы вернуть полный стиль.")},[]);const[pe,_e]=P.useState("planar"),me=P.useRef({frameId:null,lastTimestamp:null,routes:[]}),[xe,H]=P.useState([]),[de,Ie]=P.useState(""),[Re,Fe]=P.useState(""),[qe,ne]=P.useState(!1),[Ge,Be]=P.useState(()=>{if(typeof window>"u")return null;try{const E=new URLSearchParams(window.location.search).get("selectedVehicleId");return E&&E.trim()?E.trim():null}catch(f){return null}}),[Le,ke]=P.useState(Gu),[Te,hi]=P.useState(!1),[Yn,M]=P.useState([]),[fi,Me]=P.useState([]),[oe,x]=P.useState([]),[ze,Ut]=P.useState(null),[ot,an]=P.useState([]),[wt,In]=P.useState([]),[q,gi]=P.useState(!0),[di,Ct]=P.useState(!1),[mi,ye]=P.useState(It()),[on,un]=P.useState(0),ln=P.useRef(!1),fe=P.useRef(new Set),Sn=Qa(),Ne=eo(),[ge]=to(),yi=P.useMemo(()=>{try{const E=new URLSearchParams(Ne.search).get("withTrack");return E==="true"||E==="1"}catch(f){return!1}},[Ne.search]),ut=ge.has("task")||ge.has("newTask"),{user:dt}=io(),{controller:he}=yo(),He=(lt=dt==null?void 0:dt.role)!=null?lt:null;P.useEffect(()=>{try{const E=new URLSearchParams(Ne.search).get("selectedVehicleId"),C=E&&E.trim()?E.trim():null;Be(L=>L===C?L:C)}catch(f){Be(E=>E)}},[Ne.search]);const wn=P.useCallback(f=>{Be(E=>{var D;const C=f(E),L=C&&C.trim()?C.trim():null;if(E===L)return E;if(typeof window<"u"&&typeof((D=window.history)==null?void 0:D.replaceState)=="function")try{const j=new URL(window.location.href);L?j.searchParams.set("selectedVehicleId",L):j.searchParams.delete("selectedVehicleId"),window.history.replaceState(window.history.state,"","".concat(j.pathname).concat(j.search).concat(j.hash))}catch(j){}return L})},[]),cn=P.useCallback(f=>{wn(()=>f)},[wn]),et=P.useCallback(f=>{wn(E=>E===f?null:f)},[wn]),We=P.useMemo(()=>xe.filter(f=>Qs(f)!==null),[xe]),mt=P.useMemo(()=>{var f;return(f=xe.find(E=>E.id===Ge))!=null?f:null},[xe,Ge]);P.useEffect(()=>{Ge&&(xe.some(f=>f.id===Ge)||cn(null))},[xe,Ge,cn]);const Bt=P.useMemo(()=>new Set(Yn),[Yn]),Lt=P.useMemo(()=>new Set(fi),[fi]),hn=P.useMemo(()=>new Set(oe),[oe]),Vt=P.useMemo(()=>{var f;return new Set((f=ze==null?void 0:ze.ids)!=null?f:[])},[ze]),tt=P.useMemo(()=>q?nl(N,ot,wt):N,[wt,N,ot,q]),V=P.useMemo(()=>{const f=new Map,E=C=>{var D;if(!C)return;const L=(D=C.status)!=null?D:"draft";C.routes.forEach(j=>{j.tasks.forEach(Z=>{const re=typeof Z.taskId=="string"?Z.taskId:typeof Z.task_id=="string"?Z.task_id:null;re&&f.set(re,L)})})};return E(A!=null?A:null),w&&E(w),f},[w,A]),ft=P.useMemo(()=>tt.filter(f=>{var Z;const E=(Z=V.get(f._id))!=null?Z:"unassigned";if(Lt.has(E))return!1;const C=ji(f),L=nn(C);if(hn.has(L))return!1;const D=Rr(f),j=nn(D);return!Bt.has(j)}),[tt,Lt,Bt,hn,V]),Gt=P.useMemo(()=>{const f={};return ft.forEach(E=>{var L;const C=typeof E.status=="string"&&E.status.trim()?E.status.trim():"Новая";f[C]=((L=f[C])!=null?L:0)+1}),f},[ft]),Xt=P.useMemo(()=>{const f=new Map;if(Vs.forEach(E=>{f.set(E,{count:0,color:An(E)})}),tt.forEach(E=>{var D;const C=(D=V.get(E._id))!=null?D:"unassigned",L=f.get(C);L?L.count+=1:f.set(C,{count:1,color:An(C)})}),We.length){const E=f.get("vehicle");E?E.count+=We.length:f.set("vehicle",{count:We.length,color:An("vehicle")})}return f},[tt,V,We]),Un=P.useMemo(()=>{const f=new Map;return tt.forEach(E=>{const C=ji(E),L=ui(C),D=nn(L),j=Gi(L),Z=f.get(D);Z?Z.count+=1:f.set(D,{label:L,count:1,color:j})}),We.forEach(E=>{var Z;const C=ui((Z=E.transportType)!=null?Z:""),L=nn(C),D=Gi(C),j=f.get(L);j?j.count+=1:f.set(L,{label:C,count:1,color:D})}),f},[tt,We]),jt=P.useMemo(()=>{const f=new Map;tt.forEach(L=>{const D=Rr(L),j=nn(D),Z=f.get(j);Z?Z.count+=1:f.set(j,{label:D,count:1})}),We.length&&f.set(Di,{label:Ir,count:We.length});const E=Array.from(f.keys()).sort(),C=new Map;return E.forEach((L,D)=>{const j=f.get(L);if(!j)return;const Z=Hs[D%Hs.length];C.set(L,{label:j.label,count:j.count,color:Z})}),C},[tt,We]),vi=P.useMemo(()=>Vs.map(f=>{var E,C;return{key:f,count:(C=(E=Xt.get(f))==null?void 0:E.count)!=null?C:0,color:An(f)}}),[Xt]),qt=P.useMemo(()=>Array.from(Un.entries()).sort((f,E)=>f[1].label.localeCompare(E[1].label)).map(([f,E])=>({key:f,...E})),[Un]),pi=P.useMemo(()=>Array.from(jt.entries()).map(([f,E])=>({key:f,...E})),[jt]),Ht=P.useMemo(()=>{const f=[],E=(C,L)=>{f.push({type:"Feature",geometry:{type:"Point",coordinates:C},properties:L})};return ft.forEach(C=>{var Et,Xe,bt,_n;const D=(Et=V.get(C._id))!=null?Et:"unassigned",j=An(D),Z=ji(C),re=nn(Z),te=Gi(Z),ue=Rr(C),le=nn(ue),ie=(bt=(Xe=jt.get(le))==null?void 0:Xe.color)!=null?bt:"#334155",ee=Js(ue),ae=Cr(te),ve=(_n=C.title)!=null?_n:C._id,Ee=ve.length>28?"".concat(ve.slice(0,25),"…"):ve,Oe=Vt.has(C._id),At=rn(C.startCoordinates),Je=rn(C.finishCoordinates);if(At){const Jt=Lr(le,D,re,"start");E(At,{entity:"task",taskId:C._id,title:ve,label:Ee,routeStatus:D,transportType:Z,taskType:ue,pointRole:"start",iconId:Jt,iconFill:te,iconStroke:j,iconText:ee,iconTextColor:ae,iconAccent:ie,selected:Oe})}if(Je){const Jt=Lr(le,D,re,"finish");E(Je,{entity:"task",taskId:C._id,title:ve,label:Ee,routeStatus:D,transportType:Z,taskType:ue,pointRole:"finish",iconId:Jt,iconFill:te,iconStroke:j,iconText:ee,iconTextColor:ae,iconAccent:ie,selected:Oe})}}),We.forEach(C=>{var ve,Ee,Oe;const L=Qs(C);if(!L)return;const D=ui((ve=C.transportType)!=null?ve:""),j=nn(D),Z="vehicle";if(Lt.has(Z)||hn.has(j)||Bt.has(Di))return;const re=Gi(D),te=Js(Ir),ue=Cr(re),le=(Oe=(Ee=jt.get(Di))==null?void 0:Ee.color)!=null?Oe:"#0f172a",ie=Lr(Di,Z,j,"vehicle"),ee=C.name,ae=ee.length>28?"".concat(ee.slice(0,25),"…"):ee;E(L,{entity:"vehicle",vehicleId:C.id,title:ee,label:ae,routeStatus:Z,transportType:D,taskType:Ir,pointRole:"vehicle",iconId:ie,iconFill:re,iconStroke:An(Z),iconText:te,iconTextColor:ue,iconAccent:le,selected:Ge===C.id})}),{type:"FeatureCollection",features:f}},[ft,Lt,Bt,hn,Vt,V,jt,We,Ge]);P.useEffect(()=>{if(!Te)return;const f=$.current;if(!f)return;const E=f.getSource(Pn);if(!E)return;Ht.features.forEach(L=>{var le,ie,ee,ae,ve,Ee;const D=(le=L.properties)==null?void 0:le.iconId;if(typeof D!="string"||!D)return;const j=typeof((ie=L.properties)==null?void 0:ie.iconFill)=="string"?L.properties.iconFill:"#2563eb",Z=typeof((ee=L.properties)==null?void 0:ee.iconStroke)=="string"?L.properties.iconStroke:"#0f172a",re=typeof((ae=L.properties)==null?void 0:ae.iconText)=="string"?L.properties.iconText:"",te=typeof((ve=L.properties)==null?void 0:ve.iconTextColor)=="string"?L.properties.iconTextColor:Cr(j),ue=typeof((Ee=L.properties)==null?void 0:Ee.iconAccent)=="string"?L.properties.iconAccent:void 0;tl(f,fe.current,D,j,Z,re,te,ue)});const C=Le.tasks?Ht:It();E.setData(C)},[Le.tasks,Te,Ht]);const Qi=P.useMemo(()=>{const f=us.map(C=>{var L,D;return{key:C,label:C,color:(L=Nr[C])!=null?L:"#2563eb",count:(D=Gt[C])!=null?D:0}}),E=Object.keys(Gt).filter(C=>!us.includes(C));return E.length&&E.forEach(C=>{var L,D;f.push({key:C,label:C,color:(L=Nr[C])!=null?L:"#2563eb",count:(D=Gt[C])!=null?D:0})}),f},[Gt]),yt=P.useMemo(()=>Vt.size?ft.filter(f=>Vt.has(f._id)):ft,[ft,Vt]),bn=P.useMemo(()=>JSON.stringify(yt.map(f=>{var E;return[f._id,f.status,(E=f.updatedAt)!=null?E:null]})),[yt]),nt=P.useRef("");P.useEffect(()=>{if(!ze)return;const f=new Set(ze.ids);ft.some(C=>f.has(C._id))||Ut(null)},[ft,ze]);const gt=P.useCallback(()=>{const f=me.current;f.frameId!==null&&(cancelAnimationFrame(f.frameId),f.frameId=null),f.lastTimestamp=null},[]),Zt=P.useCallback(()=>{if(gt(),!Te)return;const f=me.current;if(!f.routes.length)return;const E=$.current;if(!E)return;const C=E.getSource(ii);if(!C)return;const L=f.routes.map(j=>{const{position:Z,bearing:re}=ta(j,j.progress);return{type:"Feature",geometry:{type:"Point",coordinates:Z},properties:{color:j.color,taskId:j.taskId,title:j.title,bearing:re,icon:Tr}}});C.setData({type:"FeatureCollection",features:L});const D=j=>{const Z=me.current,re=$.current;if(!re){gt();return}const te=re.getSource(ii);if(!te){gt();return}const ue=Z.lastTimestamp;Z.lastTimestamp=j;const le=ue!=null?(j-ue)/1e3:0,ie=[];Z.routes.forEach(ee=>{if(ee.total<=0)return;ee.progress=(ee.progress+le*Ku)%ee.total;const{position:ae,bearing:ve}=ta(ee,ee.progress);ie.push({type:"Feature",geometry:{type:"Point",coordinates:ae},properties:{color:ee.color,taskId:ee.taskId,title:ee.title,bearing:ve,icon:Tr}})}),te.setData({type:"FeatureCollection",features:ie}),Z.frameId=requestAnimationFrame(D)};f.frameId=requestAnimationFrame(D)},[Te,gt]);P.useEffect(()=>{if(nt.current===bn)return;nt.current=bn,v(yt);const f=Number(dt==null?void 0:dt.telegram_id)||void 0;he.setIndex("logistics:all",yt,{kind:"task",mine:!1,userId:f,pageSize:yt.length,total:yt.length,sort:"desc"})},[he,bn,yt,dt]);const Rt=P.useCallback(f=>f?JSON.parse(JSON.stringify(f)):null,[]),je=P.useCallback(f=>{z(f),U(Rt(f));const E=f?f.routes.map(C=>C.routeLink).filter(C=>!!C):[];O(E)},[Rt]),Ot=P.useCallback(async()=>{W(!0),F(""),Y("neutral");try{const f=await ys("draft",1,1);if(f.items.length>0){je(f.items[0]);return}const E=await ys(void 0,1,1);if(E.items.length>0){je(E.items[0]);return}je(null),F(g.current("logistics.planEmpty"))}catch(f){const E=f instanceof Error?f.message:g.current("logistics.planLoadError");F(E),Y("error")}finally{W(!1)}},[je]),fn=P.useCallback(f=>{var E;return{title:f.title,notes:(E=f.notes)!=null?E:null,routes:f.routes.map(C=>{var L,D,j,Z,re;return{id:C.id,order:C.order,vehicleId:(L=C.vehicleId)!=null?L:null,vehicleName:(D=C.vehicleName)!=null?D:null,driverId:(j=C.driverId)!=null?j:null,driverName:(Z=C.driverName)!=null?Z:null,notes:(re=C.notes)!=null?re:null,tasks:C.tasks.map(te=>te.taskId)}})}},[]),kt=P.useCallback((f,E)=>{U(C=>{if(!C)return C;const L=C.routes.map((D,j)=>j===f?E(D):D);return{...C,routes:L}})},[]),Ve=P.useCallback(f=>{U(E=>E&&{...E,title:f})},[]),er=P.useCallback(f=>{U(E=>E&&{...E,notes:f})},[]),tr=P.useCallback((f,E)=>{kt(f,C=>({...C,driverName:E}))},[kt]),Tn=P.useCallback((f,E)=>{kt(f,C=>({...C,vehicleName:E}))},[kt]),gn=P.useCallback((f,E)=>{kt(f,C=>({...C,notes:E||null}))},[kt]),Cn=P.useCallback((f,E,C)=>{U(L=>{if(!L)return L;const D=L.routes.map((j,Z)=>{if(Z!==f)return j;const re=[...j.tasks],te=E+C;if(te<0||te>=re.length)return j;const[ue]=re.splice(E,1);return re.splice(te,0,ue),{...j,tasks:re.map((le,ie)=>({...le,order:ie}))}});return{...L,routes:D}})},[]),Bn=P.useCallback(()=>{if(!q)return;const f=Q.current;f&&f.changeMode("draw_polygon")},[q]),_i=P.useCallback((f,E)=>{In(C=>{const L=new Set(C);return E?L.add(f):L.delete(f),Array.from(L)})},[]),nr=P.useCallback((f,E)=>{Me(C=>{const L=new Set(C);return E?L.delete(f):L.add(f),Array.from(L)})},[]),vt=P.useCallback((f,E)=>{x(C=>{const L=new Set(C);return E?L.delete(f):L.add(f),Array.from(L)})},[]),Kt=P.useCallback((f,E)=>{M(C=>{const L=new Set(C);return E?L.delete(f):L.add(f),Array.from(L)})},[]),Vn=P.useCallback(()=>{Ut(null)},[]),Wt=P.useCallback(f=>{const E=()=>{an(j=>j.filter(Z=>Z.id!==f.id)),In(j=>j.filter(Z=>Z!==f.id))},C=Q.current;if(!C){E();return}const L=!!C.get(f.drawId),D=C.delete(f.drawId);if(!L){E();return}(Array.isArray(D)?D.length===0:!D)&&E()},[]),Xn=P.useCallback(async()=>{if(A){W(!0);try{const f=fn(A),E=await So(A.id,f);je(E),F(g.current("logistics.planSaved")),Y("success")}catch(f){const E=f instanceof Error?f.message:g.current("logistics.planSaveError");F(E),Y("error")}finally{W(!1)}}},[A,fn,je]),ir=P.useCallback(async()=>{if(A){W(!0);try{const f=await vs(A.id,"approved");je(f),F(g.current("logistics.planPublished")),Y("success")}catch(f){const E=f instanceof Error?f.message:g.current("logistics.planStatusError");F(E),Y("error")}finally{W(!1)}}},[A,je]),rr=P.useCallback(async()=>{if(A){W(!0);try{const f=await vs(A.id,"completed");je(f),F(g.current("logistics.planCompleted")),Y("success")}catch(f){const E=f instanceof Error?f.message:g.current("logistics.planStatusError");F(E),Y("error")}finally{W(!1)}}},[A,je]),xi=P.useCallback(async()=>{F(""),Y("neutral"),await Ot()},[Ot]),ki=P.useCallback(()=>{je(null),F(g.current("logistics.planEmpty")),Y("neutral")},[je]);P.useEffect(()=>{Ot()},[Ot]),P.useEffect(()=>{const f=g.current,E=f("logistics.metaTitle"),C=f("logistics.metaDescription"),L="/hero/logistics.png";document.title=E;const D=(j,Z,re)=>{let te=document.querySelector("meta[".concat(j,'="').concat(Z,'"]'));te||(te=document.createElement("meta"),te.setAttribute(j,Z),document.head.appendChild(te)),te.setAttribute("content",re)};D("name","description",C),D("property","og:title",E),D("property","og:description",C),D("property","og:image",L)},[h]);const dn=P.useCallback(f=>{const E=new URLSearchParams(Ne.search);E.set("task",f),Sn({search:E.toString()},{replace:!0})},[Ne,Sn]),mn=P.useCallback(f=>{const E=L=>typeof(L==null?void 0:L.lat)=="number"&&Number.isFinite(L.lat)&&typeof(L==null?void 0:L.lng)=="number"&&Number.isFinite(L.lng),C=[];return f.forEach(L=>{const D=ji(L),j=L.logistics_details,Z=(ve,Ee)=>{if(typeof ve=="string"){const Oe=ve.trim();if(Oe)return Oe}if(typeof Ee=="string"){const Oe=Ee.trim();if(Oe)return Oe}return""},re=Z(j==null?void 0:j.start_location,L.start_location),te=Z(j==null?void 0:j.end_location,L.end_location);if(!(E(L.startCoordinates)||E(L.finishCoordinates))&&!(!!re||!!te))return;const ie={...j!=null?j:{}};ie.transport_type||(ie.transport_type=D),!ie.start_location&&re&&(ie.start_location=re),!ie.end_location&&te&&(ie.end_location=te);const ee={...L,logistics_details:ie},ae=ee;ae.transport_type||(ae.transport_type=D),re&&!ae.start_location&&(ae.start_location=re),te&&!ae.end_location&&(ae.end_location=te),C.push(ee)}),C},[]),it=P.useCallback(()=>{const f=Number(dt==null?void 0:dt.telegram_id)||void 0;ro({},f,!0).then(E=>{const D=(Array.isArray(E)?E:E.items||E.tasks||E.data||[]).map(Z=>{var ue,le;const re=Z,te=String((le=(ue=re._id)!=null?ue:re.id)!=null?le:"").trim();return te?{...re,id:te,_id:te}:null}).filter(Z=>!!Z),j=mn(D);d(j)})},[he,mn,dt]),$e=P.useCallback(async()=>{if(He==="admin"){ne(!0),Fe(""),Ie("");try{const f=await vo("",1,100);if(H(f.items),!f.items.length){Fe(g.current("logistics.noVehicles"));return}}catch(f){const E=f instanceof Error?f.message:g.current("logistics.loadError");Fe(E),H([]),Ie(E)}finally{ne(!1)}}},[He,g]),Hn=P.useCallback(()=>{it(),He==="admin"&&$e()},[it,$e,He]),Mt=P.useCallback(()=>{He==="admin"&&$e()},[$e,He]);xo(()=>{He==="admin"&&$e()},qu,{enabled:He==="admin"&&yi,deps:[$e,He,yi]}),P.useEffect(()=>{const f={tasks:!1,plan:!1,fleet:!1};let E=!0,C=null;const L=()=>{C!==null&&(clearTimeout(C),C=null)},D=()=>{if(C=null,!E){f.tasks=!1,f.plan=!1,f.fleet=!1;return}const re=f.tasks,te=f.plan,ue=f.fleet;f.tasks=!1,f.plan=!1,f.fleet=!1,re&&it(),ue&&Mt(),te&&Ot()},j=()=>{C===null&&(C=setTimeout(D,ju))},Z=Eo(re=>{switch(re.type){case"logistics.init":f.tasks=!0,f.plan=!0,f.fleet=!0;break;case"tasks.changed":f.tasks=!0,f.plan=!0;break;case"route-plan.updated":case"route-plan.removed":f.plan=!0;break;default:return}j()});return()=>{E=!1,L(),Z()}},[it,Ot,Mt]);const sr=P.useCallback(async()=>{const f=c.map(E=>E._id);if(!f.length){je(null),F(g.current("logistics.planEmpty")),Y("neutral");return}W(!0),F(""),Y("neutral");try{const E=await _o(f,b,_);if(!E){je(null),F(g.current("logistics.planEmpty"));return}je(E),F(g.current("logistics.planDraftCreated")),Y("success")}catch(E){const C=E instanceof Error?E.message:g.current("logistics.planOptimizeError");F(C),Y("error")}finally{W(!1)}},[je,_,c,b]),Zn=P.useCallback(f=>typeof f=="number"&&Number.isFinite(f)?"".concat(f.toFixed(1)," ").concat(g.current("km")):g.current("logistics.planNoDistance"),[]),ar=P.useCallback(f=>{if(typeof f=="number"&&Number.isFinite(f)&&f>0){const E=Math.round(f),C=Math.floor(E/60),L=E%60,D=[];return C>0&&D.push(g.current("logistics.etaHours",{count:C})),(L>0||C===0)&&D.push(g.current("logistics.etaMinutes",{count:L})),D.join(" ")}return g.current("logistics.planNoEta")},[]),or=P.useCallback(f=>{if(typeof f!="number"||!Number.isFinite(f))return"—";if(f>=1)return"".concat(new Intl.NumberFormat(h,{maximumFractionDigits:2}).format(f)," км²");const E=f*100;if(E>=1)return"".concat(new Intl.NumberFormat(h,{maximumFractionDigits:1}).format(E)," га");const C=f*1e6;return"".concat(new Intl.NumberFormat(h,{maximumFractionDigits:0}).format(C)," м²")},[h]),Ei=P.useCallback(f=>{if(typeof f!="number"||!Number.isFinite(f))return"—";if(f>=1)return"".concat(new Intl.NumberFormat(h,{maximumFractionDigits:2}).format(f)," км");const E=f*1e3;return"".concat(new Intl.NumberFormat(h,{maximumFractionDigits:0}).format(E)," м")},[h]),yn=P.useCallback(f=>typeof f!="number"||!Number.isFinite(f)?"—":"".concat(new Intl.NumberFormat(h,{maximumFractionDigits:0}).format(f)," м"),[h]),Kn=P.useMemo(()=>K==="error"?"text-sm text-red-600":K==="success"?"text-sm text-emerald-600":"text-sm text-muted-foreground",[K]),Ni=(vn=(ct=A==null?void 0:A.status)!=null?ct:w==null?void 0:w.status)!=null?vn:"draft",Ii=a("logistics.planStatusValue.".concat(Ni)),$t=Ni!=="completed",Ln=(Si=A==null?void 0:A.routes)!=null?Si:[],Pe=P.useMemo(()=>{var f;return typeof((f=A==null?void 0:A.metrics)==null?void 0:f.totalStops)=="number"?A.metrics.totalStops:A?A.routes.reduce((E,C)=>E+C.stops.length,0):0},[A]),zt=($n=(wi=A==null?void 0:A.metrics)==null?void 0:wi.totalRoutes)!=null?$n:Ln.length,ur=(Jn=(bi=(pn=A==null?void 0:A.metrics)==null?void 0:pn.totalTasks)!=null?bi:A==null?void 0:A.tasks.length)!=null?Jn:0,Wn=P.useCallback(()=>{ye(It()),O([])},[]);return P.useEffect(()=>{it()},[it,Ne.key]),P.useEffect(()=>{un(0)},[bn]),P.useEffect(()=>{const f=g.current;if(He!=="admin"){ln.current=!1,H([]),Ie(He==="manager"?f("logistics.adminOnly"):""),Fe(He?f("logistics.noAccess"):""),cn(null);return}Fe(""),Ie(""),ln.current||(ln.current=!0,$e())},[$e,He]),P.useEffect(()=>{const f=g.current;He==="admin"&&!xe.length&&!de&&!qe&&Fe(f("logistics.noVehicles"))},[xe.length,de,He,qe]),P.useEffect(()=>{var Z,re;if(ut||$.current)return;const f=new yr.Map({container:"logistics-map",style:uo,center:sl,zoom:oo,minZoom:5,maxZoom:22,maxBounds:al});$.current=f,typeof((Z=f.dragRotate)==null?void 0:Z.disable)=="function"&&f.dragRotate.disable(),typeof((re=f.touchZoomRotate)==null?void 0:re.disableRotation)=="function"&&f.touchZoomRotate.disableRotation();const E=new yr.NavigationControl({showCompass:!1});f.addControl(E,"top-right");const C=new yr.AttributionControl({compact:!0,customAttribution:lo});f.addControl(C,"bottom-right");const L=new mo({displayControlsDefault:!1,controls:{polygon:!0,trash:!0},defaultMode:"simple_select",styles:Io});Q.current=L,f.addControl(L,"top-left");const D=()=>{typeof f.isStyleLoaded=="function"&&!f.isStyleLoaded()||No(f)},j=()=>{if(D(),!ri&&!f.getSource(br)){f.addSource(br,{type:"vector",url:Bu});const ve={id:Dn,type:"symbol",source:br,"source-layer":Vu,minzoom:17,layout:{"text-field":["get","housenumber"],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":13,"text-letter-spacing":.02,"text-allow-overlap":!1,"text-ignore-placement":!1,"text-padding":2},paint:{"text-color":"#0f172a","text-halo-color":"#f8fafc","text-halo-width":1.2,"text-halo-blur":.6}},Ee=Gr(f,Na);f.addLayer(ve,Ee),Wu(f)}f.addSource(Fi,{type:"geojson",data:It()}),f.addLayer({id:Yu,type:"fill",source:Fi,paint:{"fill-color":["case",["boolean",["get","active"],!1],"rgba(37, 99, 235, 0.35)","rgba(148, 163, 184, 0.2)"],"fill-opacity":["case",["boolean",["get","active"],!1],.4,.2]}}),f.addLayer({id:Uu,type:"line",source:Fi,paint:{"line-color":["case",["boolean",["get","active"],!1],"#2563eb","#94a3b8"],"line-width":["case",["boolean",["get","active"],!1],2.5,1.5]}}),f.addSource(wr,{type:"geojson",data:It()});const te={id:$s,type:"line",source:wr,layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get","color"],"line-width":4,"line-dasharray":[1.5,1.5],"line-opacity":.8}};f.addLayer(te),f.addSource(Sr,{type:"geojson",data:It()});const ue={id:Zs,type:"line",source:Sr,layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get","color"],"line-width":3,"line-opacity":.85}};f.addLayer(ue),f.addSource(Pn,{type:"geojson",data:It(),cluster:!0,clusterRadius:60,clusterMaxZoom:14,clusterProperties:{draft:Pi.draft,approved:Pi.approved,completed:Pi.completed,unassigned:Pi.unassigned}});const le={id:en,type:"circle",source:Pn,filter:["has","point_count"],paint:{"circle-color":["case",["all",[">=",["get","completed"],["get","approved"]],[">=",["get","completed"],["get","draft"]],[">=",["get","completed"],["get","unassigned"]]],oi.completed,["all",[">=",["get","approved"],["get","draft"]],[">=",["get","approved"],["get","unassigned"]]],oi.approved,[">=",["get","draft"],["get","unassigned"]],oi.draft,oi.unassigned],"circle-radius":["interpolate",["linear"],["zoom"],8,16,12,22,14,30],"circle-opacity":.82,"circle-stroke-width":1.6,"circle-stroke-color":"#f8fafc"}};f.addLayer(le);const ie={id:Ks,type:"symbol",source:Pn,filter:["has","point_count"],layout:{"text-field":["get","point_count_abbreviated"],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#0f172a","text-halo-color":"#ffffff","text-halo-width":1.2}};f.addLayer(ie);const ee={id:tn,type:"symbol",source:Pn,filter:["!",["has","point_count"]],layout:{"icon-image":["get","iconId"],"icon-size":["case",["boolean",["get","selected"],!1],.8,.65],"icon-allow-overlap":!0,"icon-ignore-placement":!0,"text-field":["coalesce",["get","label"],""],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":10,"text-offset":[0,1.4],"text-anchor":"top","text-optional":!0},paint:{"icon-opacity":.95,"text-color":"#0f172a","text-halo-color":"#ffffff","text-halo-width":.9}};f.addLayer(ee),f.addSource(ii,{type:"geojson",data:It()});const ae={id:Ws,type:"symbol",source:ii,layout:{"text-field":["get","icon"],"text-size":20,"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-allow-overlap":!0,"text-ignore-placement":!0,"text-rotate":["get","bearing"]},paint:{"text-color":["get","color"],"text-halo-color":"rgba(17, 24, 39, 0.55)","text-halo-width":1.2}};f.addLayer(ae),hi(!0)};return f.on("styledata",D),f.on("load",j),()=>{typeof f.off=="function"&&(f.off("styledata",D),f.off("load",j)),hi(!1),Ct(!1),Q.current=null,gt(),f.remove(),$.current=null}},[ut,gt]),P.useEffect(()=>{if(!Te)return;const f=$.current;if(!f)return;const E=()=>{var L,D;typeof((L=f.dragRotate)==null?void 0:L.enable)=="function"&&f.dragRotate.enable(),typeof((D=f.touchZoomRotate)==null?void 0:D.enableRotation)=="function"&&f.touchZoomRotate.enableRotation()},C=()=>{var L,D;typeof((L=f.dragRotate)==null?void 0:L.disable)=="function"&&f.dragRotate.disable(),typeof((D=f.touchZoomRotate)==null?void 0:D.disableRotation)=="function"&&f.touchZoomRotate.disableRotation()};pe==="perspective"?(E(),typeof f.easeTo=="function"?f.easeTo({pitch:55,bearing:28,duration:600}):(f.setPitch(55),f.setBearing(28))):(typeof f.easeTo=="function"?f.easeTo({pitch:0,bearing:0,duration:400}):(f.setPitch(0),f.setBearing(0)),C())},[Te,pe]),P.useEffect(()=>{if(!Te)return;const f=$.current,E=Q.current;if(!f||!E)return;const C=[],L=new Map,D=te=>{C.length=0,an(ue=>{var ae,ve;const le=[...ue],ie=ue.length,ee=new Date().toISOString();for(const Ee of(ae=te.features)!=null?ae:[]){if(!Ee||!Fn(Ee.geometry))continue;const Oe=typeof Ee.id=="string"?Ee.id:Ee.id!=null?String(Ee.id):"draw-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2)),At=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"zone-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2)),Je=g.current("logistics.geozoneDefaultName",{index:ie+C.length+1}),Et=na({id:At,drawId:Oe,name:Je,createdAt:ee,geometry:Ee.geometry,properties:(ve=Ee.properties)!=null?ve:{},active:!0});C.push(Et),le.push(Et)}return le}),C.length&&In(ue=>{const le=new Set(ue);return C.forEach(ie=>le.add(ie.id)),Array.from(le)})},j=te=>{var ie;const ue=new Set;for(const ee of(ie=te.features)!=null?ie:[]){if(!ee)continue;const ae=typeof ee.id=="string"?ee.id:ee.id!=null?String(ee.id):"";ae&&ue.add(ae)}if(!ue.size)return;const le=[];an(ee=>ee.filter(ve=>{const Ee=ue.has(ve.drawId);return Ee&&le.push(ve.id),!Ee})),le.length&&In(ee=>ee.filter(ae=>!le.includes(ae)))},Z=te=>{var ue,le;L.clear();for(const ie of(ue=te.features)!=null?ue:[]){if(!ie||!Fn(ie.geometry))continue;const ee=typeof ie.id=="string"?ie.id:ie.id!=null?String(ie.id):"";ee&&L.set(ee,{type:"Feature",geometry:ie.geometry,properties:{...(le=ie.properties)!=null?le:{}}})}L.size&&an(ie=>ie.map(ee=>{var ve,Ee;const ae=L.get(ee.drawId);return!ae||!Fn(ae.geometry)?ee:na({id:ee.id,drawId:ee.drawId,name:ee.name,createdAt:ee.createdAt,geometry:ae.geometry,properties:(Ee=(ve=ae.properties)!=null?ve:ee.feature.properties)!=null?Ee:{},active:wt.includes(ee.id),bufferMeters:ee.metrics.bufferMeters})}))},re=te=>{Ct(te.mode==="draw_polygon")};return f.on("draw.create",D),f.on("draw.delete",j),f.on("draw.update",Z),f.on("draw.modechange",re),()=>{f.off("draw.create",D),f.off("draw.delete",j),f.off("draw.update",Z),f.off("draw.modechange",re)}},[wt,Te]),P.useEffect(()=>{if(!Te)return;const f=Q.current;f&&(q||f.changeMode("simple_select"))},[q,Te]),P.useEffect(()=>{if(!Te)return;const f=$.current;if(!f)return;const E=f.getSource(Fi);if(!E)return;const C=q?ot.map(L=>{var D;return{...L.feature,id:L.drawId,properties:{...(D=L.feature.properties)!=null?D:{},zoneId:L.id,name:L.name,active:wt.includes(L.id)}}}):[];E.setData({type:"FeatureCollection",features:C})},[wt,ot,q,Te]),P.useEffect(()=>{if(!Te)return;const f=$.current;if(!f)return;const E=f.getSource(Sr),C=f.getSource(ii);if(!E||!C)return;if(!Le.tasks||!c.length){E.setData(It()),C.setData(It()),me.current.routes=[],gt();return}let L=!1;return(async()=>{var Z,re,te;const D=[],j=[];for(const ue of c){if(L)break;const le=rn(ue.startCoordinates),ie=rn(ue.finishCoordinates);if(!le||!ie)continue;const ee=await po(ue.startCoordinates,ue.finishCoordinates);if(!ee||L)continue;const ae=typeof ue.status=="string"?ue.status.trim():"",ve=(Z=Nr[ae])!=null?Z:"#2563eb",Ee=ee;D.push({type:"Feature",geometry:{type:"LineString",coordinates:Ee},properties:{color:ve,taskId:ue._id,title:(re=ue.title)!=null?re:ue._id}});const Oe=rl(Ee,ve,ue._id,(te=ue.title)!=null?te:ue._id);Oe&&j.push(Oe)}L||(E.setData({type:"FeatureCollection",features:D}),me.current.routes=j,me.current.lastTimestamp=null,j.length?Zt():(C.setData(It()),gt()))})(),()=>{L=!0,gt()}},[Le.tasks,Te,Zt,c,gt]),P.useEffect(()=>{if(!Le.optimized||!A){ye(It());return}const f=["#ef4444","#22c55e","#f97316"],E=[];A.routes.forEach((C,L)=>{const D=[];C.tasks.forEach(j=>{const Z=rn(j.start),re=rn(j.finish);Z&&D.push(Z),re&&D.push(re)}),!(D.length<2)&&E.push({type:"Feature",geometry:{type:"LineString",coordinates:D},properties:{color:f[L%f.length],routeId:C.id}})}),ye({type:"FeatureCollection",features:E})},[Le.optimized,A]),P.useEffect(()=>{if(!Te)return;const f=$.current;if(!f)return;const E=f.getSource(wr);E&&E.setData(mi)},[Te,mi]),P.useEffect(()=>{if(!Te)return;const f=$.current;if(!f)return;const E=(C,L)=>{f.getLayer(C)&&f.setLayoutProperty(C,"visibility",L?"visible":"none")};E(Zs,Le.tasks),E(en,Le.tasks),E(Ks,Le.tasks),E(tn,Le.tasks),E(Ws,Le.tasks),E($s,Le.optimized)},[Le.optimized,Le.tasks,Te]),P.useEffect(()=>{if(!Te)return;const f=$.current;if(!f)return;const E=f.getSource(Pn);if(!E)return;const C=re=>{var ie,ee,ae,ve;const te=(ie=re.features)==null?void 0:ie[0];if(!te)return;if(((ee=te.properties)==null?void 0:ee.entity)==="vehicle"){const Ee=(ae=te.properties)==null?void 0:ae.vehicleId;typeof Ee=="string"&&Ee&&et(Ee);return}const le=(ve=te.properties)==null?void 0:ve.taskId;typeof le=="string"&&le&&dn(le)},L=re=>{var Ee,Oe,At;const te=(Ee=re.features)==null?void 0:Ee[0];if(!te)return;const ue=(Oe=te.properties)==null?void 0:Oe.cluster_id;if(typeof ue!="number")return;const le=te.geometry&&te.geometry.type==="Point"?te.geometry.coordinates:null;E.getClusterExpansionZoom(ue,(Je,Et)=>{!Je&&typeof Et=="number"&&le&&f.easeTo({center:le,zoom:Et,duration:600})});const ie=typeof((At=te.properties)==null?void 0:At.point_count)=="number"?te.properties.point_count:0,ee=Math.min(Math.max(ie,1),50),ae=new Set,ve=Je=>{E.getClusterLeaves(ue,ee,Je,(Et,Xe)=>{if(!(Et||!Xe))if(Xe.forEach(bt=>{var _n,Jt;if(((_n=bt.properties)==null?void 0:_n.entity)==="task"){const Qn=(Jt=bt.properties)==null?void 0:Jt.taskId;typeof Qn=="string"&&Qn&&ae.add(Qn)}}),Xe.length===ee&&Je+Xe.length<ie)ve(Je+Xe.length);else{const bt=Array.from(ae);Ut(bt.length?{ids:bt,center:le!=null?le:null}:null)}})};ve(0)},D=re=>{const te=f.getCanvas();te.style.cursor=re},j=()=>D("pointer"),Z=()=>D("");return f.on("click",tn,C),f.on("mouseenter",tn,j),f.on("mouseleave",tn,Z),f.on("click",en,L),f.on("mouseenter",en,j),f.on("mouseleave",en,Z),()=>{f.off("click",tn,C),f.off("mouseenter",tn,j),f.off("mouseleave",tn,Z),f.off("click",en,L),f.off("mouseenter",en,j),f.off("mouseleave",en,Z)}},[Te,dn,et]),P.useEffect(()=>{if(ut||!Te)return;const f=$.current;f&&typeof f.resize=="function"&&f.resize()},[ut,Te]),k.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[k.jsxs("header",{className:"flex flex-wrap items-start justify-between gap-3",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("h2",{className:"text-2xl font-semibold",children:a("logistics.title")}),k.jsx("p",{className:"max-w-3xl text-sm text-muted-foreground",children:a("logistics.pageLead",{defaultValue:"Планируйте маршруты, управляйте автопарком и отслеживайте задачи на одной карте."})})]}),k.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[k.jsx(Ze,{type:"button",size:"sm",variant:"outline",onClick:Hn,children:a("refresh")}),k.jsx(Ze,{type:"button",size:"sm",variant:"outline",onClick:xi,disabled:B,children:a(B?"loading":"logistics.planReload")})]})]}),ri?k.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-3 text-sm text-amber-900",children:a("logistics.mapFallbackWarning",{defaultValue:"Карта использует временные растровые тайлы OpenStreetMap. Подключите локальные PMTiles в public/tiles, чтобы активировать детализированный стиль."})}):null,k.jsxs("div",{className:"grid gap-4 xl:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[k.jsxs("div",{className:"space-y-4",children:[k.jsxs("section",{className:"space-y-4 rounded-lg border bg-white/85 p-4 shadow-sm",children:[k.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("h3",{className:"text-lg font-semibold",children:a("logistics.planSectionTitle")}),k.jsx("p",{className:"text-sm text-muted-foreground",children:a("logistics.planSummary")})]}),k.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[k.jsx("span",{className:"text-sm font-medium",children:a("logistics.planStatus")}),k.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-700",children:Ii}),B?k.jsx("span",{className:"text-xs text-muted-foreground",children:a("loading")}):null]})]}),k.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[k.jsx(Ze,{type:"button",size:"sm",variant:"outline",onClick:xi,disabled:B,children:a(B?"loading":"logistics.planReload")}),k.jsx(Ze,{type:"button",size:"sm",variant:"outline",onClick:ki,disabled:B,children:a("logistics.planClear")}),k.jsx(Ze,{type:"button",size:"sm",onClick:Xn,disabled:!A||!$t||B,children:a("save")}),(A==null?void 0:A.status)==="draft"?k.jsx(Ze,{type:"button",size:"sm",variant:"success",onClick:ir,disabled:B,children:a("logistics.planApprove")}):null,(A==null?void 0:A.status)==="approved"?k.jsx(Ze,{type:"button",size:"sm",variant:"success",onClick:rr,disabled:B,children:a("logistics.planComplete")}):null]}),A?k.jsxs("div",{className:"space-y-4",children:[k.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[k.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[k.jsx("span",{className:"font-medium",children:a("logistics.planTitleLabel")}),k.jsx(mr,{value:A.title,onChange:f=>Ve(f.target.value),disabled:!$t||B})]}),k.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[k.jsx("span",{className:"font-medium",children:a("logistics.planNotesLabel")}),k.jsx("textarea",{value:(we=A.notes)!=null?we:"",onChange:f=>er(f.target.value),className:"min-h-[96px] rounded border px-3 py-2 text-sm",disabled:!$t||B})]})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx("h4",{className:"text-sm font-semibold uppercase text-muted-foreground",children:a("logistics.planSummary")}),k.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[k.jsxs("div",{className:"rounded border bg-white/70 px-3 py-2 text-sm shadow-sm",children:[k.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:a("logistics.planTotalDistance")}),k.jsx("div",{className:"font-semibold",children:Zn((Rn=(pt=A.metrics)==null?void 0:pt.totalDistanceKm)!=null?Rn:null)})]}),k.jsxs("div",{className:"rounded border bg-white/70 px-3 py-2 text-sm shadow-sm",children:[k.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:a("logistics.planTotalRoutes")}),k.jsx("div",{className:"font-semibold",children:zt})]}),k.jsxs("div",{className:"rounded border bg-white/70 px-3 py-2 text-sm shadow-sm",children:[k.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:a("logistics.planTotalTasks")}),k.jsx("div",{className:"font-semibold",children:ur})]}),k.jsxs("div",{className:"rounded border bg-white/70 px-3 py-2 text-sm shadow-sm",children:[k.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:a("logistics.planTotalStops")}),k.jsx("div",{className:"font-semibold",children:Pe})]})]})]}),k.jsx("div",{className:"space-y-3",children:Ln.map((f,E)=>{var D,j,Z,re,te,ue,le;const C=typeof f.order=="number"&&Number.isFinite(f.order)?f.order+1:E+1,L=(j=(D=f.metrics)==null?void 0:D.stops)!=null?j:f.stops.length;return k.jsxs("div",{className:"space-y-3 rounded border bg-white/70 px-3 py-3 shadow-sm",children:[k.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[k.jsxs("div",{children:[k.jsx("h4",{className:"text-base font-semibold",children:a("logistics.planRouteTitle",{index:C})}),k.jsx("div",{className:"text-xs text-muted-foreground",children:a("logistics.planRouteSummary",{tasks:f.tasks.length,stops:L})})]}),k.jsx("div",{className:"text-xs text-muted-foreground",children:a("logistics.planRouteDistance",{distance:Zn((re=(Z=f.metrics)==null?void 0:Z.distanceKm)!=null?re:null)})})]}),k.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[k.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[k.jsx("span",{className:"font-medium",children:a("logistics.planDriver")}),k.jsx(mr,{value:(te=f.driverName)!=null?te:"",onChange:ie=>tr(E,ie.target.value),disabled:!$t||B})]}),k.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[k.jsx("span",{className:"font-medium",children:a("logistics.planVehicle")}),k.jsx(mr,{value:(ue=f.vehicleName)!=null?ue:"",onChange:ie=>Tn(E,ie.target.value),disabled:!$t||B})]}),k.jsxs("label",{className:"md:col-span-2 flex flex-col gap-1 text-sm",children:[k.jsx("span",{className:"font-medium",children:a("logistics.planRouteNotes")}),k.jsx("textarea",{value:(le=f.notes)!=null?le:"",onChange:ie=>gn(E,ie.target.value),className:"min-h-[80px] rounded border px-3 py-2 text-sm",disabled:!$t||B})]})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx("h5",{className:"text-sm font-semibold uppercase text-muted-foreground",children:a("logistics.planTasksTitle")}),k.jsx("ul",{className:"space-y-2",children:f.tasks.length?f.tasks.map((ie,ee)=>{var ve,Ee;const ae=yt.find(Oe=>Oe._id===ie.taskId);return ae?k.jsxs("li",{className:"rounded border bg-white/60 px-3 py-2 text-sm shadow-sm",children:[k.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[k.jsxs("div",{children:[k.jsx("button",{type:"button",className:"text-left font-medium text-accentPrimary hover:underline",onClick:()=>dn(ae),children:ae.title||ae._id}),k.jsx("div",{className:"text-xs text-muted-foreground",children:ae.address||a("logistics.planRouteNoAddress")})]}),k.jsxs("div",{className:"flex gap-1",children:[k.jsx(Ze,{type:"button",size:"xs",variant:"outline",onClick:()=>Cn(E,ee,-1),disabled:ee===0,children:a("logistics.planTaskUp")}),k.jsx(Ze,{type:"button",size:"xs",variant:"outline",onClick:()=>Cn(E,ee,1),disabled:ee===f.tasks.length-1,children:a("logistics.planTaskDown")})]})]}),k.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[k.jsx("span",{children:a("logistics.planRouteDistance",{distance:Zn((ve=ie.distanceKm)!=null?ve:null)})}),k.jsx("span",{children:a("logistics.planRouteDuration",{duration:ar((Ee=ie.durationMinutes)!=null?Ee:null)})})]})]},"".concat(f.id,"-").concat(ie.taskId,"-").concat(ee)):null}):k.jsx("li",{className:"rounded border border-dashed bg-white/60 px-3 py-2 text-sm text-muted-foreground",children:a("logistics.planRouteEmpty")})})]})]},f.id||"".concat(E))})}),X?k.jsx("div",{className:Kn,children:X}):null]}):k.jsx("div",{className:Kn,children:B?a("loading"):X||a("logistics.planEmpty")})]}),k.jsxs("section",{className:"space-y-4 rounded-lg border bg-white/85 p-4 shadow-sm",children:[k.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("h3",{className:"text-lg font-semibold",children:a("logistics.mapPanelTitle",{defaultValue:"Карта маршрутов"})}),k.jsx("p",{className:"text-sm text-muted-foreground",children:a("logistics.mapPanelSummary",{defaultValue:"Включайте нужные слои, выбирайте алгоритм и запускайте оптимизацию прямо на карте."})})]}),k.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[k.jsxs("label",{className:"inline-flex items-center gap-2",children:[k.jsx("input",{type:"checkbox",className:"size-4",checked:Le.tasks,onChange:f=>ke(E=>({...E,tasks:f.target.checked}))}),k.jsx("span",{children:a("logistics.layerTasks")})]}),k.jsxs("label",{className:"inline-flex items-center gap-2",children:[k.jsx("input",{type:"checkbox",className:"size-4",checked:Le.optimized,onChange:f=>ke(E=>({...E,optimized:f.target.checked}))}),k.jsx("span",{children:a("logistics.layerOptimization")})]})]})]}),k.jsx("div",{id:"logistics-map",className:"h-[320px] w-full rounded border ".concat(ut?"hidden":"")}),k.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 text-sm",children:[k.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[k.jsxs("label",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"text-xs font-medium uppercase text-muted-foreground",children:a("logistics.vehicleCountLabel")}),k.jsxs("select",{value:b,onChange:f=>I(Number(f.target.value)),className:"h-8 rounded border px-2 text-sm","aria-label":a("logistics.vehicleCountAria"),children:[k.jsx("option",{value:1,children:"1"}),k.jsx("option",{value:2,children:"2"}),k.jsx("option",{value:3,children:"3"})]})]}),k.jsxs("label",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"text-xs font-medium uppercase text-muted-foreground",children:a("logistics.optimizeMethodLabel")}),k.jsxs("select",{value:_,onChange:f=>p(f.target.value),className:"h-8 rounded border px-2 text-sm","aria-label":a("logistics.optimizeMethodAria"),children:[k.jsx("option",{value:"angle",children:"angle"}),k.jsx("option",{value:"trip",children:"trip"})]})]})]}),k.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[k.jsx(Ze,{type:"button",size:"sm",onClick:sr,children:a("logistics.optimize")}),k.jsx(Ze,{type:"button",size:"sm",onClick:Wn,children:a("reset")}),k.jsx(Ze,{type:"button",size:"sm",onClick:Hn,children:a("refresh")})]})]}),ze!=null&&ze.ids.length?k.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded border border-dashed border-slate-300 bg-white/70 px-3 py-2 text-xs text-slate-600",children:[k.jsx("span",{children:a("logistics.clusterSelectionSummary",{count:ze.ids.length,defaultValue:"В кластере задач: ".concat(ze.ids.length)})}),k.jsx(Ze,{type:"button",size:"xs",variant:"outline",onClick:Vn,children:a("clear")})]}):null]}),k.jsxs("section",{className:"space-y-3 rounded-lg border bg-white/85 p-4 shadow-sm",children:[k.jsx("h3",{className:"text-lg font-semibold",children:a("logistics.tasksHeading")}),k.jsx(so,{tasks:yt,onDataChange:f=>v(f),onRowClick:dn,page:on,pageCount:Math.max(1,Math.ceil(yt.length/25)),onPageChange:un})]})]}),k.jsxs("aside",{className:"space-y-4",children:[He==="admin"?k.jsxs("section",{className:"space-y-3 rounded-lg border bg-white/85 p-4 shadow-sm",children:[k.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-sm",children:[k.jsx("h3",{className:"font-semibold",children:a("logistics.transport")}),k.jsx(Ze,{type:"button",size:"sm",variant:"outline",onClick:Mt,disabled:qe,children:qe?a("loading"):a("logistics.refreshFleet",{defaultValue:"Обновить автопарк"})})]}),de?k.jsx("div",{className:"text-sm text-red-600",children:de}):null,Re&&!xe.length?k.jsx("div",{className:"text-sm text-muted-foreground",children:Re}):null,xe.length?k.jsx("div",{className:"overflow-x-auto",children:k.jsxs("table",{className:"w-full min-w-[480px] table-fixed border-separate border-spacing-y-1 text-xs sm:text-sm",children:[k.jsx("thead",{children:k.jsxs("tr",{className:"text-left text-muted-foreground",children:[k.jsx("th",{className:"rounded-l-md bg-slate-50 px-3 py-2 font-medium uppercase tracking-wide text-[0.7rem] dark:bg-slate-800/70",children:a("logistics.vehicleColumnName",{defaultValue:"Транспорт"})}),k.jsx("th",{className:"bg-slate-50 px-3 py-2 font-medium uppercase tracking-wide text-[0.7rem] dark:bg-slate-800/70",children:a("logistics.vehicleColumnPlate",{defaultValue:"Госномер"})}),k.jsx("th",{className:"bg-slate-50 px-3 py-2 font-medium uppercase tracking-wide text-[0.7rem] dark:bg-slate-800/70",children:a("logistics.vehicleColumnType",{defaultValue:"Тип"})}),k.jsx("th",{className:"bg-slate-50 px-3 py-2 font-medium uppercase tracking-wide text-[0.7rem] dark:bg-slate-800/70",children:a("logistics.vehicleColumnTasks",{defaultValue:"Задачи"})}),k.jsx("th",{className:"rounded-r-md bg-slate-50 px-3 py-2 font-medium uppercase tracking-wide text-[0.7rem] dark:bg-slate-800/70",children:a("logistics.vehicleColumnMileage",{defaultValue:"Пробег"})})]})}),k.jsx("tbody",{children:xe.map(f=>{const E=Ge===f.id,C=Array.isArray(f.currentTasks)?f.currentTasks.length:null,L=typeof f.odometerCurrent=="number"&&Number.isFinite(f.odometerCurrent)?f.odometerCurrent:null;return k.jsxs("tr",{onClick:()=>et(f.id),className:"bg-white/80 text-sm shadow-sm transition dark:bg-slate-900/60 ".concat(E?"cursor-pointer ring-2 ring-sky-500":"cursor-pointer hover:bg-slate-100/80"),"data-state":E?"selected":void 0,"aria-selected":E,children:[k.jsx("td",{className:"rounded-l-md px-3 py-2 font-medium",children:f.name||a("logistics.unselectedVehicle",{defaultValue:"Не выбран"})}),k.jsx("td",{className:"px-3 py-2 text-xs text-muted-foreground",children:f.registrationNumber||a("logistics.assignDialogUnknown",{defaultValue:"нет данных"})}),k.jsx("td",{className:"px-3 py-2 text-xs text-muted-foreground",children:f.transportType||a("logistics.assignDialogUnknown",{defaultValue:"нет данных"})}),k.jsx("td",{className:"px-3 py-2 text-xs text-muted-foreground",children:typeof C=="number"?a("logistics.vehicleTasksShort",{count:C,defaultValue:"".concat(C)}):a("logistics.assignDialogUnknown",{defaultValue:"нет данных"})}),k.jsx("td",{className:"rounded-r-md px-3 py-2 text-xs text-muted-foreground",children:L!==null?a("logistics.vehicleMileageShort",{value:L,defaultValue:"".concat(L," км")}):a("logistics.assignDialogUnknown",{defaultValue:"нет данных"})})]},f.id)})})]})}):null,mt?k.jsx("div",{className:"rounded border border-sky-200 bg-sky-50 px-3 py-2 text-xs text-sky-700",children:a("logistics.selectedVehicle",{name:mt.name||a("logistics.unselectedVehicle",{defaultValue:"Не выбран"})})}):null]}):de?k.jsx("p",{className:"rounded-lg border border-dashed bg-white/40 p-3 text-xs text-muted-foreground",children:de}):null,k.jsxs("section",{className:"space-y-3 rounded-lg border bg-white/85 p-4 shadow-sm",children:[k.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("h3",{className:"text-sm font-semibold uppercase text-muted-foreground",children:a("logistics.geozonesTitle")}),k.jsx("p",{className:"text-xs text-muted-foreground",children:a("logistics.geozonesDescription",{defaultValue:"Геозоны ограничивают задачи выбранными районами. Отключите, если нужно видеть все адреса."})})]}),k.jsxs("label",{className:"flex items-center gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[k.jsx("input",{type:"checkbox",className:"size-4",checked:q,onChange:f=>gi(f.target.checked)}),k.jsx("span",{children:a("logistics.geozonesToggleLabel",{defaultValue:"Геозоны"})})]})]}),k.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[k.jsx(Ze,{type:"button",size:"xs",variant:"outline",onClick:Bn,disabled:!Te||!q,children:a(di?"logistics.geozonesDrawing":"logistics.geozonesDraw")}),q?null:k.jsx("span",{className:"text-xs text-muted-foreground",children:a("logistics.geozonesDisabled",{defaultValue:"Фильтрация по зонам выключена."})})]}),q?k.jsxs(k.Fragment,{children:[k.jsx("p",{className:"text-xs text-muted-foreground",children:a("logistics.geozonesHint")}),ot.length?k.jsx("ul",{className:"space-y-2 text-sm",children:ot.map((f,E)=>{var L,D,j;const C=wt.includes(f.id);return k.jsxs("li",{className:"space-y-2 rounded border bg-white/70 p-3 shadow-sm",children:[k.jsxs("div",{className:"flex items-center justify-between gap-2",children:[k.jsxs("label",{className:"flex items-center gap-2",children:[k.jsx("input",{type:"checkbox",className:"size-4",checked:C,disabled:!q,onChange:Z=>_i(f.id,Z.target.checked)}),k.jsx("span",{className:"font-medium",children:f.name||a("logistics.geozoneDefaultName",{index:E+1})})]}),k.jsx(Ze,{type:"button",size:"xs",variant:"ghost",onClick:()=>Wt(f),children:a("logistics.geozoneRemove")})]}),k.jsx("div",{className:"text-xs text-muted-foreground",children:a(C?"logistics.geozoneStatusActive":"logistics.geozoneStatusInactive")}),k.jsxs("div",{className:"flex flex-wrap gap-2 text-[0.7rem] text-muted-foreground",children:[k.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-1",children:a("logistics.geozoneArea",{value:or((L=f.metrics)==null?void 0:L.areaKm2)})}),k.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-1",children:a("logistics.geozonePerimeter",{value:Ei((D=f.metrics)==null?void 0:D.perimeterKm)})}),k.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-1",children:a("logistics.geozoneBuffer",{value:yn((j=f.metrics)==null?void 0:j.bufferMeters)})})]})]},f.id)})}):k.jsx("p",{className:"text-sm text-muted-foreground",children:a("logistics.geozonesEmpty")})]}):k.jsx("p",{className:"rounded border border-dashed px-3 py-2 text-xs text-muted-foreground",children:a("logistics.geozonesDisabledHint",{defaultValue:"Включите переключатель выше, чтобы снова показывать зоны."})})]}),k.jsxs("section",{className:"space-y-3 rounded-lg border bg-white/85 p-4 shadow-sm",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("h3",{className:"text-sm font-semibold uppercase text-muted-foreground",children:a("logistics.layersTitle")}),k.jsx("p",{className:"text-xs text-muted-foreground",children:a("logistics.layersSummary",{defaultValue:"Настройте легенду карты по статусам, транспорту и типам задач."})})]}),k.jsxs("div",{className:"space-y-3 border-t border-dashed border-slate-200 pt-3 text-sm",children:[k.jsxs("fieldset",{className:"space-y-2",children:[k.jsx("legend",{className:"text-xs font-semibold uppercase text-muted-foreground",children:a("logistics.layerRouteStatuses",{defaultValue:"Статусы маршрутов"})}),k.jsx("ul",{className:"space-y-1",children:vi.map(({key:f,count:E,color:C})=>{const L=!Lt.has(f),D=a("logistics.routeStatus.".concat(f),{defaultValue:zu[f]});return k.jsxs("li",{className:"flex items-center justify-between gap-2",children:[k.jsxs("label",{className:"flex flex-1 items-center gap-2",children:[k.jsx("input",{type:"checkbox",className:"size-4",checked:L,onChange:j=>nr(f,j.target.checked)}),k.jsxs("span",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"inline-block size-3 rounded-full",style:{backgroundColor:C},"aria-hidden":"true"}),k.jsx("span",{children:D})]})]}),k.jsx("span",{className:"text-xs text-muted-foreground",children:a("logistics.legendCount",{count:E,defaultValue:"(".concat(E,")")})})]},f)})})]}),k.jsxs("fieldset",{className:"space-y-2",children:[k.jsx("legend",{className:"text-xs font-semibold uppercase text-muted-foreground",children:a("logistics.layerTransports",{defaultValue:"Типы транспорта"})}),k.jsx("ul",{className:"space-y-1",children:qt.map(({key:f,label:E,count:C,color:L})=>{const D=!hn.has(f);return k.jsxs("li",{className:"flex items-center justify-between gap-2",children:[k.jsxs("label",{className:"flex flex-1 items-center gap-2",children:[k.jsx("input",{type:"checkbox",className:"size-4",checked:D,onChange:j=>vt(f,j.target.checked)}),k.jsxs("span",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"inline-block size-3 rounded-full",style:{backgroundColor:L},"aria-hidden":"true"}),k.jsx("span",{children:E})]})]}),k.jsx("span",{className:"text-xs text-muted-foreground",children:a("logistics.legendCount",{count:C,defaultValue:"(".concat(C,")")})})]},f)})})]}),k.jsxs("fieldset",{className:"space-y-2",children:[k.jsx("legend",{className:"text-xs font-semibold uppercase text-muted-foreground",children:a("logistics.layerTaskTypes",{defaultValue:"Типы задач"})}),k.jsx("ul",{className:"space-y-1",children:pi.map(({key:f,label:E,count:C,color:L})=>{const D=!Bt.has(f);return k.jsxs("li",{className:"flex items-center justify-between gap-2",children:[k.jsxs("label",{className:"flex flex-1 items-center gap-2",children:[k.jsx("input",{type:"checkbox",className:"size-4",checked:D,onChange:j=>Kt(f,j.target.checked)}),k.jsxs("span",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"inline-block size-3 rounded-full",style:{backgroundColor:L},"aria-hidden":"true"}),k.jsx("span",{children:E})]})]}),k.jsx("span",{className:"text-xs text-muted-foreground",children:a("logistics.legendCount",{count:C,defaultValue:"(".concat(C,")")})})]},f)})})]})]}),k.jsxs("div",{className:"space-y-1 border-t border-dashed border-slate-200 pt-2",children:[k.jsx("span",{className:"text-xs font-medium uppercase text-muted-foreground",children:a("logistics.viewModeLabel")}),k.jsxs("div",{className:"flex gap-2",children:[k.jsx(Ze,{type:"button",size:"xs",variant:pe==="planar"?"default":"outline",onClick:()=>_e("planar"),"aria-pressed":pe==="planar",children:a("logistics.viewModePlanar")}),k.jsx(Ze,{type:"button",size:"xs",variant:pe==="perspective"?"default":"outline",onClick:()=>!ri&&_e("perspective"),"aria-pressed":pe==="perspective",disabled:ri,children:a("logistics.viewModeTilted")})]})]}),!!S.length&&k.jsx("div",{className:"space-y-1 text-sm",children:S.map((f,E)=>k.jsx("a",{href:f,target:"_blank",rel:"noopener noreferrer",className:"text-accentPrimary underline",children:a("logistics.linksLabel",{index:E+1})},"".concat(E,"-").concat(f)))})]}),k.jsxs("section",{className:"space-y-3 rounded-lg border bg-white/85 p-4 shadow-sm",children:[k.jsx("h3",{className:"text-sm font-semibold uppercase text-muted-foreground",children:a("logistics.legendTitle")}),k.jsxs("div",{className:"space-y-3 text-sm",children:[k.jsx("p",{className:"text-xs text-muted-foreground",children:a("logistics.legendDescription",{defaultValue:"Заливка маркера соответствует типу транспорта, обводка — статусу маршрута, внутреннее кольцо — типу задачи. Размер и цвет кластера показывают преобладающую категорию."})}),k.jsxs("ul",{className:"flex flex-col gap-2 sm:grid sm:grid-cols-2",children:[k.jsxs("li",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"legend-symbol legend-symbol--start","aria-hidden":"true",children:Hu}),k.jsx("span",{children:a("logistics.legendStart")})]}),k.jsxs("li",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"legend-symbol legend-symbol--finish","aria-hidden":"true",children:Zu}),k.jsx("span",{children:a("logistics.legendFinish")})]}),k.jsxs("li",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"legend-symbol legend-symbol--movement","aria-hidden":"true",children:Tr}),k.jsx("span",{children:a("logistics.legendMovement")})]})]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:a("logistics.legendStatusesHeading",{defaultValue:"Статусы задач"})}),k.jsx("ul",{className:"space-y-2",children:Qi.map(f=>k.jsxs("li",{className:"flex items-center justify-between gap-2",children:[k.jsxs("span",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"legend-color",style:{backgroundColor:f.color},"aria-hidden":"true"}),k.jsx("span",{children:f.label})]}),f.count?k.jsx("span",{className:"text-xs text-muted-foreground",children:a("logistics.legendCount",{count:f.count,defaultValue:"(".concat(f.count,")")})}):null]},f.key))})]})]})]})]})]})]})}export{qu as LOGISTICS_FLEET_POLL_INTERVAL_MS,pl as default};
//# sourceMappingURL=Logistics-CdPdTjes.js.map
