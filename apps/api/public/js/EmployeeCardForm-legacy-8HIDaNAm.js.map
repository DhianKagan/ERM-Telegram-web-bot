{"version":3,"file":"EmployeeCardForm-legacy-8HIDaNAm.js","sources":["../../../web/src/services/roles.ts","../../../web/src/utils/roleDisplay.ts","../../../web/src/components/EmployeeCardForm.tsx"],"sourcesContent":["// Назначение: запросы к API ролей\r\n// Основные модули: authFetch\r\nimport authFetch from \"../utils/authFetch\";\r\n\r\nexport interface Role {\r\n  _id: string;\r\n  name: string;\r\n  access: number;\r\n}\r\n\r\nexport const fetchRoles = (): Promise<Role[]> =>\r\n  authFetch(\"/api/v1/roles\").then((r) => (r.ok ? r.json() : []));\r\n\r\nexport const updateRole = (id: string, permissions: number) =>\r\n  authFetch(`/api/v1/roles/${id}`, {\r\n    method: \"PATCH\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ permissions }),\r\n  }).then((r) => r.json());\r\n","// Назначение файла: функции и константы для отображения названий ролей\r\n// Основные модули: словарь соответствий ролей и экспортируемые утилиты\r\n\r\nexport const ROLE_LABELS: Record<string, string> = {\r\n  admin: \"Администратор\",\r\n  manager: \"Менеджер\",\r\n  user: \"Сотрудник\",\r\n};\r\n\r\nexport interface RoleOption {\r\n  value: string;\r\n  label: string;\r\n}\r\n\r\nexport const ROLE_OPTIONS: RoleOption[] = [\r\n  { value: \"admin\", label: ROLE_LABELS.admin },\r\n  { value: \"manager\", label: ROLE_LABELS.manager },\r\n  { value: \"user\", label: ROLE_LABELS.user },\r\n];\r\n\r\nexport const formatRoleName = (role?: string | null): string => {\r\n  if (!role) return \"—\";\r\n  return ROLE_LABELS[role] ?? role;\r\n};\r\n","// Назначение: форма карточки сотрудника для создания и редактирования пользователей.\r\n// Основные модули: React, services/users, services/collections, services/roles.\r\nimport {\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useState,\r\n  type FormEvent,\r\n} from \"react\";\r\nimport clsx from \"clsx\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport ConfirmDialog from \"./ConfirmDialog\";\r\nimport {\r\n  fetchCollectionItems,\r\n  type CollectionItem,\r\n} from \"../services/collections\";\r\nimport { fetchRoles, type Role } from \"../services/roles\";\r\nimport { ROLE_OPTIONS } from \"../utils/roleDisplay\";\r\nimport {\r\n  createUser,\r\n  fetchUser,\r\n  previewUserCredentials,\r\n  updateUser,\r\n  type GeneratedUserCredentials,\r\n  type UserDetails,\r\n} from \"../services/users\";\r\nimport { useAuth } from \"../context/useAuth\";\r\nimport { showToast } from \"../utils/toast\";\r\nimport { hasAccess, ACCESS_ADMIN } from \"../utils/access\";\r\nimport type { UserFormData } from \"../pages/Settings/UserForm\";\r\n\r\ninterface EmployeeCardFormProps {\r\n  telegramId?: string;\r\n  className?: string;\r\n  mode?: \"create\" | \"update\";\r\n  onSaved?: (user: UserDetails) => void;\r\n}\r\n\r\nconst emptyForm: UserFormData = {\r\n  telegram_id: undefined,\r\n  username: \"\",\r\n  name: \"\",\r\n  phone: \"\",\r\n  mobNumber: \"\",\r\n  email: \"\",\r\n  role: \"user\",\r\n  access: 1,\r\n  roleId: \"\",\r\n  departmentId: \"\",\r\n  divisionId: \"\",\r\n  positionId: \"\",\r\n};\r\n\r\nfunction mapUserToForm(user: UserDetails): UserFormData {\r\n  return {\r\n    telegram_id: user.telegram_id,\r\n    username: user.telegram_username || user.username || \"\",\r\n    name: user.name || \"\",\r\n    phone: user.phone || \"\",\r\n    mobNumber: user.mobNumber || \"\",\r\n    email: user.email || \"\",\r\n    role: user.role || \"user\",\r\n    access: user.access,\r\n    roleId: user.roleId || \"\",\r\n    departmentId: user.departmentId || \"\",\r\n    divisionId: user.divisionId || \"\",\r\n    positionId: user.positionId || \"\",\r\n  };\r\n}\r\n\r\nconst normalize = (value: unknown): string => {\r\n  if (value === undefined || value === null) return \"\";\r\n  if (typeof value === \"number\") return String(value);\r\n  return String(value);\r\n};\r\n\r\nexport default function EmployeeCardForm({\r\n  telegramId,\r\n  className,\r\n  mode,\r\n  onSaved,\r\n}: EmployeeCardFormProps) {\r\n  const { user } = useAuth();\r\n  const [form, setForm] = useState<UserFormData>({ ...emptyForm });\r\n  const [initialForm, setInitialForm] = useState<UserFormData>({ ...emptyForm });\r\n  const [departments, setDepartments] = useState<CollectionItem[]>([]);\r\n  const [divisions, setDivisions] = useState<CollectionItem[]>([]);\r\n  const [positions, setPositions] = useState<CollectionItem[]>([]);\r\n  const [roles, setRoles] = useState<Role[]>([]);\r\n  const resolvedMode = mode ?? (telegramId ? \"update\" : \"create\");\r\n  const [loading, setLoading] = useState<boolean>(\r\n    resolvedMode === \"update\" && !!telegramId,\r\n  );\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [saving, setSaving] = useState(false);\r\n  const [confirmSave, setConfirmSave] = useState(false);\r\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\r\n  const [prefillError, setPrefillError] = useState<string | null>(null);\r\n\r\n  const isCreateMode = resolvedMode === \"create\";\r\n  const canEdit = hasAccess(user?.access, ACCESS_ADMIN);\r\n\r\n  useEffect(() => {\r\n    fetchCollectionItems(\"departments\", \"\", 1, 100).then((d) =>\r\n      setDepartments(d.items),\r\n    ).catch(() => setDepartments([]));\r\n    fetchCollectionItems(\"divisions\", \"\", 1, 100).then((d) =>\r\n      setDivisions(d.items),\r\n    ).catch(() => setDivisions([]));\r\n    fetchCollectionItems(\"positions\", \"\", 1, 100).then((d) =>\r\n      setPositions(d.items),\r\n    ).catch(() => setPositions([]));\r\n    fetchRoles().then((list) => setRoles(list));\r\n  }, []);\r\n\r\n  const applyGeneratedCredentials = useCallback(\r\n    (credentials: GeneratedUserCredentials) => {\r\n      setForm((prev) => ({\r\n        ...prev,\r\n        telegram_id: credentials.telegram_id,\r\n        username: credentials.username,\r\n      }));\r\n      setInitialForm((prev) => ({\r\n        ...prev,\r\n        telegram_id: credentials.telegram_id,\r\n        username: credentials.username,\r\n      }));\r\n    },\r\n    [],\r\n  );\r\n\r\n  const requestGeneratedCredentials = useCallback(\r\n    () => previewUserCredentials(),\r\n    [],\r\n  );\r\n\r\n  useEffect(() => {\r\n    setSuccessMessage(null);\r\n    if (isCreateMode) {\r\n      setLoading(false);\r\n      setError(null);\r\n      setForm({ ...emptyForm });\r\n      setInitialForm({ ...emptyForm });\r\n      let active = true;\r\n      requestGeneratedCredentials()\r\n        .then((generated) => {\r\n          if (!active) return;\r\n          applyGeneratedCredentials(generated);\r\n          setPrefillError(null);\r\n        })\r\n        .catch((error) => {\r\n          if (!active) return;\r\n          const message =\r\n            error instanceof Error\r\n              ? error.message\r\n              : \"Не удалось подготовить данные\";\r\n          setPrefillError(message);\r\n          showToast(message, \"error\");\r\n        });\r\n      return () => {\r\n        active = false;\r\n      };\r\n    }\r\n    setPrefillError(null);\r\n    if (!telegramId) {\r\n      setLoading(false);\r\n      setError(null);\r\n      setForm({ ...emptyForm });\r\n      setInitialForm({ ...emptyForm });\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    setError(null);\r\n    fetchUser(telegramId)\r\n      .then((data) => {\r\n        if (!data) {\r\n          setError(\"Пользователь не найден\");\r\n          setForm({ ...emptyForm });\r\n          setInitialForm({ ...emptyForm });\r\n          return;\r\n        }\r\n        const mapped = mapUserToForm(data);\r\n        setForm(mapped);\r\n        setInitialForm({ ...mapped });\r\n      })\r\n      .catch((e) => {\r\n        const message = e instanceof Error ? e.message : \"Ошибка загрузки\";\r\n        setError(message || \"Ошибка загрузки\");\r\n        setForm({ ...emptyForm });\r\n        setInitialForm({ ...emptyForm });\r\n      })\r\n      .finally(() => setLoading(false));\r\n  }, [\r\n    telegramId,\r\n    isCreateMode,\r\n    applyGeneratedCredentials,\r\n    requestGeneratedCredentials,\r\n  ]);\r\n\r\n  const isDirty = useMemo(() => {\r\n    if (!canEdit) return false;\r\n    if (isCreateMode) {\r\n      return Boolean(form.telegram_id && form.username);\r\n    }\r\n    const keys = Object.keys(initialForm) as (keyof UserFormData)[];\r\n    return keys.some((key) => normalize(form[key]) !== normalize(initialForm[key]));\r\n  }, [canEdit, form, initialForm, isCreateMode]);\r\n\r\n  const updateField = <K extends keyof UserFormData>(\r\n    key: K,\r\n    value: UserFormData[K],\r\n  ) => {\r\n    setSuccessMessage(null);\r\n    setForm((prev) => ({ ...prev, [key]: value }));\r\n  };\r\n\r\n  const handleRoleChange = (value: string) => {\r\n    const role = roles.find((r) => r.name === value);\r\n    setSuccessMessage(null);\r\n    setForm((prev) => ({\r\n      ...prev,\r\n      role: value,\r\n      roleId: role?._id || prev.roleId,\r\n      access: role?.access ?? prev.access,\r\n    }));\r\n  };\r\n\r\n  const resetChanges = () => {\r\n    if (isCreateMode) {\r\n      setSuccessMessage(null);\r\n      setForm({ ...emptyForm });\r\n      setInitialForm({ ...emptyForm });\r\n      requestGeneratedCredentials()\r\n        .then((generated) => {\r\n          applyGeneratedCredentials(generated);\r\n          setPrefillError(null);\r\n        })\r\n        .catch((error) => {\r\n          const message =\r\n            error instanceof Error\r\n              ? error.message\r\n              : \"Не удалось подготовить данные\";\r\n          setPrefillError(message);\r\n          showToast(message, \"error\");\r\n        });\r\n      return;\r\n    }\r\n    setSuccessMessage(null);\r\n    setForm({ ...initialForm });\r\n  };\r\n\r\n  const handleSubmit = (event: FormEvent<HTMLFormElement>) => {\r\n    event.preventDefault();\r\n    if (!canEdit) return;\r\n    if (!isDirty) return;\r\n    setConfirmSave(true);\r\n  };\r\n\r\n  const persistChanges = async () => {\r\n    if (!canEdit) {\r\n      setConfirmSave(false);\r\n      return;\r\n    }\r\n    if (isCreateMode) {\r\n      if (!form.telegram_id || !form.username) {\r\n        showToast(\"Укажите ID и username сотрудника\", \"error\");\r\n        setConfirmSave(false);\r\n        return;\r\n      }\r\n      setSaving(true);\r\n      try {\r\n        const telegramIdValue = Number(form.telegram_id);\r\n        if (!Number.isFinite(telegramIdValue)) {\r\n          throw new Error(\"ID должен быть числом\");\r\n        }\r\n        await createUser(telegramIdValue, form.username, form.roleId);\r\n        const { telegram_id: _, ...payload } = form;\r\n        const updated = await updateUser(telegramIdValue, payload);\r\n        if (!updated) throw new Error(\"Не удалось сохранить изменения\");\r\n        const mapped = mapUserToForm(updated);\r\n        setForm(mapped);\r\n        setInitialForm({ ...mapped });\r\n        onSaved?.(updated);\r\n        setSuccessMessage(\"Сотрудник создан\");\r\n      } catch (error) {\r\n        const message = error instanceof Error ? error.message : \"Не удалось сохранить\";\r\n        showToast(message, \"error\");\r\n      } finally {\r\n        setSaving(false);\r\n        setConfirmSave(false);\r\n      }\r\n      return;\r\n    }\r\n    if (!form.telegram_id) {\r\n      setConfirmSave(false);\r\n      return;\r\n    }\r\n    setSaving(true);\r\n    try {\r\n      const { telegram_id: telegramIdValue, ...payload } = form;\r\n      const updated = await updateUser(telegramIdValue, payload);\r\n      if (!updated) throw new Error(\"Не удалось сохранить изменения\");\r\n      const mapped = mapUserToForm(updated);\r\n      setForm(mapped);\r\n      setInitialForm({ ...mapped });\r\n      onSaved?.(updated);\r\n      setSuccessMessage(\"Данные сотрудника сохранены\");\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : \"Не удалось сохранить\";\r\n      showToast(message, \"error\");\r\n    } finally {\r\n      setSaving(false);\r\n      setConfirmSave(false);\r\n    }\r\n  };\r\n\r\n  if (!telegramId && !isCreateMode) {\r\n    return <div className=\"text-sm text-gray-500\">Выберите сотрудника слева</div>;\r\n  }\r\n\r\n  return (\r\n    <div className={clsx(\"space-y-4\", className)}>\r\n      <div className=\"space-y-1\">\r\n        <h2 className=\"text-xl font-semibold\">\r\n          {isCreateMode ? \"Новый сотрудник\" : \"Карточка сотрудника\"}\r\n        </h2>\r\n        <p className=\"text-sm text-gray-500\">\r\n          {isCreateMode\r\n            ? \"Заполните данные и сохраните, чтобы создать запись.\"\r\n            : \"Измените данные и подтвердите сохранение.\"}\r\n        </p>\r\n      </div>\r\n      {loading && <div>Загрузка...</div>}\r\n      {!loading && isCreateMode && prefillError && (\r\n        <div className=\"rounded border border-rose-200 bg-rose-50 p-3 text-sm text-rose-900\">\r\n          {prefillError}\r\n        </div>\r\n      )}\r\n      {!loading && error && <div className=\"text-red-600\">{error}</div>}\r\n      {!loading && !error && (\r\n        <form\r\n          onSubmit={handleSubmit}\r\n          className=\"space-y-4 rounded bg-white p-6 shadow\"\r\n        >\r\n          {successMessage && (\r\n            <div className=\"rounded border border-green-200 bg-green-50 p-3 text-sm text-green-800\">\r\n              {successMessage}\r\n            </div>\r\n          )}\r\n          {!canEdit && (\r\n            <div className=\"rounded border border-amber-200 bg-amber-50 p-3 text-sm text-amber-900\">\r\n              У вас нет прав на редактирование, данные доступны только для чтения.\r\n            </div>\r\n          )}\r\n          <div className=\"grid gap-4 md:grid-cols-2\">\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">ID</span>\r\n              <input\r\n                name=\"telegramId\"\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.telegram_id ?? \"\"}\r\n                onChange={(e) =>\r\n                  updateField(\r\n                    \"telegram_id\",\r\n                    e.target.value ? Number(e.target.value) : undefined,\r\n                  )\r\n                }\r\n                readOnly={!isCreateMode}\r\n                required\r\n              />\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Username</span>\r\n              <input\r\n                name=\"username\"\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.username || \"\"}\r\n                onChange={(e) => updateField(\"username\", e.target.value)}\r\n                readOnly={!isCreateMode}\r\n                required\r\n              />\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Имя</span>\r\n              <input\r\n                name=\"name\"\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.name || \"\"}\r\n                onChange={(e) => updateField(\"name\", e.target.value)}\r\n                disabled={!canEdit}\r\n              />\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Телефон</span>\r\n              <input\r\n                name=\"phone\"\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.phone || \"\"}\r\n                onChange={(e) => updateField(\"phone\", e.target.value)}\r\n                disabled={!canEdit}\r\n              />\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Доп. телефон</span>\r\n              <input\r\n                name=\"mobNumber\"\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.mobNumber || \"\"}\r\n                onChange={(e) => updateField(\"mobNumber\", e.target.value)}\r\n                disabled={!canEdit}\r\n              />\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Email</span>\r\n              <input\r\n                name=\"email\"\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.email || \"\"}\r\n                onChange={(e) => updateField(\"email\", e.target.value)}\r\n                disabled={!canEdit}\r\n              />\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Роль</span>\r\n              <select\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.role || \"user\"}\r\n                onChange={(e) => handleRoleChange(e.target.value)}\r\n                disabled={!canEdit}\r\n              >\r\n                {ROLE_OPTIONS.map((option) => (\r\n                  <option key={option.value} value={option.value}>\r\n                    {option.label}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Департамент</span>\r\n              <select\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.departmentId || \"\"}\r\n                onChange={(e) => updateField(\"departmentId\", e.target.value)}\r\n                disabled={!canEdit}\r\n              >\r\n                <option value=\"\"></option>\r\n                {departments.map((d) => (\r\n                  <option key={d._id} value={d._id}>\r\n                    {d.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Отдел</span>\r\n              <select\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.divisionId || \"\"}\r\n                onChange={(e) => updateField(\"divisionId\", e.target.value)}\r\n                disabled={!canEdit}\r\n              >\r\n                <option value=\"\"></option>\r\n                {divisions.map((d) => (\r\n                  <option key={d._id} value={d._id}>\r\n                    {d.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Должность</span>\r\n              <select\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.positionId || \"\"}\r\n                onChange={(e) => updateField(\"positionId\", e.target.value)}\r\n                disabled={!canEdit}\r\n              >\r\n                <option value=\"\"></option>\r\n                {positions.map((p) => (\r\n                  <option key={p._id} value={p._id}>\r\n                    {p.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n          </div>\r\n          {canEdit && (\r\n            <div className=\"flex gap-3\">\r\n              <Button type=\"submit\" disabled={!isDirty || saving}>\r\n                {saving ? \"Сохранение...\" : \"Сохранить\"}\r\n              </Button>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                onClick={resetChanges}\r\n                disabled={!isDirty || saving}\r\n              >\r\n                Очистить\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </form>\r\n      )}\r\n      <ConfirmDialog\r\n        open={confirmSave}\r\n        message={isCreateMode ? \"Создать сотрудника?\" : \"Сохранить изменения сотрудника?\"}\r\n        onConfirm={persistChanges}\r\n        onCancel={() => setConfirmSave(false)}\r\n        confirmText=\"Сохранить\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":["fetchRoles","authFetch","then","r","ok","json","ROLE_LABELS","admin","manager","user","ROLE_OPTIONS","exports","value","label","emptyForm","role","_ROLE_LABELS$role","telegram_id","username","name","phone","mobNumber","email","access","roleId","departmentId","divisionId","positionId","mapUserToForm","telegram_username","normalize","String","EmployeeCardForm","_ref","_form$telegram_id","telegramId","className","mode","onSaved","useAuth","_reactExports$useStat2","_slicedToArray","useState","form","setForm","_reactExports$useStat4","initialForm","setInitialForm","_reactExports$useStat6","departments","setDepartments","_reactExports$useStat8","divisions","setDivisions","_reactExports$useStat0","positions","setPositions","_reactExports$useStat10","roles","setRoles","resolvedMode","_reactExports$useStat12","loading","setLoading","_reactExports$useStat14","error","setError","_reactExports$useStat16","saving","setSaving","_reactExports$useStat18","confirmSave","setConfirmSave","_reactExports$useStat20","successMessage","setSuccessMessage","_reactExports$useStat22","prefillError","setPrefillError","isCreateMode","canEdit","hasAccess","ACCESS_ADMIN","useEffect","fetchCollectionItems","d","items","catch","list","applyGeneratedCredentials","useCallback","credentials","prev","_objectSpread","requestGeneratedCredentials","previewUserCredentials","active","generated","message","Error","showToast","fetchUser","data","mapped","e","finally","isDirty","useMemo","Boolean","Object","keys","some","key","updateField","persistChanges","_callee","telegramIdValue","payload","updated","_telegramIdValue","_payload","_updated","_mapped","_message","_t","_t2","_regenerator","w","_context","p","n","a","Number","isFinite","createUser","_excluded","updateUser","v","f","_excluded2","clsx","children","jsxs","jsx","onSubmit","event","preventDefault","onChange","target","readOnly","required","disabled","find","_role$access","_id","map","option","Button","type","variant","onClick","ConfirmDialog","open","onConfirm","onCancel","confirmText"],"mappings":"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"}