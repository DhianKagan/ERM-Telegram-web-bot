{"version":3,"file":"ThemeProvider-Cb68Cd29.js","sources":["../../../web/src/context/ThemeProvider.tsx"],"sourcesContent":["// Провайдер темы и токенов\n// Модули: React, next-themes, ThemeContext\nimport { useState, useEffect, useRef, type ReactNode } from 'react';\nimport { ThemeProvider as NextThemesProvider } from 'next-themes';\nimport { ThemeContext, type ThemeTokens } from './ThemeContext';\nimport presets from '../theme/presets.json';\n\nfunction getCookie(name: string): string | null {\n  const match = document.cookie.match(new RegExp(`(?:^|; )${name}=([^;]*)`));\n  return match ? decodeURIComponent(match[1]) : null;\n}\n\nfunction setCookie(name: string, value: string) {\n  document.cookie = `${name}=${encodeURIComponent(value)};path=/;max-age=31536000`;\n}\n\nconst presetMap = presets as Record<string, ThemeTokens>;\nconst defaultTheme = 'light';\n\nfunction sanitizeTokens(\n  source: unknown,\n  base: ThemeTokens,\n): Partial<ThemeTokens> | null {\n  if (!source || typeof source !== 'object') return null;\n  const sanitized: Partial<ThemeTokens> = {};\n  for (const [key, value] of Object.entries(\n    source as Record<string, unknown>,\n  )) {\n    if (typeof value === 'string' && key in base) {\n      sanitized[key as keyof ThemeTokens] = value;\n    }\n  }\n  return Object.keys(sanitized).length ? sanitized : null;\n}\n\nfunction readThemeCookie(): string {\n  const cookieTheme = getCookie('theme');\n  return cookieTheme && presetMap[cookieTheme] ? cookieTheme : defaultTheme;\n}\n\nfunction readTokensCookie(\n  theme: string,\n  base: ThemeTokens,\n): Partial<ThemeTokens> | null {\n  const raw = getCookie('theme-tokens');\n  if (!raw) return null;\n  try {\n    const parsed = JSON.parse(raw) as unknown;\n    if (!parsed || typeof parsed !== 'object') return null;\n    if ('theme' in parsed || 'tokens' in parsed) {\n      const cookieTheme = (parsed as { theme?: unknown }).theme;\n      if (typeof cookieTheme === 'string' && cookieTheme !== theme) {\n        return null;\n      }\n      const cookieTokens = sanitizeTokens(\n        (parsed as { tokens?: unknown }).tokens,\n        base,\n      );\n      return cookieTokens;\n    }\n    return sanitizeTokens(parsed, base);\n  } catch {\n    return null;\n  }\n}\n\nfunction mergeWithPreset(\n  base: ThemeTokens,\n  extra: Partial<ThemeTokens> | null,\n): ThemeTokens {\n  if (!extra) return base;\n  return { ...extra, ...base } as ThemeTokens;\n}\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const initialTheme = readThemeCookie();\n  const initialBase = presetMap[initialTheme] || presetMap[defaultTheme];\n  const [theme, setTheme] = useState(initialTheme);\n  const [tokens, setTokens] = useState<ThemeTokens>(() =>\n    mergeWithPreset(initialBase, readTokensCookie(initialTheme, initialBase)),\n  );\n\n  const appliedKeys = useRef<Set<string>>(new Set());\n\n  useEffect(() => {\n    if (!presetMap[theme]) {\n      setTheme(defaultTheme);\n      return;\n    }\n    const base = presetMap[theme] || presetMap[defaultTheme];\n    setTokens(mergeWithPreset(base, readTokensCookie(theme, base)));\n  }, [theme]);\n\n  useEffect(() => {\n    const root = document.documentElement;\n    const currentKeys = new Set<string>();\n    for (const [k, v] of Object.entries(tokens)) {\n      root.style.setProperty(`--${k}`, v);\n      currentKeys.add(k);\n    }\n    for (const key of appliedKeys.current) {\n      if (!currentKeys.has(key)) {\n        root.style.removeProperty(`--${key}`);\n      }\n    }\n    appliedKeys.current = currentKeys;\n    root.classList.toggle('dark', theme === 'dark');\n    setCookie('theme', theme);\n    setCookie('theme-tokens', JSON.stringify({ theme, tokens }));\n  }, [tokens, theme]);\n\n  return (\n    <NextThemesProvider\n      attribute=\"class\"\n      defaultTheme={theme}\n      enableSystem={false}\n    >\n      <ThemeContext.Provider value={{ theme, setTheme, tokens, setTokens }}>\n        {children}\n      </ThemeContext.Provider>\n    </NextThemesProvider>\n  );\n}\n"],"names":["getCookie","name","match","setCookie","value","presetMap","presets","defaultTheme","sanitizeTokens","source","base","sanitized","key","readThemeCookie","cookieTheme","readTokensCookie","theme","raw","parsed","mergeWithPreset","extra","ThemeProvider","children","initialTheme","initialBase","setTheme","useState","tokens","setTokens","appliedKeys","useRef","useEffect","root","currentKeys","k","v","jsx","NextThemesProvider","ThemeContext"],"mappings":"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"}