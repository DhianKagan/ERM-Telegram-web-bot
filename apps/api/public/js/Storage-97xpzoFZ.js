import{j as s}from"./index-CiBvN1ph.js";import{b as p,R as n,i as ze}from"./vendor-DBLHOZWC.js";import Re from"./DataTable-yuss4d11.js";import{h as A,b as _e,s as v,B as z,M as Be,P as Oe,o as We}from"./App-CBKZhWa-.js";import{I as Ue}from"./input-DPyG2bFz.js";import{E as $e}from"./EmployeeLink-CKfquPNy.js";import{f as He}from"./users-e0BWfEj3.js";import{F as Ze}from"./PhotoIcon-CILObUDG.js";function Ke({title:e,titleId:r,...i},u){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":r},i),e?p.createElement("title",{id:r},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"}))}const ye=p.forwardRef(Ke);function Ve({title:e,titleId:r,...i},u){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":r},i),e?p.createElement("title",{id:r},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const qe=p.forwardRef(Ve);function Je({title:e,titleId:r,...i},u){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":r},i),e?p.createElement("title",{id:r},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const Ge=p.forwardRef(Je);function Qe({title:e,titleId:r,...i},u){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":r},i),e?p.createElement("title",{id:r},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const we=p.forwardRef(Qe);function Xe({title:e,titleId:r,...i},u){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":r},i),e?p.createElement("title",{id:r},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"}))}const Ye=p.forwardRef(Xe);function et({items:e}){return s.jsx("nav",{className:"text-body mb-4 text-sm",children:s.jsx("ol",{className:"list-reset flex",children:e.map((r,i)=>s.jsxs(n.Fragment,{children:[i>0&&s.jsx("li",{children:s.jsx("span",{className:"text-body px-2",children:"/"})}),s.jsx("li",{children:r.href?s.jsx("a",{href:r.href,className:"text-primary hover:underline",children:r.label}):s.jsx("span",{className:"text-bodydark",children:r.label})})]},i))})})}const tt=["inline-flex max-w-full items-center gap-1","rounded-full border border-blue-200 bg-blue-50 px-2 py-0.5 text-xs font-semibold text-blue-700 shadow-xs","transition-colors duration-150 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2","dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100"].join(" ");function st(e,r={}){var R;const i=r.onTaskOpen,u=(R=r.taskOptions)!=null?R:[],E=!!r.tasksLoading;return[{header:e.name,accessorKey:"name",meta:{minWidth:"12rem",maxWidth:"20rem",renderAsBadges:!1},cell:({row:k})=>{const d=k.original;return s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsx("span",{className:"truncate font-medium",title:d.name,children:d.name}),s.jsxs("div",{className:"flex flex-shrink-0 items-center gap-1",children:[s.jsxs("button",{type:"button",onClick:g=>{g.stopPropagation(),d.onDownload()},className:"inline-flex items-center rounded border border-blue-200 bg-blue-50 px-2 py-1 text-xs text-blue-700 hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100","aria-label":e.download,children:[s.jsx(ye,{className:"mr-1 size-4","aria-hidden":!0}),e.download]}),s.jsxs("button",{type:"button",onClick:g=>{g.stopPropagation(),d.onDelete()},className:"inline-flex items-center rounded border border-red-200 bg-red-50 px-2 py-1 text-xs text-red-700 hover:bg-red-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500 dark:border-red-500/30 dark:bg-red-500/10 dark:text-red-100","aria-label":e.delete,children:[s.jsx(we,{className:"mr-1 size-4","aria-hidden":!0}),e.delete]})]})]}),s.jsxs("div",{className:"space-y-2 rounded-md border border-border/60 bg-muted/40 p-3 text-xs",children:[s.jsx("span",{className:"block font-semibold uppercase tracking-wide text-muted-foreground",children:e.attachTitle}),s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[s.jsxs("select",{value:d.selectedTaskId,onChange:g=>{g.stopPropagation(),d.onTaskSelect(g.target.value)},disabled:d.attachLoading||E,className:"h-9 min-w-[12rem] rounded-md border border-input bg-background px-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",children:[s.jsx("option",{value:"",children:e.attachPlaceholder}),u.map(g=>s.jsx("option",{value:g.value,children:g.label},g.value))]}),s.jsx("button",{type:"button",onClick:g=>{g.stopPropagation(),d.onAttach()},className:"inline-flex items-center justify-center rounded-md border border-blue-200 bg-blue-600 px-3 py-1.5 text-xs font-semibold text-white transition hover:bg-blue-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:border-border disabled:bg-muted disabled:text-muted-foreground",disabled:d.attachDisabled,children:d.attachLoading?e.attachProcessing:e.attachAction})]}),E?s.jsx("span",{className:"block text-muted-foreground",children:e.attachLoading}):u.length===0?s.jsx("span",{className:"block text-muted-foreground",children:e.attachEmpty}):null]})]})}},{header:e.user,accessorKey:"userDisplay",meta:{minWidth:"8rem",maxWidth:"12rem",renderAsBadges:!1},cell:({row:k})=>{const d=k.original,g=d.userDisplay;return d.userId?s.jsx($e,{employeeId:d.userId,stopPropagation:!0,className:tt,title:d.userHint,children:s.jsx("span",{className:"truncate",children:g})}):s.jsx("span",{className:"truncate text-sm",title:d.userHint,children:g})}},{header:e.type,accessorKey:"type",meta:{minWidth:"8rem",maxWidth:"10rem"},cell:({row:k})=>k.original.type||""},{header:e.size,accessorKey:"sizeLabel",meta:{minWidth:"6rem",maxWidth:"8rem"},cell:({row:k})=>k.original.sizeLabel},{header:e.task,accessorKey:"taskDisplay",meta:{minWidth:"10rem",maxWidth:"16rem",renderAsBadges:!1},cell:({row:k})=>{const d=k.original,g=s.jsxs("span",{className:"block",children:[d.taskDisplay,d.taskTitle?s.jsx("span",{className:"block text-xs text-muted-foreground",children:d.taskTitle}):null]});return d.taskParam?i?s.jsx("button",{type:"button",onClick:C=>{C.stopPropagation(),i(d.taskParam)},className:"inline-flex w-full flex-col items-start gap-0.5 rounded-lg border border-blue-200 bg-blue-50 px-2 py-1 text-left text-xs font-semibold text-blue-700 transition hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100",title:d.taskTitle?e.taskTitleHint(d.taskTitle):void 0,children:g}):d.taskLink?s.jsx("a",{href:d.taskLink,className:"inline-flex w-full flex-col items-start gap-0.5 rounded-lg border border-blue-200 bg-blue-50 px-2 py-1 text-left text-xs font-semibold text-blue-700 no-underline transition hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100",onClick:C=>C.stopPropagation(),title:d.taskTitle?e.taskTitleHint(d.taskTitle):void 0,children:g}):g:g}},{header:e.uploaded,accessorKey:"uploadedLabel",meta:{minWidth:"10rem",maxWidth:"12rem"},cell:({row:k})=>k.original.uploadedLabel}]}const at=e=>{const r=new URLSearchParams;e!=null&&e.userId&&r.set("userId",String(e.userId)),e!=null&&e.type&&r.set("type",e.type);const i="/api/v1/storage".concat(r.toString()?"?".concat(r):"");return A(i).then(u=>u.ok?u.json():[])},rt=e=>A("/api/v1/storage/".concat(encodeURIComponent(e))).then(r=>r.ok?r.json():Promise.reject(r)),ot=e=>A("/api/v1/storage/".concat(encodeURIComponent(e)),{method:"DELETE"}),nt=async()=>{const e=await A("/api/v1/storage/diagnostics");if(!e.ok)throw new Error("diagnostics");return await e.json()},Z=25,lt=new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:We}),it={image:Ze,video:Ye,pdf:Ge,text:qe};function dt(e){return e.startsWith("text/")||e.includes("json")||e.endsWith("xml")||e==="application/sql"}function ct(e){if(!e||Number.isNaN(e))return"—";if(e<=0)return"0 Б";const r=["Б","КБ","МБ","ГБ","ТБ"],i=Math.min(Math.floor(Math.log(e)/Math.log(1024)),r.length-1),u=e/Math.pow(1024,i);return"".concat(u.toFixed(u>=10||i===0?0:1)," ").concat(r[i])}function je(e){if(!e)return"—";const r=Date.parse(e);if(Number.isNaN(r))return"—";const i=lt.format(new Date(r)).replace(", "," ");return"".concat(i," ").concat(Oe)}function ut(){var be;const{t:e}=_e(),[r,i]=ze(),[u,E]=n.useState([]),[R,k]=n.useState(!1),[d,g]=n.useState({}),[C,Ne]=n.useState(""),[K,Te]=n.useState("uploaded_desc"),[V,q]=n.useState(0),[w,Le]=n.useState(r.get("file")),[L,P]=n.useState(null),[Se,J]=n.useState(!1),[b,N]=n.useState(null),[_,re]=n.useState(!1),[j,oe]=n.useState([]),[ne,le]=n.useState({}),[U,$]=n.useState({}),[G,ie]=n.useState(null),[D,Ie]=n.useState(null),[de,ce]=n.useState(!1),[ue,me]=n.useState(null),he=n.useCallback(async(t,a)=>{const o=await A("/api/v1/files/".concat(encodeURIComponent(t),"/attach"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskId:a})});if(!o.ok){const l=new Error("attach");throw l.status=o.status,l}await o.json().catch(()=>({}))},[]),B=n.useCallback(()=>(k(!0),at().then(t=>{E(Array.isArray(t)?t:[])}).catch(()=>{v(e("storage.loadError"),"error")}).finally(()=>k(!1))),[e]),ge=n.useMemo(()=>u.filter(t=>!t.taskId).length,[u]),Ee=n.useCallback(()=>(ce(!0),me(null),nt().then(t=>(Ie(t),v(e("storage.diagnostics.success"),"success"),B())).catch(()=>{me(e("storage.diagnostics.error")),v(e("storage.diagnostics.error"),"error")}).finally(()=>{ce(!1)})),[B,e]);n.useEffect(()=>{B()},[B]),n.useEffect(()=>{let t=!0;return He().then(a=>{if(!t)return;const o={};a.forEach(l=>{typeof l.telegram_id=="number"&&(o[l.telegram_id]=l)}),g(o)}).catch(()=>{v(e("storage.usersLoadError"),"error")}),()=>{t=!1}},[e]),n.useEffect(()=>{let t=!1;return re(!0),A("/api/v1/tasks/mentioned").then(a=>a.ok?a.json():[]).then(a=>{if(t)return;const l=(Array.isArray(a)?a:[]).map(m=>{var ke,ve;const f=typeof m._id=="string"?((ke=m._id)!=null?ke:"").trim():typeof m.id=="string"?((ve=m.id)!=null?ve:"").trim():"";if(!f)return null;const T=m.title,F=typeof T=="string"&&T.trim().length>0?T.trim():e("storage.attach.untitled"),M=m.task_number,W=typeof M=="string"&&M.trim().length>0?M.trim():null,S=[m.changed_at,m.changedAt,m.updatedAt,m.createdAt,m.submission_date].map(y=>{if(y instanceof Date){const I=y.getTime();return Number.isNaN(I)?0:I}if(typeof y=="string"){const I=Date.parse(y);return Number.isNaN(I)?0:I}return typeof y=="number"&&Number.isFinite(y)?y:0}).reduce((y,I)=>I>y?I:y,0),ae=f.slice(-6)||f,Me=W?e("storage.attach.optionNumber",{number:W,title:F}):e("storage.attach.optionId",{id:ae,title:F});return{id:f,label:Me,title:F,number:W,changedAt:S}}).filter(m=>!!m);l.sort((m,f)=>f.changedAt-m.changedAt);const x=l.slice(0,6),h=x.reduce((m,f)=>(m[f.id]=f,m),{});oe(x),le(h)}).catch(()=>{t||(oe([]),le({}),v(e("storage.attach.tasksLoadError"),"error"))}).finally(()=>{t||re(!1)}),()=>{t=!0}},[e]),n.useEffect(()=>{if(!j.length){$(a=>Object.keys(a).length?{}:a);return}const t=new Set(j.map(a=>a.id));$(a=>{let o=!1;const l={};return Object.entries(a).forEach(([x,h])=>{h&&t.has(h)?l[x]=h:h&&(o=!0)}),o?l:a})},[j]),n.useEffect(()=>{const t=r.get("file");Le(t)},[r]),n.useEffect(()=>{if(!w){P(null),J(!1),N(null);return}const t=u.find(a=>a.id===w);if(t){P(t);return}J(!0),rt(w).then(a=>{P(a)}).catch(()=>{v(e("storage.loadError"),"error"),P(null)}).finally(()=>J(!1))},[w,u,e]),n.useEffect(()=>{if(!L){N(null);return}const t=L.type||"application/octet-stream",a=L.previewUrl||"".concat(L.url,"?mode=inline");if(t.startsWith("image/")){N({mode:"image",inlineUrl:a,mime:t});return}if(t.startsWith("video/")){N({mode:"video",inlineUrl:a,mime:t});return}if(t==="application/pdf"){N({mode:"pdf",inlineUrl:a,mime:t});return}if(dt(t)){let o=!1;return N({mode:"text",inlineUrl:a,mime:t,loading:!0}),A(a).then(l=>{if(!l.ok)throw new Error("preview");return l.text()}).then(l=>{o||N({mode:"text",inlineUrl:a,mime:t,content:l})}).catch(()=>{o||N({mode:"text",inlineUrl:a,mime:t,error:e("storage.previewError")})}),()=>{o=!0}}N(null)},[L,e]);const Q=n.useMemo(()=>{const t=C.trim().toLowerCase();return u.filter(a=>t?a.name.toLowerCase().includes(t):!0)},[u,C]),O=n.useMemo(()=>{const t=[...Q];return t.sort((a,o)=>{switch(K){case"uploaded_asc":{const l=Date.parse(a.uploadedAt||""),x=Date.parse(o.uploadedAt||"");return(l||0)-(x||0)}case"uploaded_desc":{const l=Date.parse(a.uploadedAt||"");return(Date.parse(o.uploadedAt||"")||0)-(l||0)}case"size_asc":return(a.size||0)-(o.size||0);case"size_desc":return(o.size||0)-(a.size||0);default:return 0}}),t},[Q,K]),xe=n.useMemo(()=>{const t=V*Z;return O.slice(t,t+Z)},[O,V]),X=n.useMemo(()=>j.map(t=>({value:t.id,label:t.label})),[j]),Y=n.useCallback(t=>{t.url&&(window.open(t.url,"_blank","noopener,noreferrer"),v(e("storage.openedInNewTab"),"success"))},[e]),ee=n.useCallback(t=>{window.confirm(e("storage.deleteConfirm",{name:t.name}))&&ot(t.id).then(o=>{if(!o.ok)throw new Error("delete");if(v(e("storage.deleteSuccess"),"success"),E(l=>l.filter(x=>x.id!==t.id)),w===t.id){const l=new URLSearchParams(r.toString());l.delete("file"),i(l,{replace:!0})}}).catch(()=>{v(e("storage.deleteError"),"error")})},[r,w,i,e]),pe=n.useCallback(t=>{const a=U[t.id];a&&j.some(o=>o.id===a)&&(ie(t.id),he(t.id,a).then(()=>{const o=ne[a];E(l=>l.map(x=>{var h,m,f,T;return x.id===t.id?{...x,taskId:a,taskNumber:(m=(h=o==null?void 0:o.number)!=null?h:x.taskNumber)!=null?m:null,taskTitle:(T=(f=o==null?void 0:o.title)!=null?f:x.taskTitle)!=null?T:null}:x})),w===t.id&&P(l=>{var x,h,m,f;return l&&{...l,taskId:a,taskNumber:(h=(x=o==null?void 0:o.number)!=null?x:l.taskNumber)!=null?h:null,taskTitle:(f=(m=o==null?void 0:o.title)!=null?m:l.taskTitle)!=null?f:null}}),v(e("storage.attach.success"),"success")}).catch(o=>{o.status===403?v(e("storage.attach.forbidden"),"error"):v(e("storage.attach.error"),"error")}).finally(()=>{ie(o=>o===t.id?null:o)}))},[he,U,j,ne,E,w,P,e]),H=n.useCallback(t=>{var se;const a=t.taskId!=null&&t.taskId!=="",o=a?String(t.taskId):void 0,l=typeof t.taskTitle=="string"&&t.taskTitle.trim()?t.taskTitle.trim():void 0,x=a?t.taskNumber&&t.taskNumber!==""?e("storage.taskNumberLabel",{number:t.taskNumber}):e("storage.taskLabel",{id:o}):e("storage.taskMissing"),h=typeof t.userId=="number"?d[t.userId]:void 0,m=typeof(h==null?void 0:h.name)=="string"&&h.name.trim()||typeof(h==null?void 0:h.telegram_username)=="string"&&h.telegram_username.trim()||typeof(h==null?void 0:h.username)=="string"&&h.username.trim()||e("storage.userLabel",{id:t.userId}),f=typeof t.userId=="number"?e("storage.details.userId",{id:t.userId}):e("storage.details.userId",{id:"—"});let T;if(o){const S=new URLSearchParams(r.toString());S.set("task",o),T="?".concat(S.toString())}const F=(se=U[t.id])!=null?se:"",M=j.some(S=>S.id===F),W=M?F:"";return{...t,taskTitle:l,sizeLabel:ct(t.size),uploadedLabel:je(t.uploadedAt),userDisplay:m,userHint:f,taskDisplay:x,taskParam:o,taskLink:T,onDownload:()=>Y(t),onDelete:()=>ee(t),selectedTaskId:W,onTaskSelect:S=>{$(ae=>({...ae,[t.id]:S}))},onAttach:()=>pe(t),attachLoading:G===t.id,attachDisabled:G===t.id||_||!j.length||!M}},[G,pe,ee,Y,r,U,$,e,j,_,d]),Ce=n.useMemo(()=>xe.map(t=>H(t)),[xe,H]),De=n.useMemo(()=>O.length?Math.max(1,Math.ceil(O.length/Z)):1,[O.length]),fe=n.useCallback(t=>{if(!t)return;const a=new URLSearchParams(r.toString());a.set("task",t),i(a,{replace:!1})},[r,i]),Ae=n.useCallback(()=>{const t=new URLSearchParams(r.toString());t.delete("file"),i(t,{replace:!0})},[r,i]),c=n.useMemo(()=>L?H(L):null,[L,H]),Pe=n.useMemo(()=>{if(!c)return[];const t=e("storage.details.empty");return[{key:"task",label:e("storage.details.task"),value:c.taskDisplay},{key:"taskNumber",label:e("storage.details.taskNumber"),value:c.taskNumber||t},{key:"taskId",label:e("storage.details.taskId"),value:c.taskId||t},{key:"taskTitle",label:e("storage.details.taskTitle"),value:c.taskTitle||t},{key:"user",label:e("storage.details.user"),value:s.jsxs("span",{className:"flex flex-col",children:[c.userDisplay,s.jsx("span",{className:"text-xs text-muted-foreground",children:c.userHint})]})},{key:"uploaded",label:e("storage.details.uploaded"),value:c.uploadedLabel||t},{key:"size",label:e("storage.details.size"),value:c.sizeLabel||t},{key:"type",label:e("storage.details.type"),value:c.type||t},{key:"path",label:e("storage.details.path"),value:s.jsx("code",{className:"break-all text-xs",children:c.path})}]},[c,e]),Fe=b?it[b.mode]:null,te=n.useMemo(()=>D?je(D.generatedAt):null,[D]);return s.jsxs("div",{className:"space-y-6",children:[s.jsx(et,{items:[{label:e("storage.title")}]}),s.jsxs("section",{className:"rounded border border-amber-300 bg-amber-50 p-5 shadow-sm",children:[s.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("h2",{className:"text-base font-semibold text-amber-900",children:e("storage.diagnostics.title")}),s.jsx("p",{className:"text-sm text-amber-800",children:e("storage.diagnostics.description")}),s.jsx("p",{className:"text-sm text-amber-900",children:ge===0?e("storage.sync.ok",{count:u.length}):e("storage.sync.warning",{count:ge})})]}),s.jsx(z,{type:"button",variant:"outline",className:"self-start border-amber-400 text-amber-900 hover:bg-amber-100",disabled:de,onClick:()=>{Ee()},children:e(de?"storage.diagnostics.progress":"storage.diagnostics.cta")})]}),ue?s.jsx("p",{className:"mt-3 text-sm text-red-700",children:ue}):null,D?s.jsxs("div",{className:"mt-3 space-y-1 text-sm text-amber-900",children:[s.jsx("p",{children:e("storage.diagnostics.lastRun",{date:te!=null?te:"—"})}),s.jsx("p",{children:e("storage.diagnostics.snapshot",{total:D.snapshot.totalFiles,linked:D.snapshot.linkedFiles,detached:D.snapshot.detachedFiles})})]}):s.jsx("p",{className:"mt-3 text-sm text-amber-800",children:e("storage.diagnostics.placeholder")})]}),s.jsxs("section",{className:"space-y-5 rounded border border-border bg-card p-5 shadow-sm",children:[s.jsxs("header",{className:"flex flex-col gap-4 border-b border-border pb-4",children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("h2",{className:"text-lg font-semibold text-foreground",children:e("storage.title")}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e("storage.total",{count:Q.length})})]}),s.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx(Ue,{value:C,onChange:t=>{Ne(t.target.value),q(0)},placeholder:(be=e("storage.searchPlaceholder"))!=null?be:"",className:"max-w-xs"}),s.jsxs("select",{value:K,onChange:t=>{Te(t.target.value),q(0)},className:"h-9 rounded-md border border-input bg-background px-2 text-sm",children:[s.jsx("option",{value:"uploaded_desc",children:e("storage.sort.uploadedDesc")}),s.jsx("option",{value:"uploaded_asc",children:e("storage.sort.uploadedAsc")}),s.jsx("option",{value:"size_desc",children:e("storage.sort.sizeDesc")}),s.jsx("option",{value:"size_asc",children:e("storage.sort.sizeAsc")})]}),s.jsx(z,{type:"button",variant:"secondary",onClick:()=>void B(),disabled:R,children:e("storage.refresh")})]}),s.jsx("div",{className:"text-xs text-muted-foreground md:text-sm",children:R?e("loading"):null})]})]}),s.jsx(Re,{columns:st({name:e("storage.columns.name"),user:e("storage.columns.user"),type:e("storage.columns.type"),size:e("storage.columns.size"),task:e("storage.columns.task"),uploaded:e("storage.columns.uploaded"),download:e("storage.download"),delete:e("storage.delete"),taskTitleHint:t=>e("storage.taskTitleHint",{title:t}),attachTitle:e("storage.attach.title"),attachPlaceholder:e("storage.attach.placeholder"),attachAction:e("storage.attach.button"),attachProcessing:e("storage.attach.processing"),attachEmpty:e("storage.attach.empty"),attachLoading:e("storage.attach.loading")},{onTaskOpen:fe,taskOptions:X,tasksLoading:_}),data:Ce,pageIndex:V,pageSize:Z,pageCount:De,onPageChange:q,showGlobalSearch:!1,showFilters:!1,wrapCellsAsBadges:!0,onRowClick:t=>{const a=new URLSearchParams(r.toString());a.set("file",t.id),i(a,{replace:!1})}})]}),s.jsx(Be,{open:!!w,onClose:Ae,children:Se?s.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:e("loading")}):c?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("header",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold",children:c.name}),s.jsx("p",{className:"text-sm text-muted-foreground",children:c.type||e("storage.details.type")})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsxs(z,{type:"button",variant:"outline",onClick:()=>Y(c),children:[s.jsx(ye,{className:"mr-2 size-4"}),e("storage.download")]}),s.jsxs(z,{type:"button",variant:"destructive",onClick:()=>ee(c),children:[s.jsx(we,{className:"mr-2 size-4"}),e("storage.delete")]})]})]}),b?s.jsxs("div",{className:"space-y-2 rounded-lg border border-dashed border-border p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[Fe?s.jsx("previewIcon",{className:"size-5"}):null,s.jsx("span",{children:e("storage.previewTitle")}),s.jsx("span",{className:"text-xs text-muted-foreground",children:e("storage.mimeLabel",{mime:b.mime})})]}),b.mode==="image"?s.jsx("img",{src:b.inlineUrl,alt:c.name,className:"max-h-[300px] w-full rounded-md object-contain"}):b.mode==="video"?s.jsx("video",{controls:!0,src:b.inlineUrl,className:"max-h-[320px] w-full rounded-md"}):b.mode==="pdf"?s.jsx("iframe",{title:c.name,src:b.inlineUrl,className:"h-[320px] w-full rounded-md"}):b.mode==="text"?b.loading?s.jsx("div",{className:"text-sm text-muted-foreground",children:e("storage.previewLoading")}):b.error?s.jsx("div",{className:"text-sm text-red-500",children:b.error}):s.jsx("pre",{className:"max-h-[320px] overflow-auto rounded bg-muted p-3 text-xs",children:b.content}):null]}):null,s.jsxs("section",{className:"space-y-3",children:[s.jsx("h3",{className:"text-sm font-semibold",children:e("storage.attach.title")}),s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[s.jsxs("select",{value:c.selectedTaskId,onChange:t=>c.onTaskSelect(t.target.value),disabled:c.attachLoading||_,className:"h-9 min-w-[12rem] rounded-md border border-input bg-background px-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",children:[s.jsx("option",{value:"",children:e("storage.attach.placeholder")}),X.map(t=>s.jsx("option",{value:t.value,children:t.label},t.value))]}),s.jsx(z,{type:"button",onClick:()=>c.onAttach(),disabled:c.attachDisabled,children:c.attachLoading?e("storage.attach.processing"):e("storage.attach.button")})]}),_?s.jsx("p",{className:"text-xs text-muted-foreground",children:e("storage.attach.loading")}):X.length===0?s.jsx("p",{className:"text-xs text-muted-foreground",children:e("storage.attach.empty")}):null]}),s.jsxs("section",{className:"space-y-2",children:[s.jsx("h3",{className:"text-sm font-semibold",children:e("storage.details.title")}),s.jsx("dl",{className:"grid gap-2 sm:grid-cols-2",children:Pe.map(t=>s.jsxs("div",{className:"rounded-md border border-border p-3 text-sm",children:[s.jsx("dt",{className:"text-xs font-semibold uppercase text-muted-foreground",children:t.label}),s.jsx("dd",{className:"mt-1 text-sm",children:t.value})]},t.key))}),c.taskId?s.jsx(z,{type:"button",variant:"ghost",onClick:()=>fe(c.taskId),children:e("storage.details.openTask")}):null]})]}):s.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:e("storage.loadError")})})]})}const vt=Object.freeze(Object.defineProperty({__proto__:null,default:ut},Symbol.toStringTag,{value:"Module"}));export{et as B,qe as F,ut as S,vt as a};
//# sourceMappingURL=Storage-97xpzoFZ.js.map
