!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}var t=["title","titleId"],r=["title","titleId"],n=["title","titleId"],a=["title","titleId"],o=["title","titleId"];function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){l(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function l(t,r,n){return(r=function(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,r||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==e(r)?r:r+""}(r))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function c(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],l=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(c)throw a}}return s}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return f(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function m(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,n,a,o){var l=n&&n.prototype instanceof s?n:s,c=Object.create(l.prototype);return b(c,"_invoke",function(r,n,a){var o,s,l,c=0,u=a||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,r){return o=t,s=0,l=e,f.n=r,i}};function m(r,n){for(s=r,l=n,t=0;!d&&c&&!a&&t<u.length;t++){var a,o=u[t],m=f.p,b=o[2];r>3?(a=b===n)&&(l=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=m&&((a=r<2&&m<o[1])?(s=0,f.v=n,f.n=o[1]):m<b&&(a=r<3||o[0]>n||n>b)&&(o[4]=r,o[5]=n,f.n=b,s=0))}if(a||r>1)return i;throw d=!0,n}return function(a,u,b){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,b),s=u,l=b;(t=s<2?e:l)||!d;){o||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(c=2,o){if(s||(a="next"),t=o[a]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=o.return)&&t.call(o),s<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),s=1);o=e}else if((t=(d=f.n<0)?l:r.call(n,f))!==i)break}catch(t){o=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(r,a,o),!0),c}var i={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][n]?t(t([][n]())):(b(t={},n,function(){return this}),t),d=c.prototype=s.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,b(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=c,b(d,"constructor",c),b(c,"constructor",l),l.displayName="GeneratorFunction",b(c,a,"GeneratorFunction"),b(d),b(d,a,"Generator"),b(d,n,function(){return this}),b(d,"toString",function(){return"[object Generator]"}),(m=function(){return{w:o,m:f}})()}function b(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}b=function(e,t,r,n){function o(t,r){b(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},b(e,t,r,n)}function h(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function p(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){h(o,n,a,i,s,"next",e)}function s(e){h(o,n,a,i,s,"throw",e)}i(void 0)})}}function g(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}System.register(["./index-legacy-Cw3EU-FN.js","./vendor-legacy-3V6tX1hl.js","./DataTable-legacy-BVxdFFVf.js","./App-legacy-92jDSsGS.js","./input-legacy-DL0_TS5-.js","./EmployeeLink-legacy-Bb5L4nbd.js","./users-legacy-Cx1ejVXG.js","./PhotoIcon-legacy-Dlb_tfgz.js"],function(e,i){"use strict";var d,f,b,h,x,v,y,k,j,w,N,S,I,O,E,L;return{setters:[function(e){d=e.j},function(e){f=e.b,b=e.R,h=e.i},function(e){x=e.default},function(e){v=e.h,y=e.b,k=e.s,j=e.B,w=e.M,N=e.P,S=e.o},function(e){I=e.I},function(e){O=e.E},function(e){E=e.f},function(e){L=e.F}],execute:function(){function i(e,r){var n=e.title,a=e.titleId,o=g(e,t);return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},o),n?f.createElement("title",{id:a},n):null,f.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"}))}e({B:W,S:Q});var T=f.forwardRef(i);function P(e,t){var n=e.title,a=e.titleId,o=g(e,r);return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},o),n?f.createElement("title",{id:a},n):null,f.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}var A=e("F",f.forwardRef(P));function C(e,t){var r=e.title,a=e.titleId,o=g(e,n);return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},o),r?f.createElement("title",{id:a},r):null,f.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}var D=f.forwardRef(C);function _(e,t){var r=e.title,n=e.titleId,o=g(e,a);return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},o),r?f.createElement("title",{id:n},r):null,f.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}var z=f.forwardRef(_);function M(e,t){var r=e.title,n=e.titleId,a=g(e,o);return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?f.createElement("title",{id:n},r):null,f.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"}))}var U=f.forwardRef(M);function W(e){var t=e.items;return d.jsx("nav",{className:"text-body mb-4 text-sm",children:d.jsx("ol",{className:"list-reset flex",children:t.map(function(e,t){return d.jsxs(b.Fragment,{children:[t>0&&d.jsx("li",{children:d.jsx("span",{className:"text-body px-2",children:"/"})}),d.jsx("li",{children:e.href?d.jsx("a",{href:e.href,className:"text-primary hover:underline",children:e.label}):d.jsx("span",{className:"text-bodydark",children:e.label})})]},t)})})})}var R=["inline-flex max-w-full items-center gap-1","rounded-full border border-blue-200 bg-blue-50 px-2 py-0.5 text-xs font-semibold text-blue-700 shadow-xs","transition-colors duration-150 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2","dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100"].join(" ");function B(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.onTaskOpen,a=null!==(t=r.taskOptions)&&void 0!==t?t:[],o=Boolean(r.tasksLoading);return[{header:e.name,accessorKey:"name",meta:{minWidth:"12rem",maxWidth:"20rem",renderAsBadges:!1},cell:function(t){var r=t.row.original;return d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between gap-3",children:[d.jsx("span",{className:"truncate font-medium",title:r.name,children:r.name}),d.jsxs("div",{className:"flex flex-shrink-0 items-center gap-1",children:[d.jsxs("button",{type:"button",onClick:function(e){e.stopPropagation(),r.onDownload()},className:"inline-flex items-center rounded border border-blue-200 bg-blue-50 px-2 py-1 text-xs text-blue-700 hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100","aria-label":e.download,children:[d.jsx(T,{className:"mr-1 size-4","aria-hidden":!0}),e.download]}),d.jsxs("button",{type:"button",onClick:function(e){e.stopPropagation(),r.onDelete()},className:"inline-flex items-center rounded border border-red-200 bg-red-50 px-2 py-1 text-xs text-red-700 hover:bg-red-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500 dark:border-red-500/30 dark:bg-red-500/10 dark:text-red-100","aria-label":e.delete,children:[d.jsx(z,{className:"mr-1 size-4","aria-hidden":!0}),e.delete]})]})]}),d.jsxs("div",{className:"space-y-2 rounded-md border border-border/60 bg-muted/40 p-3 text-xs",children:[d.jsx("span",{className:"block font-semibold uppercase tracking-wide text-muted-foreground",children:e.attachTitle}),d.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[d.jsxs("select",{value:r.selectedTaskId,onChange:function(e){e.stopPropagation(),r.onTaskSelect(e.target.value)},disabled:r.attachLoading||o,className:"h-9 min-w-[12rem] rounded-md border border-input bg-background px-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",children:[d.jsx("option",{value:"",children:e.attachPlaceholder}),a.map(function(e){return d.jsx("option",{value:e.value,children:e.label},e.value)})]}),d.jsx("button",{type:"button",onClick:function(e){e.stopPropagation(),r.onAttach()},className:"inline-flex items-center justify-center rounded-md border border-blue-200 bg-blue-600 px-3 py-1.5 text-xs font-semibold text-white transition hover:bg-blue-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:border-border disabled:bg-muted disabled:text-muted-foreground",disabled:r.attachDisabled,children:r.attachLoading?e.attachProcessing:e.attachAction})]}),o?d.jsx("span",{className:"block text-muted-foreground",children:e.attachLoading}):0===a.length?d.jsx("span",{className:"block text-muted-foreground",children:e.attachEmpty}):null]})]})}},{header:e.user,accessorKey:"userDisplay",meta:{minWidth:"8rem",maxWidth:"12rem",renderAsBadges:!1},cell:function(e){var t=e.row.original,r=t.userDisplay;return t.userId?d.jsx(O,{employeeId:t.userId,stopPropagation:!0,className:R,title:t.userHint,children:d.jsx("span",{className:"truncate",children:r})}):d.jsx("span",{className:"truncate text-sm",title:t.userHint,children:r})}},{header:e.type,accessorKey:"type",meta:{minWidth:"8rem",maxWidth:"10rem"},cell:function(e){return e.row.original.type||""}},{header:e.size,accessorKey:"sizeLabel",meta:{minWidth:"6rem",maxWidth:"8rem"},cell:function(e){return e.row.original.sizeLabel}},{header:e.task,accessorKey:"taskDisplay",meta:{minWidth:"10rem",maxWidth:"16rem",renderAsBadges:!1},cell:function(t){var r=t.row.original,a=d.jsxs("span",{className:"block",children:[r.taskDisplay,r.taskTitle?d.jsx("span",{className:"block text-xs text-muted-foreground",children:r.taskTitle}):null]});return r.taskParam?n?d.jsx("button",{type:"button",onClick:function(e){e.stopPropagation(),n(r.taskParam)},className:"inline-flex w-full flex-col items-start gap-0.5 rounded-lg border border-blue-200 bg-blue-50 px-2 py-1 text-left text-xs font-semibold text-blue-700 transition hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100",title:r.taskTitle?e.taskTitleHint(r.taskTitle):void 0,children:a}):r.taskLink?d.jsx("a",{href:r.taskLink,className:"inline-flex w-full flex-col items-start gap-0.5 rounded-lg border border-blue-200 bg-blue-50 px-2 py-1 text-left text-xs font-semibold text-blue-700 no-underline transition hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100",onClick:function(e){return e.stopPropagation()},title:r.taskTitle?e.taskTitleHint(r.taskTitle):void 0,children:a}):a:a}},{header:e.uploaded,accessorKey:"uploadedLabel",meta:{minWidth:"10rem",maxWidth:"12rem"},cell:function(e){return e.row.original.uploadedLabel}}]}var H=function(e){var t=new URLSearchParams;null!=e&&e.userId&&t.set("userId",String(e.userId)),null!=e&&e.type&&t.set("type",e.type);var r="/api/v1/storage".concat(t.toString()?"?".concat(t):"");return v(r).then(function(e){return e.ok?e.json():[]})},F=function(e){return v("/api/v1/storage/".concat(encodeURIComponent(e))).then(function(e){return e.ok?e.json():Promise.reject(e)})},G=function(e){return v("/api/v1/storage/".concat(encodeURIComponent(e)),{method:"DELETE"})},K=function(){var e=p(m().m(function e(){var t;return m().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,v("/api/v1/storage/diagnostics");case 1:if((t=e.v).ok){e.n=2;break}throw new Error("diagnostics");case 2:return e.n=3,t.json();case 3:return e.a(2,e.v)}},e)}));return function(){return e.apply(this,arguments)}}(),V=25,Z=new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:S}),q={image:L,video:U,pdf:D,text:A};function J(e){if(!e||Number.isNaN(e))return"—";if(e<=0)return"0 Б";var t=["Б","КБ","МБ","ГБ","ТБ"],r=Math.min(Math.floor(Math.log(e)/Math.log(1024)),t.length-1),n=e/Math.pow(1024,r);return"".concat(n.toFixed(n>=10||0===r?0:1)," ").concat(t[r])}function $(e){if(!e)return"—";var t=Date.parse(e);if(Number.isNaN(t))return"—";var r=Z.format(new Date(t)).replace(", "," ");return"".concat(r," ").concat(N)}function Q(){var e,t=y().t,r=u(h(),2),n=r[0],a=r[1],o=u(b.useState([]),2),i=o[0],f=o[1],g=u(b.useState(!1),2),N=g[0],S=g[1],O=u(b.useState({}),2),L=O[0],P=O[1],A=u(b.useState(""),2),C=A[0],D=A[1],_=u(b.useState("uploaded_desc"),2),M=_[0],U=_[1],R=u(b.useState(0),2),Z=R[0],Q=R[1],X=u(b.useState(n.get("file")),2),Y=X[0],ee=X[1],te=u(b.useState(null),2),re=te[0],ne=te[1],ae=u(b.useState(!1),2),oe=ae[0],ie=ae[1],se=u(b.useState(null),2),le=se[0],ce=se[1],ue=u(b.useState(!1),2),de=ue[0],fe=ue[1],me=u(b.useState([]),2),be=me[0],he=me[1],pe=u(b.useState({}),2),ge=pe[0],xe=pe[1],ve=u(b.useState({}),2),ye=ve[0],ke=ve[1],je=u(b.useState(null),2),we=je[0],Ne=je[1],Se=u(b.useState(null),2),Ie=Se[0],Oe=Se[1],Ee=u(b.useState(!1),2),Le=Ee[0],Te=Ee[1],Pe=u(b.useState(null),2),Ae=Pe[0],Ce=Pe[1],De=b.useCallback(function(){var e=p(m().m(function e(t,r){var n,a;return m().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,v("/api/v1/files/".concat(encodeURIComponent(t),"/attach"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskId:r})});case 1:if((n=e.v).ok){e.n=2;break}throw(a=new Error("attach")).status=n.status,a;case 2:return e.n=3,n.json().catch(function(){return{}});case 3:return e.a(2)}},e)}));return function(t,r){return e.apply(this,arguments)}}(),[]),_e=b.useCallback(function(){return S(!0),H().then(function(e){f(Array.isArray(e)?e:[])}).catch(function(){k(t("storage.loadError"),"error")}).finally(function(){return S(!1)})},[t]),ze=b.useMemo(function(){return i.filter(function(e){return!e.taskId}).length},[i]),Me=b.useCallback(function(){return Te(!0),Ce(null),K().then(function(e){return Oe(e),k(t("storage.diagnostics.success"),"success"),_e()}).catch(function(){Ce(t("storage.diagnostics.error")),k(t("storage.diagnostics.error"),"error")}).finally(function(){Te(!1)})},[_e,t]);b.useEffect(function(){_e()},[_e]),b.useEffect(function(){var e=!0;return E().then(function(t){if(e){var r={};t.forEach(function(e){"number"==typeof e.telegram_id&&(r[e.telegram_id]=e)}),P(r)}}).catch(function(){k(t("storage.usersLoadError"),"error")}),function(){e=!1}},[t]),b.useEffect(function(){var e=!1;return fe(!0),v("/api/v1/tasks/mentioned").then(function(e){return e.ok?e.json():[]}).then(function(r){if(!e){var n=(Array.isArray(r)?r:[]).map(function(e){var r,n,a="string"==typeof e._id?(null!==(r=e._id)&&void 0!==r?r:"").trim():"string"==typeof e.id?(null!==(n=e.id)&&void 0!==n?n:"").trim():"";if(!a)return null;var o=e.title,i="string"==typeof o&&o.trim().length>0?o.trim():t("storage.attach.untitled"),s=e.task_number,l="string"==typeof s&&s.trim().length>0?s.trim():null,c=[e.changed_at,e.changedAt,e.updatedAt,e.createdAt,e.submission_date].map(function(e){if(e instanceof Date){var t=e.getTime();return Number.isNaN(t)?0:t}if("string"==typeof e){var r=Date.parse(e);return Number.isNaN(r)?0:r}return"number"==typeof e&&Number.isFinite(e)?e:0}).reduce(function(e,t){return t>e?t:e},0),u=a.slice(-6)||a;return{id:a,label:l?t("storage.attach.optionNumber",{number:l,title:i}):t("storage.attach.optionId",{id:u,title:i}),title:i,number:l,changedAt:c}}).filter(function(e){return Boolean(e)});n.sort(function(e,t){return t.changedAt-e.changedAt});var a=n.slice(0,6),o=a.reduce(function(e,t){return e[t.id]=t,e},{});he(a),xe(o)}}).catch(function(){e||(he([]),xe({}),k(t("storage.attach.tasksLoadError"),"error"))}).finally(function(){e||fe(!1)}),function(){e=!0}},[t]),b.useEffect(function(){if(be.length){var e=new Set(be.map(function(e){return e.id}));ke(function(t){var r=!1,n={};return Object.entries(t).forEach(function(t){var a=u(t,2),o=a[0],i=a[1];i&&e.has(i)?n[o]=i:i&&(r=!0)}),r?n:t})}else ke(function(e){return Object.keys(e).length?{}:e})},[be]),b.useEffect(function(){var e=n.get("file");ee(e)},[n]),b.useEffect(function(){if(!Y)return ne(null),ie(!1),void ce(null);var e=i.find(function(e){return e.id===Y});e?ne(e):(ie(!0),F(Y).then(function(e){ne(e)}).catch(function(){k(t("storage.loadError"),"error"),ne(null)}).finally(function(){return ie(!1)}))},[Y,i,t]),b.useEffect(function(){if(re){var e=re.type||"application/octet-stream",r=re.previewUrl||"".concat(re.url,"?mode=inline");if(e.startsWith("image/"))ce({mode:"image",inlineUrl:r,mime:e});else if(e.startsWith("video/"))ce({mode:"video",inlineUrl:r,mime:e});else if("application/pdf"!==e){if(function(e){return e.startsWith("text/")||e.includes("json")||e.endsWith("xml")||"application/sql"===e}(e)){var n=!1;return ce({mode:"text",inlineUrl:r,mime:e,loading:!0}),v(r).then(function(e){if(!e.ok)throw new Error("preview");return e.text()}).then(function(t){n||ce({mode:"text",inlineUrl:r,mime:e,content:t})}).catch(function(){n||ce({mode:"text",inlineUrl:r,mime:e,error:t("storage.previewError")})}),function(){n=!0}}ce(null)}else ce({mode:"pdf",inlineUrl:r,mime:e})}else ce(null)},[re,t]);var Ue=b.useMemo(function(){var e=C.trim().toLowerCase();return i.filter(function(t){return!e||t.name.toLowerCase().includes(e)})},[i,C]),We=b.useMemo(function(){var e=c(Ue);return e.sort(function(e,t){switch(M){case"uploaded_asc":return(Date.parse(e.uploadedAt||"")||0)-(Date.parse(t.uploadedAt||"")||0);case"uploaded_desc":var r=Date.parse(e.uploadedAt||"");return(Date.parse(t.uploadedAt||"")||0)-(r||0);case"size_asc":return(e.size||0)-(t.size||0);case"size_desc":return(t.size||0)-(e.size||0);default:return 0}}),e},[Ue,M]),Re=b.useMemo(function(){var e=Z*V;return We.slice(e,e+V)},[We,Z]),Be=b.useMemo(function(){return be.map(function(e){return{value:e.id,label:e.label}})},[be]),He=b.useCallback(function(e){e.url&&(window.open(e.url,"_blank","noopener,noreferrer"),k(t("storage.openedInNewTab"),"success"))},[t]),Fe=b.useCallback(function(e){window.confirm(t("storage.deleteConfirm",{name:e.name}))&&G(e.id).then(function(r){if(!r.ok)throw new Error("delete");if(k(t("storage.deleteSuccess"),"success"),f(function(t){return t.filter(function(t){return t.id!==e.id})}),Y===e.id){var o=new URLSearchParams(n.toString());o.delete("file"),a(o,{replace:!0})}}).catch(function(){k(t("storage.deleteError"),"error")})},[n,Y,a,t]),Ge=b.useCallback(function(e){var r=ye[e.id];r&&be.some(function(e){return e.id===r})&&(Ne(e.id),De(e.id,r).then(function(){var n=ge[r];f(function(t){return t.map(function(t){var a,o,i,l;return t.id===e.id?s(s({},t),{},{taskId:r,taskNumber:null!==(a=null!==(o=null==n?void 0:n.number)&&void 0!==o?o:t.taskNumber)&&void 0!==a?a:null,taskTitle:null!==(i=null!==(l=null==n?void 0:n.title)&&void 0!==l?l:t.taskTitle)&&void 0!==i?i:null}):t})}),Y===e.id&&ne(function(e){var t,a,o,i;return e?s(s({},e),{},{taskId:r,taskNumber:null!==(t=null!==(a=null==n?void 0:n.number)&&void 0!==a?a:e.taskNumber)&&void 0!==t?t:null,taskTitle:null!==(o=null!==(i=null==n?void 0:n.title)&&void 0!==i?i:e.taskTitle)&&void 0!==o?o:null}):e}),k(t("storage.attach.success"),"success")}).catch(function(e){var r=e.status;k(t(403===r?"storage.attach.forbidden":"storage.attach.error"),"error")}).finally(function(){Ne(function(t){return t===e.id?null:t})}))},[De,ye,be,ge,f,Y,ne,t]),Ke=b.useCallback(function(e){var r,a,o=null!=e.taskId&&""!==e.taskId,i=o?String(e.taskId):void 0,c="string"==typeof e.taskTitle&&e.taskTitle.trim()?e.taskTitle.trim():void 0,u=o?e.taskNumber&&""!==e.taskNumber?t("storage.taskNumberLabel",{number:e.taskNumber}):t("storage.taskLabel",{id:i}):t("storage.taskMissing"),d="number"==typeof e.userId?L[e.userId]:void 0,f="string"==typeof(null==d?void 0:d.name)&&d.name.trim()||"string"==typeof(null==d?void 0:d.telegram_username)&&d.telegram_username.trim()||"string"==typeof(null==d?void 0:d.username)&&d.username.trim()||t("storage.userLabel",{id:e.userId}),m="number"==typeof e.userId?t("storage.details.userId",{id:e.userId}):t("storage.details.userId",{id:"—"});if(i){var b=new URLSearchParams(n.toString());b.set("task",i),a="?".concat(b.toString())}var h=null!==(r=ye[e.id])&&void 0!==r?r:"",p=be.some(function(e){return e.id===h}),g=p?h:"";return s(s({},e),{},{taskTitle:c,sizeLabel:J(e.size),uploadedLabel:$(e.uploadedAt),userDisplay:f,userHint:m,taskDisplay:u,taskParam:i,taskLink:a,onDownload:function(){return He(e)},onDelete:function(){return Fe(e)},selectedTaskId:g,onTaskSelect:function(t){ke(function(r){return s(s({},r),{},l({},e.id,t))})},onAttach:function(){return Ge(e)},attachLoading:we===e.id,attachDisabled:we===e.id||de||!be.length||!p})},[we,Ge,Fe,He,n,ye,ke,t,be,de,L]),Ve=b.useMemo(function(){return Re.map(function(e){return Ke(e)})},[Re,Ke]),Ze=b.useMemo(function(){return We.length?Math.max(1,Math.ceil(We.length/V)):1},[We.length]),qe=b.useCallback(function(e){if(e){var t=new URLSearchParams(n.toString());t.set("task",e),a(t,{replace:!1})}},[n,a]),Je=b.useCallback(function(){var e=new URLSearchParams(n.toString());e.delete("file"),a(e,{replace:!0})},[n,a]),$e=b.useMemo(function(){return re?Ke(re):null},[re,Ke]),Qe=b.useMemo(function(){if(!$e)return[];var e=t("storage.details.empty");return[{key:"task",label:t("storage.details.task"),value:$e.taskDisplay},{key:"taskNumber",label:t("storage.details.taskNumber"),value:$e.taskNumber||e},{key:"taskId",label:t("storage.details.taskId"),value:$e.taskId||e},{key:"taskTitle",label:t("storage.details.taskTitle"),value:$e.taskTitle||e},{key:"user",label:t("storage.details.user"),value:d.jsxs("span",{className:"flex flex-col",children:[$e.userDisplay,d.jsx("span",{className:"text-xs text-muted-foreground",children:$e.userHint})]})},{key:"uploaded",label:t("storage.details.uploaded"),value:$e.uploadedLabel||e},{key:"size",label:t("storage.details.size"),value:$e.sizeLabel||e},{key:"type",label:t("storage.details.type"),value:$e.type||e},{key:"path",label:t("storage.details.path"),value:d.jsx("code",{className:"break-all text-xs",children:$e.path})}]},[$e,t]),Xe=le?q[le.mode]:null,Ye=b.useMemo(function(){return Ie?$(Ie.generatedAt):null},[Ie]);return d.jsxs("div",{className:"space-y-6",children:[d.jsx(W,{items:[{label:t("storage.title")}]}),d.jsxs("section",{className:"rounded border border-amber-300 bg-amber-50 p-5 shadow-sm",children:[d.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("h2",{className:"text-base font-semibold text-amber-900",children:t("storage.diagnostics.title")}),d.jsx("p",{className:"text-sm text-amber-800",children:t("storage.diagnostics.description")}),d.jsx("p",{className:"text-sm text-amber-900",children:0===ze?t("storage.sync.ok",{count:i.length}):t("storage.sync.warning",{count:ze})})]}),d.jsx(j,{type:"button",variant:"outline",className:"self-start border-amber-400 text-amber-900 hover:bg-amber-100",disabled:Le,onClick:function(){Me()},children:t(Le?"storage.diagnostics.progress":"storage.diagnostics.cta")})]}),Ae?d.jsx("p",{className:"mt-3 text-sm text-red-700",children:Ae}):null,Ie?d.jsxs("div",{className:"mt-3 space-y-1 text-sm text-amber-900",children:[d.jsx("p",{children:t("storage.diagnostics.lastRun",{date:null!=Ye?Ye:"—"})}),d.jsx("p",{children:t("storage.diagnostics.snapshot",{total:Ie.snapshot.totalFiles,linked:Ie.snapshot.linkedFiles,detached:Ie.snapshot.detachedFiles})})]}):d.jsx("p",{className:"mt-3 text-sm text-amber-800",children:t("storage.diagnostics.placeholder")})]}),d.jsxs("section",{className:"space-y-5 rounded border border-border bg-card p-5 shadow-sm",children:[d.jsxs("header",{className:"flex flex-col gap-4 border-b border-border pb-4",children:[d.jsxs("div",{className:"flex flex-col gap-1",children:[d.jsx("h2",{className:"text-lg font-semibold text-foreground",children:t("storage.title")}),d.jsx("p",{className:"text-sm text-muted-foreground",children:t("storage.total",{count:Ue.length})})]}),d.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[d.jsx(I,{value:C,onChange:function(e){D(e.target.value),Q(0)},placeholder:null!==(e=t("storage.searchPlaceholder"))&&void 0!==e?e:"",className:"max-w-xs"}),d.jsxs("select",{value:M,onChange:function(e){U(e.target.value),Q(0)},className:"h-9 rounded-md border border-input bg-background px-2 text-sm",children:[d.jsx("option",{value:"uploaded_desc",children:t("storage.sort.uploadedDesc")}),d.jsx("option",{value:"uploaded_asc",children:t("storage.sort.uploadedAsc")}),d.jsx("option",{value:"size_desc",children:t("storage.sort.sizeDesc")}),d.jsx("option",{value:"size_asc",children:t("storage.sort.sizeAsc")})]}),d.jsx(j,{type:"button",variant:"secondary",onClick:function(){_e()},disabled:N,children:t("storage.refresh")})]}),d.jsx("div",{className:"text-xs text-muted-foreground md:text-sm",children:N?t("loading"):null})]})]}),d.jsx(x,{columns:B({name:t("storage.columns.name"),user:t("storage.columns.user"),type:t("storage.columns.type"),size:t("storage.columns.size"),task:t("storage.columns.task"),uploaded:t("storage.columns.uploaded"),download:t("storage.download"),delete:t("storage.delete"),taskTitleHint:function(e){return t("storage.taskTitleHint",{title:e})},attachTitle:t("storage.attach.title"),attachPlaceholder:t("storage.attach.placeholder"),attachAction:t("storage.attach.button"),attachProcessing:t("storage.attach.processing"),attachEmpty:t("storage.attach.empty"),attachLoading:t("storage.attach.loading")},{onTaskOpen:qe,taskOptions:Be,tasksLoading:de}),data:Ve,pageIndex:Z,pageSize:V,pageCount:Ze,onPageChange:Q,showGlobalSearch:!1,showFilters:!1,wrapCellsAsBadges:!0,onRowClick:function(e){var t=new URLSearchParams(n.toString());t.set("file",e.id),a(t,{replace:!1})}})]}),d.jsx(w,{open:Boolean(Y),onClose:Je,children:oe?d.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:t("loading")}):$e?d.jsxs("div",{className:"space-y-4",children:[d.jsxs("header",{className:"flex items-start justify-between gap-4",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-lg font-semibold",children:$e.name}),d.jsx("p",{className:"text-sm text-muted-foreground",children:$e.type||t("storage.details.type")})]}),d.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[d.jsxs(j,{type:"button",variant:"outline",onClick:function(){return He($e)},children:[d.jsx(T,{className:"mr-2 size-4"}),t("storage.download")]}),d.jsxs(j,{type:"button",variant:"destructive",onClick:function(){return Fe($e)},children:[d.jsx(z,{className:"mr-2 size-4"}),t("storage.delete")]})]})]}),le?d.jsxs("div",{className:"space-y-2 rounded-lg border border-dashed border-border p-4",children:[d.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[Xe?d.jsx("previewIcon",{className:"size-5"}):null,d.jsx("span",{children:t("storage.previewTitle")}),d.jsx("span",{className:"text-xs text-muted-foreground",children:t("storage.mimeLabel",{mime:le.mime})})]}),"image"===le.mode?d.jsx("img",{src:le.inlineUrl,alt:$e.name,className:"max-h-[300px] w-full rounded-md object-contain"}):"video"===le.mode?d.jsx("video",{controls:!0,src:le.inlineUrl,className:"max-h-[320px] w-full rounded-md"}):"pdf"===le.mode?d.jsx("iframe",{title:$e.name,src:le.inlineUrl,className:"h-[320px] w-full rounded-md"}):"text"===le.mode?le.loading?d.jsx("div",{className:"text-sm text-muted-foreground",children:t("storage.previewLoading")}):le.error?d.jsx("div",{className:"text-sm text-red-500",children:le.error}):d.jsx("pre",{className:"max-h-[320px] overflow-auto rounded bg-muted p-3 text-xs",children:le.content}):null]}):null,d.jsxs("section",{className:"space-y-3",children:[d.jsx("h3",{className:"text-sm font-semibold",children:t("storage.attach.title")}),d.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[d.jsxs("select",{value:$e.selectedTaskId,onChange:function(e){return $e.onTaskSelect(e.target.value)},disabled:$e.attachLoading||de,className:"h-9 min-w-[12rem] rounded-md border border-input bg-background px-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",children:[d.jsx("option",{value:"",children:t("storage.attach.placeholder")}),Be.map(function(e){return d.jsx("option",{value:e.value,children:e.label},e.value)})]}),d.jsx(j,{type:"button",onClick:function(){return $e.onAttach()},disabled:$e.attachDisabled,children:$e.attachLoading?t("storage.attach.processing"):t("storage.attach.button")})]}),de?d.jsx("p",{className:"text-xs text-muted-foreground",children:t("storage.attach.loading")}):0===Be.length?d.jsx("p",{className:"text-xs text-muted-foreground",children:t("storage.attach.empty")}):null]}),d.jsxs("section",{className:"space-y-2",children:[d.jsx("h3",{className:"text-sm font-semibold",children:t("storage.details.title")}),d.jsx("dl",{className:"grid gap-2 sm:grid-cols-2",children:Qe.map(function(e){return d.jsxs("div",{className:"rounded-md border border-border p-3 text-sm",children:[d.jsx("dt",{className:"text-xs font-semibold uppercase text-muted-foreground",children:e.label}),d.jsx("dd",{className:"mt-1 text-sm",children:e.value})]},e.key)})}),$e.taskId?d.jsx(j,{type:"button",variant:"ghost",onClick:function(){return qe($e.taskId)},children:t("storage.details.openTask")}):null]})]}):d.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:t("storage.loadError")})})]})}var X=Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"}));e("a",X)}}})}();
//# sourceMappingURL=Storage-legacy-BFy28IfG.js.map
