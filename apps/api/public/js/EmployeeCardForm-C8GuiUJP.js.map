{"version":3,"file":"EmployeeCardForm-C8GuiUJP.js","sources":["../../../web/src/services/roles.ts","../../../web/src/utils/roleDisplay.ts","../../../web/src/components/EmployeeCardForm.tsx"],"sourcesContent":["// Назначение: запросы к API ролей\r\n// Основные модули: authFetch\r\nimport authFetch from \"../utils/authFetch\";\r\n\r\nexport interface Role {\r\n  _id: string;\r\n  name: string;\r\n  access: number;\r\n}\r\n\r\nexport const fetchRoles = (): Promise<Role[]> =>\r\n  authFetch(\"/api/v1/roles\").then((r) => (r.ok ? r.json() : []));\r\n\r\nexport const updateRole = (id: string, permissions: number) =>\r\n  authFetch(`/api/v1/roles/${id}`, {\r\n    method: \"PATCH\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ permissions }),\r\n  }).then((r) => r.json());\r\n","// Назначение файла: функции и константы для отображения названий ролей\r\n// Основные модули: словарь соответствий ролей и экспортируемые утилиты\r\n\r\nexport const ROLE_LABELS: Record<string, string> = {\r\n  admin: \"Администратор\",\r\n  manager: \"Менеджер\",\r\n  user: \"Сотрудник\",\r\n};\r\n\r\nexport interface RoleOption {\r\n  value: string;\r\n  label: string;\r\n}\r\n\r\nexport const ROLE_OPTIONS: RoleOption[] = [\r\n  { value: \"admin\", label: ROLE_LABELS.admin },\r\n  { value: \"manager\", label: ROLE_LABELS.manager },\r\n  { value: \"user\", label: ROLE_LABELS.user },\r\n];\r\n\r\nexport const formatRoleName = (role?: string | null): string => {\r\n  if (!role) return \"—\";\r\n  return ROLE_LABELS[role] ?? role;\r\n};\r\n","// Назначение: форма карточки сотрудника для создания и редактирования пользователей.\r\n// Основные модули: React, services/users, services/collections, services/roles.\r\nimport {\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useState,\r\n  type FormEvent,\r\n} from \"react\";\r\nimport clsx from \"clsx\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport ConfirmDialog from \"./ConfirmDialog\";\r\nimport {\r\n  fetchCollectionItems,\r\n  type CollectionItem,\r\n} from \"../services/collections\";\r\nimport { fetchRoles, type Role } from \"../services/roles\";\r\nimport { ROLE_OPTIONS } from \"../utils/roleDisplay\";\r\nimport {\r\n  createUser,\r\n  fetchUser,\r\n  previewUserCredentials,\r\n  updateUser,\r\n  type GeneratedUserCredentials,\r\n  type UserDetails,\r\n} from \"../services/users\";\r\nimport { useAuth } from \"../context/useAuth\";\r\nimport { showToast } from \"../utils/toast\";\r\nimport { hasAccess, ACCESS_ADMIN } from \"../utils/access\";\r\nimport type { UserFormData } from \"../pages/Settings/UserForm\";\r\n\r\ninterface EmployeeCardFormProps {\r\n  telegramId?: string;\r\n  className?: string;\r\n  mode?: \"create\" | \"update\";\r\n  onSaved?: (user: UserDetails) => void;\r\n}\r\n\r\nconst emptyForm: UserFormData = {\r\n  telegram_id: undefined,\r\n  username: \"\",\r\n  name: \"\",\r\n  phone: \"\",\r\n  mobNumber: \"\",\r\n  email: \"\",\r\n  role: \"user\",\r\n  access: 1,\r\n  roleId: \"\",\r\n  departmentId: \"\",\r\n  divisionId: \"\",\r\n  positionId: \"\",\r\n};\r\n\r\nfunction mapUserToForm(user: UserDetails): UserFormData {\r\n  return {\r\n    telegram_id: user.telegram_id,\r\n    username: user.telegram_username || user.username || \"\",\r\n    name: user.name || \"\",\r\n    phone: user.phone || \"\",\r\n    mobNumber: user.mobNumber || \"\",\r\n    email: user.email || \"\",\r\n    role: user.role || \"user\",\r\n    access: user.access,\r\n    roleId: user.roleId || \"\",\r\n    departmentId: user.departmentId || \"\",\r\n    divisionId: user.divisionId || \"\",\r\n    positionId: user.positionId || \"\",\r\n  };\r\n}\r\n\r\nconst normalize = (value: unknown): string => {\r\n  if (value === undefined || value === null) return \"\";\r\n  if (typeof value === \"number\") return String(value);\r\n  return String(value);\r\n};\r\n\r\nexport default function EmployeeCardForm({\r\n  telegramId,\r\n  className,\r\n  mode,\r\n  onSaved,\r\n}: EmployeeCardFormProps) {\r\n  const { user } = useAuth();\r\n  const [form, setForm] = useState<UserFormData>({ ...emptyForm });\r\n  const [initialForm, setInitialForm] = useState<UserFormData>({ ...emptyForm });\r\n  const [departments, setDepartments] = useState<CollectionItem[]>([]);\r\n  const [divisions, setDivisions] = useState<CollectionItem[]>([]);\r\n  const [positions, setPositions] = useState<CollectionItem[]>([]);\r\n  const [roles, setRoles] = useState<Role[]>([]);\r\n  const resolvedMode = mode ?? (telegramId ? \"update\" : \"create\");\r\n  const [loading, setLoading] = useState<boolean>(\r\n    resolvedMode === \"update\" && !!telegramId,\r\n  );\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [saving, setSaving] = useState(false);\r\n  const [confirmSave, setConfirmSave] = useState(false);\r\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\r\n  const [prefillError, setPrefillError] = useState<string | null>(null);\r\n\r\n  const isCreateMode = resolvedMode === \"create\";\r\n  const canEdit = hasAccess(user?.access, ACCESS_ADMIN);\r\n\r\n  useEffect(() => {\r\n    fetchCollectionItems(\"departments\", \"\", 1, 100).then((d) =>\r\n      setDepartments(d.items),\r\n    ).catch(() => setDepartments([]));\r\n    fetchCollectionItems(\"divisions\", \"\", 1, 100).then((d) =>\r\n      setDivisions(d.items),\r\n    ).catch(() => setDivisions([]));\r\n    fetchCollectionItems(\"positions\", \"\", 1, 100).then((d) =>\r\n      setPositions(d.items),\r\n    ).catch(() => setPositions([]));\r\n    fetchRoles().then((list) => setRoles(list));\r\n  }, []);\r\n\r\n  const applyGeneratedCredentials = useCallback(\r\n    (credentials: GeneratedUserCredentials) => {\r\n      setForm((prev) => ({\r\n        ...prev,\r\n        telegram_id: credentials.telegram_id,\r\n        username: credentials.username,\r\n      }));\r\n      setInitialForm((prev) => ({\r\n        ...prev,\r\n        telegram_id: credentials.telegram_id,\r\n        username: credentials.username,\r\n      }));\r\n    },\r\n    [],\r\n  );\r\n\r\n  const requestGeneratedCredentials = useCallback(\r\n    () => previewUserCredentials(),\r\n    [],\r\n  );\r\n\r\n  useEffect(() => {\r\n    setSuccessMessage(null);\r\n    if (isCreateMode) {\r\n      setLoading(false);\r\n      setError(null);\r\n      setForm({ ...emptyForm });\r\n      setInitialForm({ ...emptyForm });\r\n      let active = true;\r\n      requestGeneratedCredentials()\r\n        .then((generated) => {\r\n          if (!active) return;\r\n          applyGeneratedCredentials(generated);\r\n          setPrefillError(null);\r\n        })\r\n        .catch((error) => {\r\n          if (!active) return;\r\n          const message =\r\n            error instanceof Error\r\n              ? error.message\r\n              : \"Не удалось подготовить данные\";\r\n          setPrefillError(message);\r\n          showToast(message, \"error\");\r\n        });\r\n      return () => {\r\n        active = false;\r\n      };\r\n    }\r\n    setPrefillError(null);\r\n    if (!telegramId) {\r\n      setLoading(false);\r\n      setError(null);\r\n      setForm({ ...emptyForm });\r\n      setInitialForm({ ...emptyForm });\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    setError(null);\r\n    fetchUser(telegramId)\r\n      .then((data) => {\r\n        if (!data) {\r\n          setError(\"Пользователь не найден\");\r\n          setForm({ ...emptyForm });\r\n          setInitialForm({ ...emptyForm });\r\n          return;\r\n        }\r\n        const mapped = mapUserToForm(data);\r\n        setForm(mapped);\r\n        setInitialForm({ ...mapped });\r\n      })\r\n      .catch((e) => {\r\n        const message = e instanceof Error ? e.message : \"Ошибка загрузки\";\r\n        setError(message || \"Ошибка загрузки\");\r\n        setForm({ ...emptyForm });\r\n        setInitialForm({ ...emptyForm });\r\n      })\r\n      .finally(() => setLoading(false));\r\n  }, [\r\n    telegramId,\r\n    isCreateMode,\r\n    applyGeneratedCredentials,\r\n    requestGeneratedCredentials,\r\n  ]);\r\n\r\n  const isDirty = useMemo(() => {\r\n    if (!canEdit) return false;\r\n    if (isCreateMode) {\r\n      return Boolean(form.telegram_id && form.username);\r\n    }\r\n    const keys = Object.keys(initialForm) as (keyof UserFormData)[];\r\n    return keys.some((key) => normalize(form[key]) !== normalize(initialForm[key]));\r\n  }, [canEdit, form, initialForm, isCreateMode]);\r\n\r\n  const updateField = <K extends keyof UserFormData>(\r\n    key: K,\r\n    value: UserFormData[K],\r\n  ) => {\r\n    setSuccessMessage(null);\r\n    setForm((prev) => ({ ...prev, [key]: value }));\r\n  };\r\n\r\n  const handleRoleChange = (value: string) => {\r\n    const role = roles.find((r) => r.name === value);\r\n    setSuccessMessage(null);\r\n    setForm((prev) => ({\r\n      ...prev,\r\n      role: value,\r\n      roleId: role?._id || prev.roleId,\r\n      access: role?.access ?? prev.access,\r\n    }));\r\n  };\r\n\r\n  const resetChanges = () => {\r\n    if (isCreateMode) {\r\n      setSuccessMessage(null);\r\n      setForm({ ...emptyForm });\r\n      setInitialForm({ ...emptyForm });\r\n      requestGeneratedCredentials()\r\n        .then((generated) => {\r\n          applyGeneratedCredentials(generated);\r\n          setPrefillError(null);\r\n        })\r\n        .catch((error) => {\r\n          const message =\r\n            error instanceof Error\r\n              ? error.message\r\n              : \"Не удалось подготовить данные\";\r\n          setPrefillError(message);\r\n          showToast(message, \"error\");\r\n        });\r\n      return;\r\n    }\r\n    setSuccessMessage(null);\r\n    setForm({ ...initialForm });\r\n  };\r\n\r\n  const handleSubmit = (event: FormEvent<HTMLFormElement>) => {\r\n    event.preventDefault();\r\n    if (!canEdit) return;\r\n    if (!isDirty) return;\r\n    setConfirmSave(true);\r\n  };\r\n\r\n  const persistChanges = async () => {\r\n    if (!canEdit) {\r\n      setConfirmSave(false);\r\n      return;\r\n    }\r\n    if (isCreateMode) {\r\n      if (!form.telegram_id || !form.username) {\r\n        showToast(\"Укажите ID и username сотрудника\", \"error\");\r\n        setConfirmSave(false);\r\n        return;\r\n      }\r\n      setSaving(true);\r\n      try {\r\n        const telegramIdValue = Number(form.telegram_id);\r\n        if (!Number.isFinite(telegramIdValue)) {\r\n          throw new Error(\"ID должен быть числом\");\r\n        }\r\n        await createUser(telegramIdValue, form.username, form.roleId);\r\n        const { telegram_id: _, ...payload } = form;\r\n        const updated = await updateUser(telegramIdValue, payload);\r\n        if (!updated) throw new Error(\"Не удалось сохранить изменения\");\r\n        const mapped = mapUserToForm(updated);\r\n        setForm(mapped);\r\n        setInitialForm({ ...mapped });\r\n        onSaved?.(updated);\r\n        setSuccessMessage(\"Сотрудник создан\");\r\n      } catch (error) {\r\n        const message = error instanceof Error ? error.message : \"Не удалось сохранить\";\r\n        showToast(message, \"error\");\r\n      } finally {\r\n        setSaving(false);\r\n        setConfirmSave(false);\r\n      }\r\n      return;\r\n    }\r\n    if (!form.telegram_id) {\r\n      setConfirmSave(false);\r\n      return;\r\n    }\r\n    setSaving(true);\r\n    try {\r\n      const { telegram_id: telegramIdValue, ...payload } = form;\r\n      const updated = await updateUser(telegramIdValue, payload);\r\n      if (!updated) throw new Error(\"Не удалось сохранить изменения\");\r\n      const mapped = mapUserToForm(updated);\r\n      setForm(mapped);\r\n      setInitialForm({ ...mapped });\r\n      onSaved?.(updated);\r\n      setSuccessMessage(\"Данные сотрудника сохранены\");\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : \"Не удалось сохранить\";\r\n      showToast(message, \"error\");\r\n    } finally {\r\n      setSaving(false);\r\n      setConfirmSave(false);\r\n    }\r\n  };\r\n\r\n  if (!telegramId && !isCreateMode) {\r\n    return <div className=\"text-sm text-gray-500\">Выберите сотрудника слева</div>;\r\n  }\r\n\r\n  return (\r\n    <div className={clsx(\"space-y-4\", className)}>\r\n      <div className=\"space-y-1\">\r\n        <h2 className=\"text-xl font-semibold\">\r\n          {isCreateMode ? \"Новый сотрудник\" : \"Карточка сотрудника\"}\r\n        </h2>\r\n        <p className=\"text-sm text-gray-500\">\r\n          {isCreateMode\r\n            ? \"Заполните данные и сохраните, чтобы создать запись.\"\r\n            : \"Измените данные и подтвердите сохранение.\"}\r\n        </p>\r\n      </div>\r\n      {loading && <div>Загрузка...</div>}\r\n      {!loading && isCreateMode && prefillError && (\r\n        <div className=\"rounded border border-rose-200 bg-rose-50 p-3 text-sm text-rose-900\">\r\n          {prefillError}\r\n        </div>\r\n      )}\r\n      {!loading && error && <div className=\"text-red-600\">{error}</div>}\r\n      {!loading && !error && (\r\n        <form\r\n          onSubmit={handleSubmit}\r\n          className=\"space-y-4 rounded bg-white p-6 shadow\"\r\n        >\r\n          {successMessage && (\r\n            <div className=\"rounded border border-green-200 bg-green-50 p-3 text-sm text-green-800\">\r\n              {successMessage}\r\n            </div>\r\n          )}\r\n          {!canEdit && (\r\n            <div className=\"rounded border border-amber-200 bg-amber-50 p-3 text-sm text-amber-900\">\r\n              У вас нет прав на редактирование, данные доступны только для чтения.\r\n            </div>\r\n          )}\r\n          <div className=\"grid gap-4 md:grid-cols-2\">\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">ID</span>\r\n              <input\r\n                name=\"telegramId\"\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.telegram_id ?? \"\"}\r\n                onChange={(e) =>\r\n                  updateField(\r\n                    \"telegram_id\",\r\n                    e.target.value ? Number(e.target.value) : undefined,\r\n                  )\r\n                }\r\n                readOnly={!isCreateMode}\r\n                required\r\n              />\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Username</span>\r\n              <input\r\n                name=\"username\"\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.username || \"\"}\r\n                onChange={(e) => updateField(\"username\", e.target.value)}\r\n                readOnly={!isCreateMode}\r\n                required\r\n              />\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Имя</span>\r\n              <input\r\n                name=\"name\"\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.name || \"\"}\r\n                onChange={(e) => updateField(\"name\", e.target.value)}\r\n                disabled={!canEdit}\r\n              />\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Телефон</span>\r\n              <input\r\n                name=\"phone\"\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.phone || \"\"}\r\n                onChange={(e) => updateField(\"phone\", e.target.value)}\r\n                disabled={!canEdit}\r\n              />\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Доп. телефон</span>\r\n              <input\r\n                name=\"mobNumber\"\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.mobNumber || \"\"}\r\n                onChange={(e) => updateField(\"mobNumber\", e.target.value)}\r\n                disabled={!canEdit}\r\n              />\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Email</span>\r\n              <input\r\n                name=\"email\"\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.email || \"\"}\r\n                onChange={(e) => updateField(\"email\", e.target.value)}\r\n                disabled={!canEdit}\r\n              />\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Роль</span>\r\n              <select\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.role || \"user\"}\r\n                onChange={(e) => handleRoleChange(e.target.value)}\r\n                disabled={!canEdit}\r\n              >\r\n                {ROLE_OPTIONS.map((option) => (\r\n                  <option key={option.value} value={option.value}>\r\n                    {option.label}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Департамент</span>\r\n              <select\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.departmentId || \"\"}\r\n                onChange={(e) => updateField(\"departmentId\", e.target.value)}\r\n                disabled={!canEdit}\r\n              >\r\n                <option value=\"\"></option>\r\n                {departments.map((d) => (\r\n                  <option key={d._id} value={d._id}>\r\n                    {d.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Отдел</span>\r\n              <select\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.divisionId || \"\"}\r\n                onChange={(e) => updateField(\"divisionId\", e.target.value)}\r\n                disabled={!canEdit}\r\n              >\r\n                <option value=\"\"></option>\r\n                {divisions.map((d) => (\r\n                  <option key={d._id} value={d._id}>\r\n                    {d.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n            <label className=\"space-y-1\">\r\n              <span className=\"block text-sm font-medium\">Должность</span>\r\n              <select\r\n                className=\"h-10 w-full rounded border px-3\"\r\n                value={form.positionId || \"\"}\r\n                onChange={(e) => updateField(\"positionId\", e.target.value)}\r\n                disabled={!canEdit}\r\n              >\r\n                <option value=\"\"></option>\r\n                {positions.map((p) => (\r\n                  <option key={p._id} value={p._id}>\r\n                    {p.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n          </div>\r\n          {canEdit && (\r\n            <div className=\"flex gap-3\">\r\n              <Button type=\"submit\" disabled={!isDirty || saving}>\r\n                {saving ? \"Сохранение...\" : \"Сохранить\"}\r\n              </Button>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                onClick={resetChanges}\r\n                disabled={!isDirty || saving}\r\n              >\r\n                Очистить\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </form>\r\n      )}\r\n      <ConfirmDialog\r\n        open={confirmSave}\r\n        message={isCreateMode ? \"Создать сотрудника?\" : \"Сохранить изменения сотрудника?\"}\r\n        onConfirm={persistChanges}\r\n        onCancel={() => setConfirmSave(false)}\r\n        confirmText=\"Сохранить\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":["fetchRoles","authFetch","r","ROLE_LABELS","ROLE_OPTIONS","formatRoleName","role","_a","emptyForm","mapUserToForm","user","normalize","value","EmployeeCardForm","telegramId","className","mode","onSaved","useAuth","form","setForm","useState","initialForm","setInitialForm","departments","setDepartments","divisions","setDivisions","positions","setPositions","roles","setRoles","resolvedMode","loading","setLoading","error","setError","saving","setSaving","confirmSave","setConfirmSave","successMessage","setSuccessMessage","prefillError","setPrefillError","isCreateMode","canEdit","hasAccess","ACCESS_ADMIN","useEffect","fetchCollectionItems","d","list","applyGeneratedCredentials","useCallback","credentials","prev","requestGeneratedCredentials","previewUserCredentials","active","generated","message","showToast","fetchUser","data","mapped","isDirty","useMemo","key","updateField","handleRoleChange","resetChanges","handleSubmit","event","persistChanges","telegramIdValue","createUser","_","payload","updated","updateUser","jsx","clsx","jsxs","option","p","Button","ConfirmDialog"],"mappings":"iXAUO,MAAMA,GAAa,IACxBC,GAAU,eAAe,EAAE,KAAMC,GAAOA,EAAE,GAAKA,EAAE,KAAA,EAAS,CAAA,CAAG,ECRlDC,EAAsC,CACjD,MAAO,gBACP,QAAS,WACT,KAAM,WACR,EAOaC,GAA6B,CACxC,CAAE,MAAO,QAAS,MAAOD,EAAY,KAAA,EACrC,CAAE,MAAO,UAAW,MAAOA,EAAY,OAAA,EACvC,CAAE,MAAO,OAAQ,MAAOA,EAAY,IAAA,CACtC,EAEaE,GAAkBC,GAAiC,OAC9D,OAAKA,GACEC,EAAAJ,EAAYG,CAAI,IAAhB,KAAAC,EAAqBD,EADV,GAEpB,ECeME,EAA0B,CAC9B,YAAa,OACb,SAAU,GACV,KAAM,GACN,MAAO,GACP,UAAW,GACX,MAAO,GACP,KAAM,OACN,OAAQ,EACR,OAAQ,GACR,aAAc,GACd,WAAY,GACZ,WAAY,EACd,EAEA,SAASC,EAAcC,EAAiC,CACtD,MAAO,CACL,YAAaA,EAAK,YAClB,SAAUA,EAAK,mBAAqBA,EAAK,UAAY,GACrD,KAAMA,EAAK,MAAQ,GACnB,MAAOA,EAAK,OAAS,GACrB,UAAWA,EAAK,WAAa,GAC7B,MAAOA,EAAK,OAAS,GACrB,KAAMA,EAAK,MAAQ,OACnB,OAAQA,EAAK,OACb,OAAQA,EAAK,QAAU,GACvB,aAAcA,EAAK,cAAgB,GACnC,WAAYA,EAAK,YAAc,GAC/B,WAAYA,EAAK,YAAc,EAAA,CAEnC,CAEA,MAAMC,EAAaC,GACUA,GAAU,KAAa,GACZ,OAAOA,CAAK,EAIpD,SAAwBC,GAAiB,CACvC,WAAAC,EACA,UAAAC,EACA,KAAAC,EACA,QAAAC,CACF,EAA0B,OACxB,KAAM,CAAE,KAAAP,CAAA,EAASQ,GAAA,EACX,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAAuB,CAAE,GAAGb,EAAW,EACzD,CAACc,EAAaC,CAAc,EAAIF,EAAAA,SAAuB,CAAE,GAAGb,EAAW,EACvE,CAACgB,EAAaC,CAAc,EAAIJ,EAAAA,SAA2B,CAAA,CAAE,EAC7D,CAACK,EAAWC,CAAY,EAAIN,EAAAA,SAA2B,CAAA,CAAE,EACzD,CAACO,EAAWC,CAAY,EAAIR,EAAAA,SAA2B,CAAA,CAAE,EACzD,CAACS,EAAOC,CAAQ,EAAIV,EAAAA,SAAiB,CAAA,CAAE,EACvCW,EAAehB,GAAA,KAAAA,EAASF,EAAa,SAAW,SAChD,CAACmB,EAASC,CAAU,EAAIb,EAAAA,SAC5BW,IAAiB,UAAY,CAAC,CAAClB,CAAA,EAE3B,CAACqB,EAAOC,CAAQ,EAAIf,EAAAA,SAAwB,IAAI,EAChD,CAACgB,EAAQC,CAAS,EAAIjB,EAAAA,SAAS,EAAK,EACpC,CAACkB,EAAaC,CAAc,EAAInB,EAAAA,SAAS,EAAK,EAC9C,CAACoB,EAAgBC,CAAiB,EAAIrB,EAAAA,SAAwB,IAAI,EAClE,CAACsB,EAAcC,CAAe,EAAIvB,EAAAA,SAAwB,IAAI,EAE9DwB,EAAeb,IAAiB,SAChCc,EAAUC,GAAUrC,GAAA,YAAAA,EAAM,OAAQsC,EAAY,EAEpDC,EAAAA,UAAU,IAAM,CACdC,EAAqB,cAAe,GAAI,EAAG,GAAG,EAAE,KAAMC,GACpD1B,EAAe0B,EAAE,KAAK,CAAA,EACtB,MAAM,IAAM1B,EAAe,CAAA,CAAE,CAAC,EAChCyB,EAAqB,YAAa,GAAI,EAAG,GAAG,EAAE,KAAMC,GAClDxB,EAAawB,EAAE,KAAK,CAAA,EACpB,MAAM,IAAMxB,EAAa,CAAA,CAAE,CAAC,EAC9BuB,EAAqB,YAAa,GAAI,EAAG,GAAG,EAAE,KAAMC,GAClDtB,EAAasB,EAAE,KAAK,CAAA,EACpB,MAAM,IAAMtB,EAAa,CAAA,CAAE,CAAC,EAC9B7B,GAAA,EAAa,KAAMoD,GAASrB,EAASqB,CAAI,CAAC,CAC5C,EAAG,CAAA,CAAE,EAEL,MAAMC,EAA4BC,EAAAA,YAC/BC,GAA0C,CACzCnC,EAASoC,IAAU,CACjB,GAAGA,EACH,YAAaD,EAAY,YACzB,SAAUA,EAAY,QAAA,EACtB,EACFhC,EAAgBiC,IAAU,CACxB,GAAGA,EACH,YAAaD,EAAY,YACzB,SAAUA,EAAY,QAAA,EACtB,CACJ,EACA,CAAA,CAAC,EAGGE,EAA8BH,EAAAA,YAClC,IAAMI,GAAA,EACN,CAAA,CAAC,EAGHT,EAAAA,UAAU,IAAM,CAEd,GADAP,EAAkB,IAAI,EAClBG,EAAc,CAChBX,EAAW,EAAK,EAChBE,EAAS,IAAI,EACbhB,EAAQ,CAAE,GAAGZ,EAAW,EACxBe,EAAe,CAAE,GAAGf,EAAW,EAC/B,IAAImD,EAAS,GACb,OAAAF,EAAA,EACG,KAAMG,GAAc,CACdD,IACLN,EAA0BO,CAAS,EACnChB,EAAgB,IAAI,EACtB,CAAC,EACA,MAAOT,GAAU,CAChB,GAAI,CAACwB,EAAQ,OACb,MAAME,EACJ1B,aAAiB,MACbA,EAAM,QACN,gCACNS,EAAgBiB,CAAO,EACvBC,EAAUD,EAAS,OAAO,CAC5B,CAAC,EACI,IAAM,CACXF,EAAS,EACX,CACF,CAEA,GADAf,EAAgB,IAAI,EAChB,CAAC9B,EAAY,CACfoB,EAAW,EAAK,EAChBE,EAAS,IAAI,EACbhB,EAAQ,CAAE,GAAGZ,EAAW,EACxBe,EAAe,CAAE,GAAGf,EAAW,EAC/B,MACF,CACA0B,EAAW,EAAI,EACfE,EAAS,IAAI,EACb2B,GAAUjD,CAAU,EACjB,KAAMkD,GAAS,CACd,GAAI,CAACA,EAAM,CACT5B,EAAS,wBAAwB,EACjChB,EAAQ,CAAE,GAAGZ,EAAW,EACxBe,EAAe,CAAE,GAAGf,EAAW,EAC/B,MACF,CACA,MAAMyD,EAASxD,EAAcuD,CAAI,EACjC5C,EAAQ6C,CAAM,EACd1C,EAAe,CAAE,GAAG0C,EAAQ,CAC9B,CAAC,EACA,MAAO,GAAM,CACZ,MAAMJ,EAAU,aAAa,MAAQ,EAAE,QAAU,kBACjDzB,EAASyB,GAAW,iBAAiB,EACrCzC,EAAQ,CAAE,GAAGZ,EAAW,EACxBe,EAAe,CAAE,GAAGf,EAAW,CACjC,CAAC,EACA,QAAQ,IAAM0B,EAAW,EAAK,CAAC,CACpC,EAAG,CACDpB,EACA+B,EACAQ,EACAI,CAAA,CACD,EAED,MAAMS,EAAUC,EAAAA,QAAQ,IACjBrB,EACDD,EACK,GAAQ1B,EAAK,aAAeA,EAAK,UAE7B,OAAO,KAAKG,CAAW,EACxB,KAAM8C,GAAQzD,EAAUQ,EAAKiD,CAAG,CAAC,IAAMzD,EAAUW,EAAY8C,CAAG,CAAC,CAAC,EALzD,GAMpB,CAACtB,EAAS3B,EAAMG,EAAauB,CAAY,CAAC,EAEvCwB,EAAc,CAClBD,EACAxD,IACG,CACH8B,EAAkB,IAAI,EACtBtB,EAASoC,IAAU,CAAE,GAAGA,EAAM,CAACY,CAAG,EAAGxD,CAAA,EAAQ,CAC/C,EAEM0D,EAAoB1D,GAAkB,CAC1C,MAAMN,EAAOwB,EAAM,KAAM5B,GAAMA,EAAE,OAASU,CAAK,EAC/C8B,EAAkB,IAAI,EACtBtB,EAASoC,GAAA,OAAU,OACjB,GAAGA,EACH,KAAM5C,EACN,QAAQN,GAAA,YAAAA,EAAM,MAAOkD,EAAK,OAC1B,QAAQjD,EAAAD,GAAA,YAAAA,EAAM,SAAN,KAAAC,EAAgBiD,EAAK,MAAA,EAC7B,CACJ,EAEMe,EAAe,IAAM,CACzB,GAAI1B,EAAc,CAChBH,EAAkB,IAAI,EACtBtB,EAAQ,CAAE,GAAGZ,EAAW,EACxBe,EAAe,CAAE,GAAGf,EAAW,EAC/BiD,EAAA,EACG,KAAMG,GAAc,CACnBP,EAA0BO,CAAS,EACnChB,EAAgB,IAAI,CACtB,CAAC,EACA,MAAOT,GAAU,CAChB,MAAM0B,EACJ1B,aAAiB,MACbA,EAAM,QACN,gCACNS,EAAgBiB,CAAO,EACvBC,EAAUD,EAAS,OAAO,CAC5B,CAAC,EACH,MACF,CACAnB,EAAkB,IAAI,EACtBtB,EAAQ,CAAE,GAAGE,EAAa,CAC5B,EAEMkD,GAAgBC,GAAsC,CAC1DA,EAAM,eAAA,EACD3B,GACAoB,GACL1B,EAAe,EAAI,CACrB,EAEMkC,GAAiB,SAAY,CACjC,GAAI,CAAC5B,EAAS,CACZN,EAAe,EAAK,EACpB,MACF,CACA,GAAIK,EAAc,CAChB,GAAI,CAAC1B,EAAK,aAAe,CAACA,EAAK,SAAU,CACvC2C,EAAU,mCAAoC,OAAO,EACrDtB,EAAe,EAAK,EACpB,MACF,CACAF,EAAU,EAAI,EACd,GAAI,CACF,MAAMqC,EAAkB,OAAOxD,EAAK,WAAW,EAC/C,GAAI,CAAC,OAAO,SAASwD,CAAe,EAClC,MAAM,IAAI,MAAM,uBAAuB,EAEzC,MAAMC,GAAWD,EAAiBxD,EAAK,SAAUA,EAAK,MAAM,EAC5D,KAAM,CAAE,YAAa0D,EAAG,GAAGC,GAAY3D,EACjC4D,EAAU,MAAMC,EAAWL,EAAiBG,CAAO,EACzD,GAAI,CAACC,EAAS,MAAM,IAAI,MAAM,gCAAgC,EAC9D,MAAMd,EAASxD,EAAcsE,CAAO,EACpC3D,EAAQ6C,CAAM,EACd1C,EAAe,CAAE,GAAG0C,EAAQ,EAC5BhD,GAAA,MAAAA,EAAU8D,GACVrC,EAAkB,kBAAkB,CACtC,OAASP,EAAO,CACd,MAAM0B,EAAU1B,aAAiB,MAAQA,EAAM,QAAU,uBACzD2B,EAAUD,EAAS,OAAO,CAC5B,QAAA,CACEvB,EAAU,EAAK,EACfE,EAAe,EAAK,CACtB,CACA,MACF,CACA,GAAI,CAACrB,EAAK,YAAa,CACrBqB,EAAe,EAAK,EACpB,MACF,CACAF,EAAU,EAAI,EACd,GAAI,CACF,KAAM,CAAE,YAAaqC,EAAiB,GAAGG,GAAY3D,EAC/C4D,EAAU,MAAMC,EAAWL,EAAiBG,CAAO,EACzD,GAAI,CAACC,EAAS,MAAM,IAAI,MAAM,gCAAgC,EAC9D,MAAMd,EAASxD,EAAcsE,CAAO,EACpC3D,EAAQ6C,CAAM,EACd1C,EAAe,CAAE,GAAG0C,EAAQ,EAC5BhD,GAAA,MAAAA,EAAU8D,GACVrC,EAAkB,6BAA6B,CACjD,OAASP,EAAO,CACd,MAAM0B,EAAU1B,aAAiB,MAAQA,EAAM,QAAU,uBACzD2B,EAAUD,EAAS,OAAO,CAC5B,QAAA,CACEvB,EAAU,EAAK,EACfE,EAAe,EAAK,CACtB,CACF,EAEA,MAAI,CAAC1B,GAAc,CAAC+B,EACXoC,EAAAA,IAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,4BAAyB,SAItE,MAAA,CAAI,UAAWC,GAAK,YAAanE,CAAS,EACzC,SAAA,CAAAoE,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAF,MAAC,KAAA,CAAG,UAAU,wBACX,SAAApC,EAAe,kBAAoB,sBACtC,QACC,IAAA,CAAE,UAAU,wBACV,SAAAA,EACG,sDACA,2CAAA,CACN,CAAA,EACF,EACCZ,GAAWgD,EAAAA,IAAC,MAAA,CAAI,SAAA,aAAA,CAAW,EAC3B,CAAChD,GAAWY,GAAgBF,SAC1B,MAAA,CAAI,UAAU,sEACZ,SAAAA,EACH,EAED,CAACV,GAAWE,SAAU,MAAA,CAAI,UAAU,eAAgB,SAAAA,EAAM,EAC1D,CAACF,GAAW,CAACE,GACZgD,EAAAA,KAAC,OAAA,CACC,SAAUX,GACV,UAAU,wCAET,SAAA,CAAA/B,GACCwC,EAAAA,IAAC,MAAA,CAAI,UAAU,yEACZ,SAAAxC,EACH,EAED,CAACK,GACAmC,EAAAA,IAAC,MAAA,CAAI,UAAU,yEAAyE,SAAA,uEAExF,EAEFE,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAA,EAAAA,KAAC,QAAA,CAAM,UAAU,YACf,SAAA,CAAAF,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA4B,SAAA,KAAE,EAC9CA,EAAAA,IAAC,QAAA,CACC,KAAK,aACL,UAAU,kCACV,OAAO1E,EAAAY,EAAK,cAAL,KAAAZ,EAAoB,GAC3B,SAAW,GACT8D,EACE,cACA,EAAE,OAAO,MAAQ,OAAO,EAAE,OAAO,KAAK,EAAI,MAAA,EAG9C,SAAU,CAACxB,EACX,SAAQ,EAAA,CAAA,CACV,EACF,EACAsC,EAAAA,KAAC,QAAA,CAAM,UAAU,YACf,SAAA,CAAAF,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA4B,SAAA,WAAQ,EACpDA,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,UAAU,kCACV,MAAO9D,EAAK,UAAY,GACxB,SAAW,GAAMkD,EAAY,WAAY,EAAE,OAAO,KAAK,EACvD,SAAU,CAACxB,EACX,SAAQ,EAAA,CAAA,CACV,EACF,EACAsC,EAAAA,KAAC,QAAA,CAAM,UAAU,YACf,SAAA,CAAAF,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA4B,SAAA,MAAG,EAC/CA,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,UAAU,kCACV,MAAO9D,EAAK,MAAQ,GACpB,SAAW,GAAMkD,EAAY,OAAQ,EAAE,OAAO,KAAK,EACnD,SAAU,CAACvB,CAAA,CAAA,CACb,EACF,EACAqC,EAAAA,KAAC,QAAA,CAAM,UAAU,YACf,SAAA,CAAAF,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA4B,SAAA,UAAO,EACnDA,EAAAA,IAAC,QAAA,CACC,KAAK,QACL,UAAU,kCACV,MAAO9D,EAAK,OAAS,GACrB,SAAW,GAAMkD,EAAY,QAAS,EAAE,OAAO,KAAK,EACpD,SAAU,CAACvB,CAAA,CAAA,CACb,EACF,EACAqC,EAAAA,KAAC,QAAA,CAAM,UAAU,YACf,SAAA,CAAAF,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA4B,SAAA,eAAY,EACxDA,EAAAA,IAAC,QAAA,CACC,KAAK,YACL,UAAU,kCACV,MAAO9D,EAAK,WAAa,GACzB,SAAW,GAAMkD,EAAY,YAAa,EAAE,OAAO,KAAK,EACxD,SAAU,CAACvB,CAAA,CAAA,CACb,EACF,EACAqC,EAAAA,KAAC,QAAA,CAAM,UAAU,YACf,SAAA,CAAAF,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA4B,SAAA,QAAK,EACjDA,EAAAA,IAAC,QAAA,CACC,KAAK,QACL,UAAU,kCACV,MAAO9D,EAAK,OAAS,GACrB,SAAW,GAAMkD,EAAY,QAAS,EAAE,OAAO,KAAK,EACpD,SAAU,CAACvB,CAAA,CAAA,CACb,EACF,EACAqC,EAAAA,KAAC,QAAA,CAAM,UAAU,YACf,SAAA,CAAAF,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA4B,SAAA,OAAI,EAChDA,EAAAA,IAAC,SAAA,CACC,UAAU,kCACV,MAAO9D,EAAK,MAAQ,OACpB,SAAW,GAAMmD,EAAiB,EAAE,OAAO,KAAK,EAChD,SAAU,CAACxB,EAEV,SAAA1C,GAAa,IAAKgF,GACjBH,EAAAA,IAAC,SAAA,CAA0B,MAAOG,EAAO,MACtC,SAAAA,EAAO,KAAA,EADGA,EAAO,KAEpB,CACD,CAAA,CAAA,CACH,EACF,EACAD,EAAAA,KAAC,QAAA,CAAM,UAAU,YACf,SAAA,CAAAF,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA4B,SAAA,cAAW,EACvDE,EAAAA,KAAC,SAAA,CACC,UAAU,kCACV,MAAOhE,EAAK,cAAgB,GAC5B,SAAW,GAAMkD,EAAY,eAAgB,EAAE,OAAO,KAAK,EAC3D,SAAU,CAACvB,EAEX,SAAA,CAAAmC,EAAAA,IAAC,SAAA,CAAO,MAAM,EAAA,CAAG,EAChBzD,EAAY,IAAK2B,GAChB8B,EAAAA,IAAC,SAAA,CAAmB,MAAO9B,EAAE,IAC1B,SAAAA,EAAE,IAAA,EADQA,EAAE,GAEf,CACD,CAAA,CAAA,CAAA,CACH,EACF,EACAgC,EAAAA,KAAC,QAAA,CAAM,UAAU,YACf,SAAA,CAAAF,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA4B,SAAA,QAAK,EACjDE,EAAAA,KAAC,SAAA,CACC,UAAU,kCACV,MAAOhE,EAAK,YAAc,GAC1B,SAAW,GAAMkD,EAAY,aAAc,EAAE,OAAO,KAAK,EACzD,SAAU,CAACvB,EAEX,SAAA,CAAAmC,EAAAA,IAAC,SAAA,CAAO,MAAM,EAAA,CAAG,EAChBvD,EAAU,IAAKyB,GACd8B,EAAAA,IAAC,SAAA,CAAmB,MAAO9B,EAAE,IAC1B,SAAAA,EAAE,IAAA,EADQA,EAAE,GAEf,CACD,CAAA,CAAA,CAAA,CACH,EACF,EACAgC,EAAAA,KAAC,QAAA,CAAM,UAAU,YACf,SAAA,CAAAF,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA4B,SAAA,YAAS,EACrDE,EAAAA,KAAC,SAAA,CACC,UAAU,kCACV,MAAOhE,EAAK,YAAc,GAC1B,SAAW,GAAMkD,EAAY,aAAc,EAAE,OAAO,KAAK,EACzD,SAAU,CAACvB,EAEX,SAAA,CAAAmC,EAAAA,IAAC,SAAA,CAAO,MAAM,EAAA,CAAG,EAChBrD,EAAU,IAAKyD,GACdJ,EAAAA,IAAC,SAAA,CAAmB,MAAOI,EAAE,IAC1B,SAAAA,EAAE,IAAA,EADQA,EAAE,GAEf,CACD,CAAA,CAAA,CAAA,CACH,CAAA,CACF,CAAA,EACF,EACCvC,GACCqC,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAF,EAAAA,IAACK,EAAA,CAAO,KAAK,SAAS,SAAU,CAACpB,GAAW7B,EACzC,SAAAA,EAAS,gBAAkB,WAAA,CAC9B,EACA4C,EAAAA,IAACK,EAAA,CACC,KAAK,SACL,QAAQ,UACR,QAASf,EACT,SAAU,CAACL,GAAW7B,EACvB,SAAA,UAAA,CAAA,CAED,CAAA,CACF,CAAA,CAAA,CAAA,EAIN4C,EAAAA,IAACM,GAAA,CACC,KAAMhD,EACN,QAASM,EAAe,sBAAwB,kCAChD,UAAW6B,GACX,SAAU,IAAMlC,EAAe,EAAK,EACpC,YAAY,WAAA,CAAA,CACd,EACF,CAEJ"}