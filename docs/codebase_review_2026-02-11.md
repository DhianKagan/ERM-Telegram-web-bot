# Codebase review backlog (2026-02-11)

## 1) Опечатка (typo)

**Где:** `apps/api/src/system/stackHealth.service.ts`.

**Наблюдение:** в диагностическом сообщении для HTTP 5xx есть опечатка `upsteam`.

**Задача:** заменить `upsteam` на `upstream` в строке подсказки, чтобы избежать путаницы в продакшн-логах.

## 2) Исправление ошибки (bugfix)

**Где:** `apps/web/src/context/ToastProvider.tsx`.

**Наблюдение:** провайдер держал только один `timeoutId`, поэтому при нескольких тостах ссылка на предыдущий таймер перезаписывалась. Это могло оставлять «висячие» таймеры и делать cleanup неполным.

**Задача:** хранить таймеры по `toast.id`, очищать их при ручном удалении тоста и при размонтировании провайдера.

## 3) Исправление комментария/документации (несоответствие)

**Где:** `docs/codebase_review_2026-02-11.md`.

**Наблюдение:** пункт про `hasRenderableComment()` устарел: в `apps/api/src/tasks/taskComments.ts` уже используется `convertHtmlToMarkdownSafe()` с type-guard и fallback.

**Задача:** синхронизировать backlog с фактическим состоянием репозитория, чтобы не планировать уже выполненный bugfix повторно.

## 4) Улучшение теста

**Где:** `tests/toast.unmount.spec.tsx`.

**Наблюдение:** тест очистки таймеров в `ToastProvider` уже включён (`test(...)`), но стоит расширить его аналогичными регрессионными кейсами для гео-парсинга, чтобы покрыть невалидные диапазоны.

**Задача:** добавить тесты на невалидные диапазоны координат в `tests/mapUtils.spec.ts` и зафиксировать ожидаемое поведение (`null`).
