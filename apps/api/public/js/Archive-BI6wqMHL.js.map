{"version":3,"file":"Archive-BI6wqMHL.js","sources":["../../../web/src/columns/archiveColumns.tsx","../../../web/src/services/archives.ts","../../../web/src/pages/Archive.tsx"],"sourcesContent":["// Конфигурация колонок архива задач\n// Основные модули: React, @tanstack/react-table\nimport React from 'react';\nimport type { ColumnDef } from '@tanstack/react-table';\nimport type { ArchiveTask } from '../types/archive';\n\nconst dateTimeFormatter = new Intl.DateTimeFormat('ru-RU', {\n  dateStyle: 'short',\n  timeStyle: 'short',\n});\n\nfunction formatDate(value?: string) {\n  if (!value) return '—';\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) return value;\n  return dateTimeFormatter.format(date);\n}\n\nexport default function archiveColumns({\n  enableSelection,\n  selectedIds,\n  onToggleRow,\n  onToggleAll,\n  visibleCount,\n}: {\n  enableSelection: boolean;\n  selectedIds: Set<string>;\n  onToggleRow: (id: string, checked: boolean) => void;\n  onToggleAll: (checked: boolean) => void;\n  visibleCount: number;\n}): ColumnDef<ArchiveTask>[] {\n  const columns: ColumnDef<ArchiveTask>[] = [];\n  if (enableSelection) {\n    columns.push({\n      id: 'select',\n      header: () => {\n        const allSelected =\n          visibleCount > 0 && selectedIds.size >= visibleCount;\n        const indeterminate =\n          selectedIds.size > 0 && selectedIds.size < visibleCount;\n        return (\n          <input\n            type=\"checkbox\"\n            aria-label=\"Выбрать все\"\n            checked={allSelected}\n            ref={(el) => {\n              if (el) el.indeterminate = indeterminate && !allSelected;\n            }}\n            onChange={(event) => onToggleAll(event.target.checked)}\n          />\n        );\n      },\n      cell: ({ row }) => {\n        const id = row.original.id;\n        if (!id) {\n          return <span className=\"text-muted-foreground\">—</span>;\n        }\n        return (\n          <input\n            type=\"checkbox\"\n            aria-label={`Выбрать задачу ${row.original.task_number || id}`}\n            checked={selectedIds.has(id)}\n            onChange={(event) => onToggleRow(id, event.target.checked)}\n          />\n        );\n      },\n      meta: { width: '3rem', minWidth: '3rem', maxWidth: '3rem' },\n    });\n  }\n  columns.push(\n    {\n      header: 'Номер',\n      accessorKey: 'task_number',\n      meta: {\n        width: '8rem',\n        minWidth: '6rem',\n        maxWidth: '8rem',\n        cellClassName: 'font-mono text-xs sm:text-sm',\n      },\n      cell: ({ row }) => row.original.task_number || row.original.id || '—',\n    },\n    {\n      header: 'Название',\n      accessorKey: 'title',\n      meta: {\n        width: '16rem',\n        minWidth: '10rem',\n        maxWidth: '22rem',\n        cellClassName: 'whitespace-normal',\n      },\n      cell: ({ row }) => {\n        const title = row.original.title || '—';\n        return (\n          <span className=\"line-clamp-2 break-words text-sm\">{title}</span>\n        );\n      },\n    },\n    {\n      header: 'Статус',\n      accessorKey: 'status',\n      meta: {\n        width: '8rem',\n        minWidth: '6rem',\n        maxWidth: '10rem',\n      },\n      cell: ({ row }) => row.original.status || '—',\n    },\n    {\n      header: 'Удалена',\n      accessorKey: 'archived_at',\n      meta: {\n        width: '10rem',\n        minWidth: '8rem',\n        maxWidth: '12rem',\n      },\n      cell: ({ row }) => formatDate(row.original.archived_at),\n    },\n  );\n  return columns;\n}\n","// Назначение: запросы к API архива задач\n// Основные модули: authFetch\nimport authFetch from '../utils/authFetch';\n\nexport interface ArchiveListResult {\n  items: Array<Record<string, unknown>>;\n  total: number;\n  page: number;\n  pages: number;\n}\n\nexport async function fetchArchive(\n  params: { page?: number; limit?: number; search?: string } = {},\n): Promise<ArchiveListResult> {\n  const query = new URLSearchParams();\n  if (params.page) query.set('page', String(params.page));\n  if (params.limit) query.set('limit', String(params.limit));\n  if (params.search) query.set('search', params.search.trim());\n  const suffix = query.toString();\n  const url = suffix ? `/api/v1/archives?${suffix}` : '/api/v1/archives';\n  const response = await authFetch(url);\n  if (!response.ok) {\n    const text = await response.text().catch(() => '');\n    throw new Error(text || 'Не удалось загрузить архив задач');\n  }\n  const data = await response.json();\n  return {\n    items: Array.isArray(data.items) ? data.items : [],\n    total: Number(data.total) || 0,\n    page: Number(data.page) || 1,\n    pages: Number(data.pages) || 0,\n  };\n}\n\nexport async function purgeArchive(ids: string[]): Promise<number> {\n  if (!Array.isArray(ids) || ids.length === 0) {\n    return 0;\n  }\n  const response = await authFetch('/api/v1/archives/purge', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({ ids }),\n  });\n  if (!response.ok) {\n    const text = await response.text().catch(() => '');\n    throw new Error(text || 'Не удалось выполнить полное удаление');\n  }\n  const payload = await response.json();\n  return Number(payload.removed) || 0;\n}\n","// Страница архива задач\n// Основные модули: React, DataTable, сервисы архива\nimport React from 'react';\nimport DataTable from '../components/DataTable';\nimport archiveColumns from '../columns/archiveColumns';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { useToast } from '../context/useToast';\nimport { useAuth } from '../context/useAuth';\nimport { fetchArchive, purgeArchive } from '../services/archives';\nimport type { ArchiveTask } from '../types/archive';\nimport { ARCHIVE_ACCESS, ACCESS_TASK_DELETE, hasAccess } from '../utils/access';\n\nconst PAGE_SIZE = 25;\n\nconst toId = (value: unknown): string => {\n  if (!value) return '';\n  if (typeof value === 'string') return value;\n  if (typeof value === 'number') return String(value);\n  if (typeof value === 'object' && value !== null && 'toString' in value) {\n    try {\n      return (value as { toString(): string }).toString();\n    } catch {\n      return '';\n    }\n  }\n  return '';\n};\n\nconst normalizeDate = (value: unknown): string | undefined => {\n  if (typeof value === 'string') return value;\n  if (value instanceof Date) return value.toISOString();\n  return undefined;\n};\n\nexport default function ArchivePage() {\n  const { addToast } = useToast();\n  const { user } = useAuth();\n  const [rows, setRows] = React.useState<ArchiveTask[]>([]);\n  const [page, setPage] = React.useState(0);\n  const [pageCount, setPageCount] = React.useState(0);\n  const [total, setTotal] = React.useState(0);\n  const [loading, setLoading] = React.useState(false);\n  const [purging, setPurging] = React.useState(false);\n  const [search, setSearch] = React.useState('');\n  const [appliedSearch, setAppliedSearch] = React.useState('');\n  const [refreshKey, setRefreshKey] = React.useState(0);\n  const [selectedIds, setSelectedIds] = React.useState<Set<string>>(new Set());\n\n  const access = typeof user?.access === 'number' ? user.access : 0;\n  const canViewArchive = hasAccess(access, ARCHIVE_ACCESS);\n  const canPurge = hasAccess(access, ACCESS_TASK_DELETE);\n\n  const visibleCount = React.useMemo(\n    () => rows.filter((row) => row.id).length,\n    [rows],\n  );\n\n  React.useEffect(() => {\n    let cancelled = false;\n    const load = async () => {\n      setLoading(true);\n      try {\n        const data = await fetchArchive({\n          page: page + 1,\n          limit: PAGE_SIZE,\n          search: appliedSearch || undefined,\n        });\n        if (cancelled) return;\n        const mapped = data.items.map((item) => {\n          const record = item as Record<string, unknown>;\n          const id = toId(record._id ?? record.id ?? record.task_number ?? '');\n          return {\n            id,\n            task_number:\n              typeof record.task_number === 'string'\n                ? record.task_number\n                : undefined,\n            title: typeof record.title === 'string' ? record.title : undefined,\n            status:\n              typeof record.status === 'string' ? record.status : undefined,\n            archived_at: normalizeDate(record.archived_at),\n            createdAt: normalizeDate(record.createdAt),\n            archived_by:\n              typeof record.archived_by === 'number' &&\n              Number.isFinite(record.archived_by)\n                ? (record.archived_by as number)\n                : undefined,\n          } satisfies ArchiveTask;\n        });\n        setRows(mapped);\n        setTotal(data.total);\n        setPageCount(data.pages);\n        setSelectedIds((prev) => {\n          const next = new Set<string>();\n          mapped.forEach((row) => {\n            if (row.id && prev.has(row.id)) {\n              next.add(row.id);\n            }\n          });\n          return next;\n        });\n        const maxPageIndex = Math.max((data.pages || 1) - 1, 0);\n        if (page > maxPageIndex) {\n          setPage(maxPageIndex);\n        }\n      } catch (error) {\n        if (!cancelled) {\n          const message =\n            error instanceof Error\n              ? error.message\n              : 'Не удалось загрузить архив задач';\n          addToast(message, 'error');\n        }\n      } finally {\n        if (!cancelled) {\n          setLoading(false);\n        }\n      }\n    };\n    if (canViewArchive) {\n      void load();\n    }\n    return () => {\n      cancelled = true;\n    };\n  }, [page, appliedSearch, refreshKey, canViewArchive, addToast]);\n\n  const handleSearchSubmit = React.useCallback(\n    (event: React.FormEvent<HTMLFormElement>) => {\n      event.preventDefault();\n      setAppliedSearch(search.trim());\n      setPage(0);\n    },\n    [search],\n  );\n\n  const handleSearchReset = React.useCallback(() => {\n    setSearch('');\n    setAppliedSearch('');\n    setPage(0);\n  }, []);\n\n  const handleToggleRow = React.useCallback((id: string, checked: boolean) => {\n    setSelectedIds((prev) => {\n      const next = new Set(prev);\n      if (checked) {\n        next.add(id);\n      } else {\n        next.delete(id);\n      }\n      return next;\n    });\n  }, []);\n\n  const handleToggleAll = React.useCallback(\n    (checked: boolean) => {\n      if (checked) {\n        const next = new Set<string>();\n        rows.forEach((row) => {\n          if (row.id) {\n            next.add(row.id);\n          }\n        });\n        setSelectedIds(next);\n      } else {\n        setSelectedIds(new Set());\n      }\n    },\n    [rows],\n  );\n\n  const handlePurge = React.useCallback(async () => {\n    if (!selectedIds.size) return;\n    setPurging(true);\n    try {\n      const removed = await purgeArchive(Array.from(selectedIds));\n      if (removed > 0) {\n        addToast(`Удалено ${removed} задач`, 'success');\n      } else {\n        addToast('Задачи не были удалены', 'error');\n      }\n      setSelectedIds(new Set());\n      setRefreshKey((prev) => prev + 1);\n    } catch (error) {\n      const message =\n        error instanceof Error\n          ? error.message\n          : 'Не удалось выполнить полное удаление';\n      addToast(message, 'error');\n    } finally {\n      setPurging(false);\n    }\n  }, [selectedIds, addToast]);\n\n  const columns = React.useMemo(\n    () =>\n      archiveColumns({\n        enableSelection: canPurge,\n        selectedIds,\n        onToggleRow: handleToggleRow,\n        onToggleAll: handleToggleAll,\n        visibleCount,\n      }),\n    [canPurge, selectedIds, handleToggleRow, handleToggleAll, visibleCount],\n  );\n\n  if (!canViewArchive) {\n    return (\n      <div className=\"space-y-4\">\n        <h1 className=\"text-2xl font-semibold\">Архив задач</h1>\n        <p className=\"text-sm text-muted-foreground\">\n          Недостаточно прав для просмотра архива.\n        </p>\n      </div>\n    );\n  }\n\n  const totalLabel = (() => {\n    const remainder10 = total % 10;\n    const remainder100 = total % 100;\n    if (remainder10 === 1 && remainder100 !== 11) return 'задача';\n    if ([2, 3, 4].includes(remainder10) && ![12, 13, 14].includes(remainder100))\n      return 'задачи';\n    return 'задач';\n  })();\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Архив задач</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Здесь отображаются удалённые задачи только для чтения.\n          </p>\n        </div>\n        {canPurge ? (\n          <Button\n            type=\"button\"\n            variant=\"destructive\"\n            disabled={!selectedIds.size || purging || loading}\n            onClick={handlePurge}\n          >\n            Полное удаление\n          </Button>\n        ) : null}\n      </div>\n      <form\n        onSubmit={handleSearchSubmit}\n        className=\"flex flex-col gap-2 sm:flex-row sm:items-center\"\n      >\n        <Input\n          value={search}\n          onChange={(event) => setSearch(event.target.value)}\n          placeholder=\"Поиск по номеру или названию\"\n          aria-label=\"Поиск по архиву\"\n        />\n        <div className=\"flex gap-2\">\n          <Button type=\"submit\" variant=\"secondary\" disabled={loading}>\n            Искать\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            disabled={loading || (!appliedSearch && !search)}\n            onClick={handleSearchReset}\n          >\n            Сбросить\n          </Button>\n        </div>\n      </form>\n      {loading ? (\n        <div className=\"text-sm text-muted-foreground\">Загрузка архива...</div>\n      ) : null}\n      <DataTable<ArchiveTask>\n        columns={columns}\n        data={rows}\n        pageIndex={page}\n        pageSize={PAGE_SIZE}\n        pageCount={pageCount}\n        onPageChange={setPage}\n        showGlobalSearch={false}\n        showFilters={false}\n      />\n      <div className=\"text-sm text-muted-foreground\">\n        Найдено {total} {totalLabel}\n      </div>\n    </div>\n  );\n}\n"],"names":["dateTimeFormatter","formatDate","value","date","archiveColumns","enableSelection","selectedIds","onToggleRow","onToggleAll","visibleCount","columns","allSelected","indeterminate","jsx","el","event","row","id","title","fetchArchive","params","query","suffix","url","response","authFetch","text","data","purgeArchive","ids","payload","PAGE_SIZE","toId","e","normalizeDate","ArchivePage","addToast","useToast","user","useAuth","rows","setRows","React","page","setPage","pageCount","setPageCount","total","setTotal","loading","setLoading","purging","setPurging","search","setSearch","appliedSearch","setAppliedSearch","refreshKey","setRefreshKey","setSelectedIds","access","canViewArchive","hasAccess","ARCHIVE_ACCESS","canPurge","ACCESS_TASK_DELETE","cancelled","mapped","item","record","_c","_b","_a","prev","next","maxPageIndex","error","message","handleSearchSubmit","handleSearchReset","handleToggleRow","checked","handleToggleAll","handlePurge","removed","jsxs","totalLabel","remainder10","remainder100","Button","Input","DataTable"],"mappings":"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"}