#!/usr/bin/env node
// patch: 022-fix-gitignore-node_modules.cjs
// purpose: гарантировать игнор node_modules и pnpm артефактов
const fs = require('fs');
const path = '.gitignore';
const rules = [
  'node_modules/',
  '.pnpm-store/',
  'pnpm-debug.log',
  '.DS_Store'
];
let cur = fs.existsSync(path) ? fs.readFileSync(path, 'utf8') : '';
const set = new Set(cur.split(/\r?\n/).filter(Boolean));
let changed = false;
for (const r of rules) {
  if (!set.has(r)) { set.add(r); changed = true; }
}
if (changed) {
  fs.writeFileSync(path, Array.from(set).join('\n') + '\n', 'utf8');
  console.log('[OK] .gitignore обновлён');
} else {
  console.log('[SKIP] .gitignore уже содержит правила');
}
