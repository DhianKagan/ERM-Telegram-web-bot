<!-- Назначение файла: правила внесения вклада в проект. -->

# Как внести вклад

Благодарим за интерес к проекту! Перед отправкой pull request выполните следующие шаги:

1. Создайте задачу через шаблон в `.github/ISSUE_TEMPLATE`.
2. Внесите изменения, следуя стилю кода из `AGENTS.md`.
3. В начале каждого файла укажите строки `// Назначение: ...` и `// Основные модули: ...`.
4. Проверьте `docker compose config` и убедитесь, что проект собирается без ошибок.
5. Запустите `./scripts/check_bot_token.sh`, чтобы убедиться в корректности `BOT_TOKEN`.
6. Обновите `README.md`, `CHANGELOG.md` и раздел «В разработке» в `ROADMAP.md`.
7. После коммита откройте pull request, кратко описав внесённые улучшения.
8. Если работаете из публичной форк-ветки, можно не добавлять секреты GitHub — workflow `Docker` подставит безопасные значения по умолчанию; реальные секреты нужны только в приватных ветках и перед выкладкой.
9. Перед отправкой PR выполните `pnpm codex:check`, чтобы убедиться в прохождении форматирования, линтинга, статического анализа и аудита зависимостей.

Ревьюеры сверяются с чек-листом из [`CODE_REVIEW_GUIDE.md`](CODE_REVIEW_GUIDE.md), прежде чем одобрять изменения.

## Требования к защите ветки `main`

Перед слиянием убедитесь, что pull request удовлетворяет правилам защиты ветки `main`:

- Слияние выполняется только через pull request; прямые коммиты запрещены, обход правил администратора выключен.
- История должна оставаться линейной (`Require linear history`).
- Все обязательные проверки завершены успешно:
  - `CI / audit-deps`;
  - `CI / lint-test-build`;
  - `CI / e2e-tests (chromium)`;
  - `CI / e2e-tests (firefox)`;
  - `CI / e2e-tests (webkit)`;
  - `Docker / build`;
  - `Lighthouse / lhci`;
  - Каждая проверка из набора `CodeQL Advanced / Analyze (…)`.
  - `Codex Quality Gate / codex-quality`.

Внутренние ветки с доступом к секрету `LHCI_GITHUB_APP_TOKEN` публикуют статусы Lighthouse CI через GitHub App и выполняют `npx lhci autorun`. Pull request из форков запускают `npx lhci collect && npx lhci assert` с `LHCI_UPLOAD__TARGET=filesystem`, поэтому отчёт остаётся на раннере, но проверка отображается успешной.

## Workflow при лимите Codex 5h/сутки

1) В чате готовим: цель → diff → тест-план → команды.
2) Запускаем `pnpm run ci:fast` (≤ 40 минут).
3) Если зелено — при необходимости `pnpm run ci:full`.
4) Любые секреты — только в переменных окружения / Secret Store.
