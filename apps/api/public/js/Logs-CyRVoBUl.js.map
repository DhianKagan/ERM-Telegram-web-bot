{"version":3,"mappings":"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","names":["ESC","ansiRegex","parseAnsiLogEntry","line","clean","match","res","msg","m","useLogsQuery","filters","page","logs","setLogs","useState","useEffect","params","authFetch","r","data","parsed","l","FiltersPanel","onChange","noCsrfId","React","jsxs","e","jsx","logColumns","DataTable","lazy","__vitePreload","LogViewer","setFilters","live","setLive","setPage","id","current","Suspense","Logs"],"ignoreList":[],"sources":["../../../web/src/utils/parseAnsiLogEntry.ts","../../../web/src/hooks/useLogsQuery.ts","../../../web/src/components/FiltersPanel.tsx","../../../web/src/columns/logColumns.ts","../../../web/src/components/LogViewer.tsx","../../../web/src/pages/Logs.tsx"],"sourcesContent":["// Назначение файла: разбор ANSI-строк логов WG Log Engine\n// Модули: регулярные выражения\n\nexport interface ParsedLog {\n  level: string;\n  time?: string;\n  method?: string;\n  status?: number;\n  endpoint?: string;\n  csrf?: boolean;\n  message: string;\n}\n\nconst ESC = '\\u001b';\nconst ansiRegex = new RegExp(`${ESC}\\\\[[0-9;]*m`, 'g');\n\nexport default function parseAnsiLogEntry(line: string): ParsedLog {\n  const clean = line.replace(ansiRegex, '');\n  const match = clean.match(/^(\\w+)\\s+\\[(.+?)\\]\\s+(.*)$/);\n  const res: ParsedLog = {\n    level: match ? match[1].toLowerCase() : 'info',\n    time: match ? match[2] : undefined,\n    message: match ? match[3] : clean,\n  };\n  const msg = res.message;\n  let m;\n  if ((m = msg.match(/API запрос (\\w+) (\\S+) token:([^ ]+) csrf:([^ ]+)/))) {\n    res.method = m[1];\n    res.endpoint = m[2];\n    res.csrf = m[4] !== 'no-csrf';\n  } else if ((m = msg.match(/API запрос (\\w+) (\\S+) (\\w+) (\\w+)/))) {\n    res.method = m[1];\n    res.endpoint = m[2];\n    res.csrf = m[4] !== 'no-csrf';\n  } else if ((m = msg.match(/API ответ (\\w+) (\\S+) (\\d+)/))) {\n    res.method = m[1];\n    res.endpoint = m[2];\n    res.status = Number(m[3]);\n  }\n  return res;\n}\n","// Назначение файла: загрузка и фильтрация логов\n// Модули: React, authFetch, parseAnsiLogEntry\nimport { useEffect, useState } from 'react';\nimport authFetch from '../utils/authFetch';\nimport parseAnsiLogEntry, { ParsedLog } from '../utils/parseAnsiLogEntry';\n\nexport interface LogFilters {\n  level?: string;\n  message?: string;\n  from?: string;\n  to?: string;\n  method?: string;\n  status?: number;\n  endpoint?: string;\n  noCsrf?: boolean;\n}\n\nexport default function useLogsQuery(filters: LogFilters, page: number) {\n  const [logs, setLogs] = useState<ParsedLog[]>([]);\n\n  useEffect(() => {\n    const params = new URLSearchParams();\n    if (filters.level) params.set('level', filters.level);\n    if (filters.message) params.set('message', filters.message);\n    if (filters.from) params.set('from', filters.from);\n    if (filters.to) params.set('to', filters.to);\n    params.set('page', String(page));\n    params.set('limit', '50');\n    authFetch(`/api/v1/logs?${params.toString()}`)\n      .then((r) => (r.ok ? r.json() : []))\n      .then((data: { message: string; level: string }[]) => {\n        const parsed = data.map((l) =>\n          parseAnsiLogEntry(`${l.level} [${l.createdAt}] ${l.message}`),\n        );\n        setLogs(parsed);\n      });\n  }, [filters, page]);\n\n  return logs.filter((l) => {\n    if (filters.method && l.method !== filters.method) return false;\n    if (filters.status && l.status !== filters.status) return false;\n    if (filters.endpoint && !(l.endpoint || '').includes(filters.endpoint))\n      return false;\n    if (filters.noCsrf && l.csrf !== false) return false;\n    return true;\n  });\n}\n","// Панель фильтров логов\n// Модули: React\nimport React from 'react';\nimport { LogFilters } from '../hooks/useLogsQuery';\n\ninterface Props {\n  filters: LogFilters;\n  onChange: (f: LogFilters) => void;\n}\n\nexport default function FiltersPanel({ filters, onChange }: Props) {\n  const noCsrfId = React.useId();\n  return (\n    <div className=\"flex flex-wrap gap-2\">\n      <select\n        className=\"rounded border p-1\"\n        aria-label=\"Уровень\"\n        name=\"level\"\n        value={filters.level || ''}\n        onChange={(e) => onChange({ ...filters, level: e.target.value })}\n      >\n        <option value=\"\">Все уровни</option>\n        <option value=\"debug\">debug</option>\n        <option value=\"info\">info</option>\n        <option value=\"warn\">warn</option>\n        <option value=\"error\">error</option>\n        <option value=\"log\">log</option>\n      </select>\n      <input\n        className=\"rounded border p-1\"\n        placeholder=\"Метод\"\n        aria-label=\"Метод\"\n        name=\"method\"\n        value={filters.method || ''}\n        onChange={(e) => onChange({ ...filters, method: e.target.value })}\n      />\n      <input\n        className=\"rounded border p-1\"\n        placeholder=\"Endpoint\"\n        aria-label=\"Endpoint\"\n        name=\"endpoint\"\n        value={filters.endpoint || ''}\n        onChange={(e) => onChange({ ...filters, endpoint: e.target.value })}\n      />\n      <input\n        className=\"rounded border p-1\"\n        placeholder=\"Статус\"\n        aria-label=\"Статус\"\n        name=\"status\"\n        value={filters.status || ''}\n        onChange={(e) =>\n          onChange({ ...filters, status: Number(e.target.value) || undefined })\n        }\n      />\n      <input\n        className=\"rounded border p-1\"\n        placeholder=\"Содержит текст\"\n        aria-label=\"Содержит текст\"\n        name=\"message\"\n        value={filters.message || ''}\n        onChange={(e) => onChange({ ...filters, message: e.target.value })}\n      />\n      <input\n        type=\"date\"\n        className=\"rounded border p-1\"\n        aria-label=\"От\"\n        name=\"from\"\n        value={filters.from || ''}\n        onChange={(e) => onChange({ ...filters, from: e.target.value })}\n      />\n      <input\n        type=\"date\"\n        className=\"rounded border p-1\"\n        aria-label=\"До\"\n        name=\"to\"\n        value={filters.to || ''}\n        onChange={(e) => onChange({ ...filters, to: e.target.value })}\n      />\n      <div className=\"flex items-center gap-1 text-sm\">\n        <input\n          id={noCsrfId}\n          name=\"noCsrf\"\n          type=\"checkbox\"\n          checked={filters.noCsrf || false}\n          onChange={(e) => onChange({ ...filters, noCsrf: e.target.checked })}\n        />\n        <label htmlFor={noCsrfId}>no-csrf</label>\n      </div>\n    </div>\n  );\n}\n","// Конфигурация колонок логов для React Table\n// Модули: @tanstack/react-table\nimport type { ColumnDef } from '@tanstack/react-table';\n\nexport interface LogRow {\n  level: string;\n  time: string;\n  method: string;\n  status: number;\n  endpoint: string;\n  message: string;\n}\n\nconst logColumns: ColumnDef<LogRow>[] = [\n  { header: 'Уровень', accessorKey: 'level' },\n  { header: 'Время', accessorKey: 'time' },\n  { header: 'Метод', accessorKey: 'method' },\n  { header: 'Статус', accessorKey: 'status' },\n  { header: 'Endpoint', accessorKey: 'endpoint' },\n  { header: 'Сообщение', accessorKey: 'message' },\n];\n\nexport default logColumns;\n","// Компонент просмотра логов на React Table\n// Модули: React, useLogsQuery, FiltersPanel, DataTable (лениво), logColumns\nimport React, { lazy, Suspense } from 'react';\nimport useLogsQuery, { LogFilters } from '../hooks/useLogsQuery';\nimport FiltersPanel from './FiltersPanel';\nconst DataTable = lazy(() => import('./DataTable'));\nimport logColumns from '../columns/logColumns';\n\nexport default function LogViewer() {\n  const [filters, setFilters] = React.useState<LogFilters>({});\n  const [live, setLive] = React.useState(true);\n  const [page, setPage] = React.useState(0);\n  const logs = useLogsQuery(filters, page + 1);\n\n  React.useEffect(() => {\n    setPage(0);\n  }, [filters]);\n\n  React.useEffect(() => {\n    if (!live) return;\n    const id = setInterval(\n      () => setFilters((current) => ({ ...current })),\n      5000,\n    );\n    return () => clearInterval(id);\n  }, [live]);\n\n  return (\n    <div className=\"space-y-4 rounded-lg bg-white p-4 shadow-sm\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-xl font-semibold\">Логи</h2>\n        <label\n          className=\"flex items-center gap-1 text-sm\"\n          htmlFor=\"log-live-toggle\"\n        >\n          <input\n            id=\"log-live-toggle\"\n            name=\"liveUpdates\"\n            type=\"checkbox\"\n            checked={live}\n            onChange={(e) => setLive(e.target.checked)}\n          />\n          Live\n        </label>\n      </div>\n      <FiltersPanel filters={filters} onChange={setFilters} />\n      <Suspense fallback={<div>Загрузка таблицы...</div>}>\n        <DataTable\n          columns={logColumns}\n          data={logs}\n          pageIndex={page}\n          pageSize={50}\n          onPageChange={setPage}\n        />\n      </Suspense>\n    </div>\n  );\n}\n","// Страница просмотра логов\nimport React from 'react';\nimport LogViewer from '../components/LogViewer';\n\nexport default function Logs() {\n  return (\n    <div className=\"space-y-6 p-4\">\n      <LogViewer />\n    </div>\n  );\n}\n"],"file":"Logs-CyRVoBUl.js"}