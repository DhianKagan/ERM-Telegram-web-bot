{"version":3,"file":"Storage-DBw_WAq7.js","sources":["../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/ArrowDownTrayIcon.js","../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/DocumentTextIcon.js","../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/DocumentIcon.js","../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/TrashIcon.js","../../../../node_modules/.pnpm/@heroicons+react@2.2.0_react@18.2.0/node_modules/@heroicons/react/24/outline/esm/VideoCameraIcon.js","../../../web/src/columns/storageColumns.tsx","../../../web/src/services/storage.ts","../../../web/src/pages/Storage.tsx"],"sourcesContent":["import * as React from \"react\";\nfunction ArrowDownTrayIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(ArrowDownTrayIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction DocumentTextIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(DocumentTextIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction DocumentIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(DocumentIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction TrashIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(TrashIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction VideoCameraIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(VideoCameraIcon);\nexport default ForwardRef;","// Конфигурация колонок таблицы файлов хранилища\n// Основные модули: React, @tanstack/react-table, heroicons\nimport React from 'react';\nimport type { ColumnDef } from '@tanstack/react-table';\nimport { ArrowDownTrayIcon, TrashIcon } from '@heroicons/react/24/outline';\nimport EmployeeLink from '../components/EmployeeLink';\nimport type { StoredFile } from '../services/storage';\n\nexport interface StorageRow extends StoredFile {\n  sizeLabel: string;\n  uploadedLabel: string;\n  userDisplay: string;\n  userHint: string;\n  taskDisplay: string;\n  taskParam?: string;\n  taskLink?: string;\n  onDownload: () => void;\n  onDelete: () => void;\n  selectedTaskId: string;\n  onTaskSelect: (taskId: string) => void;\n  onAttach: () => void;\n  attachLoading: boolean;\n  attachDisabled: boolean;\n}\n\ninterface Labels {\n  name: string;\n  user: string;\n  type: string;\n  size: string;\n  task: string;\n  uploaded: string;\n  download: string;\n  delete: string;\n  taskTitleHint: (title: string) => string;\n  attachTitle: string;\n  attachPlaceholder: string;\n  attachAction: string;\n  attachProcessing: string;\n  attachEmpty: string;\n  attachLoading: string;\n}\n\ntype TaskOption = { value: string; label: string };\n\nconst userBadgeClass = [\n  'inline-flex max-w-full items-center gap-1',\n  'rounded-full border border-blue-200 bg-blue-50 px-2 py-0.5 text-xs font-semibold text-blue-700 shadow-xs',\n  'transition-colors duration-150 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2',\n  'dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100',\n].join(' ');\n\nexport default function createStorageColumns(\n  labels: Labels,\n  options: {\n    onTaskOpen?: (taskId: string) => void;\n    taskOptions?: TaskOption[];\n    tasksLoading?: boolean;\n  } = {},\n): ColumnDef<StorageRow>[] {\n  const handleTaskOpen = options.onTaskOpen;\n  const attachOptions = options.taskOptions ?? [];\n  const isTasksLoading = Boolean(options.tasksLoading);\n  return [\n    {\n      header: labels.name,\n      accessorKey: 'name',\n      meta: { minWidth: '12rem', maxWidth: '20rem', renderAsBadges: false },\n      cell: ({ row }) => {\n        const file = row.original;\n        return (\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <span className=\"truncate font-medium\" title={file.name}>\n                {file.name}\n              </span>\n              <div className=\"flex flex-shrink-0 items-center gap-1\">\n                <button\n                  type=\"button\"\n                  onClick={(event) => {\n                    event.stopPropagation();\n                    file.onDownload();\n                  }}\n                  className=\"inline-flex items-center rounded border border-blue-200 bg-blue-50 px-2 py-1 text-xs text-blue-700 hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100\"\n                  aria-label={labels.download}\n                >\n                  <ArrowDownTrayIcon className=\"mr-1 size-4\" aria-hidden />\n                  {labels.download}\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={(event) => {\n                    event.stopPropagation();\n                    file.onDelete();\n                  }}\n                  className=\"inline-flex items-center rounded border border-red-200 bg-red-50 px-2 py-1 text-xs text-red-700 hover:bg-red-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500 dark:border-red-500/30 dark:bg-red-500/10 dark:text-red-100\"\n                  aria-label={labels.delete}\n                >\n                  <TrashIcon className=\"mr-1 size-4\" aria-hidden />\n                  {labels.delete}\n                </button>\n              </div>\n            </div>\n            <div className=\"space-y-2 rounded-md border border-border/60 bg-muted/40 p-3 text-xs\">\n              <span className=\"block font-semibold uppercase tracking-wide text-muted-foreground\">\n                {labels.attachTitle}\n              </span>\n              <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center\">\n                <select\n                  value={file.selectedTaskId}\n                  onChange={(event) => {\n                    event.stopPropagation();\n                    file.onTaskSelect(event.target.value);\n                  }}\n                  disabled={file.attachLoading || isTasksLoading}\n                  className=\"h-9 min-w-[12rem] rounded-md border border-input bg-background px-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\"\n                >\n                  <option value=\"\">{labels.attachPlaceholder}</option>\n                  {attachOptions.map((option) => (\n                    <option key={option.value} value={option.value}>\n                      {option.label}\n                    </option>\n                  ))}\n                </select>\n                <button\n                  type=\"button\"\n                  onClick={(event) => {\n                    event.stopPropagation();\n                    file.onAttach();\n                  }}\n                  className=\"inline-flex items-center justify-center rounded-md border border-blue-200 bg-blue-600 px-3 py-1.5 text-xs font-semibold text-white transition hover:bg-blue-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:border-border disabled:bg-muted disabled:text-muted-foreground\"\n                  disabled={file.attachDisabled}\n                >\n                  {file.attachLoading\n                    ? labels.attachProcessing\n                    : labels.attachAction}\n                </button>\n              </div>\n              {isTasksLoading ? (\n                <span className=\"block text-muted-foreground\">\n                  {labels.attachLoading}\n                </span>\n              ) : attachOptions.length === 0 ? (\n                <span className=\"block text-muted-foreground\">\n                  {labels.attachEmpty}\n                </span>\n              ) : null}\n            </div>\n          </div>\n        );\n      },\n    },\n    {\n      header: labels.user,\n      accessorKey: 'userDisplay',\n      meta: { minWidth: '8rem', maxWidth: '12rem', renderAsBadges: false },\n      cell: ({ row }) => {\n        const file = row.original;\n        const label = file.userDisplay;\n        if (!file.userId) {\n          return (\n            <span className=\"truncate text-sm\" title={file.userHint}>\n              {label}\n            </span>\n          );\n        }\n        return (\n          <EmployeeLink\n            employeeId={file.userId}\n            stopPropagation\n            className={userBadgeClass}\n            title={file.userHint}\n          >\n            <span className=\"truncate\">{label}</span>\n          </EmployeeLink>\n        );\n      },\n    },\n    {\n      header: labels.type,\n      accessorKey: 'type',\n      meta: { minWidth: '8rem', maxWidth: '10rem' },\n      cell: ({ row }) => row.original.type || '',\n    },\n    {\n      header: labels.size,\n      accessorKey: 'sizeLabel',\n      meta: { minWidth: '6rem', maxWidth: '8rem' },\n      cell: ({ row }) => row.original.sizeLabel,\n    },\n    {\n      header: labels.task,\n      accessorKey: 'taskDisplay',\n      meta: { minWidth: '10rem', maxWidth: '16rem', renderAsBadges: false },\n      cell: ({ row }) => {\n        const file = row.original;\n        const content = (\n          <span className=\"block\">\n            {file.taskDisplay}\n            {file.taskTitle ? (\n              <span className=\"block text-xs text-muted-foreground\">\n                {file.taskTitle}\n              </span>\n            ) : null}\n          </span>\n        );\n        if (!file.taskParam) {\n          return content;\n        }\n        if (handleTaskOpen) {\n          return (\n            <button\n              type=\"button\"\n              onClick={(event) => {\n                event.stopPropagation();\n                handleTaskOpen(file.taskParam as string);\n              }}\n              className=\"inline-flex w-full flex-col items-start gap-0.5 rounded-lg border border-blue-200 bg-blue-50 px-2 py-1 text-left text-xs font-semibold text-blue-700 transition hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100\"\n              title={\n                file.taskTitle\n                  ? labels.taskTitleHint(file.taskTitle)\n                  : undefined\n              }\n            >\n              {content}\n            </button>\n          );\n        }\n        if (file.taskLink) {\n          return (\n            <a\n              href={file.taskLink}\n              className=\"inline-flex w-full flex-col items-start gap-0.5 rounded-lg border border-blue-200 bg-blue-50 px-2 py-1 text-left text-xs font-semibold text-blue-700 no-underline transition hover:bg-blue-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-blue-500/30 dark:bg-blue-500/10 dark:text-blue-100\"\n              onClick={(event) => event.stopPropagation()}\n              title={\n                file.taskTitle\n                  ? labels.taskTitleHint(file.taskTitle)\n                  : undefined\n              }\n            >\n              {content}\n            </a>\n          );\n        }\n        return content;\n      },\n    },\n    {\n      header: labels.uploaded,\n      accessorKey: 'uploadedLabel',\n      meta: { minWidth: '10rem', maxWidth: '12rem' },\n      cell: ({ row }) => row.original.uploadedLabel,\n    },\n  ];\n}\n","// Назначение: запросы к API хранения файлов\n// Основные модули: authFetch\nimport authFetch from '../utils/authFetch';\n\nexport interface StoredFile {\n  id: string;\n  path: string;\n  userId: number;\n  name: string;\n  type: string;\n  url: string;\n  thumbnailUrl?: string;\n  previewUrl?: string;\n  size?: number;\n  uploadedAt?: string;\n  taskId?: string | number | null;\n  taskNumber?: string | null;\n  taskTitle?: string | null;\n}\n\nexport interface StorageDiagnosticsReport {\n  generatedAt: string;\n  snapshot: {\n    totalFiles: number;\n    linkedFiles: number;\n    detachedFiles: number;\n  };\n  detachedFiles: Array<{\n    id: string;\n    name: string;\n    path: string;\n    size: number;\n    uploadedAt: string;\n    userId: number;\n  }>;\n}\n\nexport const fetchFiles = (params?: { userId?: number; type?: string }) => {\n  const qs = new URLSearchParams();\n  if (params?.userId) qs.set('userId', String(params.userId));\n  if (params?.type) qs.set('type', params.type);\n  const url = `/api/v1/storage${qs.toString() ? `?${qs}` : ''}`;\n  return authFetch(url).then((r) => (r.ok ? r.json() : [])) as Promise<\n    StoredFile[]\n  >;\n};\n\nexport const fetchFile = (id: string) =>\n  authFetch(`/api/v1/storage/${encodeURIComponent(id)}`).then((res) =>\n    res.ok ? (res.json() as Promise<StoredFile>) : Promise.reject(res),\n  );\n\nexport const removeFile = (id: string) =>\n  authFetch(`/api/v1/storage/${encodeURIComponent(id)}`, {\n    method: 'DELETE',\n  });\n\nexport const runDiagnostics = async (): Promise<StorageDiagnosticsReport> => {\n  const response = await authFetch(`/api/v1/storage/diagnostics`);\n  if (!response.ok) {\n    throw new Error('diagnostics');\n  }\n  return (await response.json()) as StorageDiagnosticsReport;\n};\n\nexport default { fetchFiles, fetchFile, removeFile, runDiagnostics };\n","// Страница управления файлами: таблица, фильтры и карточка файла\n// Основные модули: React, DataTable, heroicons, storageService, react-router\nimport React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useSearchParams } from 'react-router-dom';\nimport {\n  ArrowDownTrayIcon,\n  DocumentIcon,\n  DocumentTextIcon,\n  PhotoIcon,\n  VideoCameraIcon,\n  TrashIcon,\n} from '@heroicons/react/24/outline';\n\nimport Breadcrumbs from '../components/Breadcrumbs';\nimport DataTable from '../components/DataTable';\nimport Modal from '../components/Modal';\nimport { Button } from '../components/ui/button';\nimport { Input } from '../components/ui/input';\nimport createStorageColumns, {\n  type StorageRow,\n} from '../columns/storageColumns';\nimport {\n  fetchFile,\n  fetchFiles,\n  removeFile,\n  runDiagnostics,\n  type StorageDiagnosticsReport,\n  type StoredFile,\n} from '../services/storage';\nimport { fetchUsers } from '../services/users';\nimport type { User } from '../types/user';\nimport authFetch from '../utils/authFetch';\nimport { showToast } from '../utils/toast';\nimport { PROJECT_TIMEZONE, PROJECT_TIMEZONE_LABEL } from 'shared';\n\nconst PAGE_SIZE = 25;\n\nconst dateTimeFormatter = new Intl.DateTimeFormat('ru-RU', {\n  day: '2-digit',\n  month: '2-digit',\n  year: 'numeric',\n  hour: '2-digit',\n  minute: '2-digit',\n  hour12: false,\n  timeZone: PROJECT_TIMEZONE,\n});\n\ntype SortOption = 'uploaded_desc' | 'uploaded_asc' | 'size_desc' | 'size_asc';\n\ntype PreviewMode = 'image' | 'video' | 'pdf' | 'text';\n\ntype PreviewState = {\n  mode: PreviewMode;\n  inlineUrl: string;\n  mime: string;\n  loading?: boolean;\n  error?: string;\n  content?: string;\n};\n\ntype TaskOption = {\n  id: string;\n  label: string;\n  title: string;\n  number?: string | null;\n  changedAt: number;\n};\n\nconst previewIcons: Record<\n  PreviewMode,\n  React.ComponentType<{ className?: string }>\n> = {\n  image: PhotoIcon,\n  video: VideoCameraIcon,\n  pdf: DocumentIcon,\n  text: DocumentTextIcon,\n};\n\nfunction isTextLike(mime: string): boolean {\n  return (\n    mime.startsWith('text/') ||\n    mime.includes('json') ||\n    mime.endsWith('xml') ||\n    mime === 'application/sql'\n  );\n}\n\nfunction formatSize(bytes: number | undefined): string {\n  if (!bytes || Number.isNaN(bytes)) return '—';\n  if (bytes <= 0) return '0 Б';\n  const units = ['Б', 'КБ', 'МБ', 'ГБ', 'ТБ'];\n  const index = Math.min(\n    Math.floor(Math.log(bytes) / Math.log(1024)),\n    units.length - 1,\n  );\n  const value = bytes / Math.pow(1024, index);\n  return `${value.toFixed(value >= 10 || index === 0 ? 0 : 1)} ${units[index]}`;\n}\n\nfunction formatDate(value?: string): string {\n  if (!value) return '—';\n  const time = Date.parse(value);\n  if (Number.isNaN(time)) return '—';\n  const label = dateTimeFormatter.format(new Date(time)).replace(', ', ' ');\n  return `${label} ${PROJECT_TIMEZONE_LABEL}`;\n}\n\nexport default function StoragePage() {\n  const { t } = useTranslation();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const [files, setFiles] = React.useState<StoredFile[]>([]);\n  const [loading, setLoading] = React.useState(false);\n  const [usersById, setUsersById] = React.useState<Record<number, User>>({});\n  const [search, setSearch] = React.useState('');\n  const [sort, setSort] = React.useState<SortOption>('uploaded_desc');\n  const [pageIndex, setPageIndex] = React.useState(0);\n  const [selectedId, setSelectedId] = React.useState<string | null>(\n    searchParams.get('file'),\n  );\n  const [selectedFile, setSelectedFile] = React.useState<StoredFile | null>(\n    null,\n  );\n  const [detailsLoading, setDetailsLoading] = React.useState(false);\n  const [preview, setPreview] = React.useState<PreviewState | null>(null);\n  const [tasksLoading, setTasksLoading] = React.useState(false);\n  const [taskOptions, setTaskOptions] = React.useState<TaskOption[]>([]);\n  const [taskMetaById, setTaskMetaById] = React.useState<\n    Record<string, TaskOption>\n  >({});\n  const [selectionByFile, setSelectionByFile] = React.useState<\n    Record<string, string>\n  >({});\n  const [attachLoadingId, setAttachLoadingId] = React.useState<string | null>(\n    null,\n  );\n\n  const [diagnostics, setDiagnostics] =\n    React.useState<StorageDiagnosticsReport | null>(null);\n  const [diagnosticsLoading, setDiagnosticsLoading] = React.useState(false);\n  const [diagnosticsError, setDiagnosticsError] = React.useState<string | null>(\n    null,\n  );\n\n  const attachFileToTask = React.useCallback(\n    async (fileId: string, taskId: string): Promise<void> => {\n      const response = await authFetch(\n        `/api/v1/files/${encodeURIComponent(fileId)}/attach`,\n        {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ taskId }),\n        },\n      );\n      if (!response.ok) {\n        const error = new Error('attach');\n        (error as { status?: number }).status = response.status;\n        throw error;\n      }\n      await response.json().catch(() => ({}));\n    },\n    [],\n  );\n\n  const loadFiles = React.useCallback(() => {\n    setLoading(true);\n    return fetchFiles()\n      .then((list) => {\n        setFiles(Array.isArray(list) ? list : []);\n      })\n      .catch(() => {\n        showToast(t('storage.loadError'), 'error');\n      })\n      .finally(() => setLoading(false));\n  }, [t]);\n\n  const detachedCount = React.useMemo(\n    () => files.filter((file) => !file.taskId).length,\n    [files],\n  );\n\n  const handleDiagnostics = React.useCallback(() => {\n    setDiagnosticsLoading(true);\n    setDiagnosticsError(null);\n    return runDiagnostics()\n      .then((report) => {\n        setDiagnostics(report);\n        showToast(t('storage.diagnostics.success'), 'success');\n        return loadFiles();\n      })\n      .catch(() => {\n        setDiagnosticsError(t('storage.diagnostics.error'));\n        showToast(t('storage.diagnostics.error'), 'error');\n      })\n      .finally(() => {\n        setDiagnosticsLoading(false);\n      });\n  }, [loadFiles, t]);\n\n  React.useEffect(() => {\n    void loadFiles();\n  }, [loadFiles]);\n\n  React.useEffect(() => {\n    let active = true;\n    fetchUsers()\n      .then((list) => {\n        if (!active) return;\n        const map: Record<number, User> = {};\n        list.forEach((user) => {\n          if (typeof user.telegram_id === 'number') {\n            map[user.telegram_id] = user;\n          }\n        });\n        setUsersById(map);\n      })\n      .catch(() => {\n        showToast(t('storage.usersLoadError'), 'error');\n      });\n    return () => {\n      active = false;\n    };\n  }, [t]);\n\n  React.useEffect(() => {\n    let cancelled = false;\n    setTasksLoading(true);\n    authFetch('/api/v1/tasks/mentioned')\n      .then((res) => (res.ok ? res.json() : []))\n      .then((data) => {\n        if (cancelled) return;\n        const list = Array.isArray(data)\n          ? (data as Record<string, unknown>[])\n          : [];\n        const normalized = list\n          .map((task): TaskOption | null => {\n            const rawId =\n              typeof (task as { _id?: unknown })._id === 'string'\n                ? ((task as { _id: string })._id ?? '').trim()\n                : typeof (task as { id?: unknown }).id === 'string'\n                  ? ((task as { id: string }).id ?? '').trim()\n                  : '';\n            if (!rawId) {\n              return null;\n            }\n            const rawTitle = (task as { title?: unknown }).title;\n            const title =\n              typeof rawTitle === 'string' && rawTitle.trim().length > 0\n                ? rawTitle.trim()\n                : t('storage.attach.untitled');\n            const rawNumber = (task as { task_number?: unknown }).task_number;\n            const number =\n              typeof rawNumber === 'string' && rawNumber.trim().length > 0\n                ? rawNumber.trim()\n                : null;\n            const timestamps = [\n              (task as { changed_at?: unknown }).changed_at,\n              (task as { changedAt?: unknown }).changedAt,\n              (task as { updatedAt?: unknown }).updatedAt,\n              (task as { createdAt?: unknown }).createdAt,\n              (task as { submission_date?: unknown }).submission_date,\n            ];\n            const changedAt = timestamps\n              .map((value) => {\n                if (value instanceof Date) {\n                  const time = value.getTime();\n                  return Number.isNaN(time) ? 0 : time;\n                }\n                if (typeof value === 'string') {\n                  const time = Date.parse(value);\n                  return Number.isNaN(time) ? 0 : time;\n                }\n                if (typeof value === 'number' && Number.isFinite(value)) {\n                  return value;\n                }\n                return 0;\n              })\n              .reduce((max, current) => (current > max ? current : max), 0);\n            const shortId = rawId.slice(-6) || rawId;\n            const label = number\n              ? t('storage.attach.optionNumber', { number, title })\n              : t('storage.attach.optionId', { id: shortId, title });\n            return { id: rawId, label, title, number, changedAt };\n          })\n          .filter((item): item is TaskOption => Boolean(item));\n        normalized.sort((a, b) => b.changedAt - a.changedAt);\n        const limited = normalized.slice(0, 6);\n        const meta = limited.reduce<Record<string, TaskOption>>(\n          (acc, option) => {\n            acc[option.id] = option;\n            return acc;\n          },\n          {},\n        );\n        setTaskOptions(limited);\n        setTaskMetaById(meta);\n      })\n      .catch(() => {\n        if (cancelled) return;\n        setTaskOptions([]);\n        setTaskMetaById({});\n        showToast(t('storage.attach.tasksLoadError'), 'error');\n      })\n      .finally(() => {\n        if (!cancelled) {\n          setTasksLoading(false);\n        }\n      });\n    return () => {\n      cancelled = true;\n    };\n  }, [t]);\n\n  React.useEffect(() => {\n    if (!taskOptions.length) {\n      setSelectionByFile((current) =>\n        Object.keys(current).length ? ({} as Record<string, string>) : current,\n      );\n      return;\n    }\n    const validIds = new Set(taskOptions.map((option) => option.id));\n    setSelectionByFile((current) => {\n      let changed = false;\n      const next: Record<string, string> = {};\n      Object.entries(current).forEach(([fileId, value]) => {\n        if (value && validIds.has(value)) {\n          next[fileId] = value;\n        } else if (value) {\n          changed = true;\n        }\n      });\n      return changed ? next : current;\n    });\n  }, [taskOptions]);\n\n  React.useEffect(() => {\n    const queryId = searchParams.get('file');\n    setSelectedId(queryId);\n  }, [searchParams]);\n\n  React.useEffect(() => {\n    if (!selectedId) {\n      setSelectedFile(null);\n      setDetailsLoading(false);\n      setPreview(null);\n      return;\n    }\n    const existing = files.find((file) => file.id === selectedId);\n    if (existing) {\n      setSelectedFile(existing);\n      return;\n    }\n    setDetailsLoading(true);\n    fetchFile(selectedId)\n      .then((file) => {\n        setSelectedFile(file);\n      })\n      .catch(() => {\n        showToast(t('storage.loadError'), 'error');\n        setSelectedFile(null);\n      })\n      .finally(() => setDetailsLoading(false));\n  }, [selectedId, files, t]);\n\n  React.useEffect(() => {\n    if (!selectedFile) {\n      setPreview(null);\n      return;\n    }\n    const mime = selectedFile.type || 'application/octet-stream';\n    const inlineUrl =\n      selectedFile.previewUrl || `${selectedFile.url}?mode=inline`;\n    if (mime.startsWith('image/')) {\n      setPreview({ mode: 'image', inlineUrl, mime });\n      return;\n    }\n    if (mime.startsWith('video/')) {\n      setPreview({ mode: 'video', inlineUrl, mime });\n      return;\n    }\n    if (mime === 'application/pdf') {\n      setPreview({ mode: 'pdf', inlineUrl, mime });\n      return;\n    }\n    if (isTextLike(mime)) {\n      let cancelled = false;\n      setPreview({ mode: 'text', inlineUrl, mime, loading: true });\n      authFetch(inlineUrl)\n        .then((res) => {\n          if (!res.ok) throw new Error('preview');\n          return res.text();\n        })\n        .then((content) => {\n          if (cancelled) return;\n          setPreview({ mode: 'text', inlineUrl, mime, content });\n        })\n        .catch(() => {\n          if (cancelled) return;\n          setPreview({\n            mode: 'text',\n            inlineUrl,\n            mime,\n            error: t('storage.previewError'),\n          });\n        });\n      return () => {\n        cancelled = true;\n      };\n    }\n    setPreview(null);\n    // неподдерживаемые типы доступны только для скачивания\n  }, [selectedFile, t]);\n\n  const filteredFiles = React.useMemo(() => {\n    const query = search.trim().toLowerCase();\n    return files.filter((file) =>\n      query ? file.name.toLowerCase().includes(query) : true,\n    );\n  }, [files, search]);\n\n  const sortedFiles = React.useMemo(() => {\n    const list = [...filteredFiles];\n    list.sort((a, b) => {\n      switch (sort) {\n        case 'uploaded_asc': {\n          const left = Date.parse(a.uploadedAt || '');\n          const right = Date.parse(b.uploadedAt || '');\n          return (left || 0) - (right || 0);\n        }\n        case 'uploaded_desc': {\n          const left = Date.parse(a.uploadedAt || '');\n          const right = Date.parse(b.uploadedAt || '');\n          return (right || 0) - (left || 0);\n        }\n        case 'size_asc':\n          return (a.size || 0) - (b.size || 0);\n        case 'size_desc':\n          return (b.size || 0) - (a.size || 0);\n        default:\n          return 0;\n      }\n    });\n    return list;\n  }, [filteredFiles, sort]);\n\n  const pagedFiles = React.useMemo(() => {\n    const start = pageIndex * PAGE_SIZE;\n    return sortedFiles.slice(start, start + PAGE_SIZE);\n  }, [sortedFiles, pageIndex]);\n\n  const taskOptionsForSelect = React.useMemo(\n    () =>\n      taskOptions.map((option) => ({ value: option.id, label: option.label })),\n    [taskOptions],\n  );\n\n  const handleDownload = React.useCallback(\n    (file: StoredFile) => {\n      if (!file.url) return;\n      window.open(file.url, '_blank', 'noopener,noreferrer');\n      showToast(t('storage.openedInNewTab'), 'success');\n    },\n    [t],\n  );\n\n  const handleDelete = React.useCallback(\n    (file: StoredFile) => {\n      const confirmed = window.confirm(\n        t('storage.deleteConfirm', { name: file.name }),\n      );\n      if (!confirmed) return;\n      removeFile(file.id)\n        .then((res) => {\n          if (!res.ok) throw new Error('delete');\n          showToast(t('storage.deleteSuccess'), 'success');\n          setFiles((current) =>\n            current.filter((candidate) => candidate.id !== file.id),\n          );\n          if (selectedId === file.id) {\n            const next = new URLSearchParams(searchParams.toString());\n            next.delete('file');\n            setSearchParams(next, { replace: true });\n          }\n        })\n        .catch(() => {\n          showToast(t('storage.deleteError'), 'error');\n        });\n    },\n    [searchParams, selectedId, setSearchParams, t],\n  );\n\n  const handleAttach = React.useCallback(\n    (file: StoredFile) => {\n      const selectedTaskId = selectionByFile[file.id];\n      if (!selectedTaskId) {\n        return;\n      }\n      if (!taskOptions.some((option) => option.id === selectedTaskId)) {\n        return;\n      }\n      setAttachLoadingId(file.id);\n      attachFileToTask(file.id, selectedTaskId)\n        .then(() => {\n          const meta = taskMetaById[selectedTaskId];\n          setFiles((current) =>\n            current.map((candidate) =>\n              candidate.id === file.id\n                ? {\n                    ...candidate,\n                    taskId: selectedTaskId,\n                    taskNumber: meta?.number ?? candidate.taskNumber ?? null,\n                    taskTitle: meta?.title ?? candidate.taskTitle ?? null,\n                  }\n                : candidate,\n            ),\n          );\n          if (selectedId === file.id) {\n            setSelectedFile((current) =>\n              current\n                ? {\n                    ...current,\n                    taskId: selectedTaskId,\n                    taskNumber: meta?.number ?? current.taskNumber ?? null,\n                    taskTitle: meta?.title ?? current.taskTitle ?? null,\n                  }\n                : current,\n            );\n          }\n          showToast(t('storage.attach.success'), 'success');\n        })\n        .catch((error) => {\n          const status = (error as { status?: number }).status;\n          if (status === 403) {\n            showToast(t('storage.attach.forbidden'), 'error');\n          } else {\n            showToast(t('storage.attach.error'), 'error');\n          }\n        })\n        .finally(() => {\n          setAttachLoadingId((current) =>\n            current === file.id ? null : current,\n          );\n        });\n    },\n    [\n      attachFileToTask,\n      selectionByFile,\n      taskOptions,\n      taskMetaById,\n      setFiles,\n      selectedId,\n      setSelectedFile,\n      t,\n    ],\n  );\n\n  const toRow = React.useCallback(\n    (file: StoredFile): StorageRow => {\n      const hasTaskId = file.taskId != null && file.taskId !== '';\n      const normalizedTaskId = hasTaskId ? String(file.taskId) : undefined;\n      const normalizedTitle =\n        typeof file.taskTitle === 'string' && file.taskTitle.trim()\n          ? file.taskTitle.trim()\n          : undefined;\n      const identifier = hasTaskId\n        ? file.taskNumber && file.taskNumber !== ''\n          ? t('storage.taskNumberLabel', { number: file.taskNumber })\n          : t('storage.taskLabel', { id: normalizedTaskId })\n        : t('storage.taskMissing');\n      const user =\n        typeof file.userId === 'number' ? usersById[file.userId] : undefined;\n      const displayName =\n        (typeof user?.name === 'string' && user.name.trim()) ||\n        (typeof user?.telegram_username === 'string' &&\n          user.telegram_username.trim()) ||\n        (typeof user?.username === 'string' && user.username.trim()) ||\n        t('storage.userLabel', { id: file.userId });\n      const userHint =\n        typeof file.userId === 'number'\n          ? t('storage.details.userId', { id: file.userId })\n          : t('storage.details.userId', { id: '—' });\n      let taskLink: string | undefined;\n      if (normalizedTaskId) {\n        const paramsWithTask = new URLSearchParams(searchParams.toString());\n        paramsWithTask.set('task', normalizedTaskId);\n        taskLink = `?${paramsWithTask.toString()}`;\n      }\n      const selectedCandidate = selectionByFile[file.id] ?? '';\n      const hasValidSelection = taskOptions.some(\n        (option) => option.id === selectedCandidate,\n      );\n      const selectedTaskId = hasValidSelection ? selectedCandidate : '';\n      return {\n        ...file,\n        taskTitle: normalizedTitle,\n        sizeLabel: formatSize(file.size),\n        uploadedLabel: formatDate(file.uploadedAt),\n        userDisplay: displayName,\n        userHint,\n        taskDisplay: identifier,\n        taskParam: normalizedTaskId,\n        taskLink,\n        onDownload: () => handleDownload(file),\n        onDelete: () => handleDelete(file),\n        selectedTaskId,\n        onTaskSelect: (taskId: string) => {\n          setSelectionByFile((current) => ({ ...current, [file.id]: taskId }));\n        },\n        onAttach: () => handleAttach(file),\n        attachLoading: attachLoadingId === file.id,\n        attachDisabled:\n          attachLoadingId === file.id ||\n          tasksLoading ||\n          !taskOptions.length ||\n          !hasValidSelection,\n      };\n    },\n    [\n      attachLoadingId,\n      handleAttach,\n      handleDelete,\n      handleDownload,\n      searchParams,\n      selectionByFile,\n      setSelectionByFile,\n      t,\n      taskOptions,\n      tasksLoading,\n      usersById,\n    ],\n  );\n\n  const rows = React.useMemo<StorageRow[]>(\n    () => pagedFiles.map((file) => toRow(file)),\n    [pagedFiles, toRow],\n  );\n\n  const pageCount = React.useMemo(() => {\n    if (!sortedFiles.length) return 1;\n    return Math.max(1, Math.ceil(sortedFiles.length / PAGE_SIZE));\n  }, [sortedFiles.length]);\n\n  const openTaskDialog = React.useCallback(\n    (taskId?: string) => {\n      if (!taskId) return;\n      const next = new URLSearchParams(searchParams.toString());\n      next.set('task', taskId);\n      setSearchParams(next, { replace: false });\n    },\n    [searchParams, setSearchParams],\n  );\n\n  const closeModal = React.useCallback(() => {\n    const next = new URLSearchParams(searchParams.toString());\n    next.delete('file');\n    setSearchParams(next, { replace: true });\n  }, [searchParams, setSearchParams]);\n\n  const selectedRow = React.useMemo(\n    () => (selectedFile ? toRow(selectedFile) : null),\n    [selectedFile, toRow],\n  );\n\n  const details = React.useMemo(() => {\n    if (!selectedRow) return [];\n    const empty = t('storage.details.empty');\n    return [\n      {\n        key: 'task',\n        label: t('storage.details.task'),\n        value: selectedRow.taskDisplay,\n      },\n      {\n        key: 'taskNumber',\n        label: t('storage.details.taskNumber'),\n        value: selectedRow.taskNumber || empty,\n      },\n      {\n        key: 'taskId',\n        label: t('storage.details.taskId'),\n        value: selectedRow.taskId || empty,\n      },\n      {\n        key: 'taskTitle',\n        label: t('storage.details.taskTitle'),\n        value: selectedRow.taskTitle || empty,\n      },\n      {\n        key: 'user',\n        label: t('storage.details.user'),\n        value: (\n          <span className=\"flex flex-col\">\n            {selectedRow.userDisplay}\n            <span className=\"text-xs text-muted-foreground\">\n              {selectedRow.userHint}\n            </span>\n          </span>\n        ),\n      },\n      {\n        key: 'uploaded',\n        label: t('storage.details.uploaded'),\n        value: selectedRow.uploadedLabel || empty,\n      },\n      {\n        key: 'size',\n        label: t('storage.details.size'),\n        value: selectedRow.sizeLabel || empty,\n      },\n      {\n        key: 'type',\n        label: t('storage.details.type'),\n        value: selectedRow.type || empty,\n      },\n      {\n        key: 'path',\n        label: t('storage.details.path'),\n        value: <code className=\"break-all text-xs\">{selectedRow.path}</code>,\n      },\n    ];\n  }, [selectedRow, t]);\n\n  const previewIcon = preview ? previewIcons[preview.mode] : null;\n  const diagnosticsTimestamp = React.useMemo(\n    () => (diagnostics ? formatDate(diagnostics.generatedAt) : null),\n    [diagnostics],\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      <Breadcrumbs items={[{ label: t('storage.title') }]} />\n      <section className=\"rounded border border-amber-300 bg-amber-50 p-5 shadow-sm\">\n        <div className=\"flex flex-col gap-4 md:flex-row md:items-start md:justify-between\">\n          <div className=\"space-y-2\">\n            <h2 className=\"text-base font-semibold text-amber-900\">\n              {t('storage.diagnostics.title')}\n            </h2>\n            <p className=\"text-sm text-amber-800\">\n              {t('storage.diagnostics.description')}\n            </p>\n            <p className=\"text-sm text-amber-900\">\n              {detachedCount === 0\n                ? t('storage.sync.ok', { count: files.length })\n                : t('storage.sync.warning', { count: detachedCount })}\n            </p>\n          </div>\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            className=\"self-start border-amber-400 text-amber-900 hover:bg-amber-100\"\n            disabled={diagnosticsLoading}\n            onClick={() => {\n              void handleDiagnostics();\n            }}\n          >\n            {diagnosticsLoading\n              ? t('storage.diagnostics.progress')\n              : t('storage.diagnostics.cta')}\n          </Button>\n        </div>\n        {diagnosticsError ? (\n          <p className=\"mt-3 text-sm text-red-700\">{diagnosticsError}</p>\n        ) : null}\n        {diagnostics ? (\n          <div className=\"mt-3 space-y-1 text-sm text-amber-900\">\n            <p>\n              {t('storage.diagnostics.lastRun', {\n                date: diagnosticsTimestamp ?? '—',\n              })}\n            </p>\n            <p>\n              {t('storage.diagnostics.snapshot', {\n                total: diagnostics.snapshot.totalFiles,\n                linked: diagnostics.snapshot.linkedFiles,\n                detached: diagnostics.snapshot.detachedFiles,\n              })}\n            </p>\n          </div>\n        ) : (\n          <p className=\"mt-3 text-sm text-amber-800\">\n            {t('storage.diagnostics.placeholder')}\n          </p>\n        )}\n      </section>\n      <section className=\"space-y-5 rounded border border-border bg-card p-5 shadow-sm\">\n        <header className=\"flex flex-col gap-4 border-b border-border pb-4\">\n          <div className=\"flex flex-col gap-1\">\n            <h2 className=\"text-lg font-semibold text-foreground\">\n              {t('storage.title')}\n            </h2>\n            <p className=\"text-sm text-muted-foreground\">\n              {t('storage.total', { count: filteredFiles.length })}\n            </p>\n          </div>\n          <div className=\"flex flex-col gap-2 md:flex-row md:items-center md:justify-between\">\n            <div className=\"flex flex-wrap items-center gap-2\">\n              <Input\n                value={search}\n                onChange={(event) => {\n                  setSearch(event.target.value);\n                  setPageIndex(0);\n                }}\n                placeholder={t('storage.searchPlaceholder') ?? ''}\n                className=\"max-w-xs\"\n              />\n              <select\n                value={sort}\n                onChange={(event) => {\n                  setSort(event.target.value as SortOption);\n                  setPageIndex(0);\n                }}\n                className=\"h-9 rounded-md border border-input bg-background px-2 text-sm\"\n              >\n                <option value=\"uploaded_desc\">\n                  {t('storage.sort.uploadedDesc')}\n                </option>\n                <option value=\"uploaded_asc\">\n                  {t('storage.sort.uploadedAsc')}\n                </option>\n                <option value=\"size_desc\">{t('storage.sort.sizeDesc')}</option>\n                <option value=\"size_asc\">{t('storage.sort.sizeAsc')}</option>\n              </select>\n              <Button\n                type=\"button\"\n                variant=\"secondary\"\n                onClick={() => void loadFiles()}\n                disabled={loading}\n              >\n                {t('storage.refresh')}\n              </Button>\n            </div>\n            <div className=\"text-xs text-muted-foreground md:text-sm\">\n              {loading ? t('loading') : null}\n            </div>\n          </div>\n        </header>\n        <DataTable<StorageRow>\n          columns={createStorageColumns(\n            {\n              name: t('storage.columns.name'),\n              user: t('storage.columns.user'),\n              type: t('storage.columns.type'),\n              size: t('storage.columns.size'),\n              task: t('storage.columns.task'),\n              uploaded: t('storage.columns.uploaded'),\n              download: t('storage.download'),\n              delete: t('storage.delete'),\n              taskTitleHint: (title: string) =>\n                t('storage.taskTitleHint', { title }),\n              attachTitle: t('storage.attach.title'),\n              attachPlaceholder: t('storage.attach.placeholder'),\n              attachAction: t('storage.attach.button'),\n              attachProcessing: t('storage.attach.processing'),\n              attachEmpty: t('storage.attach.empty'),\n              attachLoading: t('storage.attach.loading'),\n            },\n            {\n              onTaskOpen: openTaskDialog,\n              taskOptions: taskOptionsForSelect,\n              tasksLoading,\n            },\n          )}\n          data={rows}\n          pageIndex={pageIndex}\n          pageSize={PAGE_SIZE}\n          pageCount={pageCount}\n          onPageChange={setPageIndex}\n          showGlobalSearch={false}\n          showFilters={false}\n          wrapCellsAsBadges\n          onRowClick={(row) => {\n            const next = new URLSearchParams(searchParams.toString());\n            next.set('file', row.id);\n            setSearchParams(next, { replace: false });\n          }}\n        />\n      </section>\n      <Modal open={Boolean(selectedId)} onClose={closeModal}>\n        {detailsLoading ? (\n          <div className=\"p-4 text-center text-sm text-muted-foreground\">\n            {t('loading')}\n          </div>\n        ) : selectedRow ? (\n          <div className=\"space-y-4\">\n            <header className=\"flex items-start justify-between gap-4\">\n              <div>\n                <h2 className=\"text-lg font-semibold\">{selectedRow.name}</h2>\n                <p className=\"text-sm text-muted-foreground\">\n                  {selectedRow.type || t('storage.details.type')}\n                </p>\n              </div>\n              <div className=\"flex flex-wrap items-center gap-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => handleDownload(selectedRow)}\n                >\n                  <ArrowDownTrayIcon className=\"mr-2 size-4\" />\n                  {t('storage.download')}\n                </Button>\n                <Button\n                  type=\"button\"\n                  variant=\"destructive\"\n                  onClick={() => handleDelete(selectedRow)}\n                >\n                  <TrashIcon className=\"mr-2 size-4\" />\n                  {t('storage.delete')}\n                </Button>\n              </div>\n            </header>\n            {preview ? (\n              <div className=\"space-y-2 rounded-lg border border-dashed border-border p-4\">\n                <div className=\"flex items-center gap-2 text-sm font-semibold\">\n                  {previewIcon ? <previewIcon className=\"size-5\" /> : null}\n                  <span>{t('storage.previewTitle')}</span>\n                  <span className=\"text-xs text-muted-foreground\">\n                    {t('storage.mimeLabel', { mime: preview.mime })}\n                  </span>\n                </div>\n                {preview.mode === 'image' ? (\n                  <img\n                    src={preview.inlineUrl}\n                    alt={selectedRow.name}\n                    className=\"max-h-[300px] w-full rounded-md object-contain\"\n                  />\n                ) : preview.mode === 'video' ? (\n                  <video\n                    controls\n                    src={preview.inlineUrl}\n                    className=\"max-h-[320px] w-full rounded-md\"\n                  />\n                ) : preview.mode === 'pdf' ? (\n                  <iframe\n                    title={selectedRow.name}\n                    src={preview.inlineUrl}\n                    className=\"h-[320px] w-full rounded-md\"\n                  />\n                ) : preview.mode === 'text' ? (\n                  preview.loading ? (\n                    <div className=\"text-sm text-muted-foreground\">\n                      {t('storage.previewLoading')}\n                    </div>\n                  ) : preview.error ? (\n                    <div className=\"text-sm text-red-500\">{preview.error}</div>\n                  ) : (\n                    <pre className=\"max-h-[320px] overflow-auto rounded bg-muted p-3 text-xs\">\n                      {preview.content}\n                    </pre>\n                  )\n                ) : null}\n              </div>\n            ) : null}\n            <section className=\"space-y-3\">\n              <h3 className=\"text-sm font-semibold\">\n                {t('storage.attach.title')}\n              </h3>\n              <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center\">\n                <select\n                  value={selectedRow.selectedTaskId}\n                  onChange={(event) =>\n                    selectedRow.onTaskSelect(event.target.value)\n                  }\n                  disabled={selectedRow.attachLoading || tasksLoading}\n                  className=\"h-9 min-w-[12rem] rounded-md border border-input bg-background px-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\"\n                >\n                  <option value=\"\">{t('storage.attach.placeholder')}</option>\n                  {taskOptionsForSelect.map((option) => (\n                    <option key={option.value} value={option.value}>\n                      {option.label}\n                    </option>\n                  ))}\n                </select>\n                <Button\n                  type=\"button\"\n                  onClick={() => selectedRow.onAttach()}\n                  disabled={selectedRow.attachDisabled}\n                >\n                  {selectedRow.attachLoading\n                    ? t('storage.attach.processing')\n                    : t('storage.attach.button')}\n                </Button>\n              </div>\n              {tasksLoading ? (\n                <p className=\"text-xs text-muted-foreground\">\n                  {t('storage.attach.loading')}\n                </p>\n              ) : taskOptionsForSelect.length === 0 ? (\n                <p className=\"text-xs text-muted-foreground\">\n                  {t('storage.attach.empty')}\n                </p>\n              ) : null}\n            </section>\n            <section className=\"space-y-2\">\n              <h3 className=\"text-sm font-semibold\">\n                {t('storage.details.title')}\n              </h3>\n              <dl className=\"grid gap-2 sm:grid-cols-2\">\n                {details.map((item) => (\n                  <div\n                    key={item.key}\n                    className=\"rounded-md border border-border p-3 text-sm\"\n                  >\n                    <dt className=\"text-xs font-semibold uppercase text-muted-foreground\">\n                      {item.label}\n                    </dt>\n                    <dd className=\"mt-1 text-sm\">{item.value}</dd>\n                  </div>\n                ))}\n              </dl>\n              {selectedRow.taskId ? (\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  onClick={() => openTaskDialog(selectedRow.taskId)}\n                >\n                  {t('storage.details.openTask')}\n                </Button>\n              ) : null}\n            </section>\n          </div>\n        ) : (\n          <div className=\"p-4 text-sm text-muted-foreground\">\n            {t('storage.loadError')}\n          </div>\n        )}\n      </Modal>\n    </div>\n  );\n}\n"],"names":["ArrowDownTrayIcon","title","titleId","props","svgRef","React.createElement","ForwardRef","React.forwardRef","DocumentTextIcon","DocumentIcon","TrashIcon","VideoCameraIcon","userBadgeClass","createStorageColumns","labels","options","handleTaskOpen","attachOptions","_a","isTasksLoading","row","file","jsxs","jsx","event","option","label","EmployeeLink","content","fetchFiles","params","qs","url","authFetch","r","fetchFile","id","res","removeFile","runDiagnostics","response","PAGE_SIZE","dateTimeFormatter","PROJECT_TIMEZONE","previewIcons","PhotoIcon","isTextLike","mime","formatSize","bytes","units","index","value","formatDate","time","PROJECT_TIMEZONE_LABEL","StoragePage","t","useTranslation","searchParams","setSearchParams","useSearchParams","files","setFiles","React","loading","setLoading","usersById","setUsersById","search","setSearch","sort","setSort","pageIndex","setPageIndex","selectedId","setSelectedId","selectedFile","setSelectedFile","detailsLoading","setDetailsLoading","preview","setPreview","tasksLoading","setTasksLoading","taskOptions","setTaskOptions","taskMetaById","setTaskMetaById","selectionByFile","setSelectionByFile","attachLoadingId","setAttachLoadingId","diagnostics","setDiagnostics","diagnosticsLoading","setDiagnosticsLoading","diagnosticsError","setDiagnosticsError","attachFileToTask","fileId","taskId","error","loadFiles","list","showToast","detachedCount","handleDiagnostics","report","active","fetchUsers","map","user","cancelled","data","normalized","task","rawId","_b","rawTitle","rawNumber","number","changedAt","max","current","shortId","item","a","b","limited","meta","acc","validIds","changed","next","queryId","existing","inlineUrl","filteredFiles","query","sortedFiles","left","right","pagedFiles","start","taskOptionsForSelect","handleDownload","handleDelete","candidate","handleAttach","selectedTaskId","_d","_c","toRow","hasTaskId","normalizedTaskId","normalizedTitle","identifier","displayName","userHint","taskLink","paramsWithTask","selectedCandidate","hasValidSelection","rows","pageCount","openTaskDialog","closeModal","selectedRow","details","empty","previewIcon","diagnosticsTimestamp","Breadcrumbs","Button","Input","DataTable","Modal"],"mappings":"0bACA,SAASA,GAAkB,CACzB,MAAAC,EACA,QAAAC,EACA,GAAGC,CACL,EAAGC,EAAQ,CACT,OAAoBC,gBAAoB,MAAO,OAAO,OAAO,CAC3D,MAAO,6BACP,KAAM,OACN,QAAS,YACT,YAAa,IACb,OAAQ,eACR,cAAe,OACf,YAAa,OACb,IAAKD,EACL,kBAAmBF,CACvB,EAAKC,CAAK,EAAGF,EAAqBI,EAAAA,cAAoB,QAAS,CAC3D,GAAIH,CACR,EAAKD,CAAK,EAAI,KAAmBI,EAAAA,cAAoB,OAAQ,CACzD,cAAe,QACf,eAAgB,QAChB,EAAG,8GACP,CAAG,CAAC,CACJ,CACA,MAAMC,GAA2BC,EAAAA,WAAiBP,EAAiB,ECvBnE,SAASQ,GAAiB,CACxB,MAAAP,EACA,QAAAC,EACA,GAAGC,CACL,EAAGC,EAAQ,CACT,OAAoBC,gBAAoB,MAAO,OAAO,OAAO,CAC3D,MAAO,6BACP,KAAM,OACN,QAAS,YACT,YAAa,IACb,OAAQ,eACR,cAAe,OACf,YAAa,OACb,IAAKD,EACL,kBAAmBF,CACvB,EAAKC,CAAK,EAAGF,EAAqBI,EAAAA,cAAoB,QAAS,CAC3D,GAAIH,CACR,EAAKD,CAAK,EAAI,KAAmBI,EAAAA,cAAoB,OAAQ,CACzD,cAAe,QACf,eAAgB,QAChB,EAAG,4RACP,CAAG,CAAC,CACJ,CACK,MAACC,GAA2BC,EAAAA,WAAiBC,EAAgB,ECvBlE,SAASC,GAAa,CACpB,MAAAR,EACA,QAAAC,EACA,GAAGC,CACL,EAAGC,EAAQ,CACT,OAAoBC,gBAAoB,MAAO,OAAO,OAAO,CAC3D,MAAO,6BACP,KAAM,OACN,QAAS,YACT,YAAa,IACb,OAAQ,eACR,cAAe,OACf,YAAa,OACb,IAAKD,EACL,kBAAmBF,CACvB,EAAKC,CAAK,EAAGF,EAAqBI,EAAAA,cAAoB,QAAS,CAC3D,GAAIH,CACR,EAAKD,CAAK,EAAI,KAAmBI,EAAAA,cAAoB,OAAQ,CACzD,cAAe,QACf,eAAgB,QAChB,EAAG,mQACP,CAAG,CAAC,CACJ,CACA,MAAMC,GAA2BC,EAAAA,WAAiBE,EAAY,ECvB9D,SAASC,GAAU,CACjB,MAAAT,EACA,QAAAC,EACA,GAAGC,CACL,EAAGC,EAAQ,CACT,OAAoBC,gBAAoB,MAAO,OAAO,OAAO,CAC3D,MAAO,6BACP,KAAM,OACN,QAAS,YACT,YAAa,IACb,OAAQ,eACR,cAAe,OACf,YAAa,OACb,IAAKD,EACL,kBAAmBF,CACvB,EAAKC,CAAK,EAAGF,EAAqBI,EAAAA,cAAoB,QAAS,CAC3D,GAAIH,CACR,EAAKD,CAAK,EAAI,KAAmBI,EAAAA,cAAoB,OAAQ,CACzD,cAAe,QACf,eAAgB,QAChB,EAAG,+ZACP,CAAG,CAAC,CACJ,CACA,MAAMC,GAA2BC,EAAAA,WAAiBG,EAAS,ECvB3D,SAASC,GAAgB,CACvB,MAAAV,EACA,QAAAC,EACA,GAAGC,CACL,EAAGC,EAAQ,CACT,OAAoBC,gBAAoB,MAAO,OAAO,OAAO,CAC3D,MAAO,6BACP,KAAM,OACN,QAAS,YACT,YAAa,IACb,OAAQ,eACR,cAAe,OACf,YAAa,OACb,IAAKD,EACL,kBAAmBF,CACvB,EAAKC,CAAK,EAAGF,EAAqBI,EAAAA,cAAoB,QAAS,CAC3D,GAAIH,CACR,EAAKD,CAAK,EAAI,KAAmBI,EAAAA,cAAoB,OAAQ,CACzD,cAAe,QACf,eAAgB,QAChB,EAAG,8MACP,CAAG,CAAC,CACJ,CACA,MAAMC,GAA2BC,EAAAA,WAAiBI,EAAe,ECqB3DC,GAAiB,CACrB,4CACA,2GACA,2JACA,gEACF,EAAE,KAAK,GAAG,EAEV,SAAwBC,GACtBC,EACAC,EAII,GACqB,OACzB,MAAMC,EAAiBD,EAAQ,WACzBE,GAAgBC,EAAAH,EAAQ,cAAR,KAAAG,EAAuB,CAAA,EACvCC,EAAiB,EAAQJ,EAAQ,aACvC,MAAO,CACL,CACE,OAAQD,EAAO,KACf,YAAa,OACb,KAAM,CAAE,SAAU,QAAS,SAAU,QAAS,eAAgB,EAAA,EAC9D,KAAM,CAAC,CAAE,IAAAM,KAAU,CACjB,MAAMC,EAAOD,EAAI,SACjB,OACEE,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0CACb,SAAA,CAAAC,EAAAA,IAAC,QAAK,UAAU,uBAAuB,MAAOF,EAAK,KAChD,WAAK,IAAA,CACR,EACAC,EAAAA,KAAC,MAAA,CAAI,UAAU,wCACb,SAAA,CAAAA,EAAAA,KAAC,SAAA,CACC,KAAK,SACL,QAAUE,GAAU,CAClBA,EAAM,gBAAA,EACNH,EAAK,WAAA,CACP,EACA,UAAU,kSACV,aAAYP,EAAO,SAEnB,SAAA,CAAAS,EAAAA,IAACvB,GAAA,CAAkB,UAAU,cAAc,cAAW,GAAC,EACtDc,EAAO,QAAA,CAAA,CAAA,EAEVQ,EAAAA,KAAC,SAAA,CACC,KAAK,SACL,QAAUE,GAAU,CAClBA,EAAM,gBAAA,EACNH,EAAK,SAAA,CACP,EACA,UAAU,0RACV,aAAYP,EAAO,OAEnB,SAAA,CAAAS,EAAAA,IAACb,GAAA,CAAU,UAAU,cAAc,cAAW,GAAC,EAC9CI,EAAO,MAAA,CAAA,CAAA,CACV,CAAA,CACF,CAAA,EACF,EACAQ,EAAAA,KAAC,MAAA,CAAI,UAAU,uEACb,SAAA,CAAAC,EAAAA,IAAC,OAAA,CAAK,UAAU,oEACb,SAAAT,EAAO,YACV,EACAQ,EAAAA,KAAC,MAAA,CAAI,UAAU,kDACb,SAAA,CAAAA,EAAAA,KAAC,SAAA,CACC,MAAOD,EAAK,eACZ,SAAWG,GAAU,CACnBA,EAAM,gBAAA,EACNH,EAAK,aAAaG,EAAM,OAAO,KAAK,CACtC,EACA,SAAUH,EAAK,eAAiBF,EAChC,UAAU,0JAEV,SAAA,CAAAI,EAAAA,IAAC,SAAA,CAAO,MAAM,GAAI,SAAAT,EAAO,kBAAkB,EAC1CG,EAAc,IAAKQ,GAClBF,EAAAA,IAAC,SAAA,CAA0B,MAAOE,EAAO,MACtC,SAAAA,EAAO,KAAA,EADGA,EAAO,KAEpB,CACD,CAAA,CAAA,CAAA,EAEHF,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAUC,GAAU,CAClBA,EAAM,gBAAA,EACNH,EAAK,SAAA,CACP,EACA,UAAU,8WACV,SAAUA,EAAK,eAEd,SAAAA,EAAK,cACFP,EAAO,iBACPA,EAAO,YAAA,CAAA,CACb,EACF,EACCK,EACCI,EAAAA,IAAC,OAAA,CAAK,UAAU,8BACb,WAAO,aAAA,CACV,EACEN,EAAc,SAAW,EAC3BM,MAAC,OAAA,CAAK,UAAU,8BACb,SAAAT,EAAO,YACV,EACE,IAAA,CAAA,CACN,CAAA,EACF,CAEJ,CAAA,EAEF,CACE,OAAQA,EAAO,KACf,YAAa,cACb,KAAM,CAAE,SAAU,OAAQ,SAAU,QAAS,eAAgB,EAAA,EAC7D,KAAM,CAAC,CAAE,IAAAM,KAAU,CACjB,MAAMC,EAAOD,EAAI,SACXM,EAAQL,EAAK,YACnB,OAAKA,EAAK,OAQRE,EAAAA,IAACI,GAAA,CACC,WAAYN,EAAK,OACjB,gBAAe,GACf,UAAWT,GACX,MAAOS,EAAK,SAEZ,SAAAE,EAAAA,IAAC,OAAA,CAAK,UAAU,WAAY,SAAAG,CAAA,CAAM,CAAA,CAAA,QAZjC,OAAA,CAAK,UAAU,mBAAmB,MAAOL,EAAK,SAC5C,SAAAK,EACH,CAaN,CAAA,EAEF,CACE,OAAQZ,EAAO,KACf,YAAa,OACb,KAAM,CAAE,SAAU,OAAQ,SAAU,OAAA,EACpC,KAAM,CAAC,CAAE,IAAAM,KAAUA,EAAI,SAAS,MAAQ,EAAA,EAE1C,CACE,OAAQN,EAAO,KACf,YAAa,YACb,KAAM,CAAE,SAAU,OAAQ,SAAU,MAAA,EACpC,KAAM,CAAC,CAAE,IAAAM,KAAUA,EAAI,SAAS,SAAA,EAElC,CACE,OAAQN,EAAO,KACf,YAAa,cACb,KAAM,CAAE,SAAU,QAAS,SAAU,QAAS,eAAgB,EAAA,EAC9D,KAAM,CAAC,CAAE,IAAAM,KAAU,CACjB,MAAMC,EAAOD,EAAI,SACXQ,EACJN,EAAAA,KAAC,OAAA,CAAK,UAAU,QACb,SAAA,CAAAD,EAAK,YACLA,EAAK,UACJE,MAAC,OAAA,CAAK,UAAU,sCACb,SAAAF,EAAK,UACR,EACE,IAAA,EACN,EAEF,OAAKA,EAAK,UAGNL,EAEAO,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAUC,GAAU,CAClBA,EAAM,gBAAA,EACNR,EAAeK,EAAK,SAAmB,CACzC,EACA,UAAU,+VACV,MACEA,EAAK,UACDP,EAAO,cAAcO,EAAK,SAAS,EACnC,OAGL,SAAAO,CAAA,CAAA,EAIHP,EAAK,SAELE,EAAAA,IAAC,IAAA,CACC,KAAMF,EAAK,SACX,UAAU,4WACV,QAAUG,GAAUA,EAAM,gBAAA,EAC1B,MACEH,EAAK,UACDP,EAAO,cAAcO,EAAK,SAAS,EACnC,OAGL,SAAAO,CAAA,CAAA,EAIAA,EArCEA,CAsCX,CAAA,EAEF,CACE,OAAQd,EAAO,SACf,YAAa,gBACb,KAAM,CAAE,SAAU,QAAS,SAAU,OAAA,EACrC,KAAM,CAAC,CAAE,IAAAM,KAAUA,EAAI,SAAS,aAAA,CAClC,CAEJ,CCzNO,MAAMS,GAAcC,GAAgD,CACzE,MAAMC,EAAK,IAAI,gBACXD,GAAA,MAAAA,EAAQ,QAAQC,EAAG,IAAI,SAAU,OAAOD,EAAO,MAAM,CAAC,EACtDA,GAAA,MAAAA,EAAQ,MAAMC,EAAG,IAAI,OAAQD,EAAO,IAAI,EAC5C,MAAME,EAAM,kBAAkB,OAAAD,EAAG,SAAA,EAAa,IAAI,OAAAA,GAAO,IACzD,OAAOE,EAAUD,CAAG,EAAE,KAAME,GAAOA,EAAE,GAAKA,EAAE,KAAA,EAAS,CAAA,CAAG,CAG1D,EAEaC,GAAaC,GACxBH,EAAU,mBAAmB,0BAAmBG,CAAE,EAAG,EAAE,KAAMC,GAC3DA,EAAI,GAAMA,EAAI,OAAiC,QAAQ,OAAOA,CAAG,CACnE,EAEWC,GAAcF,GACzBH,EAAU,mBAAmB,0BAAmBG,CAAE,GAAK,CACrD,OAAQ,QACV,CAAC,EAEUG,GAAiB,SAA+C,CAC3E,MAAMC,EAAW,MAAMP,EAAU,6BAA6B,EAC9D,GAAI,CAACO,EAAS,GACZ,MAAM,IAAI,MAAM,aAAa,EAE/B,OAAQ,MAAMA,EAAS,KAAA,CACzB,EC3BMC,EAAY,GAEZC,GAAoB,IAAI,KAAK,eAAe,QAAS,CACzD,IAAK,UACL,MAAO,UACP,KAAM,UACN,KAAM,UACN,OAAQ,UACR,OAAQ,GACR,SAAUC,EACZ,CAAC,EAuBKC,GAGF,CACF,MAAOC,GACP,MAAOlC,GACP,IAAKF,GACL,KAAMD,EACR,EAEA,SAASsC,GAAWC,EAAuB,CACzC,OACEA,EAAK,WAAW,OAAO,GACvBA,EAAK,SAAS,MAAM,GACpBA,EAAK,SAAS,KAAK,GACnBA,IAAS,iBAEb,CAEA,SAASC,GAAWC,EAAmC,CACrD,GAAI,CAACA,GAAS,OAAO,MAAMA,CAAK,EAAG,MAAO,IAC1C,GAAIA,GAAS,EAAG,MAAO,MACvB,MAAMC,EAAQ,CAAC,IAAK,KAAM,KAAM,KAAM,IAAI,EACpCC,EAAQ,KAAK,IACjB,KAAK,MAAM,KAAK,IAAIF,CAAK,EAAI,KAAK,IAAI,IAAI,CAAC,EAC3CC,EAAM,OAAS,CAAA,EAEXE,EAAQH,EAAQ,KAAK,IAAI,KAAME,CAAK,EAC1C,MAAO,GAAG,OAAAC,EAAM,QAAQA,GAAS,IAAMD,IAAU,EAAI,EAAI,CAAC,EAAC,KAAI,OAAAD,EAAMC,CAAK,EAC5E,CAEA,SAASE,GAAWD,EAAwB,CAC1C,GAAI,CAACA,EAAO,MAAO,IACnB,MAAME,EAAO,KAAK,MAAMF,CAAK,EAC7B,GAAI,OAAO,MAAME,CAAI,EAAG,MAAO,IAC/B,MAAM5B,EAAQgB,GAAkB,OAAO,IAAI,KAAKY,CAAI,CAAC,EAAE,QAAQ,KAAM,GAAG,EACxE,MAAO,GAAG,OAAA5B,EAAK,KAAI,OAAA6B,GACrB,CAEA,SAAwBC,IAAc,QACpC,KAAM,CAAE,EAAAC,CAAA,EAAMC,GAAA,EACR,CAACC,EAAcC,CAAe,EAAIC,GAAA,EAClC,CAACC,EAAOC,CAAQ,EAAIC,EAAM,SAAuB,CAAA,CAAE,EACnD,CAACC,EAASC,CAAU,EAAIF,EAAM,SAAS,EAAK,EAC5C,CAACG,EAAWC,CAAY,EAAIJ,EAAM,SAA+B,CAAA,CAAE,EACnE,CAACK,EAAQC,EAAS,EAAIN,EAAM,SAAS,EAAE,EACvC,CAACO,EAAMC,EAAO,EAAIR,EAAM,SAAqB,eAAe,EAC5D,CAACS,EAAWC,CAAY,EAAIV,EAAM,SAAS,CAAC,EAC5C,CAACW,EAAYC,EAAa,EAAIZ,EAAM,SACxCL,EAAa,IAAI,MAAM,CAAA,EAEnB,CAACkB,EAAcC,CAAe,EAAId,EAAM,SAC5C,IAAA,EAEI,CAACe,GAAgBC,CAAiB,EAAIhB,EAAM,SAAS,EAAK,EAC1D,CAACiB,EAASC,CAAU,EAAIlB,EAAM,SAA8B,IAAI,EAChE,CAACmB,EAAcC,EAAe,EAAIpB,EAAM,SAAS,EAAK,EACtD,CAACqB,EAAaC,EAAc,EAAItB,EAAM,SAAuB,CAAA,CAAE,EAC/D,CAACuB,GAAcC,EAAe,EAAIxB,EAAM,SAE5C,CAAA,CAAE,EACE,CAACyB,EAAiBC,CAAkB,EAAI1B,EAAM,SAElD,CAAA,CAAE,EACE,CAAC2B,EAAiBC,EAAkB,EAAI5B,EAAM,SAClD,IAAA,EAGI,CAAC6B,EAAaC,EAAc,EAChC9B,EAAM,SAA0C,IAAI,EAChD,CAAC+B,GAAoBC,EAAqB,EAAIhC,EAAM,SAAS,EAAK,EAClE,CAACiC,GAAkBC,EAAmB,EAAIlC,EAAM,SACpD,IAAA,EAGImC,GAAmBnC,EAAM,YAC7B,MAAOoC,EAAgBC,IAAkC,CACvD,MAAM7D,EAAW,MAAMP,EACrB,iBAAiB,0BAAmBmE,CAAM,EAAC,WAC3C,CACE,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,OAAAC,EAAQ,CAAA,CACjC,EAEF,GAAI,CAAC7D,EAAS,GAAI,CAChB,MAAM8D,EAAQ,IAAI,MAAM,QAAQ,EAC/B,MAAAA,EAA8B,OAAS9D,EAAS,OAC3C8D,CACR,CACA,MAAM9D,EAAS,KAAA,EAAO,MAAM,KAAO,CAAA,EAAG,CACxC,EACA,CAAA,CAAC,EAGG+D,EAAYvC,EAAM,YAAY,KAClCE,EAAW,EAAI,EACRrC,GAAA,EACJ,KAAM2E,GAAS,CACdzC,EAAS,MAAM,QAAQyC,CAAI,EAAIA,EAAO,CAAA,CAAE,CAC1C,CAAC,EACA,MAAM,IAAM,CACXC,EAAUhD,EAAE,mBAAmB,EAAG,OAAO,CAC3C,CAAC,EACA,QAAQ,IAAMS,EAAW,EAAK,CAAC,GACjC,CAACT,CAAC,CAAC,EAEAiD,GAAgB1C,EAAM,QAC1B,IAAMF,EAAM,OAAQzC,GAAS,CAACA,EAAK,MAAM,EAAE,OAC3C,CAACyC,CAAK,CAAA,EAGF6C,GAAoB3C,EAAM,YAAY,KAC1CgC,GAAsB,EAAI,EAC1BE,GAAoB,IAAI,EACjB3D,GAAA,EACJ,KAAMqE,IACLd,GAAec,CAAM,EACrBH,EAAUhD,EAAE,6BAA6B,EAAG,SAAS,EAC9C8C,EAAA,EACR,EACA,MAAM,IAAM,CACXL,GAAoBzC,EAAE,2BAA2B,CAAC,EAClDgD,EAAUhD,EAAE,2BAA2B,EAAG,OAAO,CACnD,CAAC,EACA,QAAQ,IAAM,CACbuC,GAAsB,EAAK,CAC7B,CAAC,GACF,CAACO,EAAW9C,CAAC,CAAC,EAEjBO,EAAM,UAAU,IAAM,CACfuC,EAAA,CACP,EAAG,CAACA,CAAS,CAAC,EAEdvC,EAAM,UAAU,IAAM,CACpB,IAAI6C,EAAS,GACb,OAAAC,GAAA,EACG,KAAMN,GAAS,CACd,GAAI,CAACK,EAAQ,OACb,MAAME,EAA4B,CAAA,EAClCP,EAAK,QAASQ,GAAS,CACjB,OAAOA,EAAK,aAAgB,WAC9BD,EAAIC,EAAK,WAAW,EAAIA,EAE5B,CAAC,EACD5C,EAAa2C,CAAG,CAClB,CAAC,EACA,MAAM,IAAM,CACXN,EAAUhD,EAAE,wBAAwB,EAAG,OAAO,CAChD,CAAC,EACI,IAAM,CACXoD,EAAS,EACX,CACF,EAAG,CAACpD,CAAC,CAAC,EAENO,EAAM,UAAU,IAAM,CACpB,IAAIiD,EAAY,GAChB,OAAA7B,GAAgB,EAAI,EACpBnD,EAAU,yBAAyB,EAChC,KAAMI,GAASA,EAAI,GAAKA,EAAI,KAAA,EAAS,CAAA,CAAG,EACxC,KAAM6E,GAAS,CACd,GAAID,EAAW,OAIf,MAAME,GAHO,MAAM,QAAQD,CAAI,EAC1BA,EACD,CAAA,GAED,IAAKE,GAA4B,WAChC,MAAMC,EACJ,OAAQD,EAA2B,KAAQ,WACrClG,GAAAkG,EAAyB,MAAzB,KAAAlG,GAAgC,IAAI,KAAA,EACtC,OAAQkG,EAA0B,IAAO,WACrCE,GAAAF,EAAwB,KAAxB,KAAAE,GAA8B,IAAI,OACpC,GACR,GAAI,CAACD,EACH,OAAO,KAET,MAAME,EAAYH,EAA6B,MACzCnH,EACJ,OAAOsH,GAAa,UAAYA,EAAS,KAAA,EAAO,OAAS,EACrDA,EAAS,KAAA,EACT9D,EAAE,yBAAyB,EAC3B+D,EAAaJ,EAAmC,YAChDK,EACJ,OAAOD,GAAc,UAAYA,EAAU,OAAO,OAAS,EACvDA,EAAU,KAAA,EACV,KAQAE,EAPa,CAChBN,EAAkC,WAClCA,EAAiC,UACjCA,EAAiC,UACjCA,EAAiC,UACjCA,EAAuC,eAAA,EAGvC,IAAKhE,GAAU,CACd,GAAIA,aAAiB,KAAM,CACzB,MAAME,EAAOF,EAAM,QAAA,EACnB,OAAO,OAAO,MAAME,CAAI,EAAI,EAAIA,CAClC,CACA,GAAI,OAAOF,GAAU,SAAU,CAC7B,MAAME,EAAO,KAAK,MAAMF,CAAK,EAC7B,OAAO,OAAO,MAAME,CAAI,EAAI,EAAIA,CAClC,CACA,OAAI,OAAOF,GAAU,UAAY,OAAO,SAASA,CAAK,EAC7CA,EAEF,CACT,CAAC,EACA,OAAO,CAACuE,EAAKC,IAAaA,EAAUD,EAAMC,EAAUD,EAAM,CAAC,EACxDE,GAAUR,EAAM,MAAM,EAAE,GAAKA,EAC7B3F,GAAQ+F,EACVhE,EAAE,8BAA+B,CAAE,OAAAgE,EAAQ,MAAAxH,CAAA,CAAO,EAClDwD,EAAE,0BAA2B,CAAE,GAAIoE,GAAS,MAAA5H,EAAO,EACvD,MAAO,CAAE,GAAIoH,EAAO,MAAA3F,GAAO,MAAAzB,EAAO,OAAAwH,EAAQ,UAAAC,CAAA,CAC5C,CAAC,EACA,OAAQI,GAA6B,EAAQA,CAAK,EACrDX,EAAW,KAAK,CAACY,EAAGC,IAAMA,EAAE,UAAYD,EAAE,SAAS,EACnD,MAAME,EAAUd,EAAW,MAAM,EAAG,CAAC,EAC/Be,EAAOD,EAAQ,OACnB,CAACE,EAAK1G,KACJ0G,EAAI1G,EAAO,EAAE,EAAIA,EACV0G,GAET,CAAA,CAAC,EAEH7C,GAAe2C,CAAO,EACtBzC,GAAgB0C,CAAI,CACtB,CAAC,EACA,MAAM,IAAM,CACPjB,IACJ3B,GAAe,CAAA,CAAE,EACjBE,GAAgB,CAAA,CAAE,EAClBiB,EAAUhD,EAAE,+BAA+B,EAAG,OAAO,EACvD,CAAC,EACA,QAAQ,IAAM,CACRwD,GACH7B,GAAgB,EAAK,CAEzB,CAAC,EACI,IAAM,CACX6B,EAAY,EACd,CACF,EAAG,CAACxD,CAAC,CAAC,EAENO,EAAM,UAAU,IAAM,CACpB,GAAI,CAACqB,EAAY,OAAQ,CACvBK,EAAoBkC,GAClB,OAAO,KAAKA,CAAO,EAAE,OAAU,GAAgCA,CAAA,EAEjE,MACF,CACA,MAAMQ,EAAW,IAAI,IAAI/C,EAAY,IAAK5D,GAAWA,EAAO,EAAE,CAAC,EAC/DiE,EAAoBkC,GAAY,CAC9B,IAAIS,EAAU,GACd,MAAMC,EAA+B,CAAA,EACrC,cAAO,QAAQV,CAAO,EAAE,QAAQ,CAAC,CAACxB,EAAQhD,CAAK,IAAM,CAC/CA,GAASgF,EAAS,IAAIhF,CAAK,EAC7BkF,EAAKlC,CAAM,EAAIhD,EACNA,IACTiF,EAAU,GAEd,CAAC,EACMA,EAAUC,EAAOV,CAC1B,CAAC,CACH,EAAG,CAACvC,CAAW,CAAC,EAEhBrB,EAAM,UAAU,IAAM,CACpB,MAAMuE,EAAU5E,EAAa,IAAI,MAAM,EACvCiB,GAAc2D,CAAO,CACvB,EAAG,CAAC5E,CAAY,CAAC,EAEjBK,EAAM,UAAU,IAAM,CACpB,GAAI,CAACW,EAAY,CACfG,EAAgB,IAAI,EACpBE,EAAkB,EAAK,EACvBE,EAAW,IAAI,EACf,MACF,CACA,MAAMsD,EAAW1E,EAAM,KAAMzC,GAASA,EAAK,KAAOsD,CAAU,EAC5D,GAAI6D,EAAU,CACZ1D,EAAgB0D,CAAQ,EACxB,MACF,CACAxD,EAAkB,EAAI,EACtB7C,GAAUwC,CAAU,EACjB,KAAMtD,GAAS,CACdyD,EAAgBzD,CAAI,CACtB,CAAC,EACA,MAAM,IAAM,CACXoF,EAAUhD,EAAE,mBAAmB,EAAG,OAAO,EACzCqB,EAAgB,IAAI,CACtB,CAAC,EACA,QAAQ,IAAME,EAAkB,EAAK,CAAC,CAC3C,EAAG,CAACL,EAAYb,EAAOL,CAAC,CAAC,EAEzBO,EAAM,UAAU,IAAM,CACpB,GAAI,CAACa,EAAc,CACjBK,EAAW,IAAI,EACf,MACF,CACA,MAAMnC,EAAO8B,EAAa,MAAQ,2BAC5B4D,EACJ5D,EAAa,YAAc,GAAG,OAAAA,EAAa,IAAG,gBAChD,GAAI9B,EAAK,WAAW,QAAQ,EAAG,CAC7BmC,EAAW,CAAE,KAAM,QAAS,UAAAuD,EAAW,KAAA1F,EAAM,EAC7C,MACF,CACA,GAAIA,EAAK,WAAW,QAAQ,EAAG,CAC7BmC,EAAW,CAAE,KAAM,QAAS,UAAAuD,EAAW,KAAA1F,EAAM,EAC7C,MACF,CACA,GAAIA,IAAS,kBAAmB,CAC9BmC,EAAW,CAAE,KAAM,MAAO,UAAAuD,EAAW,KAAA1F,EAAM,EAC3C,MACF,CACA,GAAID,GAAWC,CAAI,EAAG,CACpB,IAAIkE,EAAY,GAChB,OAAA/B,EAAW,CAAE,KAAM,OAAQ,UAAAuD,EAAW,KAAA1F,EAAM,QAAS,GAAM,EAC3Dd,EAAUwG,CAAS,EAChB,KAAMpG,GAAQ,CACb,GAAI,CAACA,EAAI,GAAI,MAAM,IAAI,MAAM,SAAS,EACtC,OAAOA,EAAI,KAAA,CACb,CAAC,EACA,KAAMT,GAAY,CACbqF,GACJ/B,EAAW,CAAE,KAAM,OAAQ,UAAAuD,EAAW,KAAA1F,EAAM,QAAAnB,EAAS,CACvD,CAAC,EACA,MAAM,IAAM,CACPqF,GACJ/B,EAAW,CACT,KAAM,OACN,UAAAuD,EACA,KAAA1F,EACA,MAAOU,EAAE,sBAAsB,CAAA,CAChC,CACH,CAAC,EACI,IAAM,CACXwD,EAAY,EACd,CACF,CACA/B,EAAW,IAAI,CAEjB,EAAG,CAACL,EAAcpB,CAAC,CAAC,EAEpB,MAAMiF,EAAgB1E,EAAM,QAAQ,IAAM,CACxC,MAAM2E,EAAQtE,EAAO,KAAA,EAAO,YAAA,EAC5B,OAAOP,EAAM,OAAQzC,GACnBsH,EAAQtH,EAAK,KAAK,cAAc,SAASsH,CAAK,EAAI,EAAA,CAEtD,EAAG,CAAC7E,EAAOO,CAAM,CAAC,EAEZuE,EAAc5E,EAAM,QAAQ,IAAM,CACtC,MAAMwC,EAAO,CAAC,GAAGkC,CAAa,EAC9B,OAAAlC,EAAK,KAAK,CAAC,EAAGwB,IAAM,CAClB,OAAQzD,EAAA,CACN,IAAK,eAAgB,CACnB,MAAMsE,EAAO,KAAK,MAAM,EAAE,YAAc,EAAE,EACpCC,EAAQ,KAAK,MAAMd,EAAE,YAAc,EAAE,EAC3C,OAAQa,GAAQ,IAAMC,GAAS,EACjC,CACA,IAAK,gBAAiB,CACpB,MAAMD,EAAO,KAAK,MAAM,EAAE,YAAc,EAAE,EAE1C,OADc,KAAK,MAAMb,EAAE,YAAc,EAAE,GAC1B,IAAMa,GAAQ,EACjC,CACA,IAAK,WACH,OAAQ,EAAE,MAAQ,IAAMb,EAAE,MAAQ,GACpC,IAAK,YACH,OAAQA,EAAE,MAAQ,IAAM,EAAE,MAAQ,GACpC,QACE,MAAO,EAAA,CAEb,CAAC,EACMxB,CACT,EAAG,CAACkC,EAAenE,CAAI,CAAC,EAElBwE,GAAa/E,EAAM,QAAQ,IAAM,CACrC,MAAMgF,EAAQvE,EAAYhC,EAC1B,OAAOmG,EAAY,MAAMI,EAAOA,EAAQvG,CAAS,CACnD,EAAG,CAACmG,EAAanE,CAAS,CAAC,EAErBwE,EAAuBjF,EAAM,QACjC,IACEqB,EAAY,IAAK5D,IAAY,CAAE,MAAOA,EAAO,GAAI,MAAOA,EAAO,KAAA,EAAQ,EACzE,CAAC4D,CAAW,CAAA,EAGR6D,EAAiBlF,EAAM,YAC1B3C,GAAqB,CACfA,EAAK,MACV,OAAO,KAAKA,EAAK,IAAK,SAAU,qBAAqB,EACrDoF,EAAUhD,EAAE,wBAAwB,EAAG,SAAS,EAClD,EACA,CAACA,CAAC,CAAA,EAGE0F,GAAenF,EAAM,YACxB3C,GAAqB,CACF,OAAO,QACvBoC,EAAE,wBAAyB,CAAE,KAAMpC,EAAK,KAAM,CAAA,GAGhDiB,GAAWjB,EAAK,EAAE,EACf,KAAMgB,GAAQ,CACb,GAAI,CAACA,EAAI,GAAI,MAAM,IAAI,MAAM,QAAQ,EAKrC,GAJAoE,EAAUhD,EAAE,uBAAuB,EAAG,SAAS,EAC/CM,EAAU6D,GACRA,EAAQ,OAAQwB,GAAcA,EAAU,KAAO/H,EAAK,EAAE,CAAA,EAEpDsD,IAAetD,EAAK,GAAI,CAC1B,MAAMiH,EAAO,IAAI,gBAAgB3E,EAAa,UAAU,EACxD2E,EAAK,OAAO,MAAM,EAClB1E,EAAgB0E,EAAM,CAAE,QAAS,EAAA,CAAM,CACzC,CACF,CAAC,EACA,MAAM,IAAM,CACX7B,EAAUhD,EAAE,qBAAqB,EAAG,OAAO,CAC7C,CAAC,CACL,EACA,CAACE,EAAcgB,EAAYf,EAAiBH,CAAC,CAAA,EAGzC4F,GAAerF,EAAM,YACxB3C,GAAqB,CACpB,MAAMiI,EAAiB7D,EAAgBpE,EAAK,EAAE,EACzCiI,GAGAjE,EAAY,KAAM5D,GAAWA,EAAO,KAAO6H,CAAc,IAG9D1D,GAAmBvE,EAAK,EAAE,EAC1B8E,GAAiB9E,EAAK,GAAIiI,CAAc,EACrC,KAAK,IAAM,CACV,MAAMpB,EAAO3C,GAAa+D,CAAc,EACxCvF,EAAU6D,GACRA,EAAQ,IAAKwB,GAAA,aACX,OAAAA,EAAU,KAAO/H,EAAK,GAClB,CACE,GAAG+H,EACH,OAAQE,EACR,YAAYhC,GAAApG,EAAAgH,GAAA,YAAAA,EAAM,SAAN,KAAAhH,EAAgBkI,EAAU,aAA1B,KAAA9B,EAAwC,KACpD,WAAWiC,GAAAC,EAAAtB,GAAA,YAAAA,EAAM,QAAN,KAAAsB,EAAeJ,EAAU,YAAzB,KAAAG,EAAsC,IAAA,EAEnDH,EAAA,CACN,EAEEzE,IAAetD,EAAK,IACtByD,EAAiB8C,gBACf,OAAAA,GACI,CACE,GAAGA,EACH,OAAQ0B,EACR,YAAYhC,GAAApG,EAAAgH,GAAA,YAAAA,EAAM,SAAN,KAAAhH,EAAgB0G,EAAQ,aAAxB,KAAAN,EAAsC,KAClD,WAAWiC,GAAAC,EAAAtB,GAAA,YAAAA,EAAM,QAAN,KAAAsB,EAAe5B,EAAQ,YAAvB,KAAA2B,EAAoC,IAAA,EAEjD,EAGR9C,EAAUhD,EAAE,wBAAwB,EAAG,SAAS,CAClD,CAAC,EACA,MAAO6C,GAAU,CACAA,EAA8B,SAC/B,IACbG,EAAUhD,EAAE,0BAA0B,EAAG,OAAO,EAEhDgD,EAAUhD,EAAE,sBAAsB,EAAG,OAAO,CAEhD,CAAC,EACA,QAAQ,IAAM,CACbmC,GAAoBgC,GAClBA,IAAYvG,EAAK,GAAK,KAAOuG,CAAA,CAEjC,CAAC,EACL,EACA,CACEzB,GACAV,EACAJ,EACAE,GACAxB,EACAY,EACAG,EACArB,CAAA,CACF,EAGIgG,EAAQzF,EAAM,YACjB3C,GAAiC,QAChC,MAAMqI,EAAYrI,EAAK,QAAU,MAAQA,EAAK,SAAW,GACnDsI,EAAmBD,EAAY,OAAOrI,EAAK,MAAM,EAAI,OACrDuI,EACJ,OAAOvI,EAAK,WAAc,UAAYA,EAAK,UAAU,KAAA,EACjDA,EAAK,UAAU,KAAA,EACf,OACAwI,EAAaH,EACfrI,EAAK,YAAcA,EAAK,aAAe,GACrCoC,EAAE,0BAA2B,CAAE,OAAQpC,EAAK,UAAA,CAAY,EACxDoC,EAAE,oBAAqB,CAAE,GAAIkG,CAAA,CAAkB,EACjDlG,EAAE,qBAAqB,EACrBuD,EACJ,OAAO3F,EAAK,QAAW,SAAW8C,EAAU9C,EAAK,MAAM,EAAI,OACvDyI,EACH,OAAO9C,GAAA,YAAAA,EAAM,OAAS,UAAYA,EAAK,KAAK,KAAA,GAC5C,OAAOA,GAAA,YAAAA,EAAM,oBAAsB,UAClCA,EAAK,kBAAkB,KAAA,GACxB,OAAOA,GAAA,YAAAA,EAAM,WAAa,UAAYA,EAAK,SAAS,QACrDvD,EAAE,oBAAqB,CAAE,GAAIpC,EAAK,OAAQ,EACtC0I,EACJ,OAAO1I,EAAK,QAAW,SACnBoC,EAAE,yBAA0B,CAAE,GAAIpC,EAAK,MAAA,CAAQ,EAC/CoC,EAAE,yBAA0B,CAAE,GAAI,IAAK,EAC7C,IAAIuG,EACJ,GAAIL,EAAkB,CACpB,MAAMM,EAAiB,IAAI,gBAAgBtG,EAAa,UAAU,EAClEsG,EAAe,IAAI,OAAQN,CAAgB,EAC3CK,EAAW,IAAI,OAAAC,EAAe,SAAA,EAChC,CACA,MAAMC,GAAoBhJ,GAAAuE,EAAgBpE,EAAK,EAAE,IAAvB,KAAAH,GAA4B,GAChDiJ,EAAoB9E,EAAY,KACnC5D,GAAWA,EAAO,KAAOyI,CAAA,EAEtBZ,EAAiBa,EAAoBD,EAAoB,GAC/D,MAAO,CACL,GAAG7I,EACH,UAAWuI,EACX,UAAW5G,GAAW3B,EAAK,IAAI,EAC/B,cAAegC,GAAWhC,EAAK,UAAU,EACzC,YAAayI,EACb,SAAAC,EACA,YAAaF,EACb,UAAWF,EACX,SAAAK,EACA,WAAY,IAAMd,EAAe7H,CAAI,EACrC,SAAU,IAAM8H,GAAa9H,CAAI,EACjC,eAAAiI,EACA,aAAejD,GAAmB,CAChCX,EAAoBkC,KAAa,CAAE,GAAGA,GAAS,CAACvG,EAAK,EAAE,EAAGgF,CAAA,EAAS,CACrE,EACA,SAAU,IAAMgD,GAAahI,CAAI,EACjC,cAAesE,IAAoBtE,EAAK,GACxC,eACEsE,IAAoBtE,EAAK,IACzB8D,GACA,CAACE,EAAY,QACb,CAAC8E,CAAA,CAEP,EACA,CACExE,EACA0D,GACAF,GACAD,EACAvF,EACA8B,EACAC,EACAjC,EACA4B,EACAF,EACAhB,CAAA,CACF,EAGIiG,GAAOpG,EAAM,QACjB,IAAM+E,GAAW,IAAK1H,GAASoI,EAAMpI,CAAI,CAAC,EAC1C,CAAC0H,GAAYU,CAAK,CAAA,EAGdY,GAAYrG,EAAM,QAAQ,IACzB4E,EAAY,OACV,KAAK,IAAI,EAAG,KAAK,KAAKA,EAAY,OAASnG,CAAS,CAAC,EAD5B,EAE/B,CAACmG,EAAY,MAAM,CAAC,EAEjB0B,GAAiBtG,EAAM,YAC1BqC,GAAoB,CACnB,GAAI,CAACA,EAAQ,OACb,MAAMiC,EAAO,IAAI,gBAAgB3E,EAAa,UAAU,EACxD2E,EAAK,IAAI,OAAQjC,CAAM,EACvBzC,EAAgB0E,EAAM,CAAE,QAAS,EAAA,CAAO,CAC1C,EACA,CAAC3E,EAAcC,CAAe,CAAA,EAG1B2G,GAAavG,EAAM,YAAY,IAAM,CACzC,MAAMsE,EAAO,IAAI,gBAAgB3E,EAAa,UAAU,EACxD2E,EAAK,OAAO,MAAM,EAClB1E,EAAgB0E,EAAM,CAAE,QAAS,EAAA,CAAM,CACzC,EAAG,CAAC3E,EAAcC,CAAe,CAAC,EAE5B4G,EAAcxG,EAAM,QACxB,IAAOa,EAAe4E,EAAM5E,CAAY,EAAI,KAC5C,CAACA,EAAc4E,CAAK,CAAA,EAGhBgB,GAAUzG,EAAM,QAAQ,IAAM,CAClC,GAAI,CAACwG,EAAa,MAAO,CAAA,EACzB,MAAME,EAAQjH,EAAE,uBAAuB,EACvC,MAAO,CACL,CACE,IAAK,OACL,MAAOA,EAAE,sBAAsB,EAC/B,MAAO+G,EAAY,WAAA,EAErB,CACE,IAAK,aACL,MAAO/G,EAAE,4BAA4B,EACrC,MAAO+G,EAAY,YAAcE,CAAA,EAEnC,CACE,IAAK,SACL,MAAOjH,EAAE,wBAAwB,EACjC,MAAO+G,EAAY,QAAUE,CAAA,EAE/B,CACE,IAAK,YACL,MAAOjH,EAAE,2BAA2B,EACpC,MAAO+G,EAAY,WAAaE,CAAA,EAElC,CACE,IAAK,OACL,MAAOjH,EAAE,sBAAsB,EAC/B,MACEnC,EAAAA,KAAC,OAAA,CAAK,UAAU,gBACb,SAAA,CAAAkJ,EAAY,YACbjJ,EAAAA,IAAC,OAAA,CAAK,UAAU,gCACb,WAAY,QAAA,CACf,CAAA,CAAA,CACF,CAAA,EAGJ,CACE,IAAK,WACL,MAAOkC,EAAE,0BAA0B,EACnC,MAAO+G,EAAY,eAAiBE,CAAA,EAEtC,CACE,IAAK,OACL,MAAOjH,EAAE,sBAAsB,EAC/B,MAAO+G,EAAY,WAAaE,CAAA,EAElC,CACE,IAAK,OACL,MAAOjH,EAAE,sBAAsB,EAC/B,MAAO+G,EAAY,MAAQE,CAAA,EAE7B,CACE,IAAK,OACL,MAAOjH,EAAE,sBAAsB,EAC/B,MAAOlC,EAAAA,IAAC,OAAA,CAAK,UAAU,oBAAqB,WAAY,IAAA,CAAK,CAAA,CAC/D,CAEJ,EAAG,CAACiJ,EAAa/G,CAAC,CAAC,EAEbkH,GAAc1F,EAAUrC,GAAaqC,EAAQ,IAAI,EAAI,KACrD2F,GAAuB5G,EAAM,QACjC,IAAO6B,EAAcxC,GAAWwC,EAAY,WAAW,EAAI,KAC3D,CAACA,CAAW,CAAA,EAGd,OACEvE,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAC,MAACsJ,GAAA,CAAY,MAAO,CAAC,CAAE,MAAOpH,EAAE,eAAe,CAAA,CAAG,EAAG,EACrDnC,EAAAA,KAAC,UAAA,CAAQ,UAAU,4DACjB,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oEACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAC,MAAC,KAAA,CAAG,UAAU,yCACX,SAAAkC,EAAE,2BAA2B,EAChC,QACC,IAAA,CAAE,UAAU,yBACV,SAAAA,EAAE,iCAAiC,EACtC,EACAlC,MAAC,KAAE,UAAU,yBACV,cAAkB,EACfkC,EAAE,kBAAmB,CAAE,MAAOK,EAAM,MAAA,CAAQ,EAC5CL,EAAE,uBAAwB,CAAE,MAAOiD,EAAA,CAAe,CAAA,CACxD,CAAA,EACF,EACAnF,EAAAA,IAACuJ,EAAA,CACC,KAAK,SACL,QAAQ,UACR,UAAU,gEACV,SAAU/E,GACV,QAAS,IAAM,CACRY,GAAA,CACP,EAEC,SACGlD,EADHsC,GACK,+BACA,yBAD8B,CACL,CAAA,CACjC,EACF,EACCE,GACC1E,EAAAA,IAAC,IAAA,CAAE,UAAU,4BAA6B,YAAiB,EACzD,KACHsE,EACCvE,EAAAA,KAAC,MAAA,CAAI,UAAU,wCACb,SAAA,CAAAC,EAAAA,IAAC,IAAA,CACE,WAAE,8BAA+B,CAChC,KAAMqJ,IAAA,KAAAA,GAAwB,GAAA,CAC/B,EACH,EACArJ,EAAAA,IAAC,IAAA,CACE,SAAAkC,EAAE,+BAAgC,CACjC,MAAOoC,EAAY,SAAS,WAC5B,OAAQA,EAAY,SAAS,YAC7B,SAAUA,EAAY,SAAS,aAAA,CAChC,CAAA,CACH,CAAA,EACF,EAEAtE,MAAC,IAAA,CAAE,UAAU,8BACV,SAAAkC,EAAE,iCAAiC,CAAA,CACtC,CAAA,EAEJ,EACAnC,EAAAA,KAAC,UAAA,CAAQ,UAAU,+DACjB,SAAA,CAAAA,EAAAA,KAAC,SAAA,CAAO,UAAU,kDAChB,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,sBACb,SAAA,CAAAC,MAAC,KAAA,CAAG,UAAU,wCACX,SAAAkC,EAAE,eAAe,EACpB,EACAlC,EAAAA,IAAC,IAAA,CAAE,UAAU,gCACV,SAAAkC,EAAE,gBAAiB,CAAE,MAAOiF,EAAc,MAAA,CAAQ,CAAA,CACrD,CAAA,EACF,EACApH,EAAAA,KAAC,MAAA,CAAI,UAAU,qEACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAC,EAAAA,IAACwJ,GAAA,CACC,MAAO1G,EACP,SAAW7C,GAAU,CACnB8C,GAAU9C,EAAM,OAAO,KAAK,EAC5BkD,EAAa,CAAC,CAChB,EACA,aAAaxD,GAAAuC,EAAE,2BAA2B,IAA7B,KAAAvC,GAAkC,GAC/C,UAAU,UAAA,CAAA,EAEZI,EAAAA,KAAC,SAAA,CACC,MAAOiD,EACP,SAAW/C,GAAU,CACnBgD,GAAQhD,EAAM,OAAO,KAAmB,EACxCkD,EAAa,CAAC,CAChB,EACA,UAAU,gEAEV,SAAA,CAAAnD,MAAC,SAAA,CAAO,MAAM,gBACX,SAAAkC,EAAE,2BAA2B,EAChC,QACC,SAAA,CAAO,MAAM,eACX,SAAAA,EAAE,0BAA0B,EAC/B,QACC,SAAA,CAAO,MAAM,YAAa,SAAAA,EAAE,uBAAuB,EAAE,QACrD,SAAA,CAAO,MAAM,WAAY,SAAAA,EAAE,sBAAsB,CAAA,CAAE,CAAA,CAAA,CAAA,EAEtDlC,EAAAA,IAACuJ,EAAA,CACC,KAAK,SACL,QAAQ,YACR,QAAS,IAAM,KAAKvE,EAAA,EACpB,SAAUtC,EAET,WAAE,iBAAiB,CAAA,CAAA,CACtB,EACF,EACA1C,MAAC,OAAI,UAAU,2CACZ,WAAUkC,EAAE,SAAS,EAAI,IAAA,CAC5B,CAAA,CAAA,CACF,CAAA,EACF,EACAlC,EAAAA,IAACyJ,GAAA,CACC,QAASnK,GACP,CACE,KAAM4C,EAAE,sBAAsB,EAC9B,KAAMA,EAAE,sBAAsB,EAC9B,KAAMA,EAAE,sBAAsB,EAC9B,KAAMA,EAAE,sBAAsB,EAC9B,KAAMA,EAAE,sBAAsB,EAC9B,SAAUA,EAAE,0BAA0B,EACtC,SAAUA,EAAE,kBAAkB,EAC9B,OAAQA,EAAE,gBAAgB,EAC1B,cAAgBxD,GACdwD,EAAE,wBAAyB,CAAE,MAAAxD,EAAO,EACtC,YAAawD,EAAE,sBAAsB,EACrC,kBAAmBA,EAAE,4BAA4B,EACjD,aAAcA,EAAE,uBAAuB,EACvC,iBAAkBA,EAAE,2BAA2B,EAC/C,YAAaA,EAAE,sBAAsB,EACrC,cAAeA,EAAE,wBAAwB,CAAA,EAE3C,CACE,WAAY6G,GACZ,YAAarB,EACb,aAAA9D,CAAA,CACF,EAEF,KAAMiF,GACN,UAAA3F,EACA,SAAUhC,EACV,UAAA4H,GACA,aAAc3F,EACd,iBAAkB,GAClB,YAAa,GACb,kBAAiB,GACjB,WAAatD,GAAQ,CACnB,MAAMkH,EAAO,IAAI,gBAAgB3E,EAAa,UAAU,EACxD2E,EAAK,IAAI,OAAQlH,EAAI,EAAE,EACvBwC,EAAgB0E,EAAM,CAAE,QAAS,EAAA,CAAO,CAC1C,CAAA,CAAA,CACF,EACF,EACA/G,EAAAA,IAAC0J,IAAM,KAAM,EAAQtG,EAAa,QAAS4F,GACxC,SAAAxF,GACCxD,EAAAA,IAAC,OAAI,UAAU,gDACZ,WAAE,SAAS,CAAA,CACd,EACEiJ,EACFlJ,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAA,EAAAA,KAAC,SAAA,CAAO,UAAU,yCAChB,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,wBAAyB,SAAAiJ,EAAY,KAAK,EACxDjJ,MAAC,KAAE,UAAU,gCACV,WAAY,MAAQkC,EAAE,sBAAsB,CAAA,CAC/C,CAAA,EACF,EACAnC,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,EAAAA,KAACwJ,EAAA,CACC,KAAK,SACL,QAAQ,UACR,QAAS,IAAM5B,EAAesB,CAAW,EAEzC,SAAA,CAAAjJ,EAAAA,IAACvB,GAAA,CAAkB,UAAU,aAAA,CAAc,EAC1CyD,EAAE,kBAAkB,CAAA,CAAA,CAAA,EAEvBnC,EAAAA,KAACwJ,EAAA,CACC,KAAK,SACL,QAAQ,cACR,QAAS,IAAM3B,GAAaqB,CAAW,EAEvC,SAAA,CAAAjJ,EAAAA,IAACb,GAAA,CAAU,UAAU,aAAA,CAAc,EAClC+C,EAAE,gBAAgB,CAAA,CAAA,CAAA,CACrB,CAAA,CACF,CAAA,EACF,EACCwB,EACC3D,EAAAA,KAAC,MAAA,CAAI,UAAU,8DACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,gDACZ,SAAA,CAAAqJ,GAAcpJ,EAAAA,IAAC,cAAA,CAAY,UAAU,QAAA,CAAS,EAAK,KACpDA,EAAAA,IAAC,OAAA,CAAM,SAAAkC,EAAE,sBAAsB,CAAA,CAAE,EACjClC,EAAAA,IAAC,OAAA,CAAK,UAAU,gCACb,SAAAkC,EAAE,oBAAqB,CAAE,KAAMwB,EAAQ,IAAA,CAAM,CAAA,CAChD,CAAA,EACF,EACCA,EAAQ,OAAS,QAChB1D,EAAAA,IAAC,MAAA,CACC,IAAK0D,EAAQ,UACb,IAAKuF,EAAY,KACjB,UAAU,gDAAA,CAAA,EAEVvF,EAAQ,OAAS,QACnB1D,EAAAA,IAAC,QAAA,CACC,SAAQ,GACR,IAAK0D,EAAQ,UACb,UAAU,iCAAA,CAAA,EAEVA,EAAQ,OAAS,MACnB1D,EAAAA,IAAC,SAAA,CACC,MAAOiJ,EAAY,KACnB,IAAKvF,EAAQ,UACb,UAAU,6BAAA,CAAA,EAEVA,EAAQ,OAAS,OACnBA,EAAQ,QACN1D,EAAAA,IAAC,MAAA,CAAI,UAAU,gCACZ,SAAAkC,EAAE,wBAAwB,CAAA,CAC7B,EACEwB,EAAQ,MACV1D,EAAAA,IAAC,MAAA,CAAI,UAAU,uBAAwB,SAAA0D,EAAQ,MAAM,EAErD1D,EAAAA,IAAC,MAAA,CAAI,UAAU,2DACZ,SAAA0D,EAAQ,QACX,EAEA,IAAA,CAAA,CACN,EACE,KACJ3D,EAAAA,KAAC,UAAA,CAAQ,UAAU,YACjB,SAAA,CAAAC,MAAC,KAAA,CAAG,UAAU,wBACX,SAAAkC,EAAE,sBAAsB,EAC3B,EACAnC,EAAAA,KAAC,MAAA,CAAI,UAAU,kDACb,SAAA,CAAAA,EAAAA,KAAC,SAAA,CACC,MAAOkJ,EAAY,eACnB,SAAWhJ,GACTgJ,EAAY,aAAahJ,EAAM,OAAO,KAAK,EAE7C,SAAUgJ,EAAY,eAAiBrF,EACvC,UAAU,0JAEV,SAAA,CAAA5D,MAAC,SAAA,CAAO,MAAM,GAAI,SAAAkC,EAAE,4BAA4B,EAAE,EACjDwF,EAAqB,IAAKxH,GACzBF,EAAAA,IAAC,SAAA,CAA0B,MAAOE,EAAO,MACtC,SAAAA,EAAO,KAAA,EADGA,EAAO,KAEpB,CACD,CAAA,CAAA,CAAA,EAEHF,EAAAA,IAACuJ,EAAA,CACC,KAAK,SACL,QAAS,IAAMN,EAAY,SAAA,EAC3B,SAAUA,EAAY,eAErB,WAAY,cACT/G,EAAE,2BAA2B,EAC7BA,EAAE,uBAAuB,CAAA,CAAA,CAC/B,EACF,EACC0B,EACC5D,EAAAA,IAAC,IAAA,CAAE,UAAU,gCACV,SAAAkC,EAAE,wBAAwB,CAAA,CAC7B,EACEwF,EAAqB,SAAW,QACjC,IAAA,CAAE,UAAU,gCACV,SAAAxF,EAAE,sBAAsB,EAC3B,EACE,IAAA,EACN,EACAnC,EAAAA,KAAC,UAAA,CAAQ,UAAU,YACjB,SAAA,CAAAC,MAAC,KAAA,CAAG,UAAU,wBACX,SAAAkC,EAAE,uBAAuB,EAC5B,QACC,KAAA,CAAG,UAAU,4BACX,SAAAgH,GAAQ,IAAK3C,GACZxG,EAAAA,KAAC,MAAA,CAEC,UAAU,8CAEV,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,wDACX,SAAAuG,EAAK,MACR,EACAvG,EAAAA,IAAC,KAAA,CAAG,UAAU,eAAgB,WAAK,KAAA,CAAM,CAAA,CAAA,EANpCuG,EAAK,GAAA,CAQb,EACH,EACC0C,EAAY,OACXjJ,EAAAA,IAACuJ,EAAA,CACC,KAAK,SACL,QAAQ,QACR,QAAS,IAAMR,GAAeE,EAAY,MAAM,EAE/C,WAAE,0BAA0B,CAAA,CAAA,EAE7B,IAAA,CAAA,CACN,CAAA,CAAA,CACF,QAEC,MAAA,CAAI,UAAU,oCACZ,SAAA/G,EAAE,mBAAmB,EACxB,CAAA,CAEJ,CAAA,EACF,CAEJ","x_google_ignoreList":[0,1,2,3,4]}