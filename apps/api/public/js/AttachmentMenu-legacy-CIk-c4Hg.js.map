{"version":3,"file":"AttachmentMenu-legacy-CIk-c4Hg.js","sources":["../../../web/src/pages/AttachmentMenu.tsx"],"sourcesContent":["// Страница выбора задачи для Attachment Menu\n// Модули: React, useToast, authFetch, shared\nimport React, { useEffect, useState } from 'react';\nimport type { Task } from 'shared';\n\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '../context/useToast';\nimport authFetch from '../utils/authFetch';\n\ntype MenuTask = Task & { task_number: string; createdAt: string };\n\nexport default function AttachmentMenu() {\n  const [tasks, setTasks] = useState<MenuTask[]>([]);\n  const { addToast } = useToast();\n\n  useEffect(() => {\n    authFetch('/api/v1/tasks?limit=10', { noRedirect: true })\n      .then((r) => {\n        if (r.status === 401) {\n          addToast('Сессия истекла, войдите снова', 'error');\n          return [];\n        }\n        return r.ok ? r.json() : [];\n      })\n      .then((data) =>\n        setTasks((Array.isArray(data) ? data : data.tasks || []) as MenuTask[]),\n      );\n  }, [addToast]);\n\n  function select(id: string) {\n    type TelegramApi = {\n      WebApp?: {\n        sendData?: (data: string) => void;\n      };\n    };\n    const telegram = (\n      globalThis as typeof globalThis & { Telegram?: TelegramApi }\n    ).Telegram;\n    telegram?.WebApp?.sendData?.(`task_selected:${id}`);\n  }\n\n  return (\n    <div className=\"p-4\">\n      <h1 className=\"mb-4 text-lg\">Выберите задачу</h1>\n      <ul>\n        {tasks.map((t) => (\n          <li key={t._id} className=\"mb-2\">\n            <Button\n              onClick={() => select(t._id)}\n              variant=\"link\"\n              size=\"sm\"\n              className=\"px-0\"\n            >\n              {`${t.task_number} ${t.createdAt.slice(0, 10)} ${t.title}`}\n            </Button>\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n}\n"],"names":["_reactExports$useStat2","_slicedToArray","useState","tasks","setTasks","addToast","useToast","useEffect","authFetch","noRedirect","then","r","status","ok","json","data","Array","isArray","jsxs","className","children","jsx","map","t","Button","onClick","id","_id","telegram","globalThis","Telegram","_telegram$WebApp","WebApp","_telegram$WebApp$send","sendData","call","concat","variant","size","task_number","createdAt","slice","title"],"mappings":"+zCAWA,WACE,IAAiDA,EAAAC,EAAvBC,EAAAA,SAAqB,IAAE,GAA1CC,EAAAH,EAAA,GAAOI,EAAQJ,KACdK,EAAaC,IAAbD,SA4BR,OA1BAE,EAAAA,UAAU,WACRC,EAAU,yBAA0B,CAAEC,YAAY,IAC/CC,KAAK,SAACC,GACL,OAAiB,MAAbA,EAAEC,QACJP,EAAS,gCAAiC,SACnC,IAEFM,EAAEE,GAAKF,EAAEG,OAAS,EAC3B,GACCJ,KAAK,SAACK,UACLX,EAAUY,MAAMC,QAAQF,GAAQA,EAAOA,EAAKZ,OAAS,GAAiB,EAE5E,EAAG,CAACE,IAeFa,EAAAA,KAAC,MAAA,CAAIC,UAAU,MACbC,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAGF,UAAU,eAAeC,SAAA,oBAC7BC,EAAAA,IAAC,MACED,SAAAjB,EAAMmB,IAAI,SAACC,GAAA,OACVF,EAAAA,IAAC,KAAA,CAAeF,UAAU,OACxBC,SAAAC,EAAAA,IAACG,EAAA,CACCC,QAAS,WAAT,OAnBIC,EAmBkBH,EAAEI,SAVlCC,OAHMA,EACJC,WACAC,WACQ,QAAVC,EAAAH,EAAUI,cAAA,IAAAD,GAAQ,QAARE,EAAVF,EAAkBG,gBAAA,IAAAD,GAAlBA,EAAAE,KAAAJ,EAAA,iBAAAK,OAA8CV,KAThD,IAAgBA,EAAYK,EAAAE,EAMpBL,GAcIS,QAAQ,OACRC,KAAK,KACLnB,UAAU,OAETC,YAAAgB,OAAGb,EAAEgB,YAAW,KAAAH,OAAIb,EAAEiB,UAAUC,MAAM,EAAG,IAAG,KAAAL,OAAIb,EAAEmB,UAP9CnB,EAAEI,IAUZ,OAIT"}